"use strict";(window.webpackChunkweb=window.webpackChunkweb||[]).push([["95781"],{575550:function(e,t,r){let n,i,s,a,o,l,c,u,h,d,p,f,m,g,y,w,v,b,x,E,I;r.d(t,{W4:()=>tb,km:()=>tx,wN:()=>tE});var S=r(139378),k=r(465829);function N(e,t){let r=new URL(e);return Object.entries(t).forEach(([e,t])=>{if(null!==t)switch(typeof t){case"boolean":case"number":r.searchParams.append(e,t.toString());break;case"string":r.searchParams.append(e,t)}}),r.href}var _=r(398487),T=r(479117);let O=async()=>{let e=(0,k.iE)("passport");if(!e?.getCurUserInfo)throw new _.wd("passport","getCurUserInfo");(0,T.zV)(e.getCurUserInfo,"passportConfig.getCurUserInfo");let t=await e.getCurUserInfo();return(0,T.FF)(t.user,"userInfo.user"),(0,T.Cp)(t.user.avatarKey,"userInfo.user.avatarKey",{allowEmpty:!1}),(0,T.Cp)(t.user.avatarUrl,"userInfo.user.avatarUrl",{allowEmpty:!1}),(0,T.Cp)(t.user.geo,"userInfo.user.geo",{allowEmpty:!1}),(0,T.FF)(t.user.i18nNames,"userInfo.user.i18nNames",{nullable:!0}),t.user.i18nNames&&((0,T.Cp)(t.user.i18nNames?.["en-US"],"userInfo.user.i18nNames.en-US",{allowEmpty:!0}),(0,T.Cp)(t.user.i18nNames?.["ja-JP"],"userInfo.user.i18nNames.ja-JP",{allowEmpty:!0}),(0,T.Cp)(t.user.i18nNames?.["zh-CN"],"userInfo.user.i18nNames.zh-CN",{allowEmpty:!0})),(0,T.Cp)(t.user.id,"userInfo.user.id",{allowEmpty:!1}),(0,T.Cp)(t.user.name,"userInfo.user.id",{allowEmpty:!1}),(0,T.FF)(t.user.tenant,"userInfo.user.tenant",{nullable:!1}),(0,T.Cp)(t.user.tenant.id,"userInfo.user.tenant.id",{allowEmpty:!1}),(0,T.Cp)(t.user.tenant.name,"userInfo.user.tenant.name",{allowEmpty:!1}),(0,T.lt)(t.user.tenant.tenantBrand,"userInfo.user.tenant.tenantBrand",["feishu","lark"]),(0,T.Cp)(t.user.unit,"userInfo.user.unit"),(0,T.mE)(t.user.tenant.tenantTag,"userInfo.user.tenant.tenantTag"),t},$=()=>{let e=(0,k.iE)("passport");if(!e?.userId)throw new _.wd("passport","userId");return(0,T.Cp)(e?.userId,"passportConfig.userId"),e.userId};function C(){return{getSpaces:()=>["larkapi",$()]}}function R(e,t){return e&&t.getSpaces()[1]===e}function A(e,t){let r=!1;if(e.length===t.length){r=!0;for(let n=0;n<e.length;n++)if(e[n]!==t[n]){r=!1;break}}return r}function L(e,t=""){return function(r,n){return async function(...n){try{return await r.call(this,...n)}catch(r){throw e.error(r,t),r}}}}function P(e){(0,T.Cp)(e,"partition",{allowEmpty:!1})}function D(e){(0,T.IL)(e,"keys"),e.forEach(e=>{(0,T.Cp)(e,"key",{allowEmpty:!1})})}let j={debug:2,info:3,warn:4,error:5},M="_lark_context_id_",F=/[\u4e00-\u9fa5]+/g,U=[new class{#e=1;#t=!1;#r;#n;#i;#s=!1;#a=-1;constructor(e,t,r="[zh]"){(0,T.mE)(t,"intervalCount",{min:1}),(0,T.mE)(e,"intervalTime",{min:1}),this.#n=e||1e3,this.#r=t||100,this.#i=r,this.#o()}check(e){if(-1===this.#a&&this.#l(),this.#c()){let t=e;return F.lastIndex=0,F.test(e)&&(t=e.replace(F,this.#i)),this.#u(),t}return this.#h(),e}#h(){this.#e++,this.#e>=this.#r&&(this.#t=!0)}#u(){this.#d(),this.#o()}#o(){this.#e=1,this.#t=this.#e>=this.#r}#d(){this.#s=!1,-1!==this.#a&&(this.#a>0&&clearTimeout(this.#a),this.#l())}#c(){return this.#t||this.#s}#l(){this.#a=setTimeout(()=>{this.#a=0,this.#s=!0},this.#n)}}(400,10,"[zh]")],B={runtime:()=>globalThis.DedicatedWorkerGlobalScope&&globalThis instanceof DedicatedWorkerGlobalScope?"webworker":globalThis.SharedWorkerGlobalScope&&globalThis instanceof SharedWorkerGlobalScope?"sharedworker":"web"},W=new Proxy({},{get:(e,t)=>t in B?B[t]():t in((0,k.iE)("env")||{})?(0,k.iE)("env")?.[t]:void 0});function H(e,t){let r=console;(r[e]||r.log)(t)}let V=(e,t)=>{let{traceName:r,tracerId:n,scope:i,eventType:s}=t;if(!r.trim())return e.error("[LogTracer] trace error: missing traceName field"),"";let a=`[LogTracer][tracerId=${n}][scope=${i}]`;return a+`[traceName=${r}][type=${s}]`},K=new class{log=e=>{let t=function(e,t,r,n){let i=[];e.forEach(e=>i.push(`[${e}]`)),t.forEach(e=>i.push(`[${e}]`));let s=Object.keys(n).filter(e=>n[e]).map(e=>`${e}=${n[e]}`).concat("").join(",");return`${i.join("")}: ${s}${r}`}(e.context,e.namespaces,e.message,e.prefix);!function(e,t){if(!W.isDev)return;let r=function(){let e=W.logFilter;return"string"==typeof e?e:""}();r.trim()?e.message.includes(r)&&H(e.level,t):H(e.level,t)}(e,t)}};async function z(){try{return(await indexedDB.databases()).filter(e=>!!e.name).map(e=>e.name)}catch(e){return[]}}function G(e,t){return"number"==typeof e&&e>0?e:t}class q{#p;#f="stopped";#m;#g;constructor(e,t){this.#m=e,this.#p=t}start(){"started"!==this.#f&&(this.#f="started",this.#l())}stop(){"stopped"!==this.#f&&(this.#y(),this.#f="stopped")}#l=()=>{this.#y(),this.#g=setTimeout(async()=>{try{this.#g=void 0,await this.#p()}catch(e){}finally{this.#l()}},this.#m)};#y=()=>{this.#g&&(clearTimeout(this.#g),this.#g=void 0)}}class J{#w;#v=null;#b;#x=!1;constructor(e){this.#E(e),this.#b=e,this.#w=!1}hasNext(){return!this.#w}async next(e){(0,T.mE)(e,"count",{min:1});let t=[];if(this.#w)return t;if(this.#x)throw new _.I1(`traverser.next(${e})`,"Please wait for next() before calling next() again");return this.#x=!0,(t=this.#v?await this.#I(e):await this.#S(e)).length<e&&(this.#w=!0),this.#x=!1,t}#E(e){let{db:t,storeName:r,startTime:n,endTime:i}=e;if((0,T.FF)(t,"options.db"),(0,T.Cp)(r,"options.storeName",{allowEmpty:!1}),n>=i)throw new _.WR("options.startTime",n,`startTime(${n}) should less than endTime(${i})`)}#I(e){return new Promise((t,r)=>{let n=[];this.#k(t=>{let{direction:r}=this.#b,i="prev"===r?IDBKeyRange.upperBound(this.#v,!0):IDBKeyRange.lowerBound(this.#v,!0),s=t.openCursor(i,r);s.onsuccess=()=>{let t=s.result;if(t){this.#v=t.primaryKey;let r=t.value;this.#N(r)&&(n.push(t.value),n.length<e&&t.continue())}}},()=>{t(n)},e=>{r(e)})})}#S(e){return new Promise((t,r)=>{let n=[];this.#k(t=>{let r=t.index("date"),{startTime:i,endTime:s,direction:a}=this.#b,o=IDBKeyRange.bound(i,s,!1,!1),l=r.openCursor(o,a);l.onsuccess=()=>{let t=l.result;t&&(this.#v=t.primaryKey,n.push(t.value),n.length<e&&t.continue())}},()=>{t(n)},e=>{r(e)})})}#N(e){let{startTime:t,endTime:r}=this.#b;return e?.date<=r&&e?.date>=t}#k(e,t,r){let{db:n,storeName:i}=this.#b,s=n.transaction(i,"readonly");s.oncomplete=()=>{t()},s.onerror=()=>{r(s.error)},e(s.objectStore(i))}}class Z{#w=!1;#_=null;constructor(e){this.#_=function(e){let t=null,r=null;for(let n of e){let e={value:n,next:null};if(!t){r=t=e;continue}r&&(r.next=e,r=r.next)}return t}(e),this.#_||(this.#w=!0)}hasNext(){return!this.#w}async next(e){let t=this.#_,r=[];if(this.#w)return r;for(;r.length<e&&t?.value&&((await t.value.next(e-r.length)).forEach(e=>r.push(e)),r.length<e&&(t=t.next),t););return this.#_=t,r.length<e&&(this.#w=!0),r}}class Q{#T;#O;#$=[];#C=!1;#R;#A=null;#L;#P=new Map;#D;#j;#M=!1;constructor(e){this.#R=e.dbName,this.#D=e.storeName,this.#j=!!e.useCache,this.#T=e.cacheCount,this.#O=e.cacheInterval,this.#L=new Promise(t=>{try{let r=indexedDB.open(this.#R);r.onsuccess=()=>{t(r.result),this.#F("init-success")},r.onupgradeneeded=()=>{let t=r.result;if(!t.objectStoreNames.contains(this.#D)){let r=t.createObjectStore(this.#D,{autoIncrement:!0});e.indexes.forEach(e=>r.createIndex(e.indexName,e.keyPath,{unique:e.unique}))}},r.onerror=()=>{t(null),this.#F("init-error")},r.onblocked=()=>{t(null),this.#F("init-error")}}catch(e){t(null)}}),this.#A=new q(this.#O,async()=>{if(this.#C)return void this.#U();await this.#B()})}async close(){if(this.#C)return;this.#U();let e=await this.#L;e&&(e.close(),this.#C=!0,this.#F("closed"),this.#P=new Map)}async flush(){await this.#B()}async getTraverser(e){let t=await this.#L;return!t||this.#C?null:new J({...e,db:t,storeName:this.#D})}observe(e,t){this.#P.set(e,t)}async save(e){if(await this.#L&&!this.#C){if(this.#$.push(e),!this.#j)return void this.#B();this.#W(),this.#$.length>=this.#T&&this.#B()}}#F(e){if(this.#C)return;let t=this.#P.get(e);if(t)try{t()}catch(e){}}async #H(){let e=await this.#L;if(e)return new Promise((t,r)=>{if(0===this.#$.length)return t(void 0);try{let n=e.transaction(this.#D,"readwrite");n.oncomplete=()=>{this.#F("flushed"),t(void 0)},n.onabort=()=>{r(Error("Transaction AbortError"))},n.onerror=e=>{let t=n.error||Error("Transaction failed");this.#$=[],r(t)};let i=n.objectStore(this.#D),s=this.#$;this.#$=[],s.forEach(e=>{i.add(e)})}catch(e){this.#$=[],r(e)}})}#W(){this.#A&&this.#A.start()}#U(){this.#A&&(this.#A.stop(),this.#A=null)}async #B(){if(!this.#M){this.#M=!0;try{await this.#H()}catch(e){}this.#M=!1}}}class Y{#V=!1;#C=!1;#K=new Map;#P=new Map;#b;constructor(e){this.#b=e}close=()=>{for(let[e,t]of(this.#C=!0,this.#P=new Map,this.#K.entries()))this.#K.delete(e),t.close()};flush=async()=>{if(this.#C)return;let e=this.#z(new Date);await e.flush()};getTraverser=async e=>{if(this.#C)return null;let{startTime:t,endTime:r}=e,n=await this.#b.dbNameHandler.filterDatabaseNames(t,r);if(!n.length)return null;let i=n.map(e=>this.#G(e)).filter(e=>!!e),s=(await Promise.all(i.map(t=>t.getTraverser(e)))).filter(e=>!!e);return s.length?("prev"===e.direction&&s.reverse(),new Z(s)):null};log=async e=>{if(this.#C)return;this.#V||this.#q();let t=this.#z(e.date);await t.save(e)};observe=(e,t)=>{this.#P.set(e,t)};#J=async()=>{try{let e=await this.#b.dbNameHandler.filterExpireDatabaseNames(new Date);await Promise.all(e.map(e=>this.#Z(e))),this.#F("clear-expired")}catch(e){}};#Z=e=>new Promise(async(t,r)=>{let n=this.#K.get(e);n&&(await n.close(),this.#K.delete(e)),new Promise(t=>{let r=indexedDB.deleteDatabase(e);r.onsuccess=()=>{t(!0)},r.onerror=()=>{t(!1)},r.onblocked=()=>{t(!1)}}).then(e=>{t(e)}).catch(e=>{r(e)})});#F=e=>{let t=this.#P.get(e);if(t)try{t()}catch(e){}};#G=e=>{let t=this.#K.get(e);if(t)return t;let r=new Q({dbName:e,indexes:this.#b.indexes,storeName:this.#b.storeName,useCache:this.#b.useCache,cacheCount:G(this.#b.cacheCount,1e3),cacheInterval:G(this.#b.cacheInterval,1e3)});return this.#K.set(e,r),r.observe("flushed",()=>this.#F("flushed")),r};#z=e=>{let t=this.#b.dbNameHandler.getDatabaseName(e);return this.#G(t)};#q=()=>{this.#V||(this.#V=!0,setTimeout(()=>this.#J(),this.#b.expiredCheckFirstMs),setInterval(()=>this.#J(),this.#b.expiredCheckIntervalMs))}}let X=new Y({dbNameHandler:new class{#b;constructor(e){this.#E(e),this.#b=e}filterDatabaseNames=async(e,t)=>(await this.#Q()).filter(r=>this.#Y(r,e,t)).sort((e,t)=>{let r=this.#X(e),n=this.#X(t);return r&&n?r?.getTime()-n?.getTime():0});filterExpireDatabaseNames=async e=>(await this.#Q()).filter(t=>this.#ee(t,e));getDatabaseName=e=>{let t=[e.getFullYear(),e.getMonth()+1],{granularity:r,dateDelimiter:n,delimiter:i,prefix:s,suffix:a}=this.#b;do{if(t.push(e.getDate()),"day"===r||(t.push(e.getHours()),"hour"===r)||(t.push(e.getMinutes()),"minute"===r)||(t.push(e.getSeconds()),"second"===r))break;throw new _.WR("granularity",r,"is not supported.")}while(!1);let o=[s,t.join(n)];return a&&o.push(a),o.join(i)};#E(e){let{granularity:t}=e;(0,T.lt)(t,"granularity",["day","hour","minute","second"],{optional:!1})}#Q=async()=>{let e=await this.#b.getAllNames(),{prefix:t,delimiter:r}=this.#b;return e.filter(e=>e.startsWith(`${t}${r}`))};#et=e=>{let t=this.#X(e);if(!t)return null;var r=this.#b.granularity;let n=new Date(t.getTime()),i=null;switch(r){case"day":n.setHours(0,0,0,0),i=new Date(n.getTime()+864e5-1);break;case"hour":n.setMinutes(0,0,0),i=new Date(n.getTime()+36e5-1);break;case"minute":n.setSeconds(0,0),i=new Date(n.getTime()+6e4-1);break;case"second":n.setMilliseconds(0),i=new Date(n.getTime()+1e3-1);break;default:throw new _.WR("granularity",r,"is not supported.")}return{start:n,end:i}};#ee=(e,t)=>{let r=this.#et(e);if(!r)return!1;let{granularity:n,expireUnitCount:i}=this.#b,s=0;switch(n){case"day":s=864e5*i;break;case"hour":s=36e5*i;break;case"minute":s=6e4*i;break;case"second":s=1e3*i;break;default:throw new _.WR("granularity",n,"is not supported.")}let{end:a}=r;return a.getTime()<=t.getTime()-s};#Y=(e,t,r)=>{let n=this.#et(e);if(!n)return!1;let{start:i,end:s}={start:t,end:r},{start:a,end:o}=n;return!(s<i)&&!(o<a)&&(i<a?s>a:i<o)};#X=e=>{let{delimiter:t,dateDelimiter:r}=this.#b,n=e.split(t)[1];if(!n)return null;let i=n.split(r),s=[];for(let e of i){let t=Number(e);if(e&&!Number.isNaN(t)){s.push(t);continue}return null}if(![["day",3],["hour",4],["minute",5],["second",6]].some(e=>{let t,r;return t=e[0],r=e[1],this.#b.granularity===t&&i.length===r}))return null;let[a,o,l,c,u,h]=s;return new Date(a,o-1,l,c??0,u??0,h??0)}}({dateDelimiter:"_",delimiter:"||",expireUnitCount:5,getAllNames:z,granularity:"day",prefix:"lark_api_log",suffix:""}),indexes:[{keyPath:"date",indexName:"date",unique:!1},{keyPath:"level",indexName:"level",unique:!1}],storeName:"logs",expiredCheckFirstMs:5e3,expiredCheckIntervalMs:432e6,useCache:!0,cacheCount:1e3,cacheInterval:1e3});class ee{#er=!1;#en=[];#ei;#es;#ea;#eo;#el;#ec;#eu=10;#eh;constructor(e){this.#er=e.analyzeStackContextId,this.#en=function(){let e=[],t=W.runtime;return e.push(t),e.push(function(e){if(!e)return"web";switch(e){case"web":if(globalThis?.location?.href){let e=location.href.match(/^https?:\/\/[0-9a-zA-Z.-]+(\/next\/|\/)((?<name1>[a-z]+$)|(?<name2>[a-z]+)\/.*$)/);return e?.groups?.name1??e?.groups?.name2??"unknown"}return"unknown";case"webworker":case"sharedworker":return globalThis?.name||"unknown";default:throw Error(`runtime '${e}' is not supported.`)}}(t)),e}(),this.#es=e.handlerSet,this.#ea=e.module,this.#eo=[...e.namespaces],this.#eu=e.stackTraceLimit,this.#el=e.persist,this.#ec=e.printToConsole,this.#ei=e.delegate,this.#eh=e.validators}debug=(...e)=>{this.#ed("debug",e)};error=(...e)=>{this.#ed("error",e)};extractContextId=()=>this.#er?(e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=e;let{stack:r}=Error();Error.stackTraceLimit=t;let n="";if(r){let e=r.lastIndexOf(M);if(-1!==e){let t=r.substring(e),i=M.length,s=t.indexOf(" ");n=t.substring(i,s)}}return n})(this.#eu):"";getContext=()=>this.#en;getNamespaces=()=>this.#eo;getPersistHandler=()=>this.#es.persistHandler;info=(...e)=>{this.#ed("info",e)};warn=(...e)=>{this.#ed("warn",e)};#ep(e,t){return{level:e,context:this.#en,namespaces:this.#eo,message:t.map(e=>(function(e){let t="";try{var r;let n;t=!function(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object DOMError]":case"[object DOMException]":return!0;default:return e instanceof Error}}(e)?"object"==typeof e&&null!==e?function(e){try{return Object.prototype.toString.call(e)}catch(e){return"[Object]"}}(e):String(e):(r=e,(n=Object.getOwnPropertyNames(r)).length||(n=["code","name","message"]),JSON.stringify(r,n,2).replace(/\\n/g,"\n"))}catch(e){t="[format_error]"}finally{return t}})(e)).join(" "),date:new Date,module:this.#ea,prefix:this.#ef()}}#ef(){let e={};return this.#er&&(e.contextId=this.extractContextId()),e}#ed(e,t){try{var r;let n=this.#ep(e,t);if(n.message=this.#em(n.message),!1!==this.#ec&&this.#es.devToolsHandler.log(n),r=n.level,!(j[function(){let e=new Set(["debug","info","warn","error"]),t=W.logLevel;return t&&e.has(t)?t:"info"}()]<=j[r]))return;!1!==this.#el&&this.#es.persistHandler.log(n),this.#ei?.log(n)}catch(e){}}#em(e){let t=e;return this.#eh.forEach(e=>{t=e.check(t)}),t}}function et(e,t,r,n){let i={devToolsHandler:n?.devToolsHandler??K,persistHandler:n?.persistHandler??X};return new ee({analyzeStackContextId:e.analyzeStackContextId??!1,delegate:e.delegate,handlerSet:i,module:r,namespaces:e.namespaces,persist:void 0===e.persist?"default":e.persist,printToConsole:void 0===e.printToConsole?"dev-only":e.printToConsole,stackTraceLimit:e.stackTraceLimit??10,validators:t})}class er{#b;constructor(e){this.#b=e}begin(e,...t){(0,T.Cp)(e,"traceName");let{logger:r,scope:n,tracerId:i}=this.#b,s=V(r,{scope:n,tracerId:i,traceName:e,eventType:"begin"});return r.info(s,...t),new en({...this.#b,traceName:e})}}class en{#eg;#b;#ey;constructor(e){this.#b=e,this.#eg=this.#ew("end"),this.#ey=this.#ew("scatter")}debug(...e){this.#b.logger.debug(this.#ey,...e)}end(...e){let{logger:t}=this.#b;t.info(this.#eg,...e)}error(...e){this.#b.logger.error(this.#ey,...e)}info(...e){this.#b.logger.info(this.#ey,...e)}warn(...e){this.#b.logger.warn(this.#ey,...e)}#ew(e){let{logger:t,scope:r,traceName:n,tracerId:i}=this.#b;return V(t,{scope:r,tracerId:i,traceName:n,eventType:e})}}let ei=e=>{(0,T.FF)(e,"options"),(0,T.IL)(e.namespaces,"options.namespaces"),(0,T.US)(e.analyzeStackContextId,"options.analyzeStackContextId",{optional:!0}),(0,T.FF)(e.delegate,"options.delegate",{optional:!0}),(0,T.zV)(e.delegate?.log,"options.delegate.log",{optional:!0}),(0,T.mE)(e.stackTraceLimit,"options.stackTraceLimit",{optional:!0})},es=e=>(ei(e),et(e,U,"lark-api-logger")),ea=e=>{var t;ei(e),(0,T.Cp)(e.scope,"options.scope",{optional:!0}),(0,T.Cp)(e.tracerId,"options.tracerId",{optional:!0});return new er({logger:et({namespaces:e.namespaces??["NamespacedTracer"],delegate:e.delegate},U,"lark-api-tracer"),scope:e.scope??"defaultScope",tracerId:e.tracerId??(t=0,[...Array(8)].map(()=>Math.floor(36*Math.random()).toString(36)).join(""))})},eo=es({namespaces:["larkapi","storage","sync"]});class el{#ev;#eb=null;#ex;#eE;#eI;#eS;#ek;constructor(e){var t;this.#E(e);let{partition:r,expireHours:n,spaceDelegate:i,storage:s}=e;this.#eE=r,this.#ev=n,this.#eS=i,this.#ek=s,this.#ex=[...i.getSpaces()],this.#eI=(t=this.#eE,[...this.#ex,t].join("/")),this.#eb=e.logger||null}clear(){this.#eN("clear()"),this.#e_().forEach(e=>this.#ek.removeItem(e))}getAllKeys(){this.#eN("getAllKeys()");let e=this.#e_();if(!this.#eT())return e.map(e=>this.#eO(e));let{reserved:t}=this.#e$(e);return t.map(e=>this.#eO(e))}getItem(e){let t=this.#eC([e],!1);return t.length?t[0].value:null}getItems(e){return this.#eC(e,!0)}hasItem(e){return this.#eR([e],!1)[0]}hasItems(e){return this.#eR(e,!0)}removeItem(e){this.#eA([e],!1)}removeItems(e){this.#eA(e,!0)}setItem(e,t){this.#eL([{key:e,value:t}],!1)}setItems(e){this.#eL(e,!0)}#E(e){let{partition:t,expireHours:r}=e;if("string"!=typeof t||""===t.trim()){let e=new _.WR("partition",t,"should not be empty.");throw this.#eb?.error(e.toString()),e}if(r<-1||!(0,S.isInteger)(r)||0===r){let e=new _.WR("expireHours",r,"should be -1 or value that is greater than 0");throw this.#eb?.error(e.toString()),e}}#eN(e){let t=this.#eS.getSpaces();if(!A(this.#ex,t)){let r=new _.nb("checkSpaces()",`currentSpace=${t}, originSpaces=${this.#ex}, when ${e} is called.`);throw this.#eb?.error(r.toString()),r}}#eC(e,t){D(e);let r=`getItem${t?"s":""}`;return this.#eN(`${r}(${e})`),e.map(e=>({key:e,value:(e=>{let t=this.#eP(e),r=this.#ek.getItem(t);if(!r)return null;try{let e=JSON.parse(r);if(!this.#eT())return e.value;if(this.#eD(t,e))return null;return e.lastTime=Date.now(),this.#ek.setItem(t,JSON.stringify(e)),e.value}catch(e){return null}})(e)}))}#e_(){let e=[];for(let t=0;t<this.#ek.length;t++){let r=this.#ek.key(t);if(!r)continue;let n=this.#eI+"/";r.startsWith(n)&&e.push(r)}return e}#eO(e){let t=this.#eI+"/";return e.slice(t.length)}#eP(e){return this.#eI+"/"+e}#eR(e,t){D(e);let r=`hasItem${t?"s":""}`;return this.#eN(`${r}(${e})`),e.map(e=>{let t=this.#eP(e),r=this.#ek.getItem(t);if(!r)return!1;if(!this.#eT())return!0;try{let e=JSON.parse(r);return!this.#eD(t,e)}catch(e){return!1}})}#e$(e){let t=[],r=[];return e.forEach(e=>{this.#eD(e)?t.push(e):r.push(e)}),{removed:t,reserved:r}}#eA(e,t){D(e);let r=`removeItem${t?"s":""}`;this.#eN(`${r}(${e})`),e.forEach(e=>{this.#ek.removeItem(this.#eP(e))})}#eD(e,t){var r,n;if(!t){let r=this.#ek.getItem(e);if(!r)return!0;try{t=JSON.parse(r)}catch(e){return!0}}return r=t.lastTime,n=this.#ev,!!(Date.now()-r>36e5*n)&&(this.#ek.removeItem(e),!0)}#eL(e,t){(0,T.IL)(e,"options");let r=`setItem${t?"s":""}`,n=[];e.forEach(({key:e})=>{if(!e?.trim()){let t=new _.WR("key",e,`should not be empty when call ${r}().`);throw this.#eb?.error(t.toString()),t}n.push(e)}),this.#eN(`${r}(${n})`),e.forEach(({key:e,value:t})=>{this.#ek.setItem(this.#eP(e),JSON.stringify({value:t,lastTime:Date.now()}))})}#eT(){return -1!==this.#ev}}let ec="lastTime";function eu(e,t){return -1!==t&&(Date.now()-e.getTime())/1e3>t}function eh(e,t){return new Promise((r,n)=>{let i=e.delete(t);i.onsuccess=()=>r(),i.onerror=()=>n(i.error)})}function ed(e,t){return new Promise((r,n)=>{let i=e.get(t);i.onsuccess=()=>r(i.result),i.onerror=()=>n(i.error)})}function ep(){}var ef=r(127759);let em=(0,_.j7)(ef.c.storageBatchFailed,(e,t)=>{let r=`Failed batch storage for module: "${e}"`;return t&&(r+=`, ${t}`),r},Error);class eg extends em{detail;constructor(e,t){super("storage",t),this.detail=e}}let ey=()=>void 0!==globalThis.navigator.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1,ew=ea({namespaces:["LarkAPI","tea","sdk"]}),ev=new Date().getTimezoneOffset(),eb=parseInt(`${-ev/60}`,10),ex=60*ev;class eE{#ej;#eM;constructor(e){this.#eM=e;let t=(()=>{let e=globalThis.navigator.appVersion,t=globalThis?.document?.referrer,r=t?t.split("/")?.[2]:"",n=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(e)?"wap":"web",i=(()=>{let e,t=globalThis.navigator.userAgent,r=globalThis.navigator.appVersion,n=`${parseFloat(r)}`,i=(e=>{let t={};if(-1!==e.indexOf("Edge")||-1!==e.indexOf("Edg")){t.browser="Microsoft Edge";let r=e.includes("Edge");t.versionOffset=e.indexOf(r?"Edge":"Edg"),t.browserVersion=e.substring(t.versionOffset+(r?5:4))}return t.browser?t:null})(t)||(e=>{let t={};return -1!==(t.versionOffset=e.indexOf("MSIE"))&&(t.browser="Microsoft Internet Explorer",t.browserVersion=e.substring(t.versionOffset+5)),t.browser?t:null})(t)||(e=>{let t={};return -1!==(t.versionOffset=e.indexOf("Lark"))&&(t.browser="Lark",t.browserVersion=e.substring(t.versionOffset+5,t.versionOffset+11)),t.browser?t:null})(t)||(e=>{let t={};return -1!==(t.versionOffset=e.indexOf("MetaSr"))&&(t.browser="sogoubrowser",t.browserVersion=e.substring(t.versionOffset+7,t.versionOffset+10)),t.browser?t:null})(t)||(e=>{let t={};return e.includes("QQ")&&(t.browser="qqbrowser",-1!==(t.versionOffset=e.indexOf("MQQBrowser"))?t.browserVersion=e.substring(t.versionOffset+11,t.versionOffset+15):-1!==(t.versionOffset=e.indexOf("QQBrowser"))?t.browserVersion=e.substring(t.versionOffset+10,t.versionOffset+17):-1!==(t.versionOffset=e.indexOf("QQ"))&&(t.browserVersion=e.substring(t.versionOffset+3,t.versionOffset+8))),t.browser?t:null})(t)||(e=>{let t={};return -1!==e.indexOf("Chrome")&&(-1!==(t.versionOffset=e.indexOf("MicroMessenger"))?(t.browser="weixin",t.browserVersion=e.substring(t.versionOffset+15,t.versionOffset+20)):-1!==(t.versionOffset=e.indexOf("360"))?(t.browser="360browser",t.browserVersion=e.substring(e.indexOf("Chrome")+7)):-1!==e.indexOf("baidubrowser")||-1!==e.indexOf("BIDUBrowser")?(-1!==e.indexOf("baidubrowser")&&(t.versionOffset=e.indexOf("baidubrowser"),t.browserVersion=e.substring(t.versionOffset+13,t.versionOffset+16)),t.browser="baidubrowser"):-1!==(t.versionOffset=e.indexOf("xiaomi"))?(t.browser="xiaomi",t.browserVersion=e.substring(t.versionOffset-7,t.versionOffset-1)):-1!==(t.versionOffset=e.indexOf("TTWebView"))?(t.browser="TTWebView",t.browserVersion=e.substring(t.versionOffset+10,t.versionOffset+23)):-1!==(t.versionOffset=e.indexOf("Chrome"))&&(t.browser="Chrome",t.browserVersion=e.substring(t.versionOffset+7))),t.browser?t:null})(t)||(e=>{let t={};return -1!==(t.versionOffset=e.indexOf("Safari"))&&(t.browser="Safari",t.browserVersion=e.substring(t.versionOffset+7),-1!==(t.versionOffset=e.indexOf("Version"))&&(t.browserVersion=e.substring(t.versionOffset+8))),t.browser?t:null})(t)||(e=>{let t={};return -1!==(t.versionOffset=e.indexOf("Firefox"))&&(t.browser="Firefox",t.browserVersion=e.substring(t.versionOffset+8)),t.browser?t:null})(t)||(e=>{let t={};return -1!==(t.versionOffset=e.indexOf("MicroMessenger"))&&(t.browser="weixin",t.browserVersion=e.substring(t.versionOffset+15,t.versionOffset+20)),t.browser?t:null})(t)||(e=>{let t={};return -1!==(t.versionOffset=e.indexOf("Opera"))&&(t.browser="Opera",t.browserVersion=e.substring(t.versionOffset+6),-1!==(t.versionOffset=e.indexOf("Version"))&&(t.browserVersion=e.substring(t.versionOffset+8))),t.browser?t:null})(t),s=i?.browser;return -1!==(e=(n=i?.browserVersion||"").indexOf(";"))&&(n=n.substring(0,e)),-1!==(e=n.indexOf(" "))&&(n=n.substring(0,e)),-1!==(e=n.indexOf(")"))&&(n=n.substring(0,e)),{browser:s,browserVersion:n}})(),s=(()=>{let e=globalThis.navigator.userAgent,t=globalThis.navigator.appVersion,r="",n="";for(let t of[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"OpenHarmony",r:/Harmony/}])if(t.r.test(e)){"Mac OS X"===(r=t.s)&&ey()&&(r="iOS");break}let i=(e,t)=>{let r=e.exec(t);return r?.[1]?r[1]:""},s=(e,t)=>{let r=RegExp(`(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:${e})`,"i").exec(t);return r?r.slice(1)[0]:""};switch(/Windows/.test(r)&&(n=i(/Windows (.*)/,r),r="windows"),r){case"Mac OS X":n=s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",e),r="mac";break;case"Android":let a;(a=i(/Android ([\.\_\d]+)/,e))||(a=i(/Android\/([\.\_\d]+)/,e)),n=a,r="android";break;case"iOS":n=ey()?s("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",e):(n=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))?"":`${n[1]}.${n[2]}.${0|n[3]}`,r="ios";break;case"OpenHarmony":let o;(o=i(/OpenHarmony\s*([\d\.]+)/,e))||(o=i(/OpenHarmony\s*([\d\.]+)/,e)),n=o,r="OpenHarmony"}return{os_name:r,os_version:n}})();return{browser:i.browser,browser_version:i.browserVersion,platform:n,os_name:s.os_name,os_version:s.os_version,userAgent:globalThis.navigator.userAgent,screen_width:globalThis?.screen&&globalThis.screen.width,screen_height:globalThis?.screen&&globalThis.screen.height,device_model:(e=>{let t="";try{if("android"===e)navigator.userAgent.split(";").forEach(function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))});else if("ios"===e||"mac"===e||"windows"===e)if(ey())t="iPad";else{let e=navigator.userAgent.replace("Mozilla/5.0 (",""),r=e.indexOf(";");t=e.slice(0,r)}}catch(e){}return t.trim()})(s.os_name),language:globalThis.navigator.language,referrer:t,referrer_host:r}})();this.#ej={user:{user_unique_id:void 0,device_id:void 0,web_id:void 0},header:{app_id:e.app_id,app_name:void 0,app_version:void 0,os_name:t.os_name,os_version:t.os_version,device_model:t.device_model,language:t.language,platform:t.platform,sdk_version:"5.1.5",timezone:eb,tz_offset:ex,resolution:`${t.screen_width}x${t.screen_height}`,browser:t.browser,browser_version:t.browser_version,referrer:t.referrer,referrer_host:t.referrer_host,screen_width:t.screen_width,screen_height:t.screen_height,custom:{}}}}get(){try{return JSON.parse(JSON.stringify(this.#ej))}catch(e){ew.begin("config-get",`get env_info from config error: ${e}`)}}getDomain(){return this.#eM.channel_domain||""}getUrl(){return`${this.getDomain()}/list`}set(e){Object.keys(e).forEach(t=>{let r="",n="";if(t.indexOf(".")>-1){let e=t.split(".");r=e[0],n=e[1]}r?"user"===r||"header"===r?this.#ej[r][n]=e[t]:this.#ej.header.custom[n]=e[t]:Object.hasOwnProperty.call(this.#ej.user,t)?this.#ej.user[t]=e[t]?String(e[t]):e[t]:Object.hasOwnProperty.call(this.#ej.header,t)?this.#ej.header[t]=e[t]:this.#ej.header.custom[t]=e[t]})}}let eI={Ready:"ready",Destroy:"destroy",DestroyOver:"destroy-over",Event:"event",SubmitSuccess:"submit-success",SubmitError:"submit-error"};async function eS(e,t,r){let n,{interceptor:i,logger:s,retryInterval:a=1e3,timeout:o=5e3}=r||{},l=r?.retry||0;do try{let r=new AbortController;n=setTimeout(()=>{s?.error?.(`abort signal due to timeout exceed: ${o} with input: ${e}`),r.abort()},o);let a=await fetch(e,{...t,signal:r.signal});if(!a.ok)throw Error(`http error: ${a.status} ${a.statusText}`);if("function"==typeof i){let e=await i(a);return n&&clearTimeout(n),e}return n&&clearTimeout(n),a}catch(t){if(n&&clearTimeout(n),0===l){let r=t instanceof DOMException?Error(`exceed timeout: ${o}ms`):t;throw s?.error?.(`failed to fetchWithRetry with input: ${e}, error:`,r),r}s?.error?.(`unable to fetchWithRetry with input: ${e}, error:`,t),await function(e){return new Promise(t=>setTimeout(()=>t(),e))}(a)}while(l-- >0);throw Error(`failed to fetchWithRetry with input: ${e}`)}let ek=(e,t)=>(globalThis.addEventListener(e,t,!1),()=>globalThis.removeEventListener(e,t,!1));class eN{#eF=[];#eU;#eB;#eW=[];#eH=50;#eV=navigator.onLine;#eK;#ez;#eG;#eq;constructor(e,t){this.#eU=e,this.#eB=e.configManager,this.#eK=t.max_report||50,this.#ez=t.report_time||30,this.#eq=t.report_url||this.#eB.getUrl(),this.#p(),ew.begin("online",`online_state=${this.#eV}`)}#eJ(){this.#eZ(!0),this.#eU.emit(eI.DestroyOver),this.#eW.forEach(e=>e())}#eQ(e){let t=[...this.#eF],r=[...e,...this.#eF];if(this.#eF=r,ew.begin("event",`cache the event: ${e?.[0].event}`),!this.#eV){t.length>300&&(ew.begin("cache has been clear due to the limit of max length in offline"),this.#eF=e);return}this.#eG&&clearTimeout(this.#eG),r.length>=this.#eK?this.#eZ(!1):this.#eG=setTimeout(()=>{this.#eZ(!1),this.#eG=null},this.#ez)}#eY(e){this.#eV=e,ew.begin("online",`online_state=${this.#eV}`),this.#eV&&this.#eZ(!0)}#p(){this.#eU.on(eI.Destroy,()=>this.#eJ()),this.#eU.on(eI.Ready,()=>this.#eZ(!1)),this.#eU.on(eI.Event,e=>this.#eQ(e)),this.#eW.push(ek("offline",()=>this.#eY(!1))),this.#eW.push(ek("online",()=>this.#eY(!0))),this.#eW.push(ek("unload",()=>this.#eZ(!0))),this.#eW.push(ek("beforeunload",()=>this.#eZ(!0))),this.#eW.push(ek("visibilitychange",()=>this.#eZ(!0)))}#eX(e){let{header:t,user:r}=this.#eB.get(),n=e.map(e=>({...e,params:JSON.stringify(e.params)}));return Object.keys(r).length?[[{events:n,user:r,header:{...t,custom:JSON.stringify(t.custom)},local_time:Math.floor(Date.now()/1e3)}]]:[]}#eZ(e){if(this.#eU.destroyed||!this.#eU.sdkReady)return void ew.begin("destroy",`the tea instance has been destroyed, destroy_state=${this.#eU.destroyed} or has not been ready, ready_state=${this.#eU.sdkReady}, and the length of events is ${this.#eF.length} with beacon: ${e}`);let t=[...this.#eF];t.length&&(this.#eF=[],this.#e0(t,e))}async #e1(e,t){if(e.length){try{let r=null;if(t&&globalThis.navigator?.sendBeacon)globalThis.navigator.sendBeacon(this.#eq,JSON.stringify(e))&&(r={e:0});else{let t=await eS(this.#eq,{method:"POST",body:JSON.stringify(e)},{timeout:1e5,retry:1,logger:{error:(...e)=>ew.begin("submit-error",...e)}});r=await t.json()}if(r?.e===0)return void this.#eU.emit(eI.SubmitSuccess,{data:e})}catch(e){ew.begin("submit-error",`report the events failed, msg: ${e}`)}this.#eU.emit(eI.SubmitError,{data:e})}}#e0(e,t){for(let r=0;r<e.length;r+=this.#eH)this.#eX(e.slice(r,r+this.#eH)).forEach(e=>this.#e1(e,t))}}let e_=10;function eT(e,t,r){let n={fired:!1,wrapFn:void 0,target:e,event:t,listener:r};function i(...e){if(!n.fired)return(n.target.removeListener(n.event,n.wrapFn),n.fired=!0,0===e.length)?n.listener.call(n.target):n.listener.apply(n.target,e)}return i.listener=r,n.wrapFn=i,i}function eO(e){let t=Array(e.length);for(let r=0;r<e.length;++r)t[r]=e[r];return t}function e$(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}class eC{off=this.removeListener;on=this.addListener;#e3=Object.create(null);#e5=0;#e2;static get defaultMaxListeners(){return e_}static set defaultMaxListeners(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");e_=e}addListener(e,t){return this.#e4(e,t,!1)}emit(e,...t){let r=this.#e3[e];if(void 0===r)return!1;if("function"==typeof r)Reflect.apply(r,this,t);else for(let e of eO(r))Reflect.apply(e,this,t);return!0}eventNames(){return this.#e5>0?Reflect.ownKeys(this.#e3):[]}getMaxListeners(){return void 0===this.#e2?eC.defaultMaxListeners:this.#e2}listenerCount(e){let t=this.#e3[e];return void 0!==t?t.length:0}listeners(e){return this.#e8(e,!0)}once(e,t){return e$(t),this.on(e,eT(this,e,t)),this}prependListener(e,t){return this.#e4(e,t,!0)}prependOnceListener(e,t){return e$(t),this.prependListener(e,eT(this,e,t)),this}rawListeners(e){return this.#e8(e,!1)}removeAllListeners(e){let t,r=this.#e3;if(void 0===r.removeListener)return void 0===e?(this.#e3=Object.create(null),this.#e5=0):void 0!==r[e]&&(0==--this.#e5?this.#e3=Object.create(null):delete r[e]),this;if(void 0===e){let e,n=Object.keys(r);for(t=0;t<n.length;++t)"removeListener"!==(e=n[t])&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this.#e3=Object.create(null),this.#e5=0,this}let n=r[e];if("function"==typeof n)this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;t>=0;t--)this.removeListener(e,n[t]);return this}removeListener(e,t){let r,n,i;e$(t);let s=this.#e3,a=this.#e3[e];if(void 0===a)return this;for(r=-1,n=a.length-1;n>=0;n--)if(a[n]===t||a[n].listener===t){i=a[n].listener,r=n;break}if(r<0)return this;if(0===r)a.shift();else{for(var o=r;o+1<a.length;o++)a[o]=a[o+1];a.pop()}return 0===a.length&&(0==--this.#e5?this.#e3=Object.create(null):delete s[e]),void 0!==s.removeListener&&this.emit("removeListener",e,i||t),this}setMaxListeners(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this.#e2=e,this}#e4(e,t,r){let n;e$(t);let i=this.#e3;if(void 0!==this.#e3.newListener&&(this.emit("newListener",e,t.listener?t.listener:t),i=this.#e3),void 0===(n=i[e]))i[e]=[t],n=[t],++this.#e5;else{r?n.unshift(t):n.push(t);let i=this.getMaxListeners();if(i>0&&n.length>i&&!n.warned){n.warned=!0;let t=Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");t.name="MaxListenersExceededWarning",console.warn(t)}}return this}#e8(e,t){let r=this.#e3[e];return void 0===r?[]:t?function(e){let t=Array(e.length);for(let r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(r):eO(r)}}function eR(e,t){return(...r)=>0===r.length?e.call(t):e.apply(t,r)}class eA extends eC{constructor(){super(),this.on("removeListener",e=>{0===this.listenerCount(e)&&this.emit(`internal-event-${e}-cleared`)})}onWithDisposer(e,t,r){let n=eR(t,this);return r?this.prependListener(e,n):this.on(e,n),()=>{this.off(e,n)}}onceWithDisposer(e,t,r){let n=eR(t,this);return r?this.prependOnceListener(e,n):this.once(e,n),()=>{this.off(e,n)}}}class eL{configManager;destroyed=!1;sdkReady=!1;#e6=new eA;config(e){this.configManager?.set({...e})}destroy(){let e=ew.begin("destroy","status=begin");this.on(eI.DestroyOver,()=>{this.destroyed=!0,this.#e6.removeAllListeners(),e.end("status=end")}),this.emit(eI.Destroy)}emit(e,t){this.#e6.emit(e,t)}event(e,t){ew.begin("event",`add an event named ${e} to the queue.`);let r=[[e,t||{}]];r.length&&this.emit(eI.Event,r.map(e=>this.#e7(e[0],e[1]||{})))}init(e){ew.begin("init","wait for the start command"),this.configManager=new eE(e),new eN(this,e)}off(e,t){this.#e6.off(e,t)}on(e,t){this.#e6.on(e,t)}start(){ew.begin("start","wait for the start command"),this.sdkReady=!0,this.emit(eI.Ready)}#e7(e,t){let r=e;/^event\./.test(e)&&(r=e.slice(6));let n="object"==typeof t?t:{},i=n.local_ms?n.local_ms:Date.now();return Reflect.deleteProperty(n,"local_ms"),{event:r,params:n,local_time_ms:i}}}function eP(e,t){let r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function eD(e){var t;let{q:r,a:n,b:i,x:s,s:a,t:o}=e;return eP((t=eP(eP(n,r),eP(s,o)))<<a|t>>>32-a,i)}function ej(e){let{a:t,b:r,c:n,d:i,x:s,s:a,t:o}=e;return eD({q:r&n|~r&i,a:t,b:r,x:s,s:a,t:o})}function eM(e){let{a:t,b:r,c:n,d:i,x:s,s:a,t:o}=e;return eD({q:r&i|n&~i,a:t,b:r,x:s,s:a,t:o})}function eF(e){let{a:t,b:r,c:n,d:i,x:s,s:a,t:o}=e;return eD({q:r^n^i,a:t,b:r,x:s,s:a,t:o})}function eU(e){let{a:t,b:r,c:n,d:i,x:s,s:a,t:o}=e;return eD({q:n^(r|~i),a:t,b:r,x:s,s:a,t:o})}function eB(e,t){let r,n,i,s,a;e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;let o=0x67452301,l=-0x10325477,c=-0x67452302,u=0x10325476;for(r=0;r<e.length;r+=16)n=o,i=l,s=c,a=u,o=ej({a:o,b:l,c,d:u,x:e[r],s:7,t:-0x28955b88}),u=ej({a:u,b:o,c:l,d:c,x:e[r+1],s:12,t:-0x173848aa}),c=ej({a:c,b:u,c:o,d:l,x:e[r+2],s:17,t:0x242070db}),l=ej({a:l,b:c,c:u,d:o,x:e[r+3],s:22,t:-0x3e423112}),o=ej({a:o,b:l,c,d:u,x:e[r+4],s:7,t:-0xa83f051}),u=ej({a:u,b:o,c:l,d:c,x:e[r+5],s:12,t:0x4787c62a}),c=ej({a:c,b:u,c:o,d:l,x:e[r+6],s:17,t:-0x57cfb9ed}),l=ej({a:l,b:c,c:u,d:o,x:e[r+7],s:22,t:-0x2b96aff}),o=ej({a:o,b:l,c,d:u,x:e[r+8],s:7,t:0x698098d8}),u=ej({a:u,b:o,c:l,d:c,x:e[r+9],s:12,t:-0x74bb0851}),c=ej({a:c,b:u,c:o,d:l,x:e[r+10],s:17,t:-42063}),l=ej({a:l,b:c,c:u,d:o,x:e[r+11],s:22,t:-0x76a32842}),o=ej({a:o,b:l,c,d:u,x:e[r+12],s:7,t:0x6b901122}),u=ej({a:u,b:o,c:l,d:c,x:e[r+13],s:12,t:-0x2678e6d}),c=ej({a:c,b:u,c:o,d:l,x:e[r+14],s:17,t:-0x5986bc72}),l=ej({a:l,b:c,c:u,d:o,x:e[r+15],s:22,t:0x49b40821}),o=eM({a:o,b:l,c,d:u,x:e[r+1],s:5,t:-0x9e1da9e}),u=eM({a:u,b:o,c:l,d:c,x:e[r+6],s:9,t:-0x3fbf4cc0}),c=eM({a:c,b:u,c:o,d:l,x:e[r+11],s:14,t:0x265e5a51}),l=eM({a:l,b:c,c:u,d:o,x:e[r],s:20,t:-0x16493856}),o=eM({a:o,b:l,c,d:u,x:e[r+5],s:5,t:-0x29d0efa3}),u=eM({a:u,b:o,c:l,d:c,x:e[r+10],s:9,t:0x2441453}),c=eM({a:c,b:u,c:o,d:l,x:e[r+15],s:14,t:-0x275e197f}),l=eM({a:l,b:c,c:u,d:o,x:e[r+4],s:20,t:-0x182c0438}),o=eM({a:o,b:l,c,d:u,x:e[r+9],s:5,t:0x21e1cde6}),u=eM({a:u,b:o,c:l,d:c,x:e[r+14],s:9,t:-0x3cc8f82a}),c=eM({a:c,b:u,c:o,d:l,x:e[r+3],s:14,t:-0xb2af279}),l=eM({a:l,b:c,c:u,d:o,x:e[r+8],s:20,t:0x455a14ed}),o=eM({a:o,b:l,c,d:u,x:e[r+13],s:5,t:-0x561c16fb}),u=eM({a:u,b:o,c:l,d:c,x:e[r+2],s:9,t:-0x3105c08}),c=eM({a:c,b:u,c:o,d:l,x:e[r+7],s:14,t:0x676f02d9}),l=eM({a:l,b:c,c:u,d:o,x:e[r+12],s:20,t:-0x72d5b376}),o=eF({a:o,b:l,c,d:u,x:e[r+5],s:4,t:-378558}),u=eF({a:u,b:o,c:l,d:c,x:e[r+8],s:11,t:-0x788e097f}),c=eF({a:c,b:u,c:o,d:l,x:e[r+11],s:16,t:0x6d9d6122}),l=eF({a:l,b:c,c:u,d:o,x:e[r+14],s:23,t:-0x21ac7f4}),o=eF({a:o,b:l,c,d:u,x:e[r+1],s:4,t:-0x5b4115bc}),u=eF({a:u,b:o,c:l,d:c,x:e[r+4],s:11,t:0x4bdecfa9}),c=eF({a:c,b:u,c:o,d:l,x:e[r+7],s:16,t:-0x944b4a0}),l=eF({a:l,b:c,c:u,d:o,x:e[r+10],s:23,t:-0x41404390}),o=eF({a:o,b:l,c,d:u,x:e[r+13],s:4,t:0x289b7ec6}),u=eF({a:u,b:o,c:l,d:c,x:e[r],s:11,t:-0x155ed806}),c=eF({a:c,b:u,c:o,d:l,x:e[r+3],s:16,t:-0x2b10cf7b}),l=eF({a:l,b:c,c:u,d:o,x:e[r+6],s:23,t:0x4881d05}),o=eF({a:o,b:l,c,d:u,x:e[r+9],s:4,t:-0x262b2fc7}),u=eF({a:u,b:o,c:l,d:c,x:e[r+12],s:11,t:-0x1924661b}),c=eF({a:c,b:u,c:o,d:l,x:e[r+15],s:16,t:0x1fa27cf8}),l=eF({a:l,b:c,c:u,d:o,x:e[r+2],s:23,t:-0x3b53a99b}),o=eU({a:o,b:l,c,d:u,x:e[r],s:6,t:-0xbd6ddbc}),u=eU({a:u,b:o,c:l,d:c,x:e[r+7],s:10,t:0x432aff97}),c=eU({a:c,b:u,c:o,d:l,x:e[r+14],s:15,t:-0x546bdc59}),l=eU({a:l,b:c,c:u,d:o,x:e[r+5],s:21,t:-0x36c5fc7}),o=eU({a:o,b:l,c,d:u,x:e[r+12],s:6,t:0x655b59c3}),u=eU({a:u,b:o,c:l,d:c,x:e[r+3],s:10,t:-0x70f3336e}),c=eU({a:c,b:u,c:o,d:l,x:e[r+10],s:15,t:-1051523}),l=eU({a:l,b:c,c:u,d:o,x:e[r+1],s:21,t:-0x7a7ba22f}),o=eU({a:o,b:l,c,d:u,x:e[r+8],s:6,t:0x6fa87e4f}),u=eU({a:u,b:o,c:l,d:c,x:e[r+15],s:10,t:-0x1d31920}),c=eU({a:c,b:u,c:o,d:l,x:e[r+6],s:15,t:-0x5cfebcec}),l=eU({a:l,b:c,c:u,d:o,x:e[r+13],s:21,t:0x4e0811a1}),o=eU({a:o,b:l,c,d:u,x:e[r+4],s:6,t:-0x8ac817e}),u=eU({a:u,b:o,c:l,d:c,x:e[r+11],s:10,t:-0x42c50dcb}),c=eU({a:c,b:u,c:o,d:l,x:e[r+2],s:15,t:0x2ad7d2bb}),l=eU({a:l,b:c,c:u,d:o,x:e[r+9],s:21,t:-0x14792c6f}),o=eP(o,n),l=eP(l,i),c=eP(c,s),u=eP(u,a);return[o,l,c,u]}function eW(e){let t,r="",n=32*e.length;for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function eH(e){let t,r=[];for(t=0,r[(e.length>>2)-1]=void 0;t<r.length;t+=1)r[t]=0;let n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function eV(e){let t,r,n="0123456789abcdef",i="";for(r=0;r<e.length;r+=1)i+=n.charAt((t=e.charCodeAt(r))>>>4&15)+n.charAt(15&t);return i}function eK(e){return unescape(encodeURIComponent(e))}function ez(e){var t;return eW(eB(eH(t=eK(e)),8*t.length))}function eG(e,t){return function(e,t){let r,n=eH(e),i=[],s=[];for(i[15]=void 0,s[15]=void 0,n.length>16&&(n=eB(n,8*e.length)),r=0;r<16;r+=1)i[r]=0x36363636^n[r],s[r]=0x5c5c5c5c^n[r];let a=eB(i.concat(eH(t)),512+8*t.length);return eW(eB(s.concat(a),640))}(eK(e),eK(t))}function eq(e,t,r){if(!t)return r?ez(e):eV(ez(e));return r?eG(t,e):eV(eG(t,e))}async function eJ(e,t){(0,T.lt)(e,"algorithm",["SHA-1","SHA-256","SHA-384","SHA-512"]),(0,T.Cp)(t,"message",{allowEmpty:!1});let r=new TextEncoder().encode(t);return Array.from(new Uint8Array(await crypto.subtle.digest(e,r))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function eZ(e){return(0,T.Cp)(e,"message",{allowEmpty:!1}),eJ("SHA-1",e)}let eQ=async e=>{(0,T.Cp)(e,"id",{allowEmpty:!1});let t=eq("ee"),r=t.substring(0,6),n=t.substring(t.length-6);return await eZ(r+eq(e.concat(n)))};var eY=function(e,t,r){for(var n=arguments.length>2,i=0;i<t.length;i++)r=n?t[i].call(e,r):t[i].call(e);return n?r:void 0},eX=function(e,t,r,n,i,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,l=n.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?n.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),d=!1,p=r.length-1;p>=0;p--){var f={};for(var m in n)f[m]="access"===m?{}:n[m];for(var m in n.access)f.access[m]=n.access[m];f.addInitializer=function(e){if(d)throw TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,r[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&i.push(o)}else(o=a(g))&&("field"===l?i.push(o):h[c]=o)}u&&Object.defineProperty(u,n.name,h),d=!0};let e0=es({namespaces:["larkapi","tea"]}),e1=new eA,e3=function(e){let{logger:t,property:r,instanceName:n,moduleName:i}=e;return function(){return function(e,s){if(s.private){let e=`not supported on private methods: ${s.name.toString()}`;throw t.error(e),new _.AQ(i,e)}if("method"!==s.kind){let e="only support decorate method";throw t.error(e),new _.AQ(i,e)}return function(...a){if(this[r]){let e=`calling method: ${s.name.toString()} is forbidden`;throw e+=`, ${n} has already been ${r}.`,t.error(e),new _.nb(i,e)}return e.call(this,...a)}}}}({logger:e0,property:"disposed",instanceName:"tea",moduleName:"tea"}),e5=(d=[],class{static{o=[e3()],l=[e3()],c=[e3()],u=[e3()],h=[e3()],eX(this,null,o,{kind:"method",name:"clearCommonParams",static:!1,private:!1,access:{has:e=>"clearCommonParams"in e,get:e=>e.clearCommonParams}},null,d),eX(this,null,l,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:e=>"dispose"in e,get:e=>e.dispose}},null,d),eX(this,null,c,{kind:"method",name:"observe",static:!1,private:!1,access:{has:e=>"observe"in e,get:e=>e.observe}},null,d),eX(this,null,u,{kind:"method",name:"setCommonParams",static:!1,private:!1,access:{has:e=>"setCommonParams"in e,get:e=>e.setCommonParams}},null,d),eX(this,null,h,{kind:"method",name:"track",static:!1,private:!1,access:{has:e=>"track"in e,get:e=>e.track}},null,d)}commonParams=(eY(this,d),{});disposed=!1;initConfig={};instanceId=(function(){let e,t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto);if(t)t(e=new Uint8Array(16));else{e=Array(16);for(let t=0,r;t<16;t++)(3&t)==0&&(r=0x100000000*Math.random()),e[t]=r>>>((3&t)<<3)&255}e[6]=15&e[6]|64,e[8]=63&e[8]|128;let r=0,n=[];for(let e=0;e<256;++e)n[e]=(e+256).toString(16).substr(1);return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")})();tracer=ea({namespaces:["larkapi","tea"]});#eW=[];constructor(e){this.#e9(e)}clearCommonParams(){this.commonParams={}}dispose(){this.#eW.forEach(e=>e()),this.disposed=!0,this.commonParams={},this.initConfig={}}async observe(e,t,r){(0,T.bl)(e,"eventNames",{allowEmpty:!1,minLength:1}),(0,T.zV)(t,"callback"),(0,T.lt)(r?.mode,"options.mode",["default","global"],{optional:!0});let n=this.tracer.begin("observe",`get observer event list: ${e.join(",")}`),i=(e,n)=>{(this.initConfig.allowGlobalObserve&&r?.mode==="global"||e.instanceId===this.instanceId)&&t(e,n)},s=e.map(e=>e1?.onWithDisposer(e,i));return this.#eW.push(...s),async()=>{s.forEach(e=>{try{this.#eW=this.#eW.filter(t=>t!==e),e()}catch(e){n.error(`execute unobserve callback error: ${e}`)}}),n.end(`get unobserve event list: ${e.join(",")}`)}}setCommonParams(e){(0,T.FF)(e,"params"),Object.assign(this.commonParams,e),Object.keys(this.commonParams).forEach(e=>{(void 0===this.commonParams[e]||null===this.commonParams[e])&&Reflect.deleteProperty(this.commonParams,e)})}track(e,t){(0,T.Cp)(e,"eventName",{allowEmpty:!1}),(0,T.FF)(t,"params",{optional:!0})}getMergedParams(e){return{...this.commonParams,...e||{}}}async #e9(e){e&&"object"==typeof e&&(this.initConfig={...e})}}),e2=()=>{let e=(0,k.iE)("app")?.locale;if(!e)throw new _.wd("app","locale");return(0,T.lt)(e,"locale",["de-DE","en-US","es-ES","fr-FR","hi-IN","id-ID","it-IT","ja-JP","ko-KR","ms-MY","pt-BR","ru-RU","th-TH","vi-VN","zh-CN","zh-HK","zh-TW"]),e};performance.timeOrigin;class e4{#te;#eb;#tt=new Set;constructor(e,t){this.#te=e,this.#eb=t?.logger||globalThis.console}get observerCount(){return this.#tt.size}diffAndNotify(e,t){let r=new Set([]);this.observerCount>0&&[...this.#tt].forEach(([n,i])=>{if(!(0,S.isEqual)(e[n],t[n])){let s=void 0!==e[n]?(0,S.cloneDeep)(e[n]):this.#te,a=void 0!==t[n]?(0,S.cloneDeep)(t[n]):this.#te;r.add(n),i(s,a)}}),this.#eb.info(`diff and notify finished, diff size: ${r.size} ${r.size?`changed keys: ${[...r.values()].join(",")}`:""}`)}observe(e,t){let r=[e,t];this.#tt.add(r),this.#eb.info(`start observing key: ${e}`);let n=[...this.#tt].filter(t=>t[0]===e);if(n.length>20){let t=Error("Possible memory leak detected. "+n.length+" "+e+" observers added and exceeded the limit 20");t.name="MaxListenersExceededWarning",this.#eb.warn(t)}return()=>{this.#tt.delete(r),this.#eb.info(`stop observing key: ${e}`)}}}let e8=es({namespaces:["larkapi","domain"]});new e4(null,{logger:e8});let e6=Object.freeze({source:"runtime"}),e7="tt_tea",e9=()=>{let e=W.isOverseaPkg?"va":"cn",t=((e,t)=>{(0,T.Cp)(e,"key",{allowEmpty:!1}),(0,T.FF)(t,"options",{optional:!0}),(0,T.lt)(t?.source,"options.source",["package","runtime","common"],{optional:!0});let r=(e=>{try{switch(e.source){case"runtime":{let e=tE("biz_domain_config");if(e)return e;let t=(0,k.iE)("domain");if(t&&!(0,S.isPlainObject)(t))throw new _.Zc("domain");if(t)return t;throw new _.Ap("domain","you should call `await LarkAPI.appConfig.startup()`")}case"package":{let e=(0,k.iE)("domain");if(e)return e;throw new _.wd("domain")}case"common":throw new _.Ap("domain","commonConfigs is empty");default:throw new _.z4("domain")}}catch(e){throw e8.error("get all domains impl failed,",e),e}})({...e6,...t})[e]?.[0];return"string"==typeof r?r:null})(e7);if(!t)throw new _.gx("tea",`${e7} must be registered in domain.`);return{locale:e2(),appName:(()=>{let e=function(){let e=globalThis.globalKaConfig;return e?.i18n?.app_name?.[e2()]||e?.i18n?.app_name?.$base||""}();if(e)return e;let t=(0,k.iE)("app")?.name;if(!t)throw new _.wd("app","name");return t})(),version:(()=>{let e=(0,k.iE)("app")?.version;if(!e)throw new _.wd("app","version");return e})(),appId:W.appId,channel:e,teaDomain:t}};class te extends e5{#L=null;#tr;constructor(e){super(e),this.#tr=new eL}dispose(){super.dispose(),this.#tr?.destroy(),this.#tr=null,this.tracer.begin("destroy-success","this instance has been destroyed")}async observe(e,t,r){if(r?.mode==="global")throw new _.WR("options.mode",r.mode,`should be 'default' in ${W.runtime}`);return await super.observe(e,t,r)}async track(e,t){super.track(e,t),await this.#e9(),this.#tr?.event(e,this.getMergedParams(t))}async #tn(){let{appName:e,locale:t,version:r}=e9(),n=$(),i=(await O()).user.tenant.id,s=await eQ(n),a=await eQ(i),o={user_unique_id:s,device_id:"",app_version:r.match(/^\d+\.\d+\.\d+/)?.[0],app_full_version:r,tenant_id:a,app_name:e,language:t.replace("_","-"),"custom.platform":"web",sub_platform:"pc_web"};return this.tracer.begin("init-options",`get init config, app_full_version: ${r}, app_name: ${e}, user_unique_id: ${s}`),o}async #e9(){this.#L||(this.#L=this.#ti(this.initConfig));try{await this.#L}catch(e){throw this.#L=null,e}}#ti=async e=>{let t=this.tracer.begin("init","start tea begin"),{appId:r,channel:n,teaDomain:i}=e9(),s=e?.appId||r;if(!s)throw new _.gx("tea","missing appId in env and options");let a={app_id:s,channel:n,channel_domain:`https://${i}`,report_url:e?.reportUrl};this.tracer.begin("init-options",`get init info success, app_id: ${r}, channel: ${n}, domain: ${i}, \
      report_url: ${e?.reportUrl}`);let o=await this.#tn();this.#tr?.on(eI.SubmitSuccess,this.#ts),this.#tr?.init(a),this.#tr?.config(o),this.#tr?.start(),t.end("start tea end")};#ts=e=>{e.data.forEach(e=>{e.events.forEach(e=>{try{let t={eventName:e.event,params:"string"==typeof e.params?JSON.parse(e.params):e.params,instanceId:this.instanceId,timestamp:e.local_time_ms,userId:$()};e1.emit(e.event,t)}catch(e){this.tracer.begin("submit-error",`emit the callback error: ${e}`)}})})}}let tt=async(e,t)=>(n||(n=new te),await n?.track(e,t));var tr=function(e,t,r){for(var n=arguments.length>2,i=0;i<t.length;i++)r=n?t[i].call(e,r):t[i].call(e);return n?r:void 0},tn=function(e,t,r,n,i,s){function a(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,l=n.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?n.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),d=!1,p=r.length-1;p>=0;p--){var f={};for(var m in n)f[m]="access"===m?{}:n[m];for(var m in n.access)f.access[m]=n.access[m];f.addInitializer=function(e){if(d)throw TypeError("Cannot add initializers after decoration has completed");s.push(a(e||null))};var g=(0,r[p])("accessor"===l?{get:h.get,set:h.set}:h[c],f);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw TypeError("Object expected");(o=a(g.get))&&(h.get=o),(o=a(g.set))&&(h.set=o),(o=a(g.init))&&i.push(o)}else(o=a(g))&&("field"===l?i.push(o):h[c]=o)}u&&Object.defineProperty(u,n.name,h),d=!0};let ti=es({namespaces:["larkapi","storage","idb"]}),ts=(I=[],class{static{p=[L(ti)],f=[L(ti)],m=[L(ti)],g=[L(ti)],y=[L(ti)],w=[L(ti)],v=[L(ti)],b=[L(ti)],x=[L(ti)],E=[L(ti)],tn(this,null,p,{kind:"method",name:"clear",static:!1,private:!1,access:{has:e=>"clear"in e,get:e=>e.clear}},null,I),tn(this,null,f,{kind:"method",name:"getAllKeys",static:!1,private:!1,access:{has:e=>"getAllKeys"in e,get:e=>e.getAllKeys}},null,I),tn(this,null,m,{kind:"method",name:"getItem",static:!1,private:!1,access:{has:e=>"getItem"in e,get:e=>e.getItem}},null,I),tn(this,null,g,{kind:"method",name:"getItems",static:!1,private:!1,access:{has:e=>"getItems"in e,get:e=>e.getItems}},null,I),tn(this,null,y,{kind:"method",name:"hasItem",static:!1,private:!1,access:{has:e=>"hasItem"in e,get:e=>e.hasItem}},null,I),tn(this,null,w,{kind:"method",name:"hasItems",static:!1,private:!1,access:{has:e=>"hasItems"in e,get:e=>e.hasItems}},null,I),tn(this,null,v,{kind:"method",name:"removeItem",static:!1,private:!1,access:{has:e=>"removeItem"in e,get:e=>e.removeItem}},null,I),tn(this,null,b,{kind:"method",name:"removeItems",static:!1,private:!1,access:{has:e=>"removeItems"in e,get:e=>e.removeItems}},null,I),tn(this,null,x,{kind:"method",name:"setItem",static:!1,private:!1,access:{has:e=>"setItem"in e,get:e=>e.setItem}},null,I),tn(this,null,E,{kind:"method",name:"setItems",static:!1,private:!1,access:{has:e=>"setItems"in e,get:e=>e.setItems}},null,I)}#ta=(tr(this,I),null);#to;#L;#eE;#eS;#tl;constructor(e){let{partition:t,expireHours:r,spaceDelegate:n}=e;this.#eE=t,this.#tl=[...n.getSpaces()],this.#to=-1===r?r:60*r*60,this.#eS=n,this.#L=this.#e9()}async clear(){await this.#tc("clear()");let e=async e=>{this.#eN("clear()"),await new Promise((t,r)=>{let n=e.clear();n.onsuccess=()=>t(),n.onerror=()=>r(n.error)})};return this.#tu("readwrite",e,ep,"clear()")}async getAllKeys(){await this.#tc("getAllKeys()");let e=[],t=async t=>{this.#eN("getAllKeys()::getKeysHandler()"),e=await new Promise((e,r)=>{let n=t.getAllKeys();n.onsuccess=()=>e(n.result),n.onerror=()=>r(n.error)})};if(this.#th())await this.#tu("readwrite",async e=>{var r;this.#eN("getAllKeys()::removeExpiredHandler()"),await (r=this.#td(),new Promise((n,i)=>{let s=e.index(ec).openCursor(r);s.onsuccess=()=>{let r=s.result;r?r.delete().onsuccess=()=>{r.continue()}:t?t(e).then(n).catch(i):n()},s.onerror=()=>i(s.error)}))},ep,"getAllKeysWithExpireCheck()");else await this.#tu("readonly",t,ep,"getAllKeys()");return e}async getItem(e){let t=await this.#eC([e],!1);return t.length?t[0].value:null}async getItems(e){return await this.#eC(e,!0)}async hasItem(e){return(await this.#eR([e],!1))[0]}async hasItems(e){return await this.#eR(e,!0)}async removeItem(e){await this.#eA([e],!1)}async removeItems(e){await this.#eA(e,!0)}async setItem(e,t){await this.#eL([{key:e,value:t}],!1)}async setItems(e){await this.#eL(e,!0)}async #tc(e){if(!await this.#L)throw new _.gx("checkInit()",`when ${e} is called.`)}#eN(e){let t=this.#eS.getSpaces();if(!A(t,this.#tl))throw new _.nb("checkSpaces()",`currentSpace=${t}, originSpaces=${this.#tl}, when ${e} is called.`)}#td(){let e=new Date(Date.now()-1e3*this.#to);return IDBKeyRange.upperBound(e)}async #eC(e,t){D(e);let r=`getItem${t?"s":""}`;await this.#tc(`${r}(${e})`);let n=[],i=t=>async i=>{this.#eN(`${r}(${e})::getHandler()`);let s=[];for await(let t of e)try{let e=await ed(i,t);e&&eu(e.lastTime,this.#to)&&(s.push(t),e.value=null),n.push(e)}catch(e){ti.error(`${r}(${t}) getByKey failed.`,e);break}t&&n.length===e.length&&await t(s,i)},s=async(e,t)=>{for await(let n of e)try{await eh(t,n)}catch(e){ti.error(`${r}(${n}) deleteByKey failed.`,e)}},a=i=>{if(n.length<e.length)if(t)return new eg(e.map(e=>({key:e,value:null})),`failed to get items. ${i}`);else return new _.AQ(`${r}(${e[0]})`,`failed to get item. ${i}`)};return this.#th()?await this.#tu("readwrite",i(s),a,`${r}WithExpireCheck(${e})`):await this.#tu("readonly",i(),a,`${r}(${e})`),this.#eN(`${r}(${e})`),n.map((t,r)=>({key:t?.key??e[r],value:t?.value??null}))}#th(){return -1!==this.#to}async #eR(e,t){D(e);let r=`hasItem${t?"s":""}`;await this.#tc(`${r}(${e})`);let n=[],i=t=>async i=>{this.#eN(`${r}(${e})::getHandler()`);let s=[];for await(let t of e)try{let e=await ed(i,t);e&&eu(e.lastTime,this.#to)&&(s.push(t),e.value=null),n.push(!!e?.value)}catch(e){ti.error(`${r}(${t}) getByKey failed.`,e);break}t&&n.length===e.length&&await t(s,i)},s=async(e,t)=>{for await(let n of e)try{await eh(t,n)}catch(e){ti.error(`${r}(${n}) deleteByKey failed.`,e)}},a=i=>{if(n.length<e.length)if(t)return new eg(e.map(e=>({key:e,value:null})),`failed to has items. ${i}`);else return new _.AQ(`${r}(${e[0]})`,`failed to has item. ${i}`)};return this.#th()?await this.#tu("readwrite",i(s),a,`${r}WithExpireCheck(${e})`):await this.#tu("readonly",i(),a,`${r}(${e})`),n}async #e9(){return new Promise(e=>{var t;let r=(t=this.#eE,[...this.#tl,t].join("/")),n=indexedDB.open(r,1);n.onblocked=()=>{let t=new _.gx("init()",`partition: ${this.#eE}, initialize is blocked.`);ti.error(t.toString()),e(null)},n.onsuccess=()=>{ti.info(`[init] partition: ${this.#eE} init success.`),this.#ta=n.result,e(this.#ta)},n.onerror=()=>{let t=new _.gx("init()",`partition: ${this.#eE}, initialize has error.`);ti.error(t.toString(),n.error);try{tt("larkapi_storage_idb_init_err",{dbName:r,errorMsg:n.error?.message||"",errorName:n.error?.name||""})}catch(e){}e(null)},n.onupgradeneeded=e=>{ti.info(`[init] onupgradeneeded oldVersion=${e.oldVersion} newVersion=${e.newVersion}`),this.#ta=n.result,this.#ta.objectStoreNames.contains("kv")||this.#ta.createObjectStore("kv",{keyPath:"key",autoIncrement:!0}).createIndex(ec,ec,{unique:!1})}})}async #eA(e,t){D(e);let r=`removeItem${t?"s":""}`;await this.#tc(`${r}(${e})`);let n=async t=>{for await(let n of(this.#eN(`${r}(${e}::handler())`),e))try{await eh(t,n)}catch(e){ti.error(`${r}(${n}) deleteByKey failed.`,e)}};await this.#tu("readwrite",n,n=>t?new eg(Array(e.length).fill(!1),`failed to remove items. ${n}`):new _.AQ(`${r}(${e[0]})`,`failed to remove item. ${n}`),`${r}(${e})`)}#tu(e,t,r,n){return new Promise((i,s)=>{if(!this.#ta)return void s(new _.AQ(`${n}::runWithTransaction(${e})`,`this.#db is ${this.#ta}`));let a=this.#ta.transaction(["kv"],e);a.onabort=()=>{let t=String(a.error),i=new _.AQ(`${n}::runWithTransaction(${e})::onAbort()`,t);s(r(t)||i)},t(a.objectStore("kv")).then(i).catch(t=>{s(new _.AQ(`${n}::runWithTransaction(${e})::handler()`,String(t)))})})}async #eL(e,t){let r=e.map(({key:e})=>e);D(r);let n=`setItem${t?"s":""}`;await this.#tc(`${n}(${r})`);let i=async t=>{for(let{key:i,value:s}of(this.#eN(`${n}(${r})::handler()`),e))await function(e,t,r){return new Promise((n,i)=>{let s=e.put({key:t,value:r,lastTime:new Date});s.onsuccess=()=>n(),s.onerror=()=>i(s.error)})}(t,i,s)};await this.#tu("readwrite",i,e=>t?new eg(Array(r.length).fill(!1),"failed to set items."):new _.AQ(`${n}(${r[0]})`,`failed to set item. ${e}`),`${n}(${r})`)}}),ta=es({namespaces:["larkapi","app-config"]}),to=new e4(null,{logger:ta}),tl={appId:NaN,data:{},hostname:"",kaChannel:"",version:""},tc=Object.freeze({syncStrategy:"try-local"}),tu=()=>(function(e,t,r,n){if((0,T.lt)(e,"type",["localStorage","persistentStorage","sessionStorage"]),P(t),(0,T.Cp)(r,"userId",{allowEmpty:!1}),(0,T.FF)(n,"createOptions",{optional:!0}),n&&((0,T.mE)(n.expireHours,"createOptions.expireHours",{min:-1}),(0,T.lt)(n.storageFileType,"createOptions.storageFileType",["encrypt-preload","encrypt","plain"],{optional:!0}),(0,T.lt)(n.valueMaxPolicy,"createOptions.valueMaxPolicy",["noeviction","volatile-lru"],{optional:!0})),"localStorage"===e){P(t),(0,T.FF)(n,"createOptions",{optional:!1}),(0,T.mE)(n.expireHours,"createOptions.expireHours",{min:-1});let e=C();if(!R(r,e)){let e=new _.nb("createUserLocalStorage()","userId is error.");throw eo.error(e.toString()),e}return new el({partition:t,storage:localStorage,spaceDelegate:e,expireHours:n.expireHours,logger:eo})}if("persistentStorage"===e){let e=C();if(!R(r,e)){let e=new _.nb("createUserIndexedDBStorage()","userId is error.");throw ti.error(e.toString()),e}return new ts({partition:t,expireHours:n.expireHours,spaceDelegate:e,spaceMode:"public",storageFileType:"plain",valueMaxPolicy:"noeviction"})}if("sessionStorage"===e){P(t);let e=C();if(!R(r,e)){let e=new _.nb("createUserSessionStorage()","userId is error.");throw eo.error(e.toString()),e}return new el({partition:t,storage:sessionStorage,spaceDelegate:e,expireHours:-1,logger:eo})}throw new _.WR("type",e,"is not supported.")})("persistentStorage","lark-api-app-config",$(),{expireHours:72});async function th(e,t){if("object"==typeof e?.data){let{appId:r,data:n,hostname:i,kaChannel:s,version:a,meta:o}=e,l=tl?.data||{},c={...l,...n};if(to.diffAndNotify(c,l),Object.assign(tl,{appId:r,data:c,hostname:i,kaChannel:s,version:a,meta:o}),ta.info(`update settings, save cache: ${t}, appId: ${r}, version: ${a}, new key size: ${Object.keys(c).length}, old key size: ${Object.keys(l).length}, hostname: ${i}`),t)try{await tu().setItem(`${i}:${r}:${s}`,tl)}catch(e){ta.error(`update settings to db failed, ${e?.message}`)}}}function td(){let e=W.appId,t=(0,k.iE)("domain")?.api?.[0],r=W.kaChannel,n=(0,k.iE)("app")?.version;if(!e)throw new _.wd("env","appId");if(!t)throw new _.wd("domain","api");if("string"!=typeof r)throw new _.wd("env","kaChannel");if(!n)throw new _.wd("app","version");return{appId:e,hostname:t,kaChannel:r,version:n}}function tp(){i&&(clearTimeout(i),i=void 0),i=setTimeout(async()=>{let e=await tv();tp(),e||(ta.error("update failed,",a),a=void 0)},1e3*(tl?.meta?.ttl||3600))}async function tf(){let{appId:e,hostname:t,kaChannel:r,version:n}=td(),i=await tu().getItem(`${t}:${e}:${r}`);if(i&&i?.version===n&&i?.data)return ta.info(`get settings from db success, appId: ${e}, version: ${n}, key size: ${Object.keys(i?.data||{}).length}, hostname: ${t}`),{appId:e,data:i?.data,hostname:t,kaChannel:r,version:n};throw Error("no cached data")}async function tm(){let{appId:e,hostname:t,kaChannel:r,version:n}=td(),i={appId:e,hostname:t,kaChannel:r,version:n,data:{}},[s,a]=await Promise.allSettled([tg(),ty()]);if("fulfilled"===s.status)i=Object.assign(i,s.value);else if("rejected"===s.status)throw s.reason;return"fulfilled"===a.status&&Object.assign(i.data,a.value.data),i}async function tg(){let e="settings v3",{appId:t,hostname:r,kaChannel:n,version:i}=td(),s={version:i,app_id:t,app:"lark",platform:"web",action:"startup",app_channel:n};try{let t=$();t&&!isNaN(Number(t))&&(s.user_id=t,ta.info(`${e} has user id: ${t}`))}catch(t){ta.error(`${e} get user id error`)}if(tl?.meta){let{user_etag:t,data_etag:r,version_code:n}=tl?.meta;s.data_etag=r,s.version_code=n,s.user_etag=t,ta.info(`${e} use meta, data_etag: ${r}, version_code: ${n}, user_etag: ${t}`)}try{let{meta:n,data:a}=await eS(N(`https://${r}/settings/v3/`,s),{method:"GET",mode:"cors",credentials:"include"},{logger:ta,retry:3,retryInterval:10,interceptor:async t=>{let r=await t.json();if(!r?.meta?.complete)throw Error(`get ${e} from server not complete`);return r},timeout:15e3}),o=Object.keys(a||{});return ta.info(`get ${e} from server success, appId: ${t}, version: ${i}, key size: ${o.length}, hostname: ${r}, keys: "${o.join(",")}", `),{data:a,meta:n}}catch(t){throw/exceed timeout/.test(t?.message)&&(ta.error(`${e} fetch timeout. timeout=15000, retryCount=3`),tt("lark_api_setting_v3_timeout",{}).catch(t=>{ta.warn(`${e} fetch timeout report failed. reason: ${t.message}`)})),t}}async function ty(){let{appId:e,hostname:t,kaChannel:r,version:n}=td(),i=await O(),s={version:n,app_id:e,app:"lark",platform:"web",action:"startup",app_channel:r,tenant_id:i?.user?.tenant?.id,user_id:i?.user?.id},a="settings unbundle";try{let{meta:r,data:i}=await eS(N(`https://${t}/settings/unbundle/`,s),{method:"GET",mode:"cors",credentials:"include"},{logger:ta,retry:3,retryInterval:10,interceptor:async e=>{let t=await e.json();if(!t?.meta?.complete)throw Error(`get ${a} from server not complete`);return t},timeout:15e3}),o=Object.keys(i||{});return ta.info(`get ${a} from server success, appId: ${e}, version: ${n}, key size: ${o.length}, hostname: ${t}, keys: "${o.join(",")}", `),{data:i,meta:r}}catch(e){throw/exceed timeout/.test(e?.message)&&(ta.error(`${a} fetch timeout. timeout=15000, retryCount=3`),tt("lark_api_setting_unbundle_timeout",{}).catch(e=>{ta.warn(`${a} fetch timeout report failed. reason: ${e.message}`)})),e}}async function tw(){try{let e=await tf();return await th(e,!1),!0}catch(e){return ta.info("update settings from cache failed,",e?.message),a=e,!1}}async function tv(){try{let e=await tm();return await th(e,!0),!0}catch(e){return ta.error("update settings from server failed,",e),a=e,!1}}let tb=async e=>{(0,T.FF)(e,"options",{optional:!0}),(0,T.lt)(e?.syncStrategy,"options.syncStrategy",["try-local","try-server"],{optional:!0}),s||(s=async function(){switch(({...tc,...e}).syncStrategy){case"try-local":if(await tw())return void tv().finally(tp);if(await tv())return tp();break;case"try-server":if(await tv()||await tw())return tp();break;default:throw new _.z4("appConfig")}throw a}()),await s.catch(e=>{throw s=void 0,a=void 0,ta.error("startup failed,",e),new _.gx("appConfig",`reason: ${e}`)})},tx=async function(e){if(!s){let e=new _.Ap("appConfig","you should call `await LarkAPI.appConfig.startup()`");throw ta.error("validate initialized failed,",e),e}return(0,T.Cp)(e,"key",{allowEmpty:!1}),void 0!==tl?.data?.[e]?(0,S.cloneDeep)(tl?.data?.[e]):null},tE=function(e){return(0,T.Cp)(e,"key",{allowEmpty:!1}),void 0!==tl?.data?.[e]?tl?.data?.[e]:null}},127759:function(e,t,r){r.d(t,{c:()=>n});let n={appNoData:"ERR_APP_NO_DATA",corruptedData:"ERR_CORRUPTED_DATA",fetchDataFailed:"ERR_FETCH_DATA_FAILED",fgNotEnabled:"ERR_FG_NOT_ENABLED",forbiddenCallFromChildFrame:"ERR_FORBIDDEN_CALL_FROM_CHILD_FRAME",illegalAccess:"ERR_ILLEGAL_ACCESS",initializeFailed:"ERR_INITIALIZE_FAILED",initializeRequired:"ERR_INITIALIZE_REQUIRED",internal:"ERR_INTERNAL",invalidArgType:"ERR_INVALID_ARG_TYPE",invalidArgValue:"ERR_INVALID_ARG_VALUE",invalidConfigurationType:"ERR_INVALID_CONFIGURATION_TYPE",launchPadExistedApp:"ERR_LAUNCH_PAD_EXISTED_APP",launchPadLastUnfinished:"ERR_LAUNCH_PAD_LAST_UNFINISHED",launchPadLimitExceeded:"ERR_LAUNCH_PAD_LIMIT_EXCEEDED",launchPadOldVersionData:"ERR_LAUNCH_PAD_OLD_VERSION_DATA",launchPadServerError:"ERR_LAUNCH_PAD_SERVER_ERROR",launchPadUnknown:"ERR_LAUNCH_PAD_UNKNOWN",launchPadUpdateNotApply:"ERR_LAUNCH_PAD_UPDATE_NOT_APPLY",manifestArgsReadFailed:"ERR_MANIFEST_ARGS_READ_FAILED",masNotMasVersion:"ERR_MAS_NOT_MAS_VERSION",missingArg:"ERR_MISSING_ARG",missingConfiguration:"ERR_MISSING_CONFIGURATION",noSuchMethod:"ERR_NO_SUCH_METHOD",notReached:"ERR_NOT_REACHED",outOfRange:"ERR_OUT_OF_RANGE",pagingContentNotFound:"ERR_PAGING_CONTENT_NOT_FOUND",pagingTabNotFound:"ERR_PAGING_TAB_NOT_FOUND",pagingUrlNotAllowed:"ERR_PAGING_URL_NOT_ALLOWED",pagingViewNotFound:"ERR_PAGING_VIEW_NOT_FOUND",pagingWatcherNotExist:"ERR_PAGING_WATCHER_NOT_EXIST",pagingWebviewNotFound:"ERR_PAGING_WEBVIEW_NOT_FOUND",passportNoActiveUser:"ERR_PASSPORT_NO_ACTIVE_USER",pipelinePolicyForbidden:"ERR_PIPELINE_POLICY_FORBIDDEN",storageBatchFailed:"ERR_STORAGE_BATCH_FAILED",systemGetFileSizeFailed:"ERR_SYSTEM_GET_FILE_SIZE_FAILED",timeGetNtpTimeFailed:"ERR_TIME_GET_NTP_TIME_FAILED",transportBackendNotAvailable:"ERR_TRANSPORT_BACKEND_NOT_AVAILABLE",unsupportedOs:"ERR_UNSUPPORTED_OS",unsupportedRuntime:"ERR_UNSUPPORTED_RUNTIME",webviewInvalidUrl:"ERR_WEBVIEW_INVALID_URL",webviewNotExist:"ERR_WEBVIEW_NOT_EXIST",webviewOperationNotAllowed:"ERR_WEBVIEW_OPERATION_NOT_ALLOWED",widgetToastCreateFailed:"ERR_WIDGET_TOAST_CREATE_FAILED",widgetToastNotFound:"ERR_WIDGET_TOAST_NOT_FOUND"}},465829:function(e,t,r){r.d(t,{iE:()=>l,rF:()=>c});var n=r(139378),i=r(479117);let s={},a={get:(e,t,r)=>e?.[t]&&"object"==typeof e?.[t]?new Proxy(e[t],a):Reflect.get(e,t,r),set:()=>!1},o=new Proxy(s,a),l=e=>((0,i.Cp)(e,"module",{allowEmpty:!1}),o?.[e]||null),c=(e,t)=>{(0,i.Cp)(e,"module",{allowEmpty:!1}),(0,i.FF)(t,"configs",{allowArray:!1,allowFunction:!1,nullable:!1}),s[e]=(0,n.merge)(s[e],t)}},398487:function(e,t,r){r.d(t,{AQ:()=>p,Ap:()=>d,I1:()=>c,V2:()=>f,WR:()=>m,Zc:()=>g,gx:()=>h,j7:()=>l,nb:()=>u,oR:()=>v,wd:()=>y,z4:()=>w});var n=r(127759);let i=/^([A-Z][a-z0-9]*)+$/,s=["string","function","number","object","boolean","bigint","symbol","Function","Object"];function a(e,t="and"){return e.length<3?Array.prototype.join.call(e,` ${t} `):`${Array.prototype.slice.call(e,0,-1).join(", ")}, ${t} ${e[e.length-1]}`}function o(e){let t="",r=e.length,n=+("-"===e[0]);for(;r>=n+4;r-=3)t=`_${String.prototype.slice.call(e,r-3,r)}${t}`;return`${String.prototype.slice.call(e,0,r)}${t}`}function l(e,t,r){return class extends r{cause;constructor(...r){super("string"==typeof t?t:t(...r)),this.cause=e}toString(){return`${this.name} [${this.cause}]: ${this.message}`}}}let c=l(n.c.fetchDataFailed,(e,t)=>{let r=`Failed to fetch module: "${e}" data`;return t&&(r+=`, ${t}`),r},Error),u=l(n.c.illegalAccess,(e,t)=>{let r=`Illegal access for module: "${e}"`;return t&&(r+=`, ${t}`),r},Error),h=l(n.c.initializeFailed,(e,t)=>{let r=`Failed to initialize module: "${e}"`;return t&&(r+=`, ${t}`),r},Error),d=l(n.c.initializeRequired,(e,t)=>{let r=`Required to initialize module: "${e}"`;return t&&(r+=`, ${t}`),r},Error),p=l(n.c.internal,(e,t)=>{let r=`Internal error for module: "${e}"`;return t&&(r+=`, ${t}`),r},Error),f=l(n.c.invalidArgType,(e,t,r)=>{Array.isArray(t)||(t=[t]);let n="The ";if(String.prototype.endsWith.call(e," argument"))n+=`${e} `;else{let t=String.prototype.includes.call(e,".")?"property":"argument";n+=`${t} "${e}" `}if(n+="must be ",n+=(e=>{let t="",r=[],n=[],o=[];for(let t of e)Array.prototype.includes.call(s,t)?Array.prototype.push.call(r,String.prototype.toLowerCase.call(t)):null!==RegExp.prototype.exec.call(i,t)?Array.prototype.push.call(n,t):Array.prototype.push.call(o,t);if(n.length>0){let e=Array.prototype.indexOf.call(r,"object");-1!==e&&(Array.prototype.splice.call(r,e,1),Array.prototype.push.call(n,"Object"))}return r.length>0&&(t+=`${r.length>1?"one of type":"of type"} ${a(r,"or")}`,(n.length>0||o.length>0)&&(t+=" or ")),n.length>0&&(t+=`an instance of ${a(n,"or")}`,o.length>0&&(t+=" or ")),o.length>0&&(o.length>1?t+=`one of ${a(o,"or")}`:(String.prototype.toLocaleLowerCase.call(o[0])!==o[0]&&(t+="an "),t+=`${o[0]}`)),t})(t),"string"!=typeof r||r.length>0){let e;e=Array.isArray(r)?"["+r+"]":"bigint"==typeof r?String(r)+"n":String(r),n+=`. Received: ${e}`}return n},TypeError),m=l(n.c.invalidArgValue,(e,t,r="is invalid")=>{let n=String.prototype.includes.call(e,".")?"property":"argument",i=`The ${n} "${e}" ${r}`;return("string"!=typeof t||t.length>0)&&(i+=`. Received: ${Array.isArray(t)?"["+t+"]":String(t)}`),i},TypeError),g=l(n.c.invalidConfigurationType,(e,t)=>{let r="Invalid type of ";return t&&(r+=`field "${t}" in `),r+=`configuration for module: "${e}", you should make sure inject correct type of the config`},TypeError),y=l(n.c.missingConfiguration,(e,t)=>{let r="Missing ";return t&&(r+=`field "${t}" in `),r+=`configuration for module: "${e}", you must call "LarkAPI.configuration.updateConfig" to inject the config`},ReferenceError),w=l(n.c.notReached,e=>`Code executed unexpectedly, please contact owner of module: "${e}"`,EvalError),v=l(n.c.outOfRange,(e,t,r,n=!1)=>{let i,s=n?e:`The value of "${e}" is out of range.`;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=o(String(r)):"bigint"==typeof r?(i=String(r),(r>BigInt(0x100000000)||r<-BigInt(0x100000000))&&(i=o(i)),i+="n"):i=r,s+=` It must be ${t}`,("string"!=typeof i||i.length>0)&&(s+=`. Received: ${Array.isArray(i)?"["+i+"]":String(i)}`),s},RangeError);l(n.c.unsupportedRuntime,(e,t)=>`Illegal execution, only runtime ${e.length>1?`("${Array.prototype.join.call(e,'"|"')}")`:`"${e[0]}"`} is supported, while the current runtime is "${t}"`,Error),l(n.c.unsupportedOs,(e,t)=>`Illegal execution, only system platform ${e.length>1?`("${Array.prototype.join.call(e,'"|"')}")`:`"${e[0]}"`} is supported, while the current system platform is "${t}"`,Error)},479117:function(e,t,r){r.d(t,{Cp:()=>c,FF:()=>l,IL:()=>i,US:()=>s,bl:()=>u,lt:()=>h,mE:()=>o,zV:()=>a});var n=r(398487);let i=(e,t,r)=>{if(r?.optional&&void 0===e)return;if(!Array.isArray(e))throw new n.V2(t,"Array",e);let i=r?.minLength===void 0?0:r.minLength,s=r?.maxLength===void 0?Number.MAX_SAFE_INTEGER:r.maxLength;if(e.length<i){let r=`must be longer than or equal to ${i}`;throw new n.WR(t,e,r)}if(e.length>s){let r=`must be shorter than or equal to ${s}`;throw new n.WR(t,e,r)}},s=(e,t,r)=>{if((!r?.optional||void 0!==e)&&"boolean"!=typeof e)throw new n.V2(t,"boolean",e)},a=(e,t,r)=>{if((!r?.optional||void 0!==e)&&"function"!=typeof e)throw new n.V2(t,"Function",e)},o=(e,t,r)=>{if(!r?.optional||void 0!==e){if("number"!=typeof e)throw new n.V2(t,"number",e);if(r?.min!=null&&e<r?.min||r?.max!=null&&e>r?.max||(r?.min!=null||r?.max!=null)&&Number.isNaN(e))throw new n.oR(t,`${r?.min!=null?`>= ${r?.min}`:""}${r?.min!=null&&r?.max!=null?" && ":""}${r?.max!=null?`<= ${r?.max}`:""}`,e)}},l=(e,t,r)=>{if(r?.optional&&void 0===e)return;let i=!!r?.allowArray,s=!!r?.allowFunction;if(!r?.nullable&&null===e||!i&&Array.isArray(e)||"object"!=typeof e&&(!s||"function"!=typeof e))throw new n.V2(t,"Object",e)},c=(e,t,r)=>{if(!r?.optional||void 0!==e){if("string"!=typeof e)throw new n.V2(t,"string",e);if(r?.allowEmpty===!1&&0===e.length)throw new n.WR(t,e,"must not be an empty string")}},u=(e,t,r)=>{if(!r?.optional||void 0!==e){i(e,t,r);for(let n=0;n<e.length;n++)c(e[n],`${t}[${n}]`,r)}},h=(e,t,r,i)=>{if((!i?.optional||void 0!==e)&&!Array.prototype.includes.call(r,e))throw new n.V2(t,`('${Array.prototype.join.call(r,"|")}')`,e)}},271350:function(e,t,r){r.d(t,{hu:()=>P});let n=/^([A-Z][a-z0-9]*)+$/,i=["string","function","number","object","boolean","bigint","symbol","Function","Object"];function s(e,t="and"){return e.length<3?Array.prototype.join.call(e,` ${t} `):`${Array.prototype.slice.call(e,0,-1).join(", ")}, ${t} ${e[e.length-1]}`}function a(e){let t="",r=e.length,n=+("-"===e[0]);for(;r>=n+4;r-=3)t=`_${String.prototype.slice.call(e,r-3,r)}${t}`;return`${String.prototype.slice.call(e,0,r)}${t}`}function o(e,t,r){return class extends r{cause;constructor(...r){super("string"==typeof t?t:t(...r)),this.cause=e}toString(){return`${this.name} [${this.cause}]: ${this.message}`}}}let l=o("ERR_FETCH_DATA_FAILED",(e,t)=>{let r=`Failed to fetch module: "${e}" data`;return t&&(r+=`, ${t}`),r},Error);o("ERR_ILLEGAL_ACCESS",(e,t)=>{let r=`Illegal access for module: "${e}"`;return t&&(r+=`, ${t}`),r},Error),o("ERR_INITIALIZE_FAILED",(e,t)=>{let r=`Failed to initialize module: "${e}"`;return t&&(r+=`, ${t}`),r},Error),o("ERR_INITIALIZE_REQUIRED",(e,t)=>{let r=`Required to initialize module: "${e}"`;return t&&(r+=`, ${t}`),r},Error),o("ERR_INTERNAL",(e,t)=>{let r=`Internal error for module: "${e}"`;return t&&(r+=`, ${t}`),r},Error);let c=o("ERR_INVALID_ARG_TYPE",(e,t,r)=>{Array.isArray(t)||(t=[t]);let a="The ";if(String.prototype.endsWith.call(e," argument"))a+=`${e} `;else{let t=String.prototype.includes.call(e,".")?"property":"argument";a+=`${t} "${e}" `}if(a+="must be ",a+=(e=>{let t="",r=[],a=[],o=[];for(let t of e)Array.prototype.includes.call(i,t)?Array.prototype.push.call(r,String.prototype.toLowerCase.call(t)):null!==RegExp.prototype.exec.call(n,t)?Array.prototype.push.call(a,t):Array.prototype.push.call(o,t);if(a.length>0){let e=Array.prototype.indexOf.call(r,"object");-1!==e&&(Array.prototype.splice.call(r,e,1),Array.prototype.push.call(a,"Object"))}return r.length>0&&(t+=`${r.length>1?"one of type":"of type"} ${s(r,"or")}`,(a.length>0||o.length>0)&&(t+=" or ")),a.length>0&&(t+=`an instance of ${s(a,"or")}`,o.length>0&&(t+=" or ")),o.length>0&&(o.length>1?t+=`one of ${s(o,"or")}`:(String.prototype.toLocaleLowerCase.call(o[0])!==o[0]&&(t+="an "),t+=`${o[0]}`)),t})(t),"string"!=typeof r||r.length>0){let e;e=Array.isArray(r)?"["+r+"]":"bigint"==typeof r?String(r)+"n":String(r),a+=`. Received: ${e}`}return a},TypeError),u=o("ERR_INVALID_ARG_VALUE",(e,t,r="is invalid")=>{let n=String.prototype.includes.call(e,".")?"property":"argument",i=`The ${n} "${e}" ${r}`;return("string"!=typeof t||t.length>0)&&(i+=`. Received: ${Array.isArray(t)?"["+t+"]":String(t)}`),i},TypeError);o("ERR_INVALID_CONFIGURATION_TYPE",(e,t)=>{let r="Invalid type of ";return t&&(r+=`field "${t}" in `),r+=`configuration for module: "${e}", you should make sure inject correct type of the config`},TypeError),o("ERR_MISSING_CONFIGURATION",(e,t)=>{let r="Missing ";return t&&(r+=`field "${t}" in `),r+=`configuration for module: "${e}", you must call "LarkAPI.configuration.updateConfig" to inject the config`},ReferenceError),o("ERR_NOT_REACHED",e=>`Code executed unexpectedly, please contact owner of module: "${e}"`,EvalError);let h=o("ERR_OUT_OF_RANGE",(e,t,r,n=!1)=>{let i,s=n?e:`The value of "${e}" is out of range.`;return Number.isInteger(r)&&Math.abs(r)>0x100000000?i=a(String(r)):"bigint"==typeof r?(i=String(r),(r>BigInt(0x100000000)||r<-BigInt(0x100000000))&&(i=a(i)),i+="n"):i=r,s+=` It must be ${t}`,("string"!=typeof i||i.length>0)&&(s+=`. Received: ${Array.isArray(i)?"["+i+"]":String(i)}`),s},RangeError);o("ERR_UNSUPPORTED_RUNTIME",(e,t)=>`Illegal execution, only runtime ${e.length>1?`("${Array.prototype.join.call(e,'"|"')}")`:`"${e[0]}"`} is supported, while the current runtime is "${t}"`,Error),o("ERR_UNSUPPORTED_OS",(e,t)=>`Illegal execution, only system platform ${e.length>1?`("${Array.prototype.join.call(e,'"|"')}")`:`"${e[0]}"`} is supported, while the current system platform is "${t}"`,Error);let d=(e,t,r)=>{if(!r?.optional||void 0!==e){if("number"!=typeof e)throw new c(t,"number",e);if(r?.min!=null&&e<r?.min||r?.max!=null&&e>r?.max||(r?.min!=null||r?.max!=null)&&Number.isNaN(e))throw new h(t,`${r?.min!=null?`>= ${r?.min}`:""}${r?.min!=null&&r?.max!=null?" && ":""}${r?.max!=null?`<= ${r?.max}`:""}`,e)}},p=(e,t,r)=>{if(r?.optional&&void 0===e)return;let n=!!r?.allowArray,i=!!r?.allowFunction;if(!r?.nullable&&null===e||!n&&Array.isArray(e)||"object"!=typeof e&&(!i||"function"!=typeof e))throw new c(t,"Object",e)},f=(e,t,r)=>{if(!r?.optional||void 0!==e){if("string"!=typeof e)throw new c(t,"string",e);if(r?.allowEmpty===!1&&0===e.length)throw new u(t,e,"must not be an empty string")}},m={debug:2,info:3,warn:4,error:5},g="_lark_context_id_",y=/[\u4e00-\u9fa5]+/g,w=[new class{#e=1;#t=!1;#r;#n;#i;#s=!1;#a=-1;constructor(e,t,r="[zh]"){d(t,"intervalCount",{min:1}),d(e,"intervalTime",{min:1}),this.#n=e||1e3,this.#r=t||100,this.#i=r,this.#o()}check(e){if(-1===this.#a&&this.#l(),this.#c()){let t=e;return y.lastIndex=0,y.test(e)&&(t=e.replace(y,this.#i)),this.#u(),t}return this.#h(),e}#h(){this.#e++,this.#e>=this.#r&&(this.#t=!0)}#u(){this.#d(),this.#o()}#o(){this.#e=1,this.#t=this.#e>=this.#r}#d(){this.#s=!1,-1!==this.#a&&(this.#a>0&&clearTimeout(this.#a),this.#l())}#c(){return this.#t||this.#s}#l(){this.#a=setTimeout(()=>{this.#a=0,this.#s=!0},this.#n)}}(400,10,"[zh]")];r(139378);let v={get:(e,t,r)=>e?.[t]&&"object"==typeof e?.[t]?new Proxy(e[t],v):Reflect.get(e,t,r),set:()=>!1},b=new Proxy({},v),x=e=>(f(e,"module",{allowEmpty:!1}),b?.[e]||null),E={runtime:()=>globalThis.DedicatedWorkerGlobalScope&&globalThis instanceof DedicatedWorkerGlobalScope?"webworker":globalThis.SharedWorkerGlobalScope&&globalThis instanceof SharedWorkerGlobalScope?"sharedworker":"web"},I=new Proxy({},{get:(e,t)=>t in E?E[t]():t in(x("env")||{})?x("env")?.[t]:void 0});function S(e,t){let r=console;(r[e]||r.log)(t)}let k=new class{log=e=>{let t=function(e,t,r,n){let i=[];e.forEach(e=>i.push(`[${e}]`)),t.forEach(e=>i.push(`[${e}]`));let s=Object.keys(n).filter(e=>n[e]).map(e=>`${e}=${n[e]}`).concat("").join(",");return`${i.join("")}: ${s}${r}`}(e.context,e.namespaces,e.message,e.prefix);!function(e,t){if(!I.isDev)return;let r=function(){let e=I.logFilter;return"string"==typeof e?e:""}();r.trim()?e.message.includes(r)&&S(e.level,t):S(e.level,t)}(e,t)}};async function N(){try{return(await indexedDB.databases()).filter(e=>!!e.name).map(e=>e.name)}catch(e){return[]}}function _(e,t){return"number"==typeof e&&e>0?e:t}class T{#p;#f="stopped";#m;#g;constructor(e,t){this.#m=e,this.#p=t}start(){"started"!==this.#f&&(this.#f="started",this.#l())}stop(){"stopped"!==this.#f&&(this.#y(),this.#f="stopped")}#l=()=>{this.#y(),this.#g=setTimeout(async()=>{try{this.#g=void 0,await this.#p()}catch(e){}finally{this.#l()}},this.#m)};#y=()=>{this.#g&&(clearTimeout(this.#g),this.#g=void 0)}}class O{#w;#v=null;#b;#x=!1;constructor(e){this.#E(e),this.#b=e,this.#w=!1}hasNext(){return!this.#w}async next(e){d(e,"count",{min:1});let t=[];if(this.#w)return t;if(this.#x)throw new l(`traverser.next(${e})`,"Please wait for next() before calling next() again");return this.#x=!0,(t=this.#v?await this.#I(e):await this.#S(e)).length<e&&(this.#w=!0),this.#x=!1,t}#E(e){let{db:t,storeName:r,startTime:n,endTime:i}=e;if(p(t,"options.db"),f(r,"options.storeName",{allowEmpty:!1}),n>=i)throw new u("options.startTime",n,`startTime(${n}) should less than endTime(${i})`)}#I(e){return new Promise((t,r)=>{let n=[];this.#k(t=>{let{direction:r}=this.#b,i="prev"===r?IDBKeyRange.upperBound(this.#v,!0):IDBKeyRange.lowerBound(this.#v,!0),s=t.openCursor(i,r);s.onsuccess=()=>{let t=s.result;if(t){this.#v=t.primaryKey;let r=t.value;this.#N(r)&&(n.push(t.value),n.length<e&&t.continue())}}},()=>{t(n)},e=>{r(e)})})}#S(e){return new Promise((t,r)=>{let n=[];this.#k(t=>{let r=t.index("date"),{startTime:i,endTime:s,direction:a}=this.#b,o=IDBKeyRange.bound(i,s,!1,!1),l=r.openCursor(o,a);l.onsuccess=()=>{let t=l.result;t&&(this.#v=t.primaryKey,n.push(t.value),n.length<e&&t.continue())}},()=>{t(n)},e=>{r(e)})})}#N(e){let{startTime:t,endTime:r}=this.#b;return e?.date<=r&&e?.date>=t}#k(e,t,r){let{db:n,storeName:i}=this.#b,s=n.transaction(i,"readonly");s.oncomplete=()=>{t()},s.onerror=()=>{r(s.error)},e(s.objectStore(i))}}class ${#w=!1;#_=null;constructor(e){this.#_=function(e){let t=null,r=null;for(let n of e){let e={value:n,next:null};if(!t){r=t=e;continue}r&&(r.next=e,r=r.next)}return t}(e),this.#_||(this.#w=!0)}hasNext(){return!this.#w}async next(e){let t=this.#_,r=[];if(this.#w)return r;for(;r.length<e&&t?.value&&((await t.value.next(e-r.length)).forEach(e=>r.push(e)),r.length<e&&(t=t.next),t););return this.#_=t,r.length<e&&(this.#w=!0),r}}class C{#T;#O;#$=[];#C=!1;#R;#A=null;#L;#P=new Map;#D;#j;#M=!1;constructor(e){this.#R=e.dbName,this.#D=e.storeName,this.#j=!!e.useCache,this.#T=e.cacheCount,this.#O=e.cacheInterval,this.#L=new Promise(t=>{try{let r=indexedDB.open(this.#R);r.onsuccess=()=>{t(r.result),this.#F("init-success")},r.onupgradeneeded=()=>{let t=r.result;if(!t.objectStoreNames.contains(this.#D)){let r=t.createObjectStore(this.#D,{autoIncrement:!0});e.indexes.forEach(e=>r.createIndex(e.indexName,e.keyPath,{unique:e.unique}))}},r.onerror=()=>{t(null),this.#F("init-error")},r.onblocked=()=>{t(null),this.#F("init-error")}}catch(e){t(null)}}),this.#A=new T(this.#O,async()=>{if(this.#C)return void this.#U();await this.#B()})}async close(){if(this.#C)return;this.#U();let e=await this.#L;e&&(e.close(),this.#C=!0,this.#F("closed"),this.#P=new Map)}async flush(){await this.#B()}async getTraverser(e){let t=await this.#L;return!t||this.#C?null:new O({...e,db:t,storeName:this.#D})}observe(e,t){this.#P.set(e,t)}async save(e){if(await this.#L&&!this.#C){if(this.#$.push(e),!this.#j)return void this.#B();this.#W(),this.#$.length>=this.#T&&this.#B()}}#F(e){if(this.#C)return;let t=this.#P.get(e);if(t)try{t()}catch(e){}}async #H(){let e=await this.#L;if(e)return new Promise((t,r)=>{if(0===this.#$.length)return t(void 0);try{let n=e.transaction(this.#D,"readwrite");n.oncomplete=()=>{this.#F("flushed"),t(void 0)},n.onabort=()=>{r(Error("Transaction AbortError"))},n.onerror=e=>{let t=n.error||Error("Transaction failed");this.#$=[],r(t)};let i=n.objectStore(this.#D),s=this.#$;this.#$=[],s.forEach(e=>{i.add(e)})}catch(e){this.#$=[],r(e)}})}#W(){this.#A&&this.#A.start()}#U(){this.#A&&(this.#A.stop(),this.#A=null)}async #B(){if(!this.#M){this.#M=!0;try{await this.#H()}catch(e){}this.#M=!1}}}class R{#V=!1;#C=!1;#K=new Map;#P=new Map;#b;constructor(e){this.#b=e}close=()=>{for(let[e,t]of(this.#C=!0,this.#P=new Map,this.#K.entries()))this.#K.delete(e),t.close()};flush=async()=>{if(this.#C)return;let e=this.#z(new Date);await e.flush()};getTraverser=async e=>{if(this.#C)return null;let{startTime:t,endTime:r}=e,n=await this.#b.dbNameHandler.filterDatabaseNames(t,r);if(!n.length)return null;let i=n.map(e=>this.#G(e)).filter(e=>!!e),s=(await Promise.all(i.map(t=>t.getTraverser(e)))).filter(e=>!!e);return s.length?("prev"===e.direction&&s.reverse(),new $(s)):null};log=async e=>{if(this.#C)return;this.#V||this.#q();let t=this.#z(e.date);await t.save(e)};observe=(e,t)=>{this.#P.set(e,t)};#J=async()=>{try{let e=await this.#b.dbNameHandler.filterExpireDatabaseNames(new Date);await Promise.all(e.map(e=>this.#Z(e))),this.#F("clear-expired")}catch(e){}};#Z=e=>new Promise(async(t,r)=>{let n=this.#K.get(e);n&&(await n.close(),this.#K.delete(e)),new Promise(t=>{let r=indexedDB.deleteDatabase(e);r.onsuccess=()=>{t(!0)},r.onerror=()=>{t(!1)},r.onblocked=()=>{t(!1)}}).then(e=>{t(e)}).catch(e=>{r(e)})});#F=e=>{let t=this.#P.get(e);if(t)try{t()}catch(e){}};#G=e=>{let t=this.#K.get(e);if(t)return t;let r=new C({dbName:e,indexes:this.#b.indexes,storeName:this.#b.storeName,useCache:this.#b.useCache,cacheCount:_(this.#b.cacheCount,1e3),cacheInterval:_(this.#b.cacheInterval,1e3)});return this.#K.set(e,r),r.observe("flushed",()=>this.#F("flushed")),r};#z=e=>{let t=this.#b.dbNameHandler.getDatabaseName(e);return this.#G(t)};#q=()=>{this.#V||(this.#V=!0,setTimeout(()=>this.#J(),this.#b.expiredCheckFirstMs),setInterval(()=>this.#J(),this.#b.expiredCheckIntervalMs))}}let A=new R({dbNameHandler:new class{#b;constructor(e){this.#E(e),this.#b=e}filterDatabaseNames=async(e,t)=>(await this.#Q()).filter(r=>this.#Y(r,e,t)).sort((e,t)=>{let r=this.#X(e),n=this.#X(t);return r&&n?r?.getTime()-n?.getTime():0});filterExpireDatabaseNames=async e=>(await this.#Q()).filter(t=>this.#ee(t,e));getDatabaseName=e=>{let t=[e.getFullYear(),e.getMonth()+1],{granularity:r,dateDelimiter:n,delimiter:i,prefix:s,suffix:a}=this.#b;do{if(t.push(e.getDate()),"day"===r||(t.push(e.getHours()),"hour"===r)||(t.push(e.getMinutes()),"minute"===r)||(t.push(e.getSeconds()),"second"===r))break;throw new u("granularity",r,"is not supported.")}while(!1);let o=[s,t.join(n)];return a&&o.push(a),o.join(i)};#E(e){let{granularity:t}=e;var r=["day","hour","minute","second"];if((!({optional:!1}).optional||void 0!==t)&&!Array.prototype.includes.call(r,t))throw new c("granularity",`('${Array.prototype.join.call(r,"|")}')`,t)}#Q=async()=>{let e=await this.#b.getAllNames(),{prefix:t,delimiter:r}=this.#b;return e.filter(e=>e.startsWith(`${t}${r}`))};#et=e=>{let t=this.#X(e);if(!t)return null;var r=this.#b.granularity;let n=new Date(t.getTime()),i=null;switch(r){case"day":n.setHours(0,0,0,0),i=new Date(n.getTime()+864e5-1);break;case"hour":n.setMinutes(0,0,0),i=new Date(n.getTime()+36e5-1);break;case"minute":n.setSeconds(0,0),i=new Date(n.getTime()+6e4-1);break;case"second":n.setMilliseconds(0),i=new Date(n.getTime()+1e3-1);break;default:throw new u("granularity",r,"is not supported.")}return{start:n,end:i}};#ee=(e,t)=>{let r=this.#et(e);if(!r)return!1;let{granularity:n,expireUnitCount:i}=this.#b,s=0;switch(n){case"day":s=864e5*i;break;case"hour":s=36e5*i;break;case"minute":s=6e4*i;break;case"second":s=1e3*i;break;default:throw new u("granularity",n,"is not supported.")}let{end:a}=r;return a.getTime()<=t.getTime()-s};#Y=(e,t,r)=>{let n=this.#et(e);if(!n)return!1;let{start:i,end:s}={start:t,end:r},{start:a,end:o}=n;return!(s<i)&&!(o<a)&&(i<a?s>a:i<o)};#X=e=>{let{delimiter:t,dateDelimiter:r}=this.#b,n=e.split(t)[1];if(!n)return null;let i=n.split(r),s=[];for(let e of i){let t=Number(e);if(e&&!Number.isNaN(t)){s.push(t);continue}return null}if(![["day",3],["hour",4],["minute",5],["second",6]].some(e=>{let t,r;return t=e[0],r=e[1],this.#b.granularity===t&&i.length===r}))return null;let[a,o,l,c,u,h]=s;return new Date(a,o-1,l,c??0,u??0,h??0)}}({dateDelimiter:"_",delimiter:"||",expireUnitCount:5,getAllNames:N,granularity:"day",prefix:"lark_api_log",suffix:""}),indexes:[{keyPath:"date",indexName:"date",unique:!1},{keyPath:"level",indexName:"level",unique:!1}],storeName:"logs",expiredCheckFirstMs:5e3,expiredCheckIntervalMs:432e6,useCache:!0,cacheCount:1e3,cacheInterval:1e3});class L{#er=!1;#en=[];#ei;#es;#ea;#eo;#el;#ec;#eu=10;#eh;constructor(e){this.#er=e.analyzeStackContextId,this.#en=function(){let e=[],t=I.runtime;return e.push(t),e.push(function(e){if(!e)return"web";switch(e){case"web":if(globalThis?.location?.href){let e=location.href.match(/^https?:\/\/[0-9a-zA-Z.-]+(\/next\/|\/)((?<name1>[a-z]+$)|(?<name2>[a-z]+)\/.*$)/);return e?.groups?.name1??e?.groups?.name2??"unknown"}return"unknown";case"webworker":case"sharedworker":return globalThis?.name||"unknown";default:throw Error(`runtime '${e}' is not supported.`)}}(t)),e}(),this.#es=e.handlerSet,this.#ea=e.module,this.#eo=[...e.namespaces],this.#eu=e.stackTraceLimit,this.#el=e.persist,this.#ec=e.printToConsole,this.#ei=e.delegate,this.#eh=e.validators}debug=(...e)=>{this.#ed("debug",e)};error=(...e)=>{this.#ed("error",e)};extractContextId=()=>this.#er?(e=>{let t=Error.stackTraceLimit;Error.stackTraceLimit=e;let{stack:r}=Error();Error.stackTraceLimit=t;let n="";if(r){let e=r.lastIndexOf(g);if(-1!==e){let t=r.substring(e),i=g.length,s=t.indexOf(" ");n=t.substring(i,s)}}return n})(this.#eu):"";getContext=()=>this.#en;getNamespaces=()=>this.#eo;getPersistHandler=()=>this.#es.persistHandler;info=(...e)=>{this.#ed("info",e)};warn=(...e)=>{this.#ed("warn",e)};#ep(e,t){return{level:e,context:this.#en,namespaces:this.#eo,message:t.map(e=>(function(e){let t="";try{var r;let n;t=!function(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object DOMError]":case"[object DOMException]":return!0;default:return e instanceof Error}}(e)?"object"==typeof e&&null!==e?function(e){try{return Object.prototype.toString.call(e)}catch(e){return"[Object]"}}(e):String(e):(r=e,(n=Object.getOwnPropertyNames(r)).length||(n=["code","name","message"]),JSON.stringify(r,n,2).replace(/\\n/g,"\n"))}catch(e){t="[format_error]"}finally{return t}})(e)).join(" "),date:new Date,module:this.#ea,prefix:this.#ef()}}#ef(){let e={};return this.#er&&(e.contextId=this.extractContextId()),e}#ed(e,t){try{var r;let n=this.#ep(e,t);if(n.message=this.#em(n.message),!1!==this.#ec&&this.#es.devToolsHandler.log(n),r=n.level,!(m[function(){let e=new Set(["debug","info","warn","error"]),t=I.logLevel;return t&&e.has(t)?t:"info"}()]<=m[r]))return;!1!==this.#el&&this.#es.persistHandler.log(n),this.#ei?.log(n)}catch(e){}}#em(e){let t=e;return this.#eh.forEach(e=>{t=e.check(t)}),t}}let P=e=>{var t,r=e;p(r,"options"),((e,t,r)=>{if(r?.optional&&void 0===e)return;if(!Array.isArray(e))throw new c(t,"Array",e);let n=r?.minLength===void 0?0:r.minLength,i=r?.maxLength===void 0?Number.MAX_SAFE_INTEGER:r.maxLength;if(e.length<n)throw new u(t,e,`must be longer than or equal to ${n}`);if(e.length>i)throw new u(t,e,`must be shorter than or equal to ${i}`)})(r.namespaces,"options.namespaces");var n=r.analyzeStackContextId;if((!({optional:!0}).optional||void 0!==n)&&"boolean"!=typeof n)throw new c("options.analyzeStackContextId","boolean",n);p(r.delegate,"options.delegate",{optional:!0});var i=r.delegate?.log;if((!({optional:!0}).optional||void 0!==i)&&"function"!=typeof i)throw new c("options.delegate.log","Function",i);d(r.stackTraceLimit,"options.stackTraceLimit",{optional:!0});let s=(t=void 0,{devToolsHandler:t?.devToolsHandler??k,persistHandler:t?.persistHandler??A});return new L({analyzeStackContextId:e.analyzeStackContextId??!1,delegate:e.delegate,handlerSet:s,module:"lark-api-logger",namespaces:e.namespaces,persist:void 0===e.persist?"default":e.persist,printToConsole:void 0===e.printToConsole?"dev-only":e.printToConsole,stackTraceLimit:e.stackTraceLimit??10,validators:w})}},510597:function(e,t,r){r.d(t,{QJ:()=>n,pM:()=>i});var n="data-lark-atuser",i="data-lark-doclink"},237434:function(e,t,r){r.d(t,{q:()=>E});var n=r(437751),i=r(399525),s=r(343779),a=r(974110),o=r(614225),l=r(695287),c=r(294489),u=r(811069),h=r(358248),d=r(724642),p=r.n(d),f=r(885121),m=r.n(f),g=r(477837),y=r.n(g),w=r(188848);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var b=function(){function e(){(0,s.Z)(this,e),(0,h.Z)(this,"prefix","[CPSDK]")}return(0,a.Z)(e,[{key:"concat",value:function(e){var t,r="",n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return v(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if("string"==typeof i)r+="".concat(i," ");else if(i instanceof Error)r+="error message".concat(i.message),i.stack&&(r+="".concat(i.stack," "));else if("object"===(0,w.Z)(i))try{r+=JSON.stringify(i)}catch(e){return"[can not JSON.stringify]"}else r+="".concat(String(i)," ")}}catch(e){n.e(e)}finally{n.f()}return r.trim()}},{key:"info",value:function(){for(var t=this,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];this.concat(n).split("\n").forEach(function(r){e.logger.info(t.prefix,r)})}},{key:"error",value:function(){for(var t=this,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];this.concat(n).split("\n").forEach(function(r){e.logger.error(t.prefix,r)})}},{key:"reportException",value:function(t){e.errorReporter&&e.errorReporter(t)}},{key:"warn",value:function(){for(var t=this,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];this.concat(n).split("\n").forEach(function(r){e.logger.warn(t.prefix,r)})}},{key:"setLogger",value:function(t){e.logger=t}},{key:"setErrorReporter",value:function(t){e.errorReporter=t}},{key:"tryStringify",value:function(e){try{return JSON.stringify(e)}catch(e){return"[can not JSON.stringify]"}}}]),e}();function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}(0,h.Z)(b,"logger",{info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];console.log.apply(null,t)},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error.apply(null,t)},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];console.warn.apply(null,t)}}),(0,h.Z)(b,"errorReporter",void 0);var E=function(e){(0,l.Z)(f,e);var t,r,d=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,u.Z)(f);return e=t?Reflect.construct(r,arguments,(0,u.Z)(this).constructor):r.apply(this,arguments),(0,c.Z)(this,e)});function f(e){var t;return(0,s.Z)(this,f),t=d.call(this),(0,h.Z)((0,o.Z)(t),"options",void 0),(0,h.Z)((0,o.Z)(t),"fgList",void 0),(0,h.Z)((0,o.Z)(t),"plugins",void 0),(0,h.Z)((0,o.Z)(t),"logger",new b),(0,h.Z)((0,o.Z)(t),"debounceCopy",void 0),t.options=e,t.plugins=e.plugins,t.debounceCopy=y()(t.handleCopy.bind((0,o.Z)(t)),500,{leading:!0}),t.init(),t}return(0,a.Z)(f,[{key:"getOptions",value:function(){return this.options}},{key:"init",value:function(){var e;this.options.takeOverCopy&&(null==(e=this.options.container)||e.addEventListener("copy",this.debounceCopy)),this.options.logger&&this.logger.setLogger(this.options.logger)}},{key:"parser",value:function(e,t){var r=m().sanitize(e,{ALLOW_UNKNOWN_PROTOCOLS:!0});return new DOMParser().parseFromString(r,"text/html").body.innerHTML}},{key:"toUniformHTML",value:function(e,t){var r=this,n={html:e};return this.plugins.forEach(function(e){if("function"==typeof e)try{e(n.html)}catch(e){r.logger.error("plugin error, error: ".concat(e))}}),e}},{key:"handleCopy",value:(r=(0,i.Z)(p().mark(function e(){var t,r,i,s,a,o,l,c,u,h,d,f,m,g=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("start copy"),t="",e.prev=2,e.next=5,navigator.clipboard.read();case 5:i=e.sent,this.logger.info("get clipboardItems, length: ".concat(i.length)),s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return x(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x(e,t)}}(e))){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}(i),e.prev=8,s.s();case 10:if((a=s.n()).done){e.next=43;break}if(!((o=a.value).types.includes("text/html")&&o.types.includes("text/plain"))){e.next=27;break}return this.logger.info("both have html and text"),e.next=16,Promise.all([o.getType("text/html"),o.getType("text/plain")]);case 16:return l=e.sent,u=(c=(0,n.Z)(l,2))[0],r=c[1],e.next=23,u.text();case 23:t=e.sent,this.logger.info("html length: ".concat(t.length)),e.next=41;break;case 27:if(!o.types.includes("text/html")){e.next=35;break}return e.next=30,o.getType("text/html");case 30:return h=e.sent,e.next=33,h.text();case 33:t=e.sent,this.logger.info("get html length: ".concat(t.length));case 35:if(!o.types.includes("text/plain")){e.next=41;break}return e.next=38,o.getType("text/plain");case 38:r=e.sent,this.logger.info("get last text blob");case 41:e.next=10;break;case 43:e.next=48;break;case 45:e.prev=45,e.t0=e.catch(8),s.e(e.t0);case 48:return e.prev=48,s.f(),e.finish(48);case 51:e.next=56;break;case 53:e.prev=53,e.t1=e.catch(2),this.logger.error("fail to get clipboard data: ",e.t1);case 56:if(!(!t||t.trim().length<=0)){e.next=58;break}return e.abrupt("return");case 58:r||(this.logger.info("new text blob is empty"),r=new Blob([""],{type:"text/plain"})),d=new DOMParser().parseFromString(t,"text/html").body,this.toUniformHTML(d),f=d.innerHTML,this.logger.info("new html length: ".concat(f.length)),e.prev=64,m=[new ClipboardItem({"text/html":new Blob([f],{type:"text/html"}),"text/plain":r})],navigator.clipboard.write(m).then(function(){g.logger.info("successfully write html to clipboard"),g.emit("copied")},function(e){g.logger.error("error write html to clipboard: ",e)}),e.next=74;break;case 70:throw e.prev=70,e.t2=e.catch(64),this.logger.error("navigator clipboard write catch error:",e.t2),Error(e.t2);case 74:case"end":return e.stop()}},e,this,[[2,53],[8,45,48,51],[64,70]])})),function(){return r.apply(this,arguments)})},{key:"addCopyListener",value:function(e){e.addEventListener("copy",this.debounceCopy)}},{key:"removeCopyListener",value:function(e){e.removeEventListener("copy",this.debounceCopy)}},{key:"destory",value:function(){var e;null==(e=this.options.container)||e.removeEventListener("copy",this.debounceCopy)}}]),f}(function(){function e(){(0,s.Z)(this,e),(0,h.Z)(this,"_events",{})}return(0,a.Z)(e,[{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}},{key:"emit",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this._events[e]&&this._events[e].slice(0).forEach(function(e){e.call.apply(e,[null].concat(r))})}},{key:"once",value:function(e,t){var r=this;this.on(e,function n(){for(var i=arguments.length,s=Array(i),a=0;a<i;a++)s[a]=arguments[a];t.call.apply(t,[null].concat(s)),r.off(e,n)})}},{key:"off",value:function(e,t){if(this._events[e]){if(!t)return void delete this._events[e];for(var r=0;r<this._events[e].length;r++)this._events[e][r]===t&&(this._events[e].splice(r,1),r--)}}},{key:"cleanEvents",value:function(){this._events={}}}]),e}())},720109:function(e,t,r){r.d(t,{z2:()=>i});var n=r(510597);function i(e){if(!(e&&e.getAttribute(n.QJ)))return null;var t=function(e){try{var t=(null==e?void 0:e.getAttribute(n.QJ))||"";return JSON.parse(t)||{}}catch(e){return{userid:"",username:""}}}(e);return{userid:t.userid,username:t.username}}},564472:function(e,t,r){r.d(t,{Ce:()=>i});var n=r(510597);function i(e){if(!(e&&e.getAttribute(n.pM)))return null;var t=function(e){try{var t=(null==e?void 0:e.getAttribute(n.pM))||"";return JSON.parse(t)||{}}catch(e){return{title:"",url:"",token:""}}}(e),r=t.title,i=t.url,s=t.token;return{title:r,url:decodeURIComponent(i||""),token:s}}},310796:function(e,t,r){r.d(t,{E:()=>s});var n=r(484715),i=r(106540),s=function(e){var t=e.selector,r=e.getAtUserData;return(0,n.Qx)(void 0===t?"[id^='at-user-']":t,function(e){var t=r(e),n=t.userid,s=t.username;(n||s)&&(0,i.E)(e,{userid:n,username:s})})}},587767:function(e,t,r){r.d(t,{J:()=>s});var n=r(484715),i=r(577027),s=function(e){var t=e.selector,r=e.getDocLinkData;return(0,n.Qx)(void 0===t?"[data-doclink*=true]":t,function(e){var t,n,s=r(e),a=s.title,o=s.url,l=s.type,c=s.token;(0,i.J)(e,{title:a||e.innerText,url:o||e.url,type:l||(null==(t=e.dataset)?void 0:t.type),token:c||(null==(n=e.dataset)?void 0:n.token)})})}},635341:function(e,t,r){r.d(t,{B:()=>i});var n=r(484715),i=function(e){var t=e.selector,r=e.getBase64List;return(0,n.Qx)(void 0===t?"img[data-img]":t,function(e){var t=r(e);e.setAttribute("src",t)})}},934502:function(e,t,r){r.d(t,{b:()=>i});var n=r(484715),i=function(e){var t=e.selector,r=e.serializerStyle;if(t)return(0,n.Qx)(t,function(e){r(e)})}},106540:function(e,t,r){r.d(t,{E:()=>i});var n=r(510597);function i(e,t,r){if(!e)return null;var i,s=r?document.createElement("span"):e,a=(i=JSON.stringify(t),{attributeName:n.QJ,attributeValue:i});if(!a)return null;var o=a.attributeName,l=a.attributeValue;return s.setAttribute(o,l),r&&s.appendChild(e),s}},577027:function(e,t,r){r.d(t,{J:()=>i});var n=r(510597);function i(e,t,r){if(!e)return null;var i=r?document.createElement("span"):e,s=function(e){if(!e.url)return null;var t=JSON.stringify({title:e.title,url:decodeURIComponent(e.url),token:e.token,type:e.type});return{attributeName:n.pM,attributeValue:t}}(t);if(!s)return null;var a=s.attributeName,o=s.attributeValue;return i.setAttribute(a,o),r&&i.appendChild(e),i}},484715:function(e,t,r){r.d(t,{Qx:()=>n});function n(e,t){return function(r){return r.querySelectorAll(e).forEach(function(e){t(e)}),r}}},161520:function(e,t,r){t.default=void 0;var n=s(r(860721)),i=s(r(331728));function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){var n,i,s;n=e,i=t,s=r[t],i in n?Object.defineProperty(n,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[i]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var l=(0,i.default)(function(e){return(e.split("#")[1]||"/").split("?")[0]}),c=(0,i.default)(function(e,t){var r=e.split("?")[1],i=n.default.stringify(o(o({},n.default.parse(t)),r?n.default.parse(r):{}));return i.startsWith("?")?i:"?".concat(i)}),u=window.location,h="native-resource:"===window.location.protocol;if(window.useHashRouter||"file:"===window.location.protocol||h){var d=window.User&&window.User.domain||"www.feishu.cn";u=new Proxy({protocol:"https:",host:d,hostname:d,port:window.location.port,origin:"https://".concat(d)},{get:function(e,t){if(t in e)return e[t];switch(t){case"pathname":return l(window.location.hash);case"hash":return"";case"href":return"".concat(u.origin).concat(u.pathname).concat(u.search).concat(u.hash);case"search":return c(window.location.hash,window.location.search)}return"function"==typeof window.location[t]?window.location[t].bind(window.location):window.location[t]},set:function(e,t,r){var n=window.User&&window.User.domain;if("href"===t)switch(!0){case n&&r.startsWith("#"):break;case n&&r.startsWith("?"):return window.open("https://".concat(n).concat(u.pathname).concat(r)),!0;case n&&r.startsWith("/"):return window.open("https://".concat(n).concat(r)),!0;case/^\w+:\/\//.test(r):return n&&r.startsWith(u.origin)&&r.replace(u.origin,"https://".concat(n)),window.open(r),!0}}})}window.docsLocation=u,t.default=u},722141:function(e,t,r){var n,i,s,a,o,l,c,u,h,d;r.d(t,{Fm:()=>s,Xn:()=>o,bs:()=>a,go:()=>n,t4:()=>i}),(l=n||(n={})).ZhCn="zh_CN",l.ZhHk="zh_HK",l.ZhTw="zh_TW",l.EnUs="en_US",l.JaJp="ja_JP",l.Rw="rw",l.Es="es_ES",l.It="it_IT",l.De="de_DE",l.Fr="fr_FR",l.PtBr="pt_BR",l.Id="id_ID",l.ViVn="vi_VN",l.Th="th_TH",l.KoKr="ko_KR",l.Ru="ru_RU",l.HiIn="hi_IN",(c=i||(i={})).Web="web",c.Native="native",(u=s||(s={})).Hosted="hosted",u.OnPremise="on-premise",u.Saas="saas",(h=a||(a={})).UnitNC="eu_nc",h.UnitEA="eu_ea",(d=o||(o={})).Dev="development",d.Alpha="alpha",d.Staging="staging",d.PreRelease="prerelease",d.Production="production"},382369:function(e,t,r){var n,i,s,a,o,l,c,u,h,d;r.d(t,{go:()=>n}),(l=n||(n={})).ZhCn="zh_CN",l.ZhHk="zh_HK",l.ZhTw="zh_TW",l.EnUs="en_US",l.JaJp="ja_JP",l.Rw="rw",l.Es="es_ES",l.It="it_IT",l.De="de_DE",l.Fr="fr_FR",l.PtBr="pt_BR",l.Id="id_ID",l.ViVn="vi_VN",l.Th="th_TH",l.KoKr="ko_KR",l.Ru="ru_RU",l.HiIn="hi_IN",(c=i||(i={})).Web="web",c.Native="native",(u=s||(s={})).Hosted="hosted",u.OnPremise="on-premise",u.Saas="saas",(h=a||(a={})).UnitNC="eu_nc",h.UnitEA="eu_ea",(d=o||(o={})).Dev="development",d.Alpha="alpha",d.Staging="staging",d.PreRelease="prerelease",d.Production="production"},317187:function(e,t,r){r.d(t,{O:()=>l});var n=r(513546),i=r.n(n),s=r(777179),a=r.n(s);let o={env:{},domains:{}},l=new Proxy({},{get(e,t){if("appName"===t){let e=function(){let e=window.globalKaConfig;if(!(null==e?void 0:e.i18n)||!e.i18n.app_name)return;let t=l.locale||l.lang;return t?(t=t.replace("_","-"),e.i18n.app_name[t]||e.i18n.app_name.$base):void console.warn("no env.locale or env.lang")}();if(e)return e}let r=function(e){let t=i()(o,"env");return"env".startsWith("runtime")?t:a()(t)}("env");return void 0===r?e[t]:void 0!==r[t]?r[t]:e[t]}});l.update=()=>{console.error("web not impl.")}},382201:function(e,t,r){let n,i,s,a;r.d(t,{kk:()=>X,U2:()=>Y,CZ:()=>es,N7:()=>er,VL:()=>ei,U7:()=>et,IF:()=>ea,B5:()=>ec,hC:()=>eu,t8:()=>ee,fd:()=>eo,wg:()=>el,Ux:()=>en});var o,l,c=r(47324),u=r(383021);let h=navigator.platform.indexOf("Mac")>-1?"Command":"Ctrl",d="lark_web_settings",p={uiSetting:{doneNext:!0},shortcut:{send:"Enter",openQuickSearch:`${h}+K`,openSecondQuickSearch:`${h}+F`},notifySetting:{notifySound:!0,showDetail:!0,showUnreadNumber:!0,newMessagePush:!0,badgeStyle:u.PN.WEAK_REMIND}},f={"lark.custom":JSON.stringify(p)},m=null,g={async get(e){if(!m){try{m=JSON.parse(localStorage.getItem(d));let e=JSON.parse(m["lark.custom"]);e&&Object.keys(e).forEach(t=>p[t]&&"object"==typeof e[t]&&(e[t]={...p[t],...e[t]})),e&&(m["lark.custom"]=JSON.stringify(e))}catch(e){console.error("use defult when getting local settings error",e),m=f}m=m||f,localStorage.setItem(d,JSON.stringify(m))}return e.reduce((e,t)=>[...e,m[t]],[])},set:async e=>(m={...m,...e},localStorage.setItem(d,JSON.stringify(m)),m)};var y=r(444299),w=r(513546),v=r.n(w),b=r(777179),x=r.n(b);r(785466),r(538265);var E=r(995334);let I={env:{},domains:{}};function S(e){let t=v()(I,e);return e.startsWith("runtime")?t:x()(t)}let k=new Proxy({},{get(e,t){if("appName"===t){let e=function(){let e=window.globalKaConfig;if(!e?.i18n||!e.i18n.app_name)return;let t=k.locale||k.lang;return t?(t=t.replace("_","-"),e.i18n.app_name[t]||e.i18n.app_name.$base):void console.warn("no env.locale or env.lang")}();if(e)return e}let r=S("env");return void 0===r?e[t]:void 0!==r[t]?r[t]:e[t]}});k.update=()=>{console.error("web not impl.")};var N=r(381105),_=r(272539),T=r(373553);(o=l||(l={}))[o.SILENT=0]="SILENT",o[o.TRACE=1]="TRACE",o[o.DEBUG=2]="DEBUG",o[o.INFO=3]="INFO",o[o.WARN=4]="WARN",o[o.ERROR=5]="ERROR";let O=["trace","debug","info","warn","error","silent"];function $(e){let t=O.indexOf(e);return -1===t?l.SILENT:t}let C={[l.TRACE]:"trace",[l.DEBUG]:"debug",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error",[l.SILENT]:"trace"},R={};class A{namespace;logLevel;loggerImpl;constructor(e,t){this.namespace=e,this.logLevel=l.DEBUG,this.loggerImpl=t}static getLogger(e,t){return R[e]=R[e]||new A(e,t),R[e]}setLevel(e){this.logLevel=$(e)}enableAll(){this.setLevel("trace")}disableAll(){this.setLevel("silent")}trace(e,...t){this.log(l.TRACE,e,t)}debug(e,...t){this.log(l.DEBUG,e,t)}info(e,...t){this.log(l.INFO,e,t)}perf(e,...t){this.log(l.INFO,e,t)}warn(e,...t){this.log(l.WARN,e,t)}error(e,...t){this.log(l.ERROR,e,t)}print({traceId:e,scene:t},...r){let n=t[0],i=t[1],s=t[2],a=t[3],o=[];if(a){let e=a.split("{}");for(let t=0,n=e.length;t<n;t++)(!e[t]||t!==n-1)&&(o.push(e[t]),n>1&&void 0!==r[t]&&o.push(r[t]))}this.log($(s),`[${e}][${n}][${i}]`,[...o])}generateTraceId(){return[...Array(8)].map(()=>Math.floor(36*Math.random()).toString(36)).join("")}log(e,t,r){this.logLevel!==l.SILENT&&(this.logLevel&&e<this.logLevel||this.loggerImpl.log({level:e,template:t,args:r,namespace:this.namespace}))}}let L={log({level:e,template:t,args:r,namespace:n}){let i=C[e];(console[i]||console.log)(n,t,...r)}},P=(e,t=L)=>A.getLogger(e,t),D=({getLogger:P,getLoggerWithLogId:P}).getLogger("frontend");function j(e){return new Promise((t,r)=>Promise.resolve(e).then(r,t))}let M=new c.EventEmitter,F=(0,T.B)("foundation","settingsV3"),U=!1;function B(){return F.getItem("data").then(e=>{if(!e){let e="[Lark Runtime] setting v3: no cached data";throw D.error(e),Error(e)}return{data:e,meta:void 0}})}async function W(e=3){try{return await function(){let{appId:e,domains:t}=["appId","domains"].reduce((e,t)=>{let r=S(t);return void 0!==r&&(e[t]=r),e},{}),r=(t||{})[E.YHf.API],n=r?r[0]:"",{appVersion:i,channel:a}=k,o={version:i,app_id:e,app:"lark",platform:"web",action:"startup",app_channel:a};if(s){let{user_etag:e,data_etag:t,version_code:r}=s;o.data_etag=t,o.version_code=r,o.user_etag=e}let l=`https://${n}/settings/v3/`;return D.info("[Lark Runtime] setting v3: server data fetch start, url={}, params={}",l,JSON.stringify(o)),(function(e){let{headers:t,data:r,method:n}=e,{url:i}=e,s={method:n,headers:(t&&(t.requestId||(t["x-request-id"]=(0,_.Z)())),t),mode:"cors",credentials:"include"};if(r)switch(n){case"GET":i=(0,N.stringifyUrl)({url:i,query:r});break;case"POST":s.body=r}return fetch(i,s)})({url:l,method:"GET",data:o}).then(e=>e.json())}()}catch(t){if(D.error("[Lark Runtime] setting v3: fetch data error while initializing",t),e<=0)return D.error("[Lark Runtime] setting v3: will try to use local cache"),B();return D.info("[Lark Runtime] setting v3: will retry fetching in 10 seconds..."),await new Promise(e=>{setTimeout(()=>e(),1e4)}),W(e-1)}}async function H(){let e=W();return e.then(e=>{var t,r;0!==Object.keys(t=e.data).length&&(M.emit("SETTINGS_UPDATE",t),i=Object.assign({},i,t),F.setItem("data",i)),(r=e.meta)&&(s=r)}).finally(()=>{U=!0,function(){a&&(clearTimeout(a),a=null);let e=v()(s,"ttl"),t=e?1e3*e:36e5;a=(window||self).setTimeout(async()=>{a=null,n=H()},t),D.info(`[Lark Runtime] setting v3: next fetch scheduled, timeout: ${t}`)}()}),e}async function V(){if(U)return Promise.resolve();n||(D.info("[Lark Runtime] setting v3: first fetch"),n=H()),await n}async function K(e,t=!1){let r=await (i?Promise.resolve(i):(U||V(),j(Promise.all([B(),n].map(j))).then(e=>e.data).catch(()=>{throw Error("setting v3 init error")}))),s={};return e.forEach(e=>{let t=v()(r,e);s[e]=x()(t)}),s}async function z(e){return(await K([e]))[e]}var G=r(688430);async function q(e,t,r){let n,{value:i,command:s}=function(e){let[t,r,n,i,s]=e.split("|");return{value:parseInt(t,10),requestPb:r,responsePb:n,type:i,command:s}}(e);if(isNaN(i))throw Error(`transport::callApi invalid cmd: ${e}`);D.info(`transport::callApi:start ${s||"unknown command"}(${i})`);try{n=await (0,G.t9)(e,t)}catch(e){throw D.info(`transport::callApi:end:error ${s||"unknown command"}(${i})`),e}return D.info(`transport::callApi:end:success ${s||"unknown command"}(${i})`),n}var J=r(382369);J.go.ZhCn,G.SQ.Chinese,J.go.EnUs,G.SQ.English,J.go.JaJp,G.SQ.Japanese,E.YHf.API,E.YHf.LONG,E.YHf.PASSPORT,E.YHf.FILE,E.YHf.SUITE_TKLOG,E.YHf.SUITE_MAIN_DOMAIN,E.YHf.OPEN,E.YHf.INTERNAL_API,E.YHf.OPEN_APPCENTER3;var Z=r(150542);let Q=new c.EventEmitter;async function Y(e){return(await g.get([e]))[0]}async function X(e){return(await g.get(e)).reduce((t,r,n)=>(t[e[n]]=r,t),{})}async function ee(e,t){let r=await g.set({[e]:t});return Q.emit("changed",[e]),r}async function et(e){let t=await g.set(e),r=Object.keys(e);return Q.emit("changed",r),t}function er(e,t){let r=async r=>{let n=r.filter(t=>e.includes(t)),i=await X(n);n.length>0&&t(i)};return Q.on("changed",r),()=>{Q.off("changed",r)}}async function en(){return Y("lark.custom").then(e=>({settings:e}))}async function ei(e){await ee("lark.custom",e.settings)}er(["lark.locale"],e=>{var t;return e["lark.locale"]&&void(t=(t=e["lark.locale"]).replace("_","-"),document.cookie=`i18n_locale=${t};path=/;expires=${new Date(Date.now()+365*864e5)};`,(0,y.setSuiteLang)(t),location.href=new URL("/messenger",location.origin).href)});let es=Y,ea=X,eo=ee,el=et,ec=er;async function eu(){let e,t;try{e=await z("client_dynamic_link")}catch(e){D.error("Get client_dynamic_l error: ",e)}try{t=await q(Z.QX8,{})}catch(e){D.error("GET_APP_CONFIG error: ",e)}return{...t?.appConfig?.resource?.addrs||{},...e||{}}}},980921:function(e,t,r){function n(){return Promise.resolve({style:"UI3"})}r.d(t,{Lo:()=>l,Ub:()=>i,V9:()=>a,Vt:()=>s,i$:()=>o,j2:()=>c,pN:()=>n});let i=async()=>Promise.resolve({style:"LIGHT"}),s=async()=>Promise.resolve({}),a=e=>()=>{},o=e=>()=>{},l=async e=>[],c=async e=>[]},398786:function(e,t,r){let n,i,s,a;r.d(t,{kk:()=>X,U2:()=>Y,CZ:()=>es,N7:()=>er,VL:()=>ei,U7:()=>et,IF:()=>ea,B5:()=>ec,hC:()=>eu,t8:()=>ee,fd:()=>eo,wg:()=>el,Ux:()=>en});var o,l,c=r(47324),u=r(136530);let h=navigator.platform.indexOf("Mac")>-1?"Command":"Ctrl",d="lark_web_settings",p={uiSetting:{doneNext:!0},shortcut:{send:"Enter",openQuickSearch:`${h}+K`,openSecondQuickSearch:`${h}+F`},notifySetting:{notifySound:!0,showDetail:!0,showUnreadNumber:!0,newMessagePush:!0,badgeStyle:u.PN.WEAK_REMIND}},f={"lark.custom":JSON.stringify(p)},m=null,g={async get(e){if(!m){try{m=JSON.parse(localStorage.getItem(d));let e=JSON.parse(m["lark.custom"]);e&&Object.keys(e).forEach(t=>p[t]&&"object"==typeof e[t]&&(e[t]={...p[t],...e[t]})),e&&(m["lark.custom"]=JSON.stringify(e))}catch(e){console.error("use defult when getting local settings error",e),m=f}m=m||f,localStorage.setItem(d,JSON.stringify(m))}return e.reduce((e,t)=>[...e,m[t]],[])},set:async e=>(m={...m,...e},localStorage.setItem(d,JSON.stringify(m)),m)};var y=r(444299),w=r(513546),v=r.n(w),b=r(777179),x=r.n(b);r(785466),r(538265);var E=r(95304);let I={env:{},domains:{}};function S(e){let t=v()(I,e);return e.startsWith("runtime")?t:x()(t)}let k=new Proxy({},{get(e,t){if("appName"===t){let e=function(){let e=window.globalKaConfig;if(!e?.i18n||!e.i18n.app_name)return;let t=k.locale||k.lang;return t?(t=t.replace("_","-"),e.i18n.app_name[t]||e.i18n.app_name.$base):void console.warn("no env.locale or env.lang")}();if(e)return e}let r=S("env");return void 0===r?e[t]:void 0!==r[t]?r[t]:e[t]}});k.update=()=>{console.error("web not impl.")};var N=r(381105),_=r(272539),T=r(373553);(o=l||(l={}))[o.SILENT=0]="SILENT",o[o.TRACE=1]="TRACE",o[o.DEBUG=2]="DEBUG",o[o.INFO=3]="INFO",o[o.WARN=4]="WARN",o[o.ERROR=5]="ERROR";let O=["trace","debug","info","warn","error","silent"];function $(e){let t=O.indexOf(e);return -1===t?l.SILENT:t}let C={[l.TRACE]:"trace",[l.DEBUG]:"debug",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error",[l.SILENT]:"trace"},R={};class A{namespace;logLevel;loggerImpl;constructor(e,t){this.namespace=e,this.logLevel=l.DEBUG,this.loggerImpl=t}static getLogger(e,t){return R[e]=R[e]||new A(e,t),R[e]}setLevel(e){this.logLevel=$(e)}enableAll(){this.setLevel("trace")}disableAll(){this.setLevel("silent")}trace(e,...t){this.log(l.TRACE,e,t)}debug(e,...t){this.log(l.DEBUG,e,t)}info(e,...t){this.log(l.INFO,e,t)}perf(e,...t){this.log(l.INFO,e,t)}warn(e,...t){this.log(l.WARN,e,t)}error(e,...t){this.log(l.ERROR,e,t)}print({traceId:e,scene:t},...r){let n=t[0],i=t[1],s=t[2],a=t[3],o=[];if(a){let e=a.split("{}");for(let t=0,n=e.length;t<n;t++)(!e[t]||t!==n-1)&&(o.push(e[t]),n>1&&void 0!==r[t]&&o.push(r[t]))}this.log($(s),`[${e}][${n}][${i}]`,[...o])}generateTraceId(){return[...Array(8)].map(()=>Math.floor(36*Math.random()).toString(36)).join("")}log(e,t,r){this.logLevel!==l.SILENT&&(this.logLevel&&e<this.logLevel||this.loggerImpl.log({level:e,template:t,args:r,namespace:this.namespace}))}}let L={log({level:e,template:t,args:r,namespace:n}){let i=C[e];(console[i]||console.log)(n,t,...r)}},P=(e,t=L)=>A.getLogger(e,t),D=({getLogger:P,getLoggerWithLogId:P}).getLogger("frontend");function j(e){return new Promise((t,r)=>Promise.resolve(e).then(r,t))}let M=new c.EventEmitter,F=(0,T.B)("foundation","settingsV3"),U=!1;function B(){return F.getItem("data").then(e=>{if(!e){let e="[Lark Runtime] setting v3: no cached data";throw D.error(e),Error(e)}return{data:e,meta:void 0}})}async function W(e=3){try{return await function(){let{appId:e,domains:t}=["appId","domains"].reduce((e,t)=>{let r=S(t);return void 0!==r&&(e[t]=r),e},{}),r=(t||{})[E.YHf.API],n=r?r[0]:"",{appVersion:i,channel:a}=k,o={version:i,app_id:e,app:"lark",platform:"web",action:"startup",app_channel:a};if(s){let{user_etag:e,data_etag:t,version_code:r}=s;o.data_etag=t,o.version_code=r,o.user_etag=e}let l=`https://${n}/settings/v3/`;return D.info("[Lark Runtime] setting v3: server data fetch start, url={}, params={}",l,JSON.stringify(o)),(function(e){let{headers:t,data:r,method:n}=e,{url:i}=e,s={method:n,headers:(t&&(t.requestId||(t["x-request-id"]=(0,_.Z)())),t),mode:"cors",credentials:"include"};if(r)switch(n){case"GET":i=(0,N.stringifyUrl)({url:i,query:r});break;case"POST":s.body=r}return fetch(i,s)})({url:l,method:"GET",data:o}).then(e=>e.json())}()}catch(t){if(D.error("[Lark Runtime] setting v3: fetch data error while initializing",t),e<=0)return D.error("[Lark Runtime] setting v3: will try to use local cache"),B();return D.info("[Lark Runtime] setting v3: will retry fetching in 10 seconds..."),await new Promise(e=>{setTimeout(()=>e(),1e4)}),W(e-1)}}async function H(){let e=W();return e.then(e=>{var t,r;0!==Object.keys(t=e.data).length&&(M.emit("SETTINGS_UPDATE",t),i=Object.assign({},i,t),F.setItem("data",i)),(r=e.meta)&&(s=r)}).finally(()=>{U=!0,function(){a&&(clearTimeout(a),a=null);let e=v()(s,"ttl"),t=e?1e3*e:36e5;a=(window||self).setTimeout(async()=>{a=null,n=H()},t),D.info(`[Lark Runtime] setting v3: next fetch scheduled, timeout: ${t}`)}()}),e}async function V(){if(U)return Promise.resolve();n||(D.info("[Lark Runtime] setting v3: first fetch"),n=H()),await n}async function K(e,t=!1){let r=await (i?Promise.resolve(i):(U||V(),j(Promise.all([B(),n].map(j))).then(e=>e.data).catch(()=>{throw Error("setting v3 init error")}))),s={};return e.forEach(e=>{let t=v()(r,e);s[e]=x()(t)}),s}async function z(e){return(await K([e]))[e]}var G=r(688430);async function q(e,t,r){let n,{value:i,command:s}=function(e){let[t,r,n,i,s]=e.split("|");return{value:parseInt(t,10),requestPb:r,responsePb:n,type:i,command:s}}(e);if(isNaN(i))throw Error(`transport::callApi invalid cmd: ${e}`);D.info(`transport::callApi:start ${s||"unknown command"}(${i})`);try{n=await (0,G.t9)(e,t)}catch(e){throw D.info(`transport::callApi:end:error ${s||"unknown command"}(${i})`),e}return D.info(`transport::callApi:end:success ${s||"unknown command"}(${i})`),n}var J=r(382369);J.go.ZhCn,G.SQ.Chinese,J.go.EnUs,G.SQ.English,J.go.JaJp,G.SQ.Japanese,E.YHf.API,E.YHf.LONG,E.YHf.PASSPORT,E.YHf.FILE,E.YHf.SUITE_TKLOG,E.YHf.SUITE_MAIN_DOMAIN,E.YHf.OPEN,E.YHf.INTERNAL_API,E.YHf.OPEN_APPCENTER3;var Z=r(119293);let Q=new c.EventEmitter;async function Y(e){return(await g.get([e]))[0]}async function X(e){return(await g.get(e)).reduce((t,r,n)=>(t[e[n]]=r,t),{})}async function ee(e,t){let r=await g.set({[e]:t});return Q.emit("changed",[e]),r}async function et(e){let t=await g.set(e),r=Object.keys(e);return Q.emit("changed",r),t}function er(e,t){let r=async r=>{let n=r.filter(t=>e.includes(t)),i=await X(n);n.length>0&&t(i)};return Q.on("changed",r),()=>{Q.off("changed",r)}}async function en(){return Y("lark.custom").then(e=>({settings:e}))}async function ei(e){await ee("lark.custom",e.settings)}er(["lark.locale"],e=>{var t;return e["lark.locale"]&&void(t=(t=e["lark.locale"]).replace("_","-"),document.cookie=`i18n_locale=${t};path=/;expires=${new Date(Date.now()+365*864e5)};`,(0,y.setSuiteLang)(t),location.href=new URL("/messenger",location.origin).href)});let es=Y,ea=X,eo=ee,el=et,ec=er;async function eu(){let e,t;try{e=await z("client_dynamic_link")}catch(e){D.error("Get client_dynamic_l error: ",e)}try{t=await q(Z.QX8,{})}catch(e){D.error("GET_APP_CONFIG error: ",e)}return{...t?.appConfig?.resource?.addrs||{},...e||{}}}},308765:function(e,t,r){function n(){return Promise.resolve({style:"UI3"})}r.d(t,{Lo:()=>l,Ub:()=>i,V9:()=>a,Vt:()=>s,i$:()=>o,j2:()=>c,pN:()=>n});let i=async()=>Promise.resolve({style:"LIGHT"}),s=async()=>Promise.resolve({}),a=e=>()=>{},o=e=>()=>{},l=async e=>[],c=async e=>[]},724410:function(e,t,r){r.d(t,{E9:()=>n,zh:()=>i});class n{static connections={};dbName;storeName;constructor({dbName:e,storeName:t}={}){this.dbName=e||"lark-idb-store",this.storeName=t||"lark-idb-keyval"}getItem(e){let t;return this.withIdbStore("readonly",r=>{t=r.get(e)}).then(()=>t.result||null)}getItems(e){let t;return this.withIdbStore("readonly",r=>{t=e.map(e=>r.get(e))}).then(()=>t.reduce((t,r,n)=>({...t,[e[n]]:r.result||null}),{}))}setItem(e,t){return this.withIdbStore("readwrite",r=>{r.put(t,e)})}setItems(e){return this.withIdbStore("readwrite",t=>{Object.entries(e).forEach(([e,r])=>t.put(r,e))})}removeItem(e){return this.withIdbStore("readwrite",t=>{t.delete(e)})}removeItems(e){return this.withIdbStore("readwrite",t=>{e.forEach(e=>t.delete(e))})}clear(){return this.withIdbStore("readwrite",e=>{e.clear()})}length(){let e;return this.withIdbStore("readonly",t=>{e=t.count()}).then(()=>e.result)}queryRows(e){let t,r=[];return e<0?Promise.resolve(r):this.withIdbStore("readonly",n=>{(t=n.openCursor()).onsuccess=()=>{let n=t.result;n&&(r.push(n.value),e!==n.key&&n.continue())}}).then(()=>r)}key(e){let t;return e<0?Promise.resolve(null):this.withIdbStore("readonly",r=>{let n=!1;(t=r.openCursor()).onsuccess=()=>{let r=t.result;r&&(0===e||n||(n=!0,r.advance(e)))}}).then(()=>t.result?t.result.key:null)}async truncate(e){await this.connect({dbName:this.dbName,storeName:this.storeName,truncate:!0,truncateStores:e})}getPeerStores(){return this.connect({dbName:this.dbName,storeName:this.storeName}).then(e=>Object.keys(e.objectStoreNames).reduce((t,r)=>e.objectStoreNames[r]===this.storeName?t:[...t,e.objectStoreNames[r]],[]))}withIdbStore(e,t){return this.connect({dbName:this.dbName,storeName:this.storeName}).then(r=>new Promise((n,i)=>{let s=r.transaction(this.storeName,e);s.oncomplete=()=>n(),s.onabort=()=>i(s.error),s.onerror=()=>i(s.error),t(s.objectStore(this.storeName))}))}async connect({dbName:e,storeName:t,truncate:r,truncateStores:i}){n.connections[e]||(n.connections[e]=this.openIdb({dbName:e,storeName:t}));let s=await n.connections[e];if(!s.objectStoreNames.contains(t)||r){let a=s.version+1;s.close(),n.connections[e]=this.openIdb({dbName:e,storeName:t,version:a,truncate:r,truncateStores:i})}return n.connections[e]}openIdb({dbName:e,storeName:t,version:r,truncate:n,truncateStores:s}){return i(e,r,e=>{if(n){s||e.deleteObjectStore(t),s&&s.forEach(t=>e.deleteObjectStore(t));return}e.createObjectStore(t)})}}function i(e,t,r){return new Promise((n,i)=>{let s=indexedDB.open(e,t);s.onerror=()=>i(s.error),s.onsuccess=()=>{n(s.result)},s.onupgradeneeded=()=>{r&&r(s.result)}})}new n},480864:function(e,t,r){r.d(t,{E9:()=>n,zh:()=>i});class n{static connections={};dbName;storeName;constructor({dbName:e,storeName:t}={}){this.dbName=e||"lark-idb-store",this.storeName=t||"lark-idb-keyval"}getItem(e){let t;return this.withIdbStore("readonly",r=>{t=r.get(e)}).then(()=>t.result||null)}getItems(e){let t;return this.withIdbStore("readonly",r=>{t=e.map(e=>r.get(e))}).then(()=>t.reduce((t,r,n)=>({...t,[e[n]]:r.result||null}),{}))}setItem(e,t){return this.withIdbStore("readwrite",r=>{r.put(t,e)})}setItems(e){return this.withIdbStore("readwrite",t=>{Object.entries(e).forEach(([e,r])=>t.put(r,e))})}removeItem(e){return this.withIdbStore("readwrite",t=>{t.delete(e)})}removeItems(e){return this.withIdbStore("readwrite",t=>{e.forEach(e=>t.delete(e))})}clear(){return this.withIdbStore("readwrite",e=>{e.clear()})}length(){let e;return this.withIdbStore("readonly",t=>{e=t.count()}).then(()=>e.result)}queryRows(e){let t,r=[];return e<0?Promise.resolve(r):this.withIdbStore("readonly",n=>{(t=n.openCursor()).onsuccess=()=>{let n=t.result;n&&(r.push(n.value),e!==n.key&&n.continue())}}).then(()=>r)}key(e){let t;return e<0?Promise.resolve(null):this.withIdbStore("readonly",r=>{let n=!1;(t=r.openCursor()).onsuccess=()=>{let r=t.result;r&&(0===e||n||(n=!0,r.advance(e)))}}).then(()=>t.result?t.result.key:null)}async truncate(e){await this.connect({dbName:this.dbName,storeName:this.storeName,truncate:!0,truncateStores:e})}getPeerStores(){return this.connect({dbName:this.dbName,storeName:this.storeName}).then(e=>Object.keys(e.objectStoreNames).reduce((t,r)=>e.objectStoreNames[r]===this.storeName?t:[...t,e.objectStoreNames[r]],[]))}withIdbStore(e,t){return this.connect({dbName:this.dbName,storeName:this.storeName}).then(r=>new Promise((n,i)=>{let s=r.transaction(this.storeName,e);s.oncomplete=()=>n(),s.onabort=()=>i(s.error),s.onerror=()=>i(s.error),t(s.objectStore(this.storeName))}))}async connect({dbName:e,storeName:t,truncate:r,truncateStores:i}){n.connections[e]||(n.connections[e]=this.openIdb({dbName:e,storeName:t}));let s=await n.connections[e];if(!s.objectStoreNames.contains(t)||r){let a=s.version+1;s.close(),n.connections[e]=this.openIdb({dbName:e,storeName:t,version:a,truncate:r,truncateStores:i})}return n.connections[e]}openIdb({dbName:e,storeName:t,version:r,truncate:n,truncateStores:s}){return i(e,r,e=>{if(n){s||e.deleteObjectStore(t),s&&s.forEach(t=>e.deleteObjectStore(t));return}e.createObjectStore(t)})}}function i(e,t,r){return new Promise((n,i)=>{let s=indexedDB.open(e,t);s.onerror=()=>i(s.error),s.onsuccess=()=>{n(s.result)},s.onupgradeneeded=()=>{r&&r(s.result)}})}new n}}]);