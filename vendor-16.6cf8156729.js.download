"use strict";(window.webpackChunkweb=window.webpackChunkweb||[]).push([["93375"],{487570:function(e,t,n){n.d(t,{G8:()=>x,J1:()=>P,K2:()=>i,LR:()=>o,LU:()=>c,VD:()=>u,Zj:()=>s,cO:()=>g,gd:()=>w,i8:()=>d,iG:()=>p,kB:()=>l,qG:()=>y,qu:()=>f,s4:()=>r,tS:()=>h,vy:()=>a});let i=12,r=18,o=12,a=3,l=1.5,s=5,d=5.25,c=800,h=1e3,p=30,g=30,u=100,x=4,f=10,y=5,P=50,w="rgb(254, 211, 42)"},452833:function(e,t,n){n.d(t,{g:()=>A});var i,r,o=n(816209),a=n(805433),l=n(889171),s=n(318440),d=n(744966),c=n(353741);class h{modes=[];clear(){}}var p=n(808687),g=n(675094),u=n(525619),x=n(405849);(i=r||(r={}))[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i[i.LEFT=3]="LEFT",i[i.RIGHT=4]="RIGHT";let f={getSelectNodes:(e,t)=>e.selectNodes?e.selectNodes:[...t.selectNodes],findNodesInCrossingArea(e,t,n){let i={minX:Math.min(e.minX,t.minX),minY:e.minY,maxX:Math.max(e.maxX,t.maxX),maxY:e.maxY},r={minX:e.minX,minY:Math.min(e.minY,t.minY),maxX:e.maxX,maxY:Math.max(e.maxY,t.maxY)};return(0,x.Z)([...n.searchNodes(i.minX,i.minY,i.maxX,i.maxY),...n.searchNodes(r.minX,r.minY,r.maxX,r.maxY)],e=>e.id)},getCrossingDistance(e,t){if(p.D.overlapRect(e,t))return null;if(e.minX<=t.maxX&&e.maxX>=t.minX){let n=(Math.max(e.minX,t.minX)+Math.min(e.maxX,t.maxX))/2;return e.maxY<t.minY?{distance:t.minY-e.maxY,isVertical:!0,position:r.UP,start:new l.E(n,e.maxY),end:new l.E(n,t.minY),startBounds:e,endBounds:t}:{distance:e.minY-t.maxY,isVertical:!0,position:r.DOWN,start:new l.E(n,t.maxY),end:new l.E(n,e.minY),startBounds:e,endBounds:t}}if(e.minY<=t.maxY&&e.maxY>=t.minY){let n=(Math.max(e.minY,t.minY)+Math.min(e.maxY,t.maxY))/2;return e.maxX<t.minX?{distance:t.minX-e.maxX,isVertical:!1,position:r.LEFT,start:new l.E(e.maxX,n),end:new l.E(t.minX,n),startBounds:e,endBounds:t}:{distance:e.minX-t.maxX,isVertical:!1,position:r.RIGHT,start:new l.E(t.maxX,n),end:new l.E(e.minX,n),startBounds:e,endBounds:t}}return null},getMinSnapOffset(e){let t=new l.E(g.Ky,g.Ky);return e.forEach(e=>{e.x!==g.Ky&&(t.x=t.x===g.Ky||Math.abs(e.x)<Math.abs(t.x)?e.x:t.x),e.y!==g.Ky&&(t.y=t.y===g.Ky||Math.abs(e.y)<Math.abs(t.y)?e.y:t.y)}),t.x===g.Ky&&(t.x=0),t.y===g.Ky&&(t.y=0),t},alignBoundsLineForSinglePoint(e,t,n,i,r){let o=[],a=i===u.d.XY||i===u.d.X,s=i===u.d.XY||i===u.d.Y,d=[],c=[];n.forEach(n=>{let i=n.getBounds();a&&[i.minY,i.maxY,(i.minY+i.maxY)/2].forEach(n=>{Math.abs(n-e.y)<=g.gj&&(d.push(i.minX),d.push(i.maxX));let a=n-t.y;Math.abs(a)<=r&&o.push(new l.E(g.Ky,a))}),s&&[i.minX,i.maxX,(i.minX+i.maxX)/2].forEach(n=>{Math.abs(n-e.x)<=g.gj&&(c.push(i.minY),c.push(i.maxY));let a=n-t.x;Math.abs(a)<=r&&o.push(new l.E(a,g.Ky))})});let h=[];return a&&d.length&&h.push({start:new l.E(Math.min(...d,e.x),e.y),end:new l.E(Math.max(...d,e.x),e.y)}),s&&c.length&&h.push({start:new l.E(e.x,Math.min(...c,e.y)),end:new l.E(e.x,Math.max(...c,e.y))}),{pointPairs:h,snapOffsets:o}}};var y=n(797615),P=n(665742);let w="moveBoundsIdForAlign";class m extends h{modes=[c.$.Move];distanceCache=new Map;getDistanceWithCache(e,t){let n=`${e.id}-${t.id}`,i=`${t.id}-${e.id}`;if(this.distanceCache.has(n))return this.distanceCache.get(n);if(this.distanceCache.has(i))return this.distanceCache.get(i);let r=f.getCrossingDistance(e,t);return this.distanceCache.set(n,r),r}filterAlignNodes(e,t){let{selectNodes:n}=t;return e.filter(e=>!n.find(t=>t.id===e.id||t.id===e.parent?.id||e.type===y.Jq.Connector&&(e.attachProps.start.id===t.id||e.attachProps.end.id===t.id)||!1))}alignBoundsLine(e,t,n,i){let r=[],o=[],a=[],d=[],c=[],h=[],p=[],u=(e.maxX+e.minX)/2,x=(e.maxY+e.minY)/2,f=(t.maxX+t.minX)/2,y=(t.maxY+t.minY)/2;n.forEach(n=>{let s=n.getBounds();[s.minY,s.maxY,(s.minY+s.maxY)/2].forEach(n=>{Math.abs(n-e.minY)<=g.gj&&(o.push(s.minX),o.push(s.maxX)),Math.abs(n-x)<=g.gj&&(d.push(s.minX),d.push(s.maxX)),Math.abs(n-e.maxY)<=g.gj&&(a.push(s.minX),a.push(s.maxX)),Math.abs(n-t.minY)<=i.snapThreshold&&r.push(new l.E(g.Ky,n-t.minY)),Math.abs(n-y)<=i.snapThreshold&&r.push(new l.E(g.Ky,n-y)),Math.abs(n-t.maxY)<=i.snapThreshold&&r.push(new l.E(g.Ky,n-t.maxY))}),[s.minX,s.maxX,(s.minX+s.maxX)/2].forEach(n=>{Math.abs(n-e.minX)<=g.gj&&(c.push(s.minY),c.push(s.maxY)),Math.abs(n-u)<=g.gj&&(p.push(s.minY),p.push(s.maxY)),Math.abs(n-e.maxX)<=g.gj&&(h.push(s.minY),h.push(s.maxY)),Math.abs(n-t.minX)<=i.snapThreshold&&r.push(new l.E(n-t.minX,g.Ky)),Math.abs(n-f)<=i.snapThreshold&&r.push(new l.E(n-f,g.Ky)),Math.abs(n-t.maxX)<=i.snapThreshold&&r.push(new l.E(n-t.maxX,g.Ky))})});let P=[];return o.length&&P.push({start:new l.E(Math.min(...o,e.minX),e.minY),end:new l.E(Math.max(...o,e.maxX),e.minY)}),a.length&&P.push({start:new l.E(Math.min(...a,e.minX),e.maxY),end:new l.E(Math.max(...a,e.maxX),e.maxY)}),d.length&&!(o.length&&a.length)&&P.push({start:new l.E(Math.min(...d,e.minX),x),end:new l.E(Math.max(...d,e.maxX),x)}),c.length&&P.push({start:new l.E(e.minX,Math.min(...c,e.minY)),end:new l.E(e.minX,Math.max(...c,e.maxY))}),h.length&&P.push({start:new l.E(e.maxX,Math.min(...h,e.minY)),end:new l.E(e.maxX,Math.max(...h,e.maxY))}),p.length&&!(c.length&&h.length)&&P.push({start:new l.E(u,Math.min(...p,e.minY)),end:new l.E(u,Math.max(...p,e.maxY))}),i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(s.T.AlignLine,{pointPairs:P}),r}findMinDistancesForPosition(e,t,n){let i=[],r=e.sort((e,t)=>e.distance-t.distance),o=t.sort((e,t)=>e.distance-t.distance),a=[0,0,0,0,0];for(let e=0;e<r.length;e++){let t=r[e];if(4===a.reduce((e,t)=>e+t,0))break;if(!a[t.position]){for(let o=e+1;o<r.length;o++){let e=r[o];t.isVertical===e.isVertical&&n(t,e)&&(a[e.position]||t.position===e.position||(i.push({a:t,b:e}),a[t.position]=1,a[e.position]=1))}for(let e=0;e<o.length;e++){let r=o[e];t.isVertical===r.isVertical&&n(t,r)&&(i.push({a:t,b:r}),a[t.position]=1)}}}return i}isTwoDistanceOppositeFromSelected(e,t){return e.startBounds.id===w&&t.startBounds.id===w&&e.position!==t.position}alignGapLine(e,t,n,i){let o=[],a=[],c=[],h=[];for(let i=0;i<n.length;i++){let r=f.getCrossingDistance(e,n[i].getBounds());r&&c.push(r);let o=f.getCrossingDistance(t,n[i].getBounds());o&&h.push(o)}let p=[];for(let t=0;t<n.length;t++)for(let i=t+1;i<n.length;i++){let r=this.getDistanceWithCache(n[t].getBounds(),n[i].getBounds());r&&0===d.Y.findLineAndRectIntersect(r.start,r.end,e).length&&p.push(r)}let u=[];return this.findMinDistancesForPosition(c,p,(e,t)=>Math.abs(e.distance-t.distance)<g.gj).forEach(e=>{u.push(e.a),u.push(e.b)}),(0,P.Z)(u).forEach(e=>{a.push({start:e.start,end:e.end})}),this.findMinDistancesForPosition(h,p,(e,t)=>{let n=Math.abs(e.distance-t.distance);return 0!==n&&(this.isTwoDistanceOppositeFromSelected(e,t)&&(n*=.5),n<i.snapThreshold)}).forEach(({a:e,b:t})=>{let n=e.distance-t.distance;this.isTwoDistanceOppositeFromSelected(e,t)&&(n*=.5),e.isVertical?o.push(new l.E(g.Ky,e.position===r.UP?n:-n)):o.push(new l.E(e.position===r.LEFT?n:-n,g.Ky))}),i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(s.T.AlignGapLine,{pointPairs:a}),o}work(e,t){let n=t.selectNodes,i=new l.E(e.endPoint.x-e.startPoint.x,e.endPoint.y-e.startPoint.y),r=a.G.getBounds(n.map(e=>e.getRectNode())),o=a.G.offset(e.startBounds,i);o.id=w;let s=a.G.pad(r,g.Wz),d=this.filterAlignNodes(f.findNodesInCrossingArea(s,t.renderManager.gmlRender.getViewPortBounds(),t.nodeManager),t),c=this.alignBoundsLine(r,o,d,t),h=this.alignGapLine(r,o,d,t);return{offset:f.getMinSnapOffset([...c,...h])}}clear(){this.distanceCache.clear()}}class M extends h{modes=[c.$.MovePoint,c.$.MoveEditableControlPoint];getCanAlignNodes(e,t){if(e.alignMode===c.$.MoveEditableControlPoint)return t.selectNodes;let n=t.selectNodes[0],i=e.endPoint,r=a.G.pad({id:n.id,minX:i.x,minY:i.y,maxX:i.x,maxY:i.y},g.Wz);return f.findNodesInCrossingArea(r,t.renderManager.gmlRender.getViewPortBounds(),t.nodeManager).filter(e=>e.id!==n.id)}alignBoundsLine(e,t,n,i){let{snapOffsets:r,pointPairs:o}=f.alignBoundsLineForSinglePoint(e,t,n,i.alignOption.alignAxis,i.snapThreshold);return i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(s.T.AlignLine,{pointPairs:o}),r}work(e,t){let n=e.endPoint,i=e.startPoint,r=this.getCanAlignNodes(e,t),o=this.alignBoundsLine(i,n,r,t);return{offset:f.getMinSnapOffset(o)}}}class T extends h{modes=[c.$.MoveTableRowCol];getRowColIndex(e){return 0===e?0:e-1}getOffset(e,t){return 0===e?-t:t}alignRow(e,t,n,i){let r=[],o=[],a=e.globalBaseProps,d=a.x+a.width/2,c=e.tableProps.rows,h=this.getRowColIndex(t),p=c[h],u=i.alignOption.startBounds.maxY-i.alignOption.startBounds.minY,x=this.getOffset(t,n),f=null,y=0;for(let e=0;e<c.length;e++){let n={start:new l.E(d,a.y+y),end:new l.E(d,a.y+y+c[e])};if(e===h)f=n;else{Math.abs(p-c[e])<g.gj&&o.push(n);let a=this.getOffset(t,c[e]-(u+x));Math.abs(a)<i.snapThreshold&&r.push(new l.E(g.Ky,a))}y+=c[e]}return o.length>0&&f&&o.push(f),i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(s.T.AlignGapLine,{pointPairs:o}),r}alignCol(e,t,n,i){let r=[],o=[],a=e.globalBaseProps,d=a.y+a.height/2,c=e.tableProps.columns,h=this.getRowColIndex(t),p=c[h],u=i.alignOption.startBounds.maxX-i.alignOption.startBounds.minX,x=this.getOffset(t,n),f=null,y=0;for(let e=0;e<c.length;e++){let n={start:new l.E(a.x+y,d),end:new l.E(a.x+y+c[e],d)};if(e===h)f=n;else{Math.abs(p-c[e])<g.gj&&o.push(n);let a=this.getOffset(t,c[e]-(u+x));Math.abs(a)<i.snapThreshold&&r.push(new l.E(a,g.Ky))}y+=c[e]}return o.length>0&&f&&o.push(f),i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(s.T.AlignGapLine,{pointPairs:o}),r}work(e,t){let n,i=t.selectNodes[0];if(!i)return null;if(e.alignAxis===u.d.Y){let r=e.endPoint.y-e.startPoint.y;n=this.alignRow(i,e.tableRowColIndex,r,t)}else{let r=e.endPoint.x-e.startPoint.x;n=this.alignCol(i,e.tableRowColIndex,r,t)}return{offset:f.getMinSnapOffset(n)}}}class b extends h{modes=[c.$.Stretch];alignStretchLine(e,t,n,i){let r=i.alignOption.alignAxis,o=[],a=[];return n.forEach(n=>{let s=n.getBounds(),d=s.maxX-s.minX,c=s.maxY-s.minY;if(r===u.d.X||r===u.d.XY){let n=e.maxX-e.minX;Math.abs(n-d)<=g.gj&&(a.push({rectNode:s,isWidth:!0}),a.push({rectNode:e,isWidth:!0}));let r=t.maxX-t.minX,c=r-d;r!==n&&Math.abs(c)<=i.snapThreshold&&o.push(new l.E(-c,g.Ky))}if(r===u.d.Y||r===u.d.XY){let n=e.maxY-e.minY;Math.abs(n-c)<=g.gj&&(a.push({rectNode:s,isWidth:!1}),a.push({rectNode:e,isWidth:!1}));let r=t.maxY-t.minY,d=r-c;r!==n&&Math.abs(d)<=i.snapThreshold&&o.push(new l.E(g.Ky,-d))}}),i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(s.T.AlignStretchLine,{stretchAlignList:a}),o}alignBoundsLine(e,t,n,i){let{startBounds:r}=i.alignOption,o=t.x<0&&Math.abs(t.x)>r.maxX-r.minX,a=t.y<0&&Math.abs(t.y)>r.maxY-r.minY,{snapOffsets:d,pointPairs:c}=f.alignBoundsLineForSinglePoint(new l.E(o?e.minX:e.maxX,a?e.minY:e.maxY),i.alignOption.endPoint,n,u.d.XY,i.snapThreshold);return i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(s.T.AlignLine,{pointPairs:c}),d.map(e=>(o&&(e.x*=-1),a&&(e.y*=-1),e))}work(e,t){let n=t.selectNodes,i=new l.E(e.endPoint.x-e.startPoint.x,e.endPoint.y-e.startPoint.y),r=a.G.getBounds(n.map(e=>e.getRectNode())),o=a.G.stretch(e.startBounds,i),s=a.G.pad(r,g.Wz),d=f.findNodesInCrossingArea(s,t.renderManager.gmlRender.getViewPortBounds(),t.nodeManager).filter(e=>!n.find(t=>t.id===e.id)),c=this.alignStretchLine(r,o,d,t),h=this.alignBoundsLine(r,i,d,t);return{offset:f.getMinSnapOffset([...c,...h])}}clear(){}}class C{currnetWorker=null;workers=[new m,new b,new M,new T];constructor(e,t,n,i){this.nodeManager=e,this.selectManager=t,this.auxiliaryManager=n,this.renderManager=i}align(e){let t={nodeManager:this.nodeManager,auxiliaryManager:this.auxiliaryManager,selectManager:this.selectManager,renderManager:this.renderManager,alignOption:e,selectNodes:f.getSelectNodes(e,this.selectManager),snapThreshold:g.xd/this.renderManager.gmlRender.getScale()};for(let n of this.workers)if(n.modes.includes(e.alignMode))return this.currnetWorker=n,n.work(e,t);return null}clear(){this.currnetWorker?.clear(),this.auxiliaryManager.removeAllAlignGraphic()}}var S=n(931425);class A{lastInteractEvent=null;lastDiffTypeEvent=null;previewElement=null;previewAddNodeDatas=null;refresh=()=>{};constructor(e,t,n,i,r,a,l,s,d,c,h,p,g,u,x,f,y){this.nodeManager=e,this.gmlRender=t,this.detectors=n,this.toolManager=i,this.inputManager=r,this.imageManager=a,this.auxiliaryCtx=l,this.actionManager=s,this.auxiliaryManager=d,this.collaborationManager=c,this.cursorManager=new o.M(t),this.docState=h,this.renderManager=p,this.commentManager=g,this.idGenerator=u,this.alignManager=new C(this.nodeManager,this.auxiliaryManager.selectManager,this.auxiliaryManager,this.renderManager),this.plugins=x,this.mindMapManager=f,this.translateManager=y}setRefreshCb(e){this.refresh=e}getDetector(e){let t=this.detectors.get(e);if(t)return t}detect(e,t){let n=this.getDetector(e);return n&&n.detect(t,this)?n.result:null}getScale(){return this.gmlRender.getScale()}getStretchMinSize(e){if(e.type===y.Jq.CompositeShape&&e instanceof S.F){let t=this.auxiliaryManager.globalConfig.shapeDescriptionConfig[e.shapeType];return e.getStretchMinSize(t)}return e.getStretchMinSize()}setCursor(e){this.cursorManager.setCursor(e)}getSelectNodes(){return this.auxiliaryManager.selectManager.selectNodes}refreshSelectStatus(e){this.auxiliaryManager.refreshSelectStatus(e),this.renderManager.addAuxiliaryDrawTask()}execAction(e){this.actionManager.execAction(e)}reset(){this.detectors.forEach(e=>{e.reset()}),this.renderManager.addAuxiliaryDrawTask(),this.auxiliaryManager.removeAllHoverGraphic(),this.auxiliaryManager.removeAllAlignGraphic()}inSelect(e){if(0===this.auxiliaryManager.selectManager.selectNodes.size)return!1;let t=this.auxiliaryManager.selectManager.getSelectBounds();return a.G.rectContains2(e,t)}inSelectNodes(e){return this.auxiliaryManager.selectManager.include(e)}canBeEditText(){return!!this.auxiliaryManager.hasTextSelection()||null!==this.inputManager.editTextInfo}addOrUpdateAuxiliaryGraphic(e,t){this.auxiliaryManager.addOrUpdateAuxiliaryGraphic(e,t),this.renderManager.addAuxiliaryDrawTask()}registerAnimationGraphic(e,t){this.auxiliaryManager.registerAnimationGraphic(e,t),this.renderManager.addAuxiliaryDrawTask()}removeAuxiliaryGraphic(e){this.auxiliaryManager.removeAuxiliaryGraphic(e),this.renderManager.addAuxiliaryDrawTask()}setSelectNodes(e){this.auxiliaryManager.setSelectNodes(e),this.renderManager.addAuxiliaryDrawTask()}isMac(){return this.docState.isMac()}}},583977:function(e,t,n){n(925174)},808687:function(e,t,n){n.d(t,{D:()=>N});var i=n(889171),r=n(73428),o=n(805433),a=n(937093),l=n(678014),s=n(428202),d=n(561347),c=n(976780),h=n(39533),p=n(797615),g=n(513665),u=n(298809),x=n(800866),f=n(175005),y=n(347250),P=n(873411),w=n(334918),m=n(382125),M=n(470608),T=n(492663),b=n(508241),C=n(596500),S=n(965732),A=n(138743),v=n(140512),E=n(744966),R=n(718077);let N={overlapPoint:(e,t,n=5)=>(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<n*n,bufferBounds(e,t,n=2){let i=t.gmlRender.globalTransform.a/2;e.minX=Math.round(e.minX*i-n)/i,e.minY=Math.round(e.minY*i-n)/i,e.maxX=Math.round(e.maxX*i+2*n)/i,e.maxY=Math.round(e.maxY*i+2*n)/i},computeDirtyDrawGraphics(e,t){let n=e.tree.search(t),i=new Set;for(let t of n){let n=e.nodeMap.get(t.id);n&&i.add(n)}return l.v.sortGraphicsV2([...i])},trimAngle(e){let t=Math.floor(e/360);return e-360*t},calculateAngle(e,t){if(.01>Math.abs(e.x-t.x))if(t.y>e.y)return 90;else return -90;return Math.atan2(t.y-e.y,t.x-e.x)/Math.PI*180},calculateAngle2(e,t){if(.01>Math.abs(e.x-t.x))if(t.y>e.y)return .5*Math.PI;else return -.5*Math.PI;return Math.atan2(t.y-e.y,t.x-e.x)},findParentInGraphicSet(e,t){let{parent:n}=e;for(;n&&n.id!==s.r.id;){if(t.has(n))return!0;n=n.parent}return!1},rectInsideRect:(e,t)=>e.minX>t.minX&&e.maxX<t.maxX&&e.minY>t.minY&&e.maxY<t.maxY,overlapRect:(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY),overlapRectV2:(e,t)=>!(e.x+e.width<t.x||e.x>t.x+t.width||e.y+e.height<t.y||e.y>t.y+t.height),overlapOolongLine(e,t){if(e.shapeType===a.SP.SimpleLine){let{points:n}=e;return this.overlapSimpleLine(n[0],n[n.length-1],t)}return e.shapeType===a.SP.Curve?E.Y.findCurveAndRectIntersect(e,t):this.overlapPolyLine(e.points,t)},overlapSimpleLine(e,t,n){if(this.overlapHorizon(n.minX,n.maxX,n.minY,e,t)||this.overlapHorizon(n.minX,n.maxX,n.maxY,e,t)||this.overlapVertical(n.minY,n.maxY,n.maxX,e,t)||this.overlapVertical(n.minY,n.maxY,n.minX,e,t))return!0;let i=e.x>t.x?t.x:e.x,r=e.x<t.x?t.x:e.x,o=e.y>t.y?t.y:e.y,a=e.y<t.y?t.y:e.y;return!!(r<=n.maxX)&&!!(i>=n.minX)&&!!(a<=n.maxY)&&!!(o>=n.minY)},overlapPolyLine(e,t,n){for(let i=0;i<e.length-1;i++){let r=e[i],o=e[i+1];if(this.overlapHorizonVertical(r,o,t,n))return!0}return!1},trimPoint:e=>new i.E(Math.floor(e.x),Math.floor(e.y)),overlapHorizonVertical(e,t,n,i=1){let r=i/2;if(N.judgeHorizon(e,t)){if(e.y+r<n.minY||e.y-r>n.maxY)return!1;let i=Math.min(e.x,t.x);if(Math.max(e.x,t.x)<n.minX||i>n.maxX)return!1}else{if(e.x+r<n.minX||e.x-r>n.maxX)return!1;let i=Math.min(e.y,t.y);if(Math.max(e.y,t.y)<n.minY||i>n.maxY)return!1}return!0},overlapHorizon(e,t,n,i,r){let o=i.y>r.y?r.y:i.y,a=i.y<r.y?r.y:i.y;if(o>n||a<n)return!1;let l=i.x>r.x?r.x:i.x,s=i.x<r.x?r.x:i.x;return!(l>t)&&!(s<e)},overlapVertical(e,t,n,i,r){let o=i.x>r.x?r.x:i.x,a=i.x<r.x?r.x:i.x;if(o>n||a<n)return!1;let l=i.y>r.y?r.y:i.y,s=i.y<r.y?r.y:i.y;return!(l>t)&&!(s<e)},interactRect:(e,t)=>({id:"interactNode",minX:Math.max(e.minX,t.minX),maxX:Math.min(e.maxX,t.maxX),minY:Math.max(e.minY,t.minY),maxY:Math.min(e.maxY,t.maxY)}),rectNode2Rect(e){let{minX:t,minY:n,maxX:i,maxY:r}=e;return{x:t,y:n,width:i-t,height:r-n}},layout(e,t){let n=[];return o.G.doubleMiddleInsertPoint(e,t,n),n},curveLayout(e,t){let n=new r.U(0,0,1,1);n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.width=Math.max(e.x,t.x)-n.x,n.height=Math.max(e.y,t.y)-n.y;let i=[];return e.y<t.y?(i.push(e),i.push(o.G.topPoint(n)),i.push(o.G.centerPoint(n)),i.push(o.G.bottomPoint(n))):(i.push(e),i.push(o.G.bottomPoint(n)),i.push(o.G.centerPoint(n)),i.push(o.G.topPoint(n))),i.push(t),i},judgeHorizon:(e,t,n=.01)=>Math.abs(e.y-t.y)<n,judgeVertical:(e,t,n=.01)=>Math.abs(e.x-t.x)<n,getArcPolyPoints(e,t,n,r,o=!1){e.length>2&&e[1].x===e[0].x&&e[1].y===e[0].y&&e.splice(1,1,t),e.splice(0,1,t),e.length>2&&e[e.length-2].x===e[e.length-1].x&&e[e.length-2].y===e[e.length-1].y&&e.splice(e.length-2,1,n),e.splice(e.length-1,1,n);let a=[],l=e[0];for(let t=0;t<e.length-2;t+=1){let n=l,s=e[t+1],d=e[t+2];if(N.judgeHorizon(n,s)){let e=.5*Math.abs(n.x-s.x),c=.5*Math.abs(s.y-d.y),h=e>c?c:e,p=r<h?r:h;o&&(p=0===t?0:p);let g=p,u=s.x>n.x?1:-1,x=d.y>s.y?1:-1;l=new i.E(s.x,s.y+x*g);let f={p0:n,p1:new i.E(s.x-u*g,s.y),arcDraw:{a:s,b:l,r:p}};a.push(f)}else{let e=.5*Math.abs(n.y-s.y),c=.5*Math.abs(s.x-d.x),h=e>c?c:e,p=r<h?r:h;o&&(p=0===t?0:p);let g=p,u=s.y>n.y?1:-1,x=d.x>s.x?1:-1;l=new i.E(s.x+x*g,s.y);let f={p0:n,p1:new i.E(s.x,s.y-u*g),arcDraw:{a:s,b:l,r:p}};a.push(f)}}return a},afterUpdateGraphic(e,t){if(e.type!==p.Jq.MindMapNode&&e.afterUpdateProps(),t.updateIndexNode(e.getRectNode()),e.children.length>0)for(let n of e.children)N.afterUpdateGraphic(n,t)},computeStretchCursorIndex(e){let t=-e,n=Math.floor(t/180),i=Math.round((t-=180*n)/7.5);return 0===i?1:25-i},computeRotateCursorIndex(e){let t=-e,n=Math.floor(t/360),i=Math.round((t-=360*n)/7.5);return 0===i?1:48-i},splitText(e,t){let{paragraphs:n}=e,{paragraphIndex:i,lineIndex:r,charIndex:o}=t,a="",l="";for(let e=0;e<i;e++)a+=`${n[e].getText()}`;for(let e=i+1;e<n.length;e++)l+=`${n[e].getText()}`;let s="",d="",c=n[i];if(0===c.lines.length)return{prev:a,next:`${l}`};for(let e=0;e<r;e++)s+=c.lines[e].getText();for(let e=r+1;e<c.lines.length;e++)d+=c.lines[e].getText();let h=c.lines[r];return -1===o?d=h.getText()+d:o===h.chars.length-1?s+=h.getText():(s+=h.getText(0,o),d=h.getText(o+1,h.chars.length-1)+d),{prev:a+s,next:`${d}${l}`}},generateInsertText(e,t,n){let{prev:i,next:r}=this.splitText(e,t);return i+n+r},generateInsertProps(e,t,n){let i=this.generateInsertText(e,t,n),r=M.P.splitIntlText(n).length,a=o.G.computeOverrideStyle(e,t,!0,r);return{type:c.d.Text,text:i,textCharProps:a}},generateDeleteProps(e,t,n=1){let i=this.generateDeleteText(e,t,n),r=o.G.computeOverrideStyle(e,t,!1,n);return{type:c.d.Text,text:i,textCharProps:r}},generateDeleteText(e,t,n=1){let{prev:i,next:r}=this.splitText(e,t);return i.length>0?i.slice(0,i.length-n)+r:i+r},UUIDv4:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=Math.floor(16*Math.random());return("x"===e?t:3&t|8).toString(16)}),generateCommentId(){return this.UUIDv4()},computeMoveNodes(e,t){let n=h.C.getAllNodes(e),i=[];for(let e of n){if(e.lockedStatusProps.locked||e.type===p.Jq.MindMapNode&&e.mindMapParent)continue;if(e.type!==p.Jq.Connector){i.push(e);continue}let{attachProps:n}=e,r=t.getNode(n.start.id||""),o=t.getNode(n.start.id||"");r||o||i.push(e)}return i},valueInRange:(e,t,n)=>e<t?t:e>n?n:e,removeNodeLinkLines(e,t){t.nodeManager.getConnectedLines(e).forEach(e=>{t.execAction(new u.q([{id:e.id}]))})},createSectionForNodes(e,t){let n=t.auxiliaryManager.selectManager.getSelectBounds(),i={x:n.minX-m.O,y:n.minY-m.O},r=e.sort((e,t)=>t.zIndex-e.zIndex);r[0].zIndex;let o=r[0].parent;if(null===o)return;let a=t.idGenerator.genId(p.Jq.Section),l=y.j.createSectionPreviewProps(t,i),s=l.find(e=>e.type===c.d.Base);"ROOT"!==o.id&&o.type!==p.Jq.Table&&(s.x-=o.baseProps.x,s.y-=o.baseProps.y),s.width=n.maxX-n.minX+2*m.O,s.height=n.maxY-n.minY+2*m.O;let d=o.type!==p.Jq.Table?o.id:void 0;t.actionManager.execAction(new w.C([{id:a,type:p.Jq.Section,zIndex:t.idGenerator.genZIndex(d),props:l,parentId:d}]));let h=t.nodeManager.getNode(a);if(h){for(let e of r){let n=e.baseProps,r=e.globalBaseProps;n.x=r.x-i.x,n.y=r.y-i.y,t.actionManager.execAction(new x.h({fromPath:e.getPath(),toPath:h.getPath(!0),fromIndex:e.zIndex,toIndex:0,id:e.id})),t.actionManager.execAction(new g.x({id:e.id,props:[n]}))}this.updateAllChildrenZIndex(o,t),t.actionManager.execAction(f.O.selectNode([a]))}},removeSection(e,t){let{children:n}=e,{parent:i}=e;if(!i)return;let r=[...n.sort((e,t)=>t.zIndex-e.zIndex)],o=[],a=e.zIndex;for(let n of r)o.push(n.id),n.baseProps.x+=e.baseProps.x,n.baseProps.y+=e.baseProps.y,t.actionManager.execAction(new x.h({fromPath:n.getPath(),toPath:i.getPath(!0),fromIndex:n.zIndex,toIndex:a,id:n.id})),t.actionManager.execAction(new g.x({id:n.id,props:[n.baseProps]}));t.actionManager.execAction(new u.q([{id:e.id}])),t.actionManager.execAction(f.O.selectNode(o))},updateAllChildrenZIndex(e,t){let n=e?.children||[];n.sort((e,t)=>e.zIndex-t.zIndex);let i=0;for(let e of n)e.zIndex=i,i++},unlockAll(e){for(let[t,n]of e.nodeManager.nodeMap)if(n.lockedStatusProps.locked){let t=n.lockedStatusProps;t.locked=!1,e.actionManager.execAction(new g.x({id:n.id,props:[t]}))}},insertChildNode(e,t,n=R.A.RIGHT){let i=v.R.getLastMindMapPos(e,n),r=t.idGenerator.genId(p.Jq.MindMapNode),o=y.j.generateDefaultNodeDO(r,p.Jq.MindMapNode);o.zIndex=t.idGenerator.genZIndex();let a=new T.v;a.parentId=e.id,a.layoutEnum=p.gd.SUB_RIGHT,o.props.push(a),o.props.push(new b.F);let l=new P.s;l.x=i.x,l.y=i.y,o.props.push(l),o.props.push(new C.b),o.props.push(new S.L);let s=new d.l;s.sizeMode=A.A.AUTO_WIDTH,o.props.push(s);let c=new w.C([o]);t.actionManager.execAction(c);let h=t.nodeManager.getNode(r),{width:g,height:u}=h.modifyBaseProps();h.baseProps.width=g,h.baseProps.height=u,v.R.updateMindMapTreeAndSendMsg(e.mindMapRoot,t),t.actionManager.execAction(f.O.selectNode([r]))},foldUnfoldChildNode(e,t){let n={type:c.d.MindMap,collapsed:!e.mindMapProps.collapsed},i={id:e.id,props:[n]};t.actionManager.execAction(new g.x(i)),t.auxiliaryManager.refreshSelectStatus()},foldUnfoldChildNodeRecursively(e,t,n){if(e.mindMapProps.collapsed!==n&&e.mindMapChildren.length>0){let i={type:c.d.MindMap,collapsed:n},r={id:e.id,props:[i]};t.actionManager.execAction(new g.x(r))}let i=e.mindMapChildren;if(i&&i.length){for(let e of i)this.foldUnfoldChildNodeRecursively(e,t,n);t.auxiliaryManager.refreshSelectStatus()}},foldUnfoldAllChildNode(e,t){if(e.mindMapRoot?.id!==e.id)return;let n=e.mindMapChildren,i=n.some(e=>0!==e.mindMapChildren.length&&!e.mindMapProps.collapsed);for(let e of n)e.type===p.Jq.MindMapNode&&0!==e.mindMapChildren.length&&this.foldUnfoldChildNodeRecursively(e,t,i)},batchUpdateChildrenZIndex(e,t){if(0!==e.size)for(let n of e){let e=t.getNode(n)||t.root;this.updateChildrenZIndex(e)}},updateChildrenZIndex(e){for(let t=0;t<e.children.length;t++)e.children[t].zIndex=t}}},675094:function(e,t,n){n.d(t,{H7:()=>c,Ky:()=>r,Wz:()=>a,bN:()=>l,gj:()=>o,iJ:()=>s,sN:()=>d,xd:()=>i});let i=5,r=6,o=.1,a=5,l=1,s=5,d="#647ee5",c=4},525619:function(e,t,n){var i,r;n.d(t,{d:()=>i}),(r=i||(i={}))[r.X=0]="X",r[r.Y=1]="Y",r[r.XY=2]="XY"},353741:function(e,t,n){var i,r;n.d(t,{$:()=>i}),(r=i||(i={}))[r.Move=0]="Move",r[r.Stretch=1]="Stretch",r[r.MoveEditableControlPoint=2]="MoveEditableControlPoint",r[r.MovePoint=3]="MovePoint",r[r.MoveTableRowCol=4]="MoveTableRowCol"},812575:function(e,t,n){n.d(t,{d:()=>i});class i{}},246001:function(e,t,n){n.d(t,{o:()=>r});var i=n(572583);class r extends i.I{constructor(){super([])}canBeEnable(e,t){return!0}canBeExit(e,t){return!0}}},568971:function(e,t,n){n.d(t,{W:()=>a});var i=n(572583),r=n(925174),o=n(805433);class a extends i.I{deltaDistance=1;locked=!1;canBeEnable(e,t){if(e.type!==r.V.pointerDown)return!1;let n=this.clickEnable(e,t);return n&&(this.locked=!0),n}work(e,t){if(e.type===r.V.pointerDown)return void super.work(e,t);if(e.type===r.V.pointerup){this.locked=!1,super.work(e,t);return}t.lastDiffTypeEvent&&o.G.distance(t.lastDiffTypeEvent.globalPoint,e.globalPoint)>this.deltaDistance/t.gmlRender.getScale()&&(this.locked=!1),super.work(e,t)}canBeExit(e,t){if(e.type===r.V.pointermove){let n=t.lastDiffTypeEvent;o.G.distance(n.globalPoint,e.globalPoint)>this.deltaDistance/t.gmlRender.getScale()&&(this.locked=!1)}return!this.locked}}},12288:function(e,t,n){n.d(t,{K:()=>r});var i=n(925174);class r{downHandlers=[];upHandlers=[];hasWorking=!1;allowEventTypeSet=new Set([i.V.pointerDown,i.V.pointerup]);registerDownHandler(e){this.downHandlers.push(e)}registerUpHandler(e){this.upHandlers.push(e)}process(e,t){this.downProcess(e,t),this.upProcess(e,t)}downProcess(e,t){if(e.type===i.V.pointerDown){for(let n of(this.hasWorking=!1,this.downHandlers))if(n.enable(e,t)){this.hasWorking=!0,n.handle(e,t);return}}}upProcess(e,t){if(e.type===i.V.pointerup){if(this.hasWorking){this.hasWorking=!1;return}for(let n of this.upHandlers)if(n.enable(e,t))return void n.handle(e,t)}}}},867953:function(e,t,n){n.d(t,{W:()=>a});var i=n(572583),r=n(925174),o=n(805433);class a extends i.I{deltaDistance=1;hasDown=!1;locked=!1;constructor(e,t=[]){super(t),this.streamProcessor=e}onDown(e,t){}canBeEnable(e,t){if(e.type===r.V.pointerDown&&(this.onDown(e,t),this.hasDown=!0),!this.hasDown||t.lastDiffTypeEvent?.type!==r.V.pointerDown||e.type!==r.V.pointermove)return!1;let n=t.lastDiffTypeEvent.globalPoint;if(o.G.distance(n,e.globalPoint)<this.deltaDistance/t.gmlRender.getScale())return!1;let i=this.streamEnable(e,t);if(i)for(let n of(this.locked=!0,this.streamProcessor))n.onStart(e,t);return i}work(e,t){if(e.type===r.V.pointermove)for(let n of this.streamProcessor)n.onMove(e,t);if(e.type===r.V.pointerup){for(let n of this.streamProcessor)n.onUp(e,t);this.locked=!1}super.work(e,t)}canBeExit(e,t){return!this.locked}}},925174:function(e,t,n){var i,r;n.d(t,{V:()=>i}),(r=i||(i={})).pointerDownOutside="pointerDownOutside",r.pointerDown="pointerdown",r.pointermove="pointermove",r.pointerup="pointerup",r.unknown="unknown"},176517:function(e,t,n){n.d(t,{q:()=>i});class i{subModes=[];constructor(e){this.subModes=e,this.currentSubMode=e[e.length-1]}canBeExit(e,t){return this.currentSubMode.canBeExit(e,t)}work(e,t){this.detect(e,t),this.currentSubMode.work(e,t)}detect(e,t){if(this.currentSubMode.canBeExit(e,t)){for(let n of this.subModes)if(n.canBeEnable(e,t)){this.currentSubMode=n;return}}}}},896026:function(e,t,n){n.d(t,{A:()=>o});var i=n(572583),r=n(925174);class o extends i.I{locked=!1;constructor(e,t=[]){super(t),this.streamProcessor=e}canBeEnable(e,t){if(e.type!==r.V.pointerDown)return!1;let n=this.streamEnable(e,t);return n&&(this.locked=!0),n}work(e,t){if(e.type===r.V.pointerDown)for(let n of this.streamProcessor)n.onStart(e,t);if(e.type===r.V.pointermove)for(let n of this.streamProcessor)n.onMove(e,t);if(e.type===r.V.pointerup){for(let n of this.streamProcessor)n.onUp(e,t);this.locked=!1}super.work(e,t)}canBeExit(e,t){return!this.locked}}},828226:function(e,t,n){n.d(t,{X:()=>r});var i=n(925174);class r{allowEventTypeSet=new Set([i.V.pointerDown,i.V.pointermove,i.V.pointerup]);process(e,t){}}},572583:function(e,t,n){n.d(t,{I:()=>i});class i{processors=[];constructor(e){this.processors=e}work(e,t){for(let n of this.processors)n.allowEventTypeSet.has(e.type)&&n.process(e,t)}}},95777:function(e,t,n){n.d(t,{e:()=>h});var i=n(867953),r=n(771313),o=n(828226),a=n(889171),l=n(318440),s=n(487570),d=n(451935);class c extends o.X{comment=null;originPoint=null;originCommentPos=null;originNodeId="";onStart(e,t){let n=t.detect(r.c.Comment,t.lastDiffTypeEvent);this.comment=n.comment,this.originPoint=t.lastDiffTypeEvent.globalPoint;let i=new a.E(this.comment.x,this.comment.y),o=t.nodeManager.nodeMap.get(this.comment.nodeID);if(o){let e=o.toGlobalPoint(i);this.originCommentPos=e,this.originNodeId=o.id}else this.originCommentPos=i,this.originNodeId=""}onMove(e,t){this.drawHoverBounds(e,t),t.setCursor("grabbing"),this.sendCommentMsg(e,t,!1)}onUp(e,t){t.setCursor("pointer"),this.sendCommentMsg(e,t,!0)}drawHoverBounds(e,t){let n=t.detect(r.c.Node,e);if(n){let e=n[0];t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(l.T.HoverBounds,{node:e,boundColor:s.gd})}}sendCommentMsg(e,t,n){let i=e.globalPoint.x-this.originPoint.x,o=e.globalPoint.y-this.originPoint.y,l=new a.E(this.originCommentPos.x+i,this.originCommentPos.y+o),s=t.detect(r.c.Node,e),c="";if(s&&s.length>0&&(c=s[0].id),""!==c){let e=t.nodeManager.getNode(c);if(e){let i=e.toLocalPoint(l),r={act:1,commentID:this.comment.commentID,nodeID:c,x:i.x,y:i.y};t.actionManager.execUnOrderAction({type:d.U.Comment,data:r},n)}return}if(""===c){let e={act:1,commentID:this.comment.commentID,nodeID:c,x:l.x,y:l.y};t.actionManager.execUnOrderAction({type:d.U.Comment,data:e},n);return}}}class h extends i.W{constructor(){super([new c])}streamEnable(e,t){return!!t.detect(r.c.Comment,t.lastDiffTypeEvent)}}},645574:function(e,t,n){n(771313),n(678014),n(243107),n(581974),n(805433),n(808687),n(963370),n(150630),n(976780),n(797379),n(755075),n(943451),n(988382),n(917519),n(544516),n(955633),n(117866),n(188893),n(140512)},731082:function(e,t,n){n(394283);var i,r,o,a,l=n(447961),s=n(568971),d=n(925174),c=n(487570),h=n(771313);s.W,n(161429),n(219169),n(983355),n(618946),n(140109),n(113298),n(644003),n(784391),n(893420);var p=n(176517),g=n(867953),u=n(828226),x=n(889171),f=n(976780),y=n(513665),P=n(944379),w=n(455360),m=n(805433),M=n(73428),T=n(797379),b=n(353741),C=n(525619);(i=o||(o={})).LEFT="left",i.RIGHT="right",i.TOP="top",i.BOTTOM="bottom";class S extends u.X{bubbleControlPointInfo=null;onStart(e,t){let n=t.getDetector(h.c.BubbleControlPoint);this.bubbleControlPointInfo=n.result,this.bubbleControlPointInfo&&t.actionManager.execAction(new P.M)}onMove(e,t){if(!this.bubbleControlPointInfo)return;let{node:n}=this.bubbleControlPointInfo,{globalPoint:i}=e,{baseProps:r}=n,a=n.getProp(f.d.ShapeType),l=a.shapeCode,s=n.toLocalPoint(i),d=new x.E(s.x,s.y),c=new M.U(0,0,r.width,r.height);if(l===T.DY.rectBubble&&m.G.rectContains(d,c))switch(this.findTheClosestBorder(c,s)){case o.LEFT:d.x=c.x,d.y=s.y;break;case o.RIGHT:d.x=c.x+c.width,d.y=s.y;break;case o.TOP:d.x=s.x,d.y=c.y;break;case o.BOTTOM:d.x=s.x,d.y=c.y+c.height}else if(l===T.DY.bubble&&this.ovalContains(n,d)){let e=new x.E(r.width/2,r.height/2),t=r.width/2,n=r.height/2,i=new x.E(d.x-e.x,d.y-e.y),o=Math.atan2(i.y,i.x),a=e.x+t*Math.cos(o),l=e.y+n*Math.sin(o);d.x=a,d.y=l}let h=a.controlPoints?.[0],p=t.alignManager.align({alignMode:b.$.MoveEditableControlPoint,alignAxis:C.d.XY,startBounds:n.getBounds(),startPoint:n.toGlobalPoint(h||d),endPoint:i});p?.offset&&(d.x+=p.offset.x,d.y+=p.offset.y);let g={controlPoints:[d],type:f.d.ShapeType},u=new y.x({id:n.id,props:[g]});t.actionManager.execAction(u)}onUp(e,t){t.actionManager.execAction(new w.q),this.bubbleControlPointInfo=null}findTheClosestBorder(e,t){let n={[o.LEFT]:t.x-e.x,[o.RIGHT]:e.x+e.width-t.x,[o.TOP]:t.y-e.y,[o.BOTTOM]:e.y+e.height-t.y},i=o.LEFT,r=n[o.LEFT];return Object.entries(n).forEach(([e,t])=>{t<r&&(r=t,i=e)}),i}ovalContains(e,t){let{baseProps:n}=e,i=new x.E(n.width/2,n.height/2),r=n.width/2,o=n.height/2,a=(t.x-i.x)/r,l=(t.y-i.y)/o;return a*a+l*l<=1}}g.W;class A extends u.X{originPos=new x.E(0,0);originOffset=new x.E(0,0);cubeStretchPointInfo=null;onStart(e,t){let n=t.getDetector(h.c.CubeControlPoint);if(this.cubeStretchPointInfo=n.result,!this.cubeStretchPointInfo)return;let{node:i,controlPoint:r}=this.cubeStretchPointInfo,o=i.toGlobalPoint(new x.E(r.x,r.y));this.originPos=new x.E(e.globalPoint.x,e.globalPoint.y),this.originOffset=new x.E(o.x-this.originPos.x,o.y-this.originPos.y),t.actionManager.execAction(new P.M)}onMove(e,t){if(!this.cubeStretchPointInfo)return;let{node:n,controlPoint:i}=this.cubeStretchPointInfo,{globalPoint:r}=e,o=new x.E(i.x,i.y),a=new x.E(r.x-this.originPos.x,r.y-this.originPos.y);o.x+=a.x,o.y+=a.y;let l=n.getProp(f.d.ShapeType).controlPoints[0],s=t.alignManager.align({alignMode:b.$.MoveEditableControlPoint,alignAxis:C.d.XY,startBounds:n.getBounds(),startPoint:n.toGlobalPoint(l),endPoint:new x.E(r.x+this.originOffset.x,r.y+this.originOffset.y)});s?.offset&&(o.x+=s.offset.x,o.y+=s.offset.y);let d={controlPoints:[o],type:f.d.ShapeType},c=new y.x({id:n.id,props:[d]});t.actionManager.execAction(c)}onUp(e,t){t.actionManager.execAction(new w.q),this.cubeStretchPointInfo=null,this.originPos.x=0,this.originPos.y=0,this.originOffset.x=0,this.originOffset.y=0}}g.W;var v=n(166887);class E extends u.X{ringControlPointInfo=null;onStart(e,t){let n=t.getDetector(h.c.CircularRingControlPoint);this.ringControlPointInfo=n.result,this.ringControlPointInfo&&t.actionManager.execAction(new P.M)}onMove(e,t){if(!this.ringControlPointInfo)return;let{node:n,controlPoints:i,cpIndex:r}=this.ringControlPointInfo,{baseProps:o}=n,{globalPoint:a}=e,l=o.width/2,s=n.toLocalPoint(a),d=new x.E(o.width/2,o.height/2);if(0===r||1===r){let e=i[r],o=t.alignManager.align({alignMode:b.$.MoveEditableControlPoint,alignAxis:C.d.XY,startBounds:n.getBounds(),startPoint:n.toGlobalPoint(e),endPoint:a});o?.offset&&(s.x+=o.offset.x,s.y+=o.offset.y),this.handleOuterControlPoint(r,s,d,l,i)}else 2===r&&this.handleInnerControlPoint(r,s,d,l,i,n);let c={controlPoints:i,type:f.d.ShapeType},h=new y.x({id:n.id,props:[c]});t.actionManager.execAction(h)}onUp(e,t){t.actionManager.execAction(new w.q),this.ringControlPointInfo=null}calculateDistance(e,t){let n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}calculateUnitVector(e,t){let n=this.calculateDistance(e,t);return new v.O((e.x-t.x)/n,(e.y-t.y)/n)}handleOuterControlPoint(e,t,n,i,r){let o=this.calculateUnitVector(t,n),a=new x.E(o.x*i+n.x,o.y*i+n.y);if(r[e].x=a.x,r[e].y=a.y,1===e){let e=this.calculateDistance(r[2],n),t=new x.E(o.x*e+n.x,o.y*e+n.y);r[2].x=t.x,r[2].y=t.y}}handleInnerControlPoint(e,t,n,i,r,o){let a=this.calculateUnitVector(r[1],n),l=new v.O(t.x-n.x,t.y-n.y).dotProduct(a);l<0?l=0:l>i&&(l=i-o.getProp(f.d.Border).borderWidth);let s=new x.E(a.x*l+n.x,a.y*l+n.y);r[e].x=s.x,r[e].y=s.y}}g.W,n(95777);class R{originPos=0;rowColLength=0;startBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};childrenMap=new Map}var N=n(106969);class I extends R{enable(e){return e.isRow}logInfo(e,t){let{table:n,index:i}=e,{columns:r,rows:o}=n.tableProps;this.rowColLength=o[i-1];let a=n.globalBaseProps.y;for(let e=0;e<i-1;e++)a+=o[e];this.originPos=a,this.startBounds={id:n.id,minX:n.globalBaseProps.x,minY:this.originPos,maxX:n.globalBaseProps.x+n.globalBaseProps.width,maxY:this.originPos+this.rowColLength};let l=n.tableProps.cellMatrix.clone(),s=[];for(let e=0;e<r.length;e++)for(let t=i;t<o.length;t++)s.push(l.getCell(t,e));for(let e of s)if(e.children.length>0)for(let n of e.children){let e=t.nodeManager.getNode(n);this.childrenMap.set(n,e.baseProps.clone())}}checkCanWork(e){return!(.001>Math.abs(e.y-this.originPos-this.rowColLength))}alignPoint(e,t,n,i){let r=e.table,o=new x.E(t.x,t.y),a=i.alignManager.align({alignMode:b.$.MoveTableRowCol,alignAxis:C.d.Y,startBounds:{id:r.id,minX:r.globalBaseProps.x,minY:this.originPos,maxX:r.globalBaseProps.x+r.globalBaseProps.width,maxY:this.originPos+this.rowColLength},startPoint:n,endPoint:o,selectNodes:[r],tableRowColIndex:e.index});a?.offset&&(o.y+=a.offset.y);let l=this.originPos+c.iG;return o.y<l&&(o.y=l),o}workAndSendMsg(e,t,n,i){let r=e.y-t.y+this.rowColLength,{index:o,table:a,isRow:l}=n;i.actionManager.execAction(new N.V({id:a.id,rowCols:[{index:o-1,length:r}],isRow:l}))}handleChildrenChangeByRowCol(e,t,n){let i=e.y-t.y;for(let[e,t]of this.childrenMap.entries()){let r={id:e,props:[{...t,y:t.y+i}]};n.actionManager.execAction(new y.x(r))}}}class B extends R{enable(e){return!e.isRow}logInfo(e,t){let{table:n,index:i}=e,{columns:r,rows:o}=n.tableProps;this.rowColLength=r[i-1];let a=n.globalBaseProps.x;for(let e=0;e<i-1;e++)a+=r[e];this.originPos=a;let l=n.tableProps.cellMatrix.clone(),s=[];for(let e=0;e<o.length;e++)for(let t=i;t<r.length;t++)s.push(l.getCell(e,t));for(let e of s)if(e.children.length>0)for(let n of e.children){let e=t.nodeManager.getNode(n);this.childrenMap.set(n,e.baseProps.clone())}}checkCanWork(e){return!(.001>Math.abs(e.x-this.originPos-this.rowColLength))}alignPoint(e,t,n,i){let r=e.table,o=new x.E(t.x,t.y),a=i.alignManager.align({alignMode:b.$.MoveTableRowCol,alignAxis:C.d.X,startBounds:{id:r.id,minX:this.originPos,minY:r.globalBaseProps.y,maxX:this.originPos+this.rowColLength,maxY:r.globalBaseProps.y+r.globalBaseProps.height},startPoint:n,endPoint:o,selectNodes:[e.table],tableRowColIndex:e.index});a?.offset&&(o.x+=a.offset.x);let l=this.originPos+c.iG;return o.x<l&&(o.x=l),o}workAndSendMsg(e,t,n,i){let r=e.x-t.x+this.rowColLength,{index:o,table:a,isRow:l}=n;i.actionManager.execAction(new N.V({id:a.id,rowCols:[{index:o-1,length:r}],isRow:l}))}handleChildrenChangeByRowCol(e,t,n){let i=e.x-t.x;for(let[e,t]of this.childrenMap.entries()){let r={id:e,props:[{...t,x:t.x+i}]};n.actionManager.execAction(new y.x(r))}}}class O extends R{enable(e){return e.isRow&&0===e.index}logInfo(e,t){let{table:n,index:i}=e,{columns:r,rows:o}=n.tableProps;this.rowColLength=o[0];let a=n.globalBaseProps.y;for(let e=0;e<i-1;e++)a+=o[e];this.originPos=a,this.startBounds={id:n.id,minX:n.globalBaseProps.x,minY:this.originPos,maxX:n.globalBaseProps.x+n.globalBaseProps.width,maxY:this.originPos+this.rowColLength};let l=n.tableProps.cellMatrix.clone(),s=[];for(let e=0;e<r.length;e++)for(let t=i+1;t<o.length;t++)s.push(l.getCell(t,e));for(let e of s)if(e.children.length>0)for(let n of e.children){let e=t.nodeManager.getNode(n);this.childrenMap.set(n,e.baseProps.clone())}}checkCanWork(e){return!(.001>Math.abs(e.y-this.originPos-this.rowColLength))}alignPoint(e,t,n,i){let r=e.table,o=new x.E(t.x,t.y),a=i.alignManager.align({alignMode:b.$.MoveTableRowCol,alignAxis:C.d.Y,startBounds:{id:r.id,minX:r.globalBaseProps.x,minY:this.originPos,maxX:r.globalBaseProps.x+r.globalBaseProps.width,maxY:this.originPos+this.rowColLength},startPoint:n,endPoint:o,selectNodes:[r],tableRowColIndex:e.index});a?.offset&&(o.y+=a.offset.y);let l=this.originPos-c.iG+this.rowColLength;return o.y>l&&(o.y=l),o}workAndSendMsg(e,t,n,i){let r=e.y-t.y,{index:o,table:a,isRow:l}=n,s=a.globalBaseProps.clone();s.y=this.originPos+r;let d={index:o,length:this.rowColLength-r};i.actionManager.execAction(new y.x({id:a.id,props:[s]})),i.actionManager.execAction(new N.V({id:a.id,rowCols:[d],isRow:l}))}handleChildrenChangeByRowCol(e,t,n){let i=e.y-t.y;for(let[e,t]of this.childrenMap.entries()){let r={id:e,props:[{...t,y:t.y-i}]};n.actionManager.execAction(new y.x(r))}}}class D extends R{enable(e){return!e.isRow&&0===e.index}logInfo(e,t){let{table:n,index:i}=e,{columns:r,rows:o}=n.tableProps;this.rowColLength=r[i];let a=n.globalBaseProps.x;for(let e=0;e<i-1;e++)a+=r[e];this.originPos=a;let l=n.tableProps.cellMatrix.clone(),s=[];for(let e=0;e<o.length;e++)for(let t=i+1;t<r.length;t++)s.push(l.getCell(e,t));for(let e of s)if(e.children.length>0)for(let n of e.children){let e=t.nodeManager.getNode(n);this.childrenMap.set(n,e.baseProps.clone())}}checkCanWork(e){return!(.001>Math.abs(e.x-this.originPos-this.rowColLength))}alignPoint(e,t,n,i){let r=e.table,o=new x.E(t.x,t.y),a=i.alignManager.align({alignMode:b.$.MoveTableRowCol,alignAxis:C.d.X,startBounds:{id:r.id,minX:this.originPos,minY:r.globalBaseProps.y,maxX:this.originPos+this.rowColLength,maxY:r.globalBaseProps.y+r.globalBaseProps.height},startPoint:n,endPoint:o,selectNodes:[e.table],tableRowColIndex:e.index});a?.offset&&(o.x+=a.offset.x);let l=this.originPos-c.iG+this.rowColLength;return o.x>l&&(o.x=l),o}workAndSendMsg(e,t,n,i){let r=e.x-t.x,{index:o,table:a,isRow:l}=n,s=a.globalBaseProps.clone();s.x=this.originPos+r;let d={index:o,length:this.rowColLength-r};i.actionManager.execAction(new y.x({id:a.id,props:[s]})),i.actionManager.execAction(new N.V({id:a.id,rowCols:[d],isRow:l}))}handleChildrenChangeByRowCol(e,t,n){let i=e.x-t.x;for(let[e,t]of this.childrenMap.entries()){let r={id:e,props:[{...t,x:t.x-i}]};n.actionManager.execAction(new y.x(r))}}}class L extends u.X{tableBoundaryStrechHandlers=[new O,new I,new D,new B];currentHandler=null;detectResult=null;lastPos=new x.E(0,0);onStart(e,t){let n=t.detect(h.c.TableRowColBoundary,t.lastDiffTypeEvent);for(let e of this.tableBoundaryStrechHandlers)if(e.enable(n)){this.currentHandler=e;break}if(!this.currentHandler)return void console.error("No handler for table row/col stretch can be enabled!");this.detectResult=n,this.lastPos=e.globalPoint,this.currentHandler.logInfo(n,t),t.actionManager.execAction(new P.M)}onMove(e,t){if(!this.detectResult||!this.currentHandler)return;let n=this.currentHandler.alignPoint(this.detectResult,e.globalPoint,this.lastPos,t);this.currentHandler.checkCanWork(n)&&(t.auxiliaryManager.removeAllHoverGraphic(),t.auxiliaryManager.removeAllSelectGraphic(),this.currentHandler.workAndSendMsg(n,this.lastPos,this.detectResult,t),this.currentHandler.handleChildrenChangeByRowCol(n,this.lastPos,t))}onUp(e,t){this.detectResult=null,this.currentHandler?.childrenMap.clear(),this.currentHandler=null,t.actionManager.execAction(new w.q)}}g.W;var G=n(873411);class H{}var Y=n(339874),k=n(988382),X=n(318440),U=n(131326),_=n(175005),q=n(118252);class W extends H{originalRowCols=[];enable(e){return e.isRow}logInfo(e,t,n){let{table:i}=e,{rows:r}=i.tableProps;this.originalRowCols=[...e.table.tableProps.rows];let{selectRows:o}=e.table.tableStatus;for(let e of(t.clear(),o))k.P.computeMergedRow(i,e,t);let a=0;for(let e of t){if(e>=r.length)return;a+=r[e]}let l=Array.from(t).sort((e,t)=>t-e);if(0===l.length||l[l.length-1]>=r.length)return;let s=i.baseProps,d=l[l.length-1],c=i.tableProps.cellMatrix.getCell(d,0);n.x=c.tableBaseProps.x+s.x,n.y=c.tableBaseProps.y+s.y,n.height=a,n.width=s.width}computeDrawBounds(e,t,n,i){let{width:r,height:o,x:a}=e,l=n.y-i.y,s=e.y+l,d=t.y,c=t.y+t.height-e.height,h=(0,q.Z)(s,d,c);return new M.U(a,h,r,o)}drawPreviewBoundaryLine(e,t,n,i){t<0||t>this.originalRowCols.length||e.addOrUpdateAuxiliaryGraphic(X.T.HoverTableRowColBoundary,{start:n,end:i,lineWidth:Y.h$})}drawPreviewBounds(e,t){t.addOrUpdateAuxiliaryGraphic(X.T.PreviewTableDragRowCol,{rect:e,color:Y.QX,alpha:Y.Z$,radii:[0,0,0,0]})}checkCanWork(){return!0}findInsertIndex(e,t,n,i,r){let o=k.P.findInsertIndex(e.rows,n.y),a=k.P.isMergeRow(e,o-1);for(;a;)o++,a=k.P.isMergeRow(e,o-1);if(o>=e.rows.length)i.x=t.x,i.y=t.y+t.height,r.x=t.x+t.width,r.y=t.y+t.height;else{let n=e.cellMatrix.getCell(o,0);i.x=t.x,i.y=t.y+n.tableBaseProps.y,r.x=t.x+t.width,r.y=t.y+n.tableBaseProps.y}return o}workAndSendMsg(e,t,n,i,r,o){let{table:a,isRow:l}=e,s=Array.from(t).sort((e,t)=>t-e),d=new Set(s),c=[],h=[],p=[];for(let e=0;e<n.rows.length;e++){let t=n.rows[e];d.has(e)?p.push(t):h.push(t)}let g=0;for(let e of s)e<i&&g++;let u=i-g,x=[];x.push(...h.slice(0,u)),x.push(...p),x.push(...h.slice(u)),r.rows=x,this.transformTableProps(n,r,s,u),o.actionManager.execAction(new y.x({id:a.id,props:[r]}));for(let e=i-g;e<i-g+p.length;e++)c.push(e);let f=_.O.selectTableRowCol(a.id,c,l);o.actionManager.execAction(f)}updateRelativeFocus(e,t,n){let i=new Map,r=0;for(let e=0;e<t.rows.length;e++){for(let n=0;n<t.columns.length;n++){let o=t.cellMatrix.getCell(e,n).children;if(o.length>0)for(let e of o)i.set(e,{originalY:r,newY:r})}r+=t.rows[e]}r=0;for(let e=0;e<n.rows.length;e++){for(let t=0;t<n.columns.length;t++){let o=n.cellMatrix.getCell(e,t).children;if(o.length>0)for(let e of o){let t=i.get(e);t&&(t.newY=r)}}r+=n.rows[e]}for(let[t,n]of i.entries()){let i=n.newY-n.originalY,r=e.nodeManager.getNode(t),o={id:t,props:[{...r.baseProps,y:r.baseProps.y+i}]};e.actionManager.execAction(new y.x(o))}}transformTableProps(e,t,n,i){let r=e.cellMatrix.clone().cells,o=new Set(n),a=[],l=[];for(let e=0;e<r.length;e++)o.has(e)?l.push(r[e]):a.push(r[e]);let s=[];s.push(...a.slice(0,i)),s.push(...l),s.push(...a.slice(i));let d=new U.p;d.cells=s,d.updateCellIJ(),d.updateRefCells(),t.cellMatrix=d}}class j extends H{originalRowCols=[];enable(e){return!e.isRow}logInfo(e,t,n){let{table:i}=e,{columns:r}=i.tableProps;this.originalRowCols=[...e.table.tableProps.columns];let{selectCols:o}=e.table.tableStatus;for(let e of(t.clear(),o))k.P.computeMergedCol(i,e,t);let a=0;for(let e of t){if(e>=r.length)return;a+=r[e]}let l=Array.from(t).sort((e,t)=>t-e);if(0===l.length||l[l.length-1]>=r.length)return;let s=i.baseProps,d=l[l.length-1],c=i.tableProps.cellMatrix.getCell(0,d);n.x=c.tableBaseProps.x+s.x,n.y=c.tableBaseProps.y+s.y,n.width=a,n.height=s.height}computeDrawBounds(e,t,n,i){let{width:r,height:o,y:a}=e,l=n.x-i.x,s=e.x+l,d=t.x,c=t.x+t.width-e.width,h=(0,q.Z)(s,d,c);return new M.U(h,a,r,o)}drawPreviewBoundaryLine(e,t,n,i){t<0||t>this.originalRowCols.length||e.addOrUpdateAuxiliaryGraphic(X.T.HoverTableRowColBoundary,{start:n,end:i,lineWidth:Y.h$})}drawPreviewBounds(e,t){t.addOrUpdateAuxiliaryGraphic(X.T.PreviewTableDragRowCol,{rect:e,color:Y.QX,alpha:Y.Z$,radii:[0,0,0,0]})}checkCanWork(){return!0}findInsertIndex(e,t,n,i,r){let o=k.P.findInsertIndex(e.columns,n.x),a=k.P.isMergeCol(e,o-1);for(;a;)o++,a=k.P.isMergeCol(e,o-1);if(o>=e.columns.length)i.x=t.x+t.width,i.y=t.y,r.x=t.x+t.width,r.y=t.y+t.height;else{let n=e.cellMatrix.getCell(0,o);i.x=t.x+n.tableBaseProps.x,i.y=t.y,r.x=t.x+n.tableBaseProps.x,r.y=t.y+t.height}return o}workAndSendMsg(e,t,n,i,r,o){let{table:a,isRow:l}=e,s=Array.from(t).sort((e,t)=>t-e),d=new Set(s),c=[],h=[],p=[];for(let e=0;e<n.columns.length;e++){let t=n.columns[e];d.has(e)?p.push(t):h.push(t)}let g=0;for(let e of s)e<i&&g++;let u=i-g,x=[];x.push(...h.slice(0,u)),x.push(...p),x.push(...h.slice(u)),r.columns=x,this.transformTableProps(n,r,s,u),o.actionManager.execAction(new y.x({id:a.id,props:[r]}));for(let e=i-g;e<i-g+p.length;e++)c.push(e);let f=_.O.selectTableRowCol(a.id,c,l);o.actionManager.execAction(f)}updateRelativeFocus(e,t,n){let i=new Map,r=0;for(let e=0;e<t.columns.length;e++){for(let n=0;n<t.rows.length;n++){let o=t.cellMatrix.getCell(n,e).children;if(o.length>0)for(let e of o)i.set(e,{originalX:r,newX:r})}r+=t.columns[e]}r=0;for(let e=0;e<n.columns.length;e++){for(let t=0;t<n.rows.length;t++){let o=n.cellMatrix.getCell(t,e).children;if(o.length>0)for(let e of o){let t=i.get(e);t&&(t.newX=r)}}r+=n.columns[e]}for(let[t,n]of i.entries()){let i=n.newX-n.originalX,r=e.nodeManager.getNode(t),o={id:t,props:[{...r.baseProps,x:r.baseProps.x+i}]};e.actionManager.execAction(new y.x(o))}}transformTableProps(e,t,n,i){let r=e.cellMatrix.clone().cells,o=m.G.matrixTranspose(r),a=new Set(n),l=[],s=[];for(let e=0;e<o.length;e++)a.has(e)?s.push(o[e]):l.push(o[e]);let d=[];d.push(...l.slice(0,i)),d.push(...s),d.push(...l.slice(i));let c=m.G.matrixTranspose(d),h=new U.p;h.cells=c,h.updateCellIJ(),h.updateRefCells(),t.cellMatrix=h}}class F extends H{originalRowCols=[];enable(e){if(e.isRow)return!1;let{table:t}=e,n=t.tableProps.cellMatrix.getCell(0,0);return!(n.colSpan<t.tableProps.columns.length)&&1===n.rowSpan}logInfo(e,t,n){let{table:i}=e,{columns:r,rows:o}=i.tableProps;this.originalRowCols=[...e.table.tableProps.columns];let{selectCols:a}=e.table.tableStatus;for(let e of(t.clear(),a))k.P.computeMergedCol(i,e,t,1);let l=0,s=o[0];for(let e of t){if(e>=r.length)return;l+=r[e]}let d=Array.from(t).sort((e,t)=>t-e);if(0===d.length||d[d.length-1]>=r.length)return;let c=i.baseProps,h=d[d.length-1],p=i.tableProps.cellMatrix.getCell(0,h);n.x=p.tableBaseProps.x+c.x,n.y=p.tableBaseProps.y+c.y+s,n.width=l,n.height=c.height-s}computeDrawBounds(e,t,n,i){let{width:r,height:o,y:a}=e,l=n.x-i.x,s=e.x+l,d=t.x,c=t.x+t.width-e.width,h=(0,q.Z)(s,d,c);return new M.U(h,a,r,o)}drawPreviewBoundaryLine(e,t,n,i){t<0||t>this.originalRowCols.length||e.addOrUpdateAuxiliaryGraphic(X.T.HoverTableRowColBoundary,{start:n,end:i,lineWidth:Y.h$})}drawPreviewBounds(e,t){t.addOrUpdateAuxiliaryGraphic(X.T.PreviewTableDragRowCol,{rect:e,color:Y.QX,alpha:Y.Z$,radii:[0,0,0,0]})}checkCanWork(){return!0}findInsertIndex(e,t,n,i,r){let o=e.rows[0],a=k.P.findInsertIndex(e.columns,n.x),l=k.P.isMergeCol(e,a-1,!0);for(;l;)a++,l=k.P.isMergeCol(e,a-1,!0);if(a>=e.columns.length)i.x=t.x+t.width,i.y=t.y+o,r.x=t.x+t.width,r.y=t.y+t.height;else{let n=e.cellMatrix.getCell(0,a);i.x=t.x+n.tableBaseProps.x,i.y=t.y+o,r.x=t.x+n.tableBaseProps.x,r.y=t.y+t.height}return a}workAndSendMsg(e,t,n,i,r,o){let{table:a,isRow:l}=e,s=Array.from(t).sort((e,t)=>t-e),d=new Set(s),c=[],h=[],p=[];for(let e=0;e<n.columns.length;e++){let t=n.columns[e];d.has(e)?p.push(t):h.push(t)}let g=0;for(let e of s)e<i&&g++;let u=i-g,x=[];x.push(...h.slice(0,u)),x.push(...p),x.push(...h.slice(u)),r.columns=x,this.transformTableProps(n,r,s,u),o.actionManager.execAction(new y.x({id:a.id,props:[r]}));for(let e=i-g;e<i-g+p.length;e++)c.push(e);let f=_.O.selectTableRowCol(a.id,c,l);o.actionManager.execAction(f)}updateRelativeFocus(e,t,n){let i=new Map,r=0;for(let e=0;e<t.columns.length;e++){for(let n=0;n<t.rows.length;n++){let o=t.cellMatrix.getCell(n,e).children;if(o.length>0)for(let e of o)i.set(e,{originalX:r,newX:r})}r+=t.columns[e]}r=0;for(let e=0;e<n.columns.length;e++){for(let t=0;t<n.rows.length;t++){let o=n.cellMatrix.getCell(t,e).children;if(o.length>0)for(let e of o){let t=i.get(e);t&&(t.newX=r)}}r+=n.columns[e]}for(let[t,n]of i.entries()){let i=n.newX-n.originalX,r=e.nodeManager.getNode(t),o={id:t,props:[{...r.baseProps,x:r.baseProps.x+i}]};e.actionManager.execAction(new y.x(o))}}transformTableProps(e,t,n,i){let r=e.cellMatrix.clone().cells,o=r[0],a=r.slice(1),l=m.G.matrixTranspose(a),s=new Set(n),d=[],c=[];for(let e=0;e<l.length;e++)s.has(e)?c.push(l[e]):d.push(l[e]);let h=[];h.push(...d.slice(0,i)),h.push(...c),h.push(...d.slice(i));let p=[o,...m.G.matrixTranspose(h)],g=new U.p;g.cells=p,g.updateCellIJ(),g.updateRefCells(),t.cellMatrix=g}}class J extends H{originalRowCols=[];enable(e){if(!e.isRow)return!1;let{table:t}=e,n=t.tableProps.cellMatrix.getCell(0,0);return!(n.rowSpan<t.tableProps.rows.length)&&1===n.colSpan}logInfo(e,t,n){let{table:i}=e,{columns:r,rows:o}=i.tableProps;this.originalRowCols=[...e.table.tableProps.rows];let{selectRows:a}=e.table.tableStatus;for(let e of(t.clear(),a))k.P.computeMergedRow(i,e,t,1);let l=0,s=r[0];for(let e of t){if(e>=o.length)return;l+=o[e]}let d=Array.from(t).sort((e,t)=>t-e);if(0===d.length||d[d.length-1]>=o.length)return;let c=i.baseProps,h=d[d.length-1],p=i.tableProps.cellMatrix.getCell(h,0);n.x=p.tableBaseProps.x+c.x+s,n.y=p.tableBaseProps.y+c.y,n.width=c.width-s,n.height=l}computeDrawBounds(e,t,n,i){let{width:r,height:o,x:a}=e,l=n.y-i.y,s=e.y+l,d=t.y,c=t.y+t.height-e.height,h=(0,q.Z)(s,d,c);return new M.U(a,h,r,o)}drawPreviewBoundaryLine(e,t,n,i){t<0||t>this.originalRowCols.length||e.addOrUpdateAuxiliaryGraphic(X.T.HoverTableRowColBoundary,{start:n,end:i,lineWidth:Y.h$})}drawPreviewBounds(e,t){t.addOrUpdateAuxiliaryGraphic(X.T.PreviewTableDragRowCol,{rect:e,color:Y.QX,alpha:Y.Z$,radii:[0,0,0,0]})}checkCanWork(){return!0}findInsertIndex(e,t,n,i,r){let o=e.columns[0],a=k.P.findInsertIndex(e.rows,n.y),l=k.P.isMergeCol(e,a-1,!0);for(;l;)a++,l=k.P.isMergeCol(e,a-1,!0);if(a>=e.rows.length)i.x=t.x+o,i.y=t.y+t.height,r.x=t.x+t.width,r.y=t.y+t.height;else{let n=e.cellMatrix.getCell(a,0);i.x=t.x+o,i.y=t.y+n.tableBaseProps.y,r.x=t.x+t.width,r.y=t.y+n.tableBaseProps.y}return a}workAndSendMsg(e,t,n,i,r,o){let{table:a,isRow:l}=e,s=Array.from(t).sort((e,t)=>t-e),d=new Set(s),c=[],h=[],p=[];for(let e=0;e<n.rows.length;e++){let t=n.rows[e];d.has(e)?p.push(t):h.push(t)}let g=0;for(let e of s)e<i&&g++;let u=i-g,x=[];x.push(...h.slice(0,u)),x.push(...p),x.push(...h.slice(u)),r.rows=x,this.transformTableProps(n,r,s,u),o.actionManager.execAction(new y.x({id:a.id,props:[r]}));for(let e=i-g;e<i-g+p.length;e++)c.push(e);let f=_.O.selectTableRowCol(a.id,c,l);o.actionManager.execAction(f)}updateRelativeFocus(e,t,n){let i=new Map,r=0;for(let e=0;e<t.rows.length;e++){for(let n=0;n<t.columns.length;n++){let o=t.cellMatrix.getCell(e,n).children;if(o.length>0)for(let e of o)i.set(e,{originalY:r,newY:r})}r+=t.rows[e]}r=0;for(let e=0;e<n.rows.length;e++){for(let t=0;t<n.columns.length;t++){let o=n.cellMatrix.getCell(e,t).children;if(o.length>0)for(let e of o){let t=i.get(e);t&&(t.newY=r)}}r+=n.rows[e]}for(let[t,n]of i.entries()){let i=n.newY-n.originalY,r=e.nodeManager.getNode(t),o={id:t,props:[{...r.baseProps,y:r.baseProps.y+i}]};e.actionManager.execAction(new y.x(o))}}transformTableProps(e,t,n,i){let r=e.cellMatrix.clone().cells,o=r.length,a=[],l=[];for(let e=0;e<o;e++){let t=r[e]||[];a.push(t[0]),l.push(t.slice(1))}let s=new Set(n),d=[],c=[];for(let e=0;e<l.length;e++)s.has(e)?c.push(l[e]):d.push(l[e]);let h=[...d.slice(0,i),...c,...d.slice(i)],p=[];for(let e=0;e<o;e++)p.push([a[e],...h[e]]);let g=new U.p;g.cells=p,g.updateCellIJ(),g.updateRefCells(),t.cellMatrix=g}}class z extends u.X{tableDragRolColHandlers=[new F,new J,new W,new j];currentHandler=null;detectResult=null;originalBaseProps=null;originalTableProps=null;originPoint=new x.E;dragRowColSet=new Set;colRowBaseProps=new G.s;insertIndex=-1;onStart(e,t){let n=t.detect(h.c.TableRowCol,t.lastDiffTypeEvent);if(n){for(let e of this.tableDragRolColHandlers)if(e.enable(n)){this.currentHandler=e;break}if(!this.currentHandler)return void console.error("No handler for table row/col drag can be enabled!");this.detectResult=n,this.currentHandler.logInfo(n,this.dragRowColSet,this.colRowBaseProps,t),this.originPoint.x=e.globalPoint.x,this.originPoint.y=e.globalPoint.y,this.originalBaseProps=n.table.globalBaseProps.clone(),this.originalTableProps=n.table.tableProps.clone(),t.actionManager.execAction(new P.M)}}onMove(e,t){if(!this.detectResult||!this.currentHandler||!this.originalTableProps||!this.originalBaseProps)return;t.auxiliaryManager.removeAllHoverGraphic();let n=new x.E(e.globalPoint.x-this.originalBaseProps.x,e.globalPoint.y-this.originalBaseProps.y),i=new x.E,r=new x.E;this.insertIndex=this.currentHandler.findInsertIndex(this.originalTableProps,this.originalBaseProps,n,i,r);let o=this.currentHandler.computeDrawBounds(this.colRowBaseProps,this.originalBaseProps,e.globalPoint,this.originPoint);this.currentHandler.drawPreviewBounds(o,t),this.currentHandler.drawPreviewBoundaryLine(t,this.insertIndex,i,r)}onUp(e,t){if(!this.currentHandler||!this.detectResult||!this.originalTableProps)return void this.reset(t);let n=this.originalTableProps.clone();this.currentHandler.workAndSendMsg(this.detectResult,this.dragRowColSet,this.originalTableProps,this.insertIndex,n,t),this.currentHandler.updateRelativeFocus(t,this.originalTableProps,n),t.actionManager.execAction(new w.q),this.reset(t)}reset(e){this.detectResult=null,this.currentHandler=null,this.originalTableProps=null,this.originalBaseProps=null,this.insertIndex=-1,e.auxiliaryManager.removeAllHoverGraphic(),e.removeAuxiliaryGraphic(X.T.PreviewTableDragRowCol)}}g.W;var V=n(876834),Z=n(891763);class $ extends u.X{firstPos=new x.E;originalWidth=0;xVector=new v.O;onStart(e,t){let n=t.getDetector(h.c.LineTextBoxStretch);if(this.result=n?.result,!this.result)return;this.firstPos=e.globalPoint;let{line:i}=this.result,{graphicText:r}=i;this.originalWidth=r.baseProps.width;let o=r.baseProps.angle*Math.PI/180;this.xVector=new v.O(Math.cos(o),Math.sin(o)),t.canBeEditText()&&(t.auxiliaryManager.clearTextSelection(),t.inputManager.blur()),t.actionManager.execAction(new P.M),t.auxiliaryManager.updateSelectGraphic({type:V.q.SingleSelectConnector,hideControlPoints:!0})}onMove(e,t){if(!this.result)return;let n=new v.O(e.globalPoint.x-this.firstPos.x,e.globalPoint.y-this.firstPos.y).dotProduct(this.xVector),i=this.originalWidth;i="left"===this.result.side?this.originalWidth-2*n:this.originalWidth+2*n;let{line:r}=this.result,o=r.captionsProps.clone(),a=o.captions[0]??new Z.A;a.textBoxWidth=Math.max(i,10),o.captions.splice(0,1,a);let l=new y.x({id:r.id,props:[o]});t.actionManager.execAction(l)}onUp(e,t){t.actionManager.execAction(new w.q),t.refreshSelectStatus({type:V.q.SingleSelectConnector,hideControlPoints:!1}),this.result=void 0,this.firstPos=new x.E,this.originalWidth=0,this.xVector=new v.O}}g.W;var K=n(335342),Q=n(117866);class ee extends u.X{onStart(e,t){let n=t.getDetector(h.c.LineTextBox);n?.result&&(this.line=n.result.line,t.canBeEditText()&&(t.auxiliaryManager.clearTextSelection(),t.inputManager.blur()),t.actionManager.execAction(new P.M),t.auxiliaryManager.updateSelectGraphic({type:V.q.SingleSelectConnector,hideControlPoints:!0}))}onMove(e,t){if(!this.line)return;let{line:n}=this,i=n.drawer.findProjectPoint(n,e.globalPoint),r=n.captionsProps.clone(),o=r.captions[0]??new Z.A;o.t=i.t,o.positionType=((e,t,n)=>{let i=K.O.ON_LINE;if(30>m.G.distance(n,t))return i;let r=e.getDrawPoints();if(e.isCurveLine()){let e=Math.floor((r.length-4)/3)+2,o=t.t*(e-1)-t.pointIndex,a=3*t.pointIndex,l=r[a],s=r[a+1],d=r[a+2],c=r[a+3],h=(0,Q.mz)(o,l,s,d,c),p=Math.sqrt(h.x*h.x+h.y*h.y),g=new v.O(-h.y/p*15,h.x/p*15),u=new v.O(n.x-t.x,n.y-t.y);g.divideScalar(g.magnitude()),u.divideScalar(u.magnitude()),i=g.dotProduct(u)>0?K.O.BELLOW_LINE:K.O.ABOVE_LINE}else{let e=r[t.pointIndex],o=r[t.pointIndex+1],a=new x.E(e.x-n.x,e.y-n.y),l=new x.E(o.x-n.x,o.y-n.y),s=a.x*l.y-a.y*l.x;s>0?i=K.O.BELLOW_LINE:s<0&&(i=K.O.ABOVE_LINE)}return i})(n,i,e.globalPoint),r.captions.splice(0,1,o);let a=new y.x({id:n.id,props:[r]});t.actionManager.execAction(a)}onUp(e,t){t.actionManager.execAction(new w.q),t.refreshSelectStatus({type:V.q.SingleSelectConnector,hideControlPoints:!1}),this.line=void 0}}g.W;var et=n(797615),en=n(678014);class ei{onEnable(e,t,n,i){let r=this.enable(e,t,n,i);return r&&this.logInfo(e,t,n,i),r}}var er=n(615691),eo=n(808687),ea=n(140512),el=n(920570);class es extends ei{lastPos=new x.E(0,0);targetNodes=[];tipNode=null;renderText=null;handler=new er._;enable(e,t,n,i){return t.length>0&&t.length===e.length&&null!==n}logInfo(e,t,n,i){let r=i.lastDiffTypeEvent.globalPoint;this.lastPos=eo.D.trimPoint(r),this.targetNodes=e,this.tipNode=n,this.renderText=new el.x;let o=this.tipNode.getTextContentBounds(),a={x:o.left,y:o.top,width:Math.max(o.right-o.left,0),height:Math.max(o.bottom-o.top,0)};this.renderText.typesetting(this.tipNode.graphicContext,this.tipNode.textProps,a),this.renderText.lineStyleOverride(),i.actionManager.execAction(new P.M)}onMove(e,t){let n=eo.D.trimPoint(e.globalPoint),i=new x.E(n.x-this.lastPos.x,n.y-this.lastPos.y);for(let r of(this.lastPos=n,this.targetNodes))for(let n of this.handler.handle(r,i,e,t))t.actionManager.execAction(n);this.computeMindMapHoverLine(i,t),t.auxiliaryManager.removeAllHoverGraphic(),t.auxiliaryManager.removeAllSelectGraphic()}onUp(e,t){let n=eo.D.trimPoint(e.globalPoint),i=new x.E(n.x-this.lastPos.x,n.y-this.lastPos.y),r=null;if(this.tipNode){let e=M.U.baseProps2Rect(this.tipNode.globalBaseProps);r=ea.R.detectInteractiveMindNode(t.nodeManager,e,new Set(this.targetNodes))}if(r){let e=this.targetNodes.filter(e=>null===e.mindMapParent);ea.R.computeMindMapActionLogs(this.targetNodes,r,i,t),ea.R.modifyMindMapNodeAndSendMsg(e,t,!0),ea.R.updateMindMapTreeAndSendMsg(r.mindMapRoot,t)}this.targetNodes.length>1?this.targetNodes.forEach(e=>e.hideInDrag=!1):this.targetNodes[0].mindMapChildren.forEach(e=>e.hideInDrag=!1),t.removeAuxiliaryGraphic(X.T.DragHoverMindMapLine),t.removeAuxiliaryGraphic(X.T.DragHoverMindMap),t.actionManager.execAction(new w.q),t.auxiliaryManager.refreshSelectStatus()}computeMindMapHoverLine(e,t){if(!this.tipNode)return null;let n=this.tipNode.globalBaseProps.clone(),i=M.U.baseProps2Rect(n),r=this.tipNode.getProp(f.d.Border).clone(),o=ea.R.detectInteractiveMindNode(t.nodeManager,i,new Set(this.targetNodes));if(o){if(this.targetNodes.length>1){this.targetNodes.forEach(e=>e.hideInDrag=!0);let e=this.tipNode.getProp(f.d.Color).clone(),i=this.tipNode.mindMapProps.clone(),o=new x.E(n.x,n.y);t.addOrUpdateAuxiliaryGraphic(X.T.DragHoverMindMap,{baseProps:n,colorProps:e,borderProps:r,mindMapProps:i,renderText:this.renderText,pos:o})}else this.targetNodes[0].mindMapChildren.forEach(e=>e.hideInDrag=!0);let e={baseProps:n,startPointBaseProps:o.globalBaseProps,parentMindLayoutEnum:o.mindMapProps.layoutEnum,borderProps:r,lineStyle:o.mindMapRoot?o.mindMapRoot.mindMapProps.lineStyle:o.mindMapProps.lineStyle};t.addOrUpdateAuxiliaryGraphic(X.T.DragHoverMindMapLine,e),t.renderManager.addContentDrawTask()}else this.targetNodes.length>1?(this.targetNodes.forEach(e=>e.hideInDrag=!1),t.removeAuxiliaryGraphic(X.T.DragHoverMindMap)):this.targetNodes[0].mindMapChildren.forEach(e=>e.hideInDrag=!1),t.renderManager.addContentDrawTask(),t.removeAuxiliaryGraphic(X.T.DragHoverMindMapLine);return o}}var ed=n(281042);class ec extends ei{lastPos=new x.E(0,0);targetNodes=[];tipNode=null;tipOriginPoint=new x.E(0,0);sameMindMapParent=null;renderText=null;handler=new er._;enable(e,t,n,i){return null!==n}logInfo(e,t,n,i){this.sameMindMapParent=null,this.targetNodes=e;let r=new Set,o=i.lastDiffTypeEvent.globalPoint;for(let t=e.length-1;t>-1;t--){let n=e[t];if(r.add(n.mindMapParent),n.contains(o)){this.tipNode=n;break}}1===r.size&&(this.sameMindMapParent=[...r][0]);let a=this.tipNode.globalBaseProps;this.tipOriginPoint=new x.E(a.x,a.y),this.lastPos=eo.D.trimPoint(i.lastDiffTypeEvent.globalPoint),this.renderText=new el.x;let l=this.tipNode.getTextContentBounds(),s={x:l.left,y:l.top,width:Math.max(l.right-l.left,0),height:Math.max(l.bottom-l.top,0)};this.renderText.typesetting(this.tipNode.graphicContext,this.tipNode.textProps,s),this.renderText.lineStyleOverride(),this.targetNodes.forEach(e=>this.transparentNode(e,!0)),i.renderManager.addContentDrawTask(),i.actionManager.execAction(new P.M)}transparentNode(e,t){for(let n of(e.transparentInDrag=t,e.mindMapChildren))this.transparentNode(n,t)}onMove(e,t){let n=eo.D.trimPoint(e.globalPoint),i=new x.E(n.x-this.lastPos.x,n.y-this.lastPos.y);this.lastPos=n;let r=this.tipNode,o=r.globalBaseProps.clone();o.x=this.tipOriginPoint.x+i.x,o.y=this.tipOriginPoint.y+i.y,this.tipOriginPoint.x=o.x,this.tipOriginPoint.y=o.y;let a=r.getProp(f.d.Color).clone(),l=r.getProp(f.d.Border).clone(),s=r.mindMapProps.clone(),d=new x.E(o.x,o.y);t.addOrUpdateAuxiliaryGraphic(X.T.DragHoverMindMap,{baseProps:o,colorProps:a,borderProps:l,mindMapProps:s,renderText:this.renderText,pos:d});let c=M.U.baseProps2Rect(o),h=ea.R.detectInteractiveMindNode(t.nodeManager,c,new Set(this.targetNodes));if(h){let e={baseProps:o,startPointBaseProps:h.globalBaseProps,parentMindLayoutEnum:h.mindMapProps.layoutEnum,borderProps:l,lineStyle:h.mindMapRoot?h.mindMapRoot.mindMapProps.lineStyle:h.mindMapProps.lineStyle};t.addOrUpdateAuxiliaryGraphic(X.T.DragHoverMindMapLine,e)}else t.removeAuxiliaryGraphic(X.T.DragHoverMindMapLine)}onUp(e,t){let n=eo.D.trimPoint(e.globalPoint),i=new x.E(n.x-this.lastPos.x,n.y-this.lastPos.y),r=this.tipNode.globalBaseProps.clone();r.x=this.tipOriginPoint.x+i.x,r.y=this.tipOriginPoint.y+i.y,this.tipOriginPoint.x=r.x,this.tipOriginPoint.y=r.y;let o=M.U.baseProps2Rect(r),a=ea.R.detectInteractiveMindNode(t.nodeManager,o,new Set(this.targetNodes));if(this.targetNodes.forEach(e=>this.transparentNode(e,!1)),t.removeAuxiliaryGraphic(X.T.DragHoverMindMap),t.removeAuxiliaryGraphic(X.T.DragHoverMindMapLine),a&&a===this.sameMindMapParent)return void t.renderManager.addContentDrawTask();let l=new Set;if(t.actionManager.execAction(new P.M),a){l.add(a.mindMapRoot),this.targetNodes.forEach(e=>{e.mindMapParent&&l.add(e.mindMapRoot)});let e=this.targetNodes.filter(e=>null===e.mindMapParent);ea.R.computeMindMapActionLogs(this.targetNodes,a,i,t),ea.R.modifyMindMapNodeAndSendMsg(e,t,!0),l.forEach(e=>ea.R.updateMindMapTreeAndSendMsg(e,t)),t.actionManager.execAction(new w.q);return}let s=this.tipNode.globalBaseProps.clone(),d=[];for(let e of this.targetNodes){let n=null===e.mindMapParent,i=new x.E;if(e===this.tipNode)i.x=o.x,i.y=o.y;else{let t=e.globalBaseProps;i.x=r.x+(t.x-s.x),i.y=r.y+(t.y-s.y)}if(n){let n=e.globalBaseProps;for(let r of this.handler.handle(e,new x.E(i.x-n.x,i.y-n.y),t.nodeManager))t.actionManager.execAction(r);continue}d.push(e);let a=[],c={type:f.d.Base,x:i.x,y:i.y};a.push(c),l.add(e.mindMapRoot),l.add(e);let h=e.mindMapRoot.mindMapProps.layoutEnum,p=e.mindMapProps.layoutEnum;h===et.gd.MINDMAP_LEFT_RIGHT&&p===et.gd.SUB_LEFT&&(h=et.gd.SUB_LEFT),h===et.gd.MINDMAP_LEFT_RIGHT&&p===et.gd.SUB_RIGHT&&(h=et.gd.SUB_RIGHT);let g={type:f.d.MindMap,parentId:"",layoutEnum:h};a.push(g);let u={id:e.id,props:a};t.actionManager.execAction(new y.x(u));let P=e.getMindMapPath(),w=[],m={id:e.id,fromParent:P,toParent:w};t.actionManager.execAction(new ed.$(m))}ea.R.modifyMindMapNodeAndSendMsg(d,t,!1),l.forEach(e=>ea.R.updateMindMapTreeAndSendMsg(e,t)),t.actionManager.execAction(new w.q)}}class eh extends ei{lastPos=new x.E(0,0);handler=new er._;rootNodes=[];enable(e,t,n,i){return t.length>0&&null===n}logInfo(e,t,n,i){this.lastPos=eo.D.trimPoint(i.lastDiffTypeEvent.globalPoint),this.rootNodes=t,i.actionManager.execAction(new P.M)}onMove(e,t){let n=eo.D.trimPoint(e.globalPoint),i=new x.E(n.x-this.lastPos.x,n.y-this.lastPos.y);for(let r of(this.lastPos=n,this.rootNodes))for(let n of this.handler.handle(r,i,e,t))t.actionManager.execAction(n);t.auxiliaryManager.removeAllHoverGraphic(),t.auxiliaryManager.removeAllSelectGraphic()}onUp(e,t){let n=eo.D.trimPoint(e.globalPoint),i=new x.E(n.x-this.lastPos.x,n.y-this.lastPos.y);for(let e of this.rootNodes)for(let n of this.handler.handle(e,i,t.nodeManager))t.actionManager.execAction(n);t.actionManager.execAction(new w.q),t.auxiliaryManager.refreshSelectStatus()}}class ep extends ei{enable(e,t,n,i){return 0===t.length&&null===n}logInfo(e,t,n,i){}onMove(e,t){}onUp(e,t){}}class eg extends u.X{dragMindMapWorker=[new es,new ec,new eh,new ep];currentWorker=null;computeTipNode(e,t){for(let n=e.length-1;n>-1;n--){let i=e[n];if(i.contains(t))return i}return null}onStart(e,t){let n=en.v.sortGraphicsV2([...t.getSelectNodes()]),i=n.filter(e=>null===e.mindMapParent),r=t.lastDiffTypeEvent.globalPoint,o=this.computeTipNode(n,r);for(let e of this.dragMindMapWorker)if(e.onEnable(n,i,o,t)){this.currentWorker=e;break}}onMove(e,t){this.currentWorker&&this.currentWorker.onMove(e,t)}onUp(e,t){this.currentWorker&&this.currentWorker.onUp(e,t)}}g.W;var eu=n(624905);class ex extends u.X{res=null;startPoint=new x.E(0,0);startPointYOffset=-1;startLifeLineLength=-1;onStart(e,t){let n=t.getDetector(h.c.LifeLine);if(!n?.detect(e,t)||!n.result)return;let i=n.result.node;this.res=n.result,this.startPoint=e.globalPoint,this.startLifeLineLength=i.lifelineProps.lifelineLength,this.startPointYOffset=e.globalPoint.y-i.getLifeLinePoint().end.y,t.actionManager.execAction(new P.M)}onMove(e,t){if(!this.res)return;let n=this.res.node,i=e.globalPoint,r=this.startLifeLineLength+(i.y-this.startPoint.y),o=t.alignManager.align({alignMode:b.$.MovePoint,alignAxis:C.d.X,startBounds:n.getBounds(),startPoint:n.getLifeLinePoint().end,endPoint:new x.E(this.startPoint.x,i.y-this.startPointYOffset)});o?.offset&&(r+=o.offset.y),r<50&&(r=50);let a=new eu.I;a.update({lifelineLength:r});let l=new y.x({id:n.id,props:[a]});t.actionManager.execAction(l)}onUp(e,t){this.res&&(t.actionManager.execAction(new w.q),this.res=null)}}g.W;var ef=n(196468),ey=n(334918),eP=n(347250),ew=n(873225),em=n(937093),eM=n(793720),eT=n(268283);class eb extends u.X{activation=null;line=null;startPoint=new x.E(0,0);snapTo=et.Tq.SNAPTO_AUTO;init(e,t,n,i){this.activation=e,this.line=t,this.startPoint=n,this.snapTo=i}onStart(e,t){}onMove(e,t){let n;if(!this.activation||!this.line)return null;let i=this.activation,r=this.isSelfCall(this.startPoint,e.globalPoint,t);if(n=r?new x.E(this.startPoint.x,eo.D.valueInRange(e.globalPoint.y,i.globalBaseProps.y,i.globalBaseProps.y+i.globalBaseProps.height)):new x.E(e.globalPoint.x,this.startPoint.y),this.line){let e=t.alignManager.align({alignMode:b.$.MovePoint,alignAxis:C.d.Y,startBounds:this.line.getBounds(),startPoint:this.line.points[this.line.points.length-1],endPoint:n,selectNodes:[this.line]});e?.offset&&(n.x+=e.offset.x)}return this.rebuildMessageLineProps(n,r,t)}onUp(e,t){return this.activation&&this.line?this.onMove(e,t):null}isSelfCall(e,t,n){let i=n.getScale(),r=c.qu/i,o=c.qG/i;return!!(Math.abs(t.x-e.x)<=r&&Math.abs(t.y-e.y)>=o)}rebuildMessageLineProps(e,t,n){let i=this.startPoint,r=this.line,o=this.activation,a=this.snapTo,l=this.line?.parent,s=o.globalBaseProps,d=l?.globalBaseProps,h=new G.s;h.x=Math.min(i.x,e.x)-(d?d.x:0)+(t&&a===et.Tq.SNAPTO_LEFT?-c.J1:0),h.y=Math.min(i.y,e.y)-(d?d.y:0);let p=new ew.o([],t?em.SP.PolyLine:em.SP.SimpleLine,eM.Y.None,eM.Y.TRIANGLE_ARROW),g=new x.E(i.x-(d?d.x:0)-h.x,i.y-(d?d.y:0)-h.y),u=new x.E(e.x-(d?d.x:0)-h.x,e.y-(d?d.y:0)-h.y);if(t){let e;e=r.points.length>2?Math.abs(r.points[1].x-r.points[0].x)*(a===et.Tq.SNAPTO_RIGHT?1:-1):c.J1*(a===et.Tq.SNAPTO_RIGHT?1:-1),p.points=[g,new x.E(g.x+e,g.y),new x.E(g.x+e,u.y),u]}else p.points=[g,u];h.width=Math.max(...p.points.map(e=>e.x))-Math.min(...p.points.map(e=>e.x)),h.height=Math.max(...p.points.map(e=>e.y))-Math.min(...p.points.map(e=>e.y));let f=new eT.j;return f.start={id:o.id,snapTo:a,attachType:et.J3.MAGNET_ANCHOR,position:new x.E((i.x-s.x)/s.width,(i.y-s.y)/s.height)},t&&(f.end={id:o.id,snapTo:a,attachType:et.J3.MAGNET_ANCHOR,position:new x.E((e.x-s.x)/s.width,(e.y-s.y)/s.height)}),[h,p,f]}}var eC=n(107671);class eS extends u.X{res=null;line=null;startPoint=new x.E(0,0);handler=new eb;onStart(e,t){if(this.res=t.getDetector(h.c.ActivationBounds).result,!this.res)return;let n=t.auxiliaryCtx.gmlRender.canvas.getContext("2d"),i=this.res.node;this.startPoint=this.res.point,this.line=new ef.s(`${eC.R.type2NodePrefix(et.Jq.Connector)}_preview-line`,n),this.line.updateNodeProps(eP.j.createDefaultLineAddDataWithPoint(this.startPoint,t).props),this.handler.init(i,this.line,this.startPoint,this.res.snapTo),t.actionManager.execAction(new P.M)}onMove(e,t){if(!this.res||!this.line)return;let n=this.handler.onMove(e,t);n&&(this.line.updateNodeProps(n),t.addOrUpdateAuxiliaryGraphic(X.T.PreviewShapes,{nodes:[this.line]}))}onUp(e,t){if(!this.res||!this.line)return;let n=this.handler.onUp(e,t);if(!n)return;[...this.line.propMap.values()].forEach(e=>{n.find(t=>t.type===e.type)||n.push(e)});let i=this.res.node.parent,r={id:t.idGenerator.genId(et.Jq.Connector),type:et.Jq.Connector,zIndex:t.idGenerator.genZIndex(),props:n};if(i){r.parentId=i.id;let e=i.globalBaseProps,t=n.find(e=>e.type===f.d.Base);t.x-=e.x,t.y-=e.y}let o=new ey.C([r]);t.actionManager.execAction(o),t.actionManager.execAction(new w.q),t.removeAuxiliaryGraphic(X.T.PreviewShapes),this.line=null,this.res=null}}g.W;class eA{}var ev=n(587884);class eE extends eA{res=null;handler=new ev.I;enable(e,t){if(!t.getDetector(h.c.MessageLineEndPoint)?.result)return!1;let{isStart:n}=t.getDetector(h.c.MessageLineEndPoint).result;return n}onStart(e,t){this.res=t.getDetector(h.c.MessageLineEndPoint).result,this.handler.init(this.res.line,new x.E(e.globalPoint.x,e.globalPoint.y),!0),t.actionManager.execAction(new P.M),t.auxiliaryManager.updateSelectGraphic({type:V.q.SingleSelectConnector,hideControlPoints:!0,hideTextBox:!0})}onMove(e,t){if(!this.res)return;let n=this.handler.onMove(e,t);n&&n.forEach(e=>t.actionManager.execAction(e))}onUp(e,t){if(!this.res)return;let n=this.handler.onUp(e,t);n&&n.forEach(e=>t.actionManager.execAction(e)),this.res=null}}class eR extends eA{res=null;activation=null;handler=new eb;enable(e,t){if(!t.getDetector(h.c.MessageLineEndPoint)?.result)return!1;let{isStart:n}=t.getDetector(h.c.MessageLineEndPoint).result;return!n}onStart(e,t){if(this.res=t.getDetector(h.c.MessageLineEndPoint).result,!this.res)return;let n=this.res.line;this.activation=t.nodeManager.getNode(n.attachProps.start.id),this.handler.init(this.activation,this.res.line,n.points[0],this.res.snapTo),t.actionManager.execAction(new P.M)}onMove(e,t){if(!this.res)return;let n=this.handler.onMove(e,t);if(!n)return;let i=this.res.line,r=new y.x({id:i.id,props:n});t.actionManager.execAction(r)}onUp(e,t){this.res&&(this.onMove(e,t),t.actionManager.execAction(new w.q),this.res=null)}}class eN extends u.X{currentHandler=null;handlers=[new eE,new eR];onStart(e,t){for(let n of this.handlers)if(n.enable(e,t))return this.currentHandler=n,n.onStart(e,t)}onMove(e,t){this.currentHandler&&this.currentHandler.onMove(e,t)}onUp(e,t){this.currentHandler&&this.currentHandler.onUp(e,t),this.currentHandler=null}}g.W;class eI extends u.X{res=null;startLinePoint=new x.E(0,0);startPoint=new x.E(0,0);startPointOffset=new x.E(0,0);activation=null;onStart(e,t){let n=t.getDetector(h.c.PolyControlPoint);this.res=n.result;let i=this.res.line,r=i.points[this.res.index];this.startLinePoint=new x.E(r.x,r.y),this.startPoint=new x.E(e.globalPoint.x,e.globalPoint.y),this.startPointOffset=new x.E(e.globalPoint.x-r.x,e.globalPoint.y-r.y),this.activation=t.nodeManager.getNode(i.attachProps.start.id),t.actionManager.execAction(new P.M),t.auxiliaryManager.updateSelectGraphic({type:V.q.SingleSelectConnector,hideControlPoints:!0,hideTextBox:!0})}onMove(e,t){if(!this.res)return;let{line:n}=this.res,i=n.points,r=n.points[this.res.index],o=this.activation.getBounds(),a=n.globalBaseProps,l=e.globalPoint.y-this.startPoint.y,s=t.alignManager.align({alignMode:b.$.MovePoint,alignAxis:C.d.X,startBounds:n.getBounds(),startPoint:r,endPoint:new x.E(e.globalPoint.x-this.startPointOffset.x,e.globalPoint.y-this.startPointOffset.y),selectNodes:[n]});s?.offset&&(l+=s.offset.y);let d=[];for(let e=0;e<i.length;e++){let t=i[e];e===this.res.index||e===this.res.index+1?d.push(new x.E(t.x,eo.D.valueInRange(this.startLinePoint.y+l,o?.minY,o?.maxY))):d.push(new x.E(t.x,t.y))}let c={type:f.d.Line,points:d.map(e=>new x.E(e.x-a.x,e.y-a.y))},h=new y.x({id:n.id,props:[c]});t.actionManager.execAction(h)}onUp(e,t){this.res&&(this.onMove(e,t),t.actionManager.execAction(new w.q),t.refreshSelectStatus({type:V.q.SingleSelectConnector,hideControlPoints:!1,hideTextBox:!1}),this.res=null)}}g.W,n(719360);n(972443);g.W;var eB=n(812575),eO=n(624621),eD=n(78485);class eL extends eB.d{node=null;enable(e,t){return!0}handle(e,t){let n=t.detect(h.c.HoverNode,e);if(n){t.actionManager.execAction(new P.M);let e=_.O.selectNode([n.id]);t.actionManager.execAction(e),t.actionManager.execAction(new w.q)}let i=t.auxiliaryManager.selectManager.selectNodes,r=!1;i.size>0&&(r=!0);let o={type:"contextMenu",contextMenuInfo:{menuType:eO.o.ContextMenu,position:{x:e.clientPoint.x,y:e.clientPoint.y},toolPanelVisible:!0,hotKeyTipsVisible:!1,contextMenuData:{detectView:r}}};t.auxiliaryManager.addOrUpdateAuxiliaryDomState(eD.l.ContextMenu,o)}}var eG=n(12288);class eH extends eG.K{constructor(){super(),this.registerUpHandler(new eL)}}s.W;class eY extends eB.d{enable(e,t){if(e.originEvent.target!==t.gmlRender.canvas&&e.originEvent.target!==t.auxiliaryCtx.gmlRender.canvas)return!1;let n=t.getDetector(h.c.Node);return!(n&&n.detect(e,t))}handle(e,t){console.log("todo quick create=====")}}var ek=n(652260),eX=n(943451);class eU extends eB.d{enable(e,t){let n=t.detect(h.c.HoverNode,e);return!!n&&n.type===et.Jq.Connector&&!n.lockedStatusProps.locked&&0===n.captions.length&&(this.line=n,!0)}handle(e,t){if(!this.line)return;let{line:n}=this,i=n.captionsProps.clone(),{t:r}=n.drawer.findProjectPoint(n,e.globalPoint),o=new Z.A({t:r});o.textProps.sizeMode=et.Ah.AUTO_WIDTH,i.captions.push(o),t.actionManager.execAction(new P.M);let a=new y.x({id:n.id,props:[i]});t.actionManager.execAction(a),t.actionManager.execAction(new w.q);let l={node:n,inputableText:{type:eX.P.LineCaption,graphicText:n.graphicText},cursorPos:new ek.t(0,0,-1)};t.inputManager.focus(l,i.captions[0].textProps.fontSize),t.auxiliaryManager.clearTextSelection(),t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(X.T.SingleSelectPlaceHolder,{node:n,placeholder:t.auxiliaryManager.globalConfig.textConfig.placeholder}),t.auxiliaryManager.updateSelectGraphic({type:V.q.SingleSelectConnector,hideControlPoints:!0});let{inputState:s}=t.inputManager,d=s.registerBlurHandler(()=>{this.handleInputBlur(t),d&&s.removeBlurHandler(d)})}handleInputBlur(e){let{line:t}=this;if(!t)return;let n=t.captionsProps.clone();if(0!==n.captions.length&&n.captions.every(e=>!e.textProps.text)){n.captions=[],e.actionManager.execAction(new P.M);let i=new y.x({id:t.id,props:[n]});e.actionManager.execAction(i),e.actionManager.execAction(new w.q)}}}class e_ extends eB.d{selectText(e,t,n,i){let r=ek.t.head(),o=t.renderText.tailCursorPosition(),a=i.auxiliaryManager.selectionManager.generateSelect(e,t,r,o);i.auxiliaryManager.selectionManager.selectionInfo={graphicText:t,node:e,selectionList:a,start:r,end:o};let{globalBaseProps:l,renderText:s}=t;i.addOrUpdateAuxiliaryGraphic(X.T.TextSelection,{selectionList:a,baseProps:l}),i.auxiliaryManager.addOrUpdateAuxiliaryGraphic(X.T.SingleSelectPlaceHolder,{node:e,placeholder:i.auxiliaryManager.globalConfig.textConfig.placeholder}),i.auxiliaryManager.updateSelectGraphic({type:V.q.SingleSelectConnector,hideControlPoints:!0});let d={node:e,inputableText:n,cursorPos:new ek.t(0,0,-1)};i.inputManager.selectionFocus(d)}}class eq extends e_{enable(e,t){let n=t.detect(h.c.HoverNode,e);return!!n&&n.type===et.Jq.Connector&&!n.lockedStatusProps.locked&&(this.line=n,n.captions.some(e=>!!e.textProps.text))}handle(e,t){if(!this.line)return;let{graphicText:n}=this.line,i={type:eX.P.LineCaption,graphicText:n};this.selectText(this.line,n,i,t)}}class eW extends e_{node=null;enable(e,t){let n=t.detect(h.c.HoverNode,e);return!!n&&n.type===et.Jq.CompositeShape&&!n.lockedStatusProps.locked&&(this.node=n,!!this.node.getProp(f.d.Text)?.text)}handle(e,t){if(!this.node)return;let{graphicText:n}=this.node,i={type:eX.P.Main,graphicText:n};this.selectText(this.node,n,i,t)}}class ej extends eG.K{constructor(){super(),this.registerDownHandler(new eU),this.registerDownHandler(new eq),this.registerDownHandler(new eW),this.registerDownHandler(new eY)}}var eF=n(572583);class eJ extends eF.I{deltaDistance=1;locked=!1;firstPointerDown=!1;canBeEnable(e,t){if(e.type===d.V.pointerDown){if(!this.firstPointerDown)return this.firstPointerDown=!0,setTimeout(()=>{this.firstPointerDown=!1},300),!1;let n=this.dbClickEnable(e,t);return n&&(this.locked=!0),n}return!1}work(e,t){this.firstPointerDown&&e.type===d.V.pointerup&&(this.locked=!1),e.type===d.V.pointermove&&m.G.distance(t.lastInteractEvent.globalPoint,e.globalPoint)>this.deltaDistance/t.gmlRender.getScale()&&(this.locked=!1),this.firstPointerDown||(this.locked=!1),super.work(e,t)}canBeExit(e,t){return!this.locked}}p.q,n(810314),n(645574),n(882684);var ez=n(799473);class eV{allowEventTypeSet=new Set([d.V.pointermove]);process(e,t){let n=t.detect(h.c.Node,e);if(n){let e=n[0];t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(X.T.HoverBounds,{node:e,boundColor:c.gd})}}}var eZ=n(578588);class e${allowEventTypeSet=new Set([d.V.pointermove]);process(e,t){if(t.detect(h.c.Comment,e))return void t.setCursor("pointer");t.setCursor(eZ.W.AddComment)}}eF.I;class eK extends eB.d{enable(e,t){return t.toolManager.currentTool.tool===ez.w.ADD_COMMENT}handle(e,t){let n=this.makeupCommentOp(e,t);t.commentManager.addCacheComment(n);let i=this.makeupCommentAddMessage(n,e,t);t.auxiliaryManager.addOrUpdateAuxiliaryDomState(eD.l.AddCommentPins,{type:"commentAdd",comment:i})}makeupCommentOp(e,t){let n=e.globalPoint,i=t.detect(h.c.Node,e);if(!i||!(i.length>0))return{act:0,commentID:eo.D.generateCommentId(),nodeID:"",x:n.x,y:n.y};{let e=i[0],t=e.toLocalPoint(n);return{act:0,commentID:eo.D.generateCommentId(),nodeID:e.id,x:t.x,y:t.y}}}makeupCommentAddMessage(e,t,n){let i=t.globalPoint,r=n.gmlRender.transformToLocal(i);if(e.nodeID){let t=n.nodeManager.getNode(e.nodeID);if(t){let n=-1;t.type===et.Jq.CompositeShape&&(n=t.getProp(f.d.ShapeType).shapeCode);let i="",o=t.getProp(f.d.Text);return o&&(i=o.text),{commentID:e.commentID,nodeID:e.nodeID,nodeType:t.type,shapeType:n,text:i,clientPoint:r}}}return{commentID:e.commentID,nodeID:"",text:"",clientPoint:r}}}class eQ extends eG.K{constructor(){super(),this.registerUpHandler(new eK)}}s.W,p.q;n(818623),n(732526),n(649356),n(508241);(r=a||(a={}))[r.HORIZONTAL=-1]="HORIZONTAL",r[r.VERTICAL=1]="VERTICAL",r[r.UNKNOWN=0]="UNKNOWN";n(178177);u.X;var e0=n(896026);e0.A,e0.A;n(298809);u.X;class e1{allowEventTypeSet=new Set([d.V.pointermove]);process(e,t){let{tool:n,paintType:i}=t.toolManager.currentTool,{paintBrushConfig:r}=t.toolManager.toolConfig,o=r[i],{isDark:a}=t.docState,l=t.gmlRender.getScale(),s=n===ez.w.ERASER?10/l:o.width/2;if(e.type===d.V.pointermove){let n=eo.D.trimPoint(e.globalPoint);t.addOrUpdateAuxiliaryGraphic(X.T.PreviewPaintBrushStroke,{point:n,radius:s,color:a?"#505050":"#DEE0E3",lineWidth:.4})}}}n(366151);eF.I,p.q,g.W,n(246001),p.q,n(415834),n(232926),p.q;var e7=n(35345);class e5 extends eG.K{constructor(){super(),this.registerUpHandler(new e7.m),this.registerUpHandler(new eK)}}s.W;class e3{allowEventTypeSet=new Set([d.V.pointermove]);process(e,t){return t.detect(h.c.Comment,e)?void t.setCursor("pointer"):t.toolManager.currentTool.tool===ez.w.ADD_COMMENT?void t.setCursor(eZ.W.AddComment):void t.setCursor("default")}}eF.I,p.q},398799:function(e,t,n){n(810314),n(645574),n(394283),n(161429),n(219169),n(983355),n(618946),n(140109),n(113298),n(644003),n(784391),n(893420);var i=n(176517),r=n(867953),o=n(487570),a=n(972443);r.W;var l=n(447961),s=n(568971),d=n(925174),c=n(380484);s.W,n(95777),n(719360),i.q,n(882684),n(246001),i.q,n(415834),n(232926),i.q},182591:function(e,t,n){n.d(t,{e:()=>r,u:()=>o});var i=n(797615);let r=[i.Jq.CompositeShape],o=[i.Jq.StickyNote]},993335:function(e,t,n){n.d(t,{h:()=>i});let i={detectors:new Map,modes:[]}},882684:function(e,t,n){var i=n(176517),r=(n(799473),n(867953)),o=n(685418);class a extends o.h{onUp(e,t){super.onUp(e,t),t.toolManager.resetTool()}}n(202463);r.W;var l=n(572583),s=n(925174),d=n(828226),c=n(318440),h=n(353741),p=n(525619),g=n(889171),u=n(456323),x=n(968531),f=n(455360),y=n(175005),P=n(334918),w=n(797615),m=n(944379);class M extends d.X{element=null;startPoint=new g.E;startBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};positionElementCenterAtMouse(e){if(!this.element)return;let{baseProps:t}=this.element,{width:n}=t,{height:i}=t;t.x=e.x-n/2,t.y=e.y-i/2}onStart(e,t){t.setCursor("grabbing");let n=(0,x.Uw)(e.globalPoint,t);this.element=u.j.load(n.id,n.props,t.auxiliaryCtx.gmlRender.canvas.getContext("2d"),null),this.positionElementCenterAtMouse(e.globalPoint),this.startPoint=e.globalPoint,this.startBounds=this.element.getBounds(),t.addOrUpdateAuxiliaryGraphic(c.T.PreviewShapes,{nodes:[this.element],opacity:.5})}onMove(e,t){if(!this.element)return;this.positionElementCenterAtMouse(e.globalPoint);let n=t.alignManager.align({alignMode:h.$.Move,alignAxis:p.d.XY,startBounds:this.startBounds,startPoint:this.startPoint,endPoint:e.globalPoint,selectNodes:[this.element]}),i=n?.offset?.x||0,r=n?.offset?.y||0,{baseProps:o}=this.element;o.x+=i,o.y+=r,t.addOrUpdateAuxiliaryGraphic(c.T.PreviewShapes,{nodes:[this.element],opacity:.5})}onUp(e,t){let n=t.idGenerator.genId(w.Jq.Connector),i=(0,x.E5)([...this.element.propMap.values()],n,t.idGenerator.genZIndex()),r=new P.C([i]);t.actionManager.execAction(new m.M),t.actionManager.execAction(r),t.actionManager.execAction(y.O.selectNode([n])),t.actionManager.execAction(new f.q),t.toolManager.resetTool(),this.element=null}}l.I;n(366151);l.I,l.I,i.q},685418:function(e,t,n){n.d(t,{h:()=>y});var i=n(828226),r=n(808687),o=n(944379),a=n(455360),l=n(334918),s=n(175005),d=n(513665),c=n(318440),h=n(771313),p=n(797615),g=n(968531),u=n(268283),x=n(937093),f=n(799473);class y extends i.X{onStart(e,t){let n=r.D.trimPoint(e.globalPoint),i=x.SP.PolyLine;t.toolManager.currentTool.tool===f.w.LINE&&(i=t.toolManager.currentTool.subTool);let a=t.getDetector(h.c.ConnectAnchor),d=t.getDetector(h.c.ConnectNodeEdge),c=new u.j;a?.detect(e,t)&&a.result?(c.start=(0,g.sU)(a.result),n=a.result.node.getLineAttachPoint(c.start.position)):d?.detect(e,t)&&d.result&&(c.start=(0,g.ic)(d.result),n=d.result.node.getLineAttachPoint(c.start.position));let y=(0,g.$x)(i,n,{globalTheme:t.docState.globalTheme,isDark:t.docState.isDark}),P=(0,g.E5)([...y,c],t.idGenerator.genId(p.Jq.Connector),t.idGenerator.genZIndex());t.actionManager.execAction(new o.M),t.actionManager.execAction(new l.C([P])),t.actionManager.execAction(s.O.selectNode([P.id]))}onMove(e,t){let n,i=Array.from(t.getSelectNodes());if(0===i.length)return;let o=i[0];if(o.type!==p.Jq.Connector)return;this.removeAuxiliaryGraphics(t);let a=r.D.trimPoint(e.globalPoint),l=t.getDetector(h.c.ConnectNodeEdge);l?.detect(e,t)&&l.result&&(n=(0,g.ic)(l.result),a=l.result.node.getLineAttachPoint(n.position));let s=(0,g.hR)(o,a,t.nodeManager,n),c=new d.x({id:o.id,props:s});t.actionManager.execAction(c)}onUp(e,t){t.actionManager.execAction(new a.q),t.auxiliaryManager.removeAllHoverGraphic()}removeAuxiliaryGraphics(e){e.auxiliaryManager.removeAuxiliaryGraphic(c.T.ConnectAnchor),e.auxiliaryManager.removeAuxiliaryGraphic(c.T.HoverEdgeAnchor),e.auxiliaryManager.removeAuxiliaryGraphic(c.T.PreviewShapes)}}},202463:function(e,t,n){n.d(t,{u:()=>a});var i=n(318440),r=n(771313),o=n(925174);class a{allowEventTypeSet=new Set([o.V.pointermove]);process(e,t){let n=t.getDetector(r.c.ConnectNodeEdge);if(!n?.detect(e,t)||!n.result)return void t.auxiliaryManager.removeAuxiliaryGraphic(i.T.ConnectHoverNodeEdge);let{node:o,attachInfo:a}=n.result;t.addOrUpdateAuxiliaryGraphic(i.T.HoverBounds,{node:o,isConnectHover:!0}),t.detect(r.c.ActivationNodeEdge,e)||t.addOrUpdateAuxiliaryGraphic(i.T.ConnectHoverNodeEdge,{node:o,attachPoint:a.point,isConnectAnchor:!!a.connectAnchor})}}},810314:function(e,t,n){var i=n(176517),r=n(513665),o=n(455360),a=n(175005),l=n(808687),s=n(828226),d=n(889171),c=n(335342),h=n(873411),p=n(561347),g=n(508241),u=n(318440),x=n(459037),f=n(138743),y=n(805433),P=n(353741),w=n(525619),m=n(334918),M=n(944379),T=n(347250),b=n(976780),C=n(799473);function S(e){let t=e.previewAddNodeDatas;e.actionManager.execAction(new M.M);let n={};return t.forEach(t=>{let i=e.idGenerator.genId(t.type),r=T.j.generateDefaultNodeDO(i,t.type);r.zIndex=e.idGenerator.genZIndex(t.parentId),r.props=[...t.props],r.props.forEach(e=>{e.type===b.d.Color?e.alpha=1:e.type===b.d.Border?e.borderAlpha=1:e.type===b.d.Text&&(e.textAlpha=1)}),t.parentId&&(r.parentId=n[t.parentId]||""),n[t.id]=i;let o=new m.C([r]);e.actionManager.execAction(o)}),function(e){let{tool:t,wireFrameInfo:n,iconSourceInfo:i}=e.toolManager.currentTool;t===C.w.WIRE_FRAME&&n?.successInsertedCallback&&n.successInsertedCallback(),t===C.w.ICON&&i?.successInsertedCallback&&i.successInsertedCallback()}(e),Object.values(n).map(t=>e.nodeManager.nodeMap.get(t))}class A extends s.X{startPos=new d.E;startBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};target=null;isMoved=!1;onStart(e,t){this.startPos=l.D.trimPoint(e.globalPoint),t.setCursor("crosshair"),this.target=S(t)[0],this.startBounds={id:this.target.id,minX:this.startPos.x,minY:this.startPos.y,maxX:this.startPos.x,maxY:this.startPos.y}}onMove(e,t){let n=l.D.trimPoint(e.globalPoint);if(y.G.distance(n,this.startPos)<8/t.gmlRender.getScale())return;this.isMoved=!0;let i={id:this.target.id,props:[]},o=t.alignManager.align({alignMode:P.$.Stretch,alignAxis:w.d.XY,startBounds:this.startBounds,startPoint:this.startPos,endPoint:n,selectNodes:[this.target]}),a=this.computeRectBounds(e,t,o?.offset);t.addOrUpdateAuxiliaryGraphic(u.T.HighlightRect,{selectionList:[a]}),i.props.push(a);let s=new r.x(i);t.actionManager.execAction(s)}onUp(e,t){if(t.setCursor("default"),!this.target)return;let n={id:this.target.id,props:[this.target.baseProps]},i=new r.x(n);t.actionManager.execAction(i),t.actionManager.execAction(a.O.selectNode([this.target.id])),t.actionManager.execAction(new o.q),this.target=null,this.isMoved=!1,t.toolManager.resetTool(),t.previewAddNodeDatas=null}computeRectBounds(e,t,n){if(!this.target)return new h.s;let i={...this.startPos},r=l.D.trimPoint(e.globalPoint);n&&(r.x-i.x>=0?r.x+=n.x:r.x-=n.x,r.y-i.y>=0?r.y+=n.y:r.y-=n.y);let o=new h.s,a=t.getStretchMinSize(this.target);return r.x>=i.x&&r.y>=i.y?(o.x=i.x,o.y=i.y,o.width=r.x-i.x,o.height=r.y-i.y,o.width<a.x&&(o.width=a.x),o.height<a.y&&(o.height=a.y)):r.x>=i.x&&r.y<i.y?(o.x=i.x,o.y=r.y,o.width=r.x-i.x,o.height=i.y-r.y,o.width<a.x&&(o.width=a.x),o.height<a.y&&(o.y-=a.y-o.height,o.height=a.y)):r.x<i.x&&r.y>=i.y?(o.x=r.x,o.y=i.y,o.width=i.x-r.x,o.height=r.y-i.y,o.width<a.x&&(o.x-=a.x-o.width,o.width=a.x),o.height<a.y&&(o.height=a.y)):r.x<i.x&&r.y<i.y&&(o.x=r.x,o.y=r.y,o.width=i.x-r.x,o.height=i.y-r.y,o.width<a.x&&(o.x-=a.x-o.width,o.width=a.x),o.height<a.y&&(o.y-=a.y-o.height,o.height=a.y)),o}themeProps(){return new g.F}textProps(e,t,n){let i=x.f.getInstance().getTextColorInfo(e,t,n),r=new p.l;return r.verticalAlign=c.Z.CENTER,r.horizonAlign=c.Z.CENTER,r.sizeMode=f.A.FIXED,r.fontColor=i.color,r.backgroundColor=i.bgColor,r}}var v=n(896026);let E=[C.w.SHAPE,C.w.SECTION,C.w.STICKY_NOTE,C.w.ICON],R=[C.w.WIRE_FRAME,C.w.TABLE,C.w.TABLE_ER,C.w.TABLE_UML,C.w.LIFE_LINE_OBJECT];[...E,...R,C.w.TEXT],v.A;var N=n(925174);class I{allowEventTypeSet=new Set([N.V.pointerup]);process(e,t){let n=S(t);t.setCursor("default"),t.actionManager.execAction(a.O.selectNode([n[0].id])),t.actionManager.execAction(new o.q),t.toolManager.resetTool(),t.previewAddNodeDatas=null}}var B=n(572583);B.I;var O=n(797615),D=n(652260),L=n(902801),G=n(943451);class H extends s.X{startPos=new d.E;startBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};target=null;isMoved=!1;onStart(e,t){this.startPos=l.D.trimPoint(e.globalPoint),this.startBounds={id:"",minX:this.startPos.x,minY:this.startPos.y,maxX:this.startPos.x,maxY:this.startPos.y},this.target=new L.j("",t.gmlRender.canvas.getContext("2d")),this.target.updateNodeProps([this.getBaseProps(this.startPos,this.startPos)])}onMove(e,t){let n=l.D.trimPoint(e.globalPoint);if(y.G.distance(n,this.startPos)<2/t.gmlRender.getScale())return;this.isMoved=!0;let i=t.alignManager.align({alignMode:P.$.Stretch,alignAxis:w.d.X,startBounds:this.startBounds,startPoint:this.startPos,endPoint:n,selectNodes:[this.target]}),r=this.getBaseProps(this.startPos,n,i?.offset);t.addOrUpdateAuxiliaryGraphic(u.T.HighlightRect,{selectionList:[r]}),this.target?.propMap.set(b.d.Base,r)}onUp(e,t){let n=t.idGenerator.genId(O.Jq.Text),i=l.D.trimPoint(e.globalPoint),r=this.getBaseProps(this.startPos,i),o=new p.l;o.horizonAlign=c.Z.TOP_OR_LEFT,o.verticalAlign=c.Z.TOP_OR_LEFT,o.fontSize=14,o.sizeMode=f.A.AUTO_WIDTH,this.isMoved||(r.width=56);let a=T.j.generateDefaultNodeDO(n,O.Jq.Text);a.zIndex=t.idGenerator.genZIndex(),a.props.push(r),a.props.push(o),t.actionManager.execAction(new M.M),t.actionManager.execAction(new m.C([a])),this.focus(t,n),this.isMoved=!1,t.toolManager.resetTool()}getBaseProps(e,t,n){let i=new h.s,r={...t};return r.x<e.x?(r.x-=n?.x??0,i.x=r.x):(r.x+=n?.x??0,i.x=e.x),i.y=e.y,i.width=Math.abs(r.x-e.x),i.height=20,i}focus(e,t){setTimeout(()=>{e.actionManager.execAction(a.O.selectNode([t]));let n=e.nodeManager.nodeMap.get(t),i=n.getProp(b.d.Text),r={node:n,inputableText:{type:G.P.Main,graphicText:n.graphicText},cursorPos:D.t.head()};e.inputManager.focus(r,i.fontSize),e.auxiliaryManager.addOrUpdateAuxiliaryGraphic(u.T.SingleSelectPlaceHolder,{node:e.nodeManager.getNode(t),placeholder:e.auxiliaryManager.globalConfig.textConfig.placeholder})})}}v.A;var Y=n(785545),k=n(456323),X=n(107671);class U{previewElements=null;startBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};startPoint=new d.E(0,0);allowEventTypeSet=new Set([N.V.pointermove,N.V.pointerup]);supportToolMap=new Map([[C.w.SHAPE,O.Jq.CompositeShape],[C.w.SECTION,O.Jq.Section],[C.w.STICKY_NOTE,O.Jq.StickyNote],[C.w.ICON,O.Jq.IconSource],[C.w.WIRE_FRAME,O.Jq.IconSource],[C.w.TABLE,O.Jq.Table],[C.w.TABLE_ER,O.Jq.TableER],[C.w.TABLE_UML,O.Jq.TableUML],[C.w.LIFE_LINE_OBJECT,O.Jq.LifelineObject]]);createPreviewAddNodeDatas({tool:e,shapeType:t,point:n,ctx:i}){let r=this.supportToolMap.get(e);if(!r)return[];let o={[C.w.TABLE]:()=>this.createTablePreviewData(i,n,r),[C.w.TABLE_ER]:()=>this.createTableERPreviewData(i,n,r),[C.w.TABLE_UML]:()=>this.createTableUMLPreviewData(i,n,r),[C.w.SECTION]:()=>this.createSectionPreviewData(i,n),[C.w.LIFE_LINE_OBJECT]:()=>this.createLifeLinePreviewData(i,n,r),[C.w.STICKY_NOTE]:()=>this.createStickyNotePreviewData(i,n),[C.w.ICON]:()=>this.createIconPreviewData(i,n),[C.w.WIRE_FRAME]:()=>this.createWireFramePreviewData(i,n),[C.w.SHAPE]:()=>this.createShapePreviewData(i,n,t)}[e];return o?o():this.createPreviewDataItem(r)}createTablePreviewData(e,t,n){let i=T.j.createTablePreviewProps(e,t,e.idGenerator.genFakeId(n),1,.5);return this.createPreviewDataItem(n,i)}createTableERPreviewData(e,t,n){let i=T.j.createTableERPreviewProps(e,t,e.idGenerator.genFakeId(n),1,.5);return this.createPreviewDataItem(n,i)}createTableUMLPreviewData(e,t,n){let i=T.j.createTableUMLPreviewProps(e,t,e.idGenerator.genFakeId(n),1,.5);return this.createPreviewDataItem(n,i)}createSectionPreviewData(e,t){let n=T.j.createSectionPreviewProps(e,t,.5);return this.createPreviewDataItem(O.Jq.Section,n)}createLifeLinePreviewData(e,t,n){let i=T.j.createLifeLinePreviewProps(e,t,e.idGenerator.genFakeId(n),1,.5);return this.createPreviewDataItem(n,i)}createStickyNotePreviewData(e,t){let n=e.toolManager.currentTool.subTool,i=T.j.createStickyNodeProps({ctx:e,position:t,fillColorCode:n,opacity:.5});return this.createPreviewDataItem(O.Jq.StickyNote,i)}createIconPreviewData(e,t){let{iconSourceInfo:n}=e.toolManager.currentTool;if(!n)return[];let i=T.j.createIconPreviewProps(e,t);return this.createPreviewDataItem(O.Jq.IconSource,i)}createWireFramePreviewData(e,t){let{wireFrameInfo:n}=e.toolManager.currentTool;if(!n)return[];let{pasteData:i}=n,{globalTheme:r,isDark:o}=e.docState,{addNodeDataArray:a}=Y.D.formatPasteDataArray({pasteData:i,pastePoint:t,shouldGenNewId:!1,globalTheme:r,isDark:o,nodeManager:e.nodeManager,idGenerator:e.idGenerator});return a}createShapePreviewData(e,t,n){let i=T.j.createPreviewProps(n,t.x,t.y,.5,e);return this.createPreviewDataItem(O.Jq.CompositeShape,i)}createPreviewDataItem(e,t=[]){return[{id:`${X.R.type2NodePrefix(e)}_preview-node`,type:e,zIndex:1,props:t}]}genPreviewKey(e){let{tool:t,iconSourceInfo:n,wireFrameInfo:i}=e.toolManager.currentTool;if(t===C.w.ICON){if(n)return`${t}_icon_${n.iconSourceFormatEnum}`;if(i)return`${t}_frame_${i.key}`}return`${t}_${this.supportToolMap.get(t)}`}updatePreviewElementsPosition(e){let{newPosition:t,shouldAdjustToCenter:n,previewElements:i,alignOffset:r,addNodeDatas:o}=e,a=i[0].getProp(b.d.Base);if(!a)return;let l=r?.x||0,s=r?.y||0,d=n?-a.width/2:0,c=n?-a.height/2:0,h=t.x-a.x+d+l,p=t.y-a.y+c+s,{nodes:g,offsetX:u,offsetY:x}={nodes:i,offsetX:h,offsetY:p};g.forEach(e=>{let t=e.getProp(b.d.Base);t&&(t.x+=u,t.y+=x,e.updateNodeProps([t]))});let{addNodeDatas:f,offsetX:y,offsetY:P}={addNodeDatas:o,offsetX:h,offsetY:p};f.forEach(e=>{let t=e.props.find(e=>e.type===b.d.Base);t&&(t.x+=y,t.y+=P)})}process(e,t){let{tool:n}=t.toolManager.currentTool;if(!this.supportToolMap.has(n))return;let{globalPoint:i}=e,{grabMode:r}=t.toolManager.currentTool;this.setCursor(t,r);let{previewElements:o,isFirstTouch:a}=this.getOrCreatePreviewElements({ctx:t,globalPoint:i,grabMode:r});this.updatePreviewPositionWithAlignment({ctx:t,globalPoint:i,grabMode:r,isFirstTouch:a,previewElements:o,startBounds:this.startBounds,startPoint:this.startPoint}),this.updateAuxiliaryGraphics(t,o)}setCursor(e,t){e.setCursor(t?"grabbing":"crosshair")}getOrCreatePreviewElements({ctx:e,globalPoint:t,grabMode:n}){let i=this.previewElements,r=!1,o=this.genPreviewKey(e);if(!i||!e.previewAddNodeDatas||o!==this.previewKey){let{tool:o,subTool:a}=e.toolManager.currentTool,l=this.createPreviewAddNodeDatas({tool:o,shapeType:a,point:t,ctx:e});i=this.createNewPreviewElements(e,l),this.initializePreviewPosition(i,t,n,l),this.previewElements=i,e.previewAddNodeDatas=l,r=!0}return{previewElements:i,isFirstTouch:r}}createNewPreviewElements(e,t){return function({addNodeData:e,auxiliaryCtx:t,parent:n,globalConfig:i,opacity:r=1}){let o={};return e.forEach(e=>{let a=k.j.load(e.id,e.props,t,o[e.parentId||""]||n,0,i),l=a.getProp(b.d.Color),s=a.getProp(b.d.Border),d=a.getProp(b.d.Text);l&&(l.alpha=r,a.updateNodeProps([l])),s&&(s.borderAlpha=r,a.updateNodeProps([s])),d&&(d.textAlpha=r,a.updateNodeProps([d])),a.type===O.Jq.DirectFocusGroup&&(a.afterUpdateProps=()=>{}),o[e.id]=a}),Object.values(o)}({addNodeData:t,auxiliaryCtx:e.auxiliaryCtx.gmlRender.canvas.getContext("2d"),parent:null,opacity:.5,globalConfig:e.auxiliaryManager.globalConfig})}initializePreviewPosition(e,t,n,i){this.updatePreviewElementsPosition({newPosition:t,shouldAdjustToCenter:n,previewElements:e,addNodeDatas:i}),this.startBounds=e[0].getBounds(),this.startPoint=t}updatePreviewPositionWithAlignment({ctx:e,globalPoint:t,grabMode:n,isFirstTouch:i,previewElements:r,startBounds:o,startPoint:a}){if(!o||!a)return;let l=e.alignManager.align({alignMode:P.$.Move,alignAxis:w.d.XY,startBounds:o,startPoint:a,endPoint:t,selectNodes:[r[0]]});this.updatePreviewElementsPosition({newPosition:t,shouldAdjustToCenter:n&&!i,alignOffset:l?.offset,previewElements:r,addNodeDatas:e.previewAddNodeDatas||[]})}updateAuxiliaryGraphics(e,t){this.previewKey=this.genPreviewKey(e),e.addOrUpdateAuxiliaryGraphic(u.T.PreviewShapes,{nodes:t,opacity:.5})}}n(366151);B.I,i.q},719360:function(e,t,n){n.d(t,{n:()=>s});var i=n(867953),r=n(685418),o=n(202463),a=n(771313),l=n(182591);class s extends i.W{constructor(){super([new r.h],[new o.u])}streamEnable(e,t){let n=t.detect(a.c.ConnectAnchor,e);return!!(n&&l.e.includes(n.node.type))}}},447961:function(e,t,n){n.d(t,{R:()=>ep});var i,r,o=n(637322),a=n(517686),l=n(797615),s=n(799473),d=n(812575),c=n(771313),h=n(805433),p=n(876834),g=n(460146),u=n(318440),x=n(544516),f=n(78485);class y extends d.d{textDetectInfo=null;enable(e,t){let n=t.getDetector(c.c.RenderText);if(n&&n.detect(e,t)&&n.result&&!n.result.editTextInfo.node.lockedStatusProps.locked){let e=n.result;if(t.inSelectNodes(e.editTextInfo.node))return this.textDetectInfo=e,!0}return t.toolManager.currentTool.tool===s.w.TEXT}handle(e,t){if(!this.textDetectInfo)return;let{editTextInfo:n,fontSize:i}=this.textDetectInfo,{inputableText:r,node:o}=n;if(!x.L.textRichContentInteractionHandler({event:e,ctx:t,graphicText:r.graphicText,textNodeId:o.id,auxiliaryDomStateType:f.l.TextNodeClick})&&(t.inputManager.focus(n,i),t.auxiliaryManager.clearTextSelection(),h.G.addFocusNodePlaceholder(o,t.inputManager,t.auxiliaryManager),o.type===l.Jq.Connector&&t.auxiliaryManager.updateSelectGraphic({type:p.q.SingleSelectConnector,hideControlPoints:!0}),r.graphicText instanceof g.l&&(o.type===l.Jq.Section||o.type===l.Jq.Table))){let e=r.graphicText,n=t.gmlRender.canvas.getContext("2d");e.enterEdit(n);let{inputState:i}=t.inputManager,o=i.registerBlurHandler(()=>{e.exitEdit(n),o&&i.removeBlurHandler(o)});t.auxiliaryManager.removeAuxiliaryGraphic(u.T.HoverTableTitle),t.auxiliaryManager.removeAuxiliaryGraphic(u.T.SelectEmptyTitle)}}}var P=n(331230),w=n(740735),m=n(12288),M=n(976780),T=n(513665);class b extends d.d{node=null;enable(e,t){if(t.detect(c.c.Comment,e))return!1;let n=t.detect(c.c.ExpandShape,e);return!!n&&(this.node=n,!0)}handle(e,t){let n=this.node,i=n.graphicText.getContentRect(),r=n.getTextContentRect(),{baseProps:o}=n,a=o.height-r.height,l={x:o.x,y:o.y,width:o.width,height:i.height+a,type:M.d.Base},s=new T.x({id:n.id,props:[l]});t.actionManager.execAction(s),t.removeAuxiliaryGraphic(u.T.SelectShapeExpand)}}var C=n(944379),S=n(175005),A=n(455360);class v extends d.d{enable(e,t){if(t.detect(c.c.Comment,e))return!1;let n=t.detect(c.c.TableRowCol,e);return!!n&&!n.table.lockedStatusProps.locked}handle(e,t){let{table:n,isRow:i,index:r}=t.detect(c.c.TableRowCol,e);t.auxiliaryManager.clearTextSelection(),t.inputManager.blur();let o=new Set;if(n.tableStatus.selectRows.length>0&&i&&(o=new Set(n.tableStatus.selectRows)),n.tableStatus.selectCols.length>0&&!i&&(o=new Set(n.tableStatus.selectCols)),o.has(r))return;t.actionManager.execAction(new C.M);let a=S.O.selectTableRowCol(n.id,[r],i);t.actionManager.execAction(a),t.actionManager.execAction(new A.q)}}var E=n(943451),R=n(988382);class N extends d.d{enable(e,t){let n=t.detect(c.c.TableCell,e);if(!n)return!1;let{table:i}=n;return!i.lockedStatusProps.locked&&1===t.getSelectNodes().size&&!!t.inSelectNodes(i)}handle(e,t){let{table:n,i,j:r}=t.detect(c.c.TableCell,e),o=-1!==n.tableStatus.selectCells.findIndex(e=>e.i===i&&e.j===r),a=n.tableStatus.selectCells.length>0&&t.canBeEditText();if(!o){t.auxiliaryManager.clearTextSelection(),t.inputManager.blur(),t.actionManager.execAction(new C.M);let e=S.O.selectTableCell(n.id,[{i,j:r}]);t.actionManager.execAction(e),t.actionManager.execAction(new A.q)}(o||a)&&this.editTableCellText(e,t,n,i,r)}editTableCellText(e,t,n,i,r){let o=this.getOrInitTableCellText(n,i,r);if(!o)return;let a=o.toLocalPoint(e.globalPoint),l=o.renderText.detect(a),s={node:n,inputableText:{type:E.P.TableCell,graphicText:o,i,j:r},cursorPos:l.textCursorPosition};x.L.textRichContentInteractionHandler({event:e,ctx:t,graphicText:o,textNodeId:n.id,auxiliaryDomStateType:f.l.TextNodeClick})||(t.inputManager.focus(s,l.fontSize),t.auxiliaryManager.clearTextSelection(),t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(u.T.TableCellTextPlaceholder,{cellText:o,placeholder:t.auxiliaryManager.globalConfig.textConfig.placeholder}))}getOrInitTableCellText(e,t,n){let i=R.P.getTableCellText(e,t,n);return i||R.P.initTableCellText(e,t,n)}}var I=n(147703),B=n(942795),O=n(335342),D=n(508241),L=n(224365),G=n(915602),H=n(561347),Y=n(457063);class k{type=l.gu.ER_KEY_ENTITY;work(e,t,n){let i=[],r=new H.l;r.text="Field",r.horizonAlign=O.Z.TOP_OR_LEFT,i.push({i:n,j:0,theme:new D.F,textProps:r,textTransformProps:new L._,opacityProps:new G.j});let o={id:t.id,infos:i},a=new Y.g(o);e.actionManager.execAction(a)}}class X{type=l.gu.ER_KEY_ENTITY;work(e,t,n){let i=[],r=new H.l,o=new H.l;o.text="Field",o.horizonAlign=O.Z.TOP_OR_LEFT;let a={i:n,j:0,theme:new D.F,textProps:r,textTransformProps:new L._,opacityProps:new G.j},l={i:n,j:1,theme:new D.F,textProps:o,textTransformProps:new L._,opacityProps:new G.j};i.push(a),i.push(l);let s={id:t.id,infos:i},d=new Y.g(s);e.actionManager.execAction(d)}}class U{type=l.gu.ER_FIELD_FIELD;work(e,t,n){let i=[],r=new H.l;r.text="Field",r.horizonAlign=O.Z.TOP_OR_LEFT;let o=new H.l;o.text="Type",o.horizonAlign=O.Z.TOP_OR_LEFT;let a={i:n,j:0,theme:new D.F,textProps:r,textTransformProps:new L._,opacityProps:new G.j},l={i:n,j:1,theme:new D.F,textProps:o,textTransformProps:new L._,opacityProps:new G.j};i.push(a),i.push(l);let s={id:t.id,infos:i},d=new Y.g(s);e.actionManager.execAction(d)}}class _{type=l.gu.ER_KEY_FIELD_TYPE;work(e,t,n){let i=[],r=new H.l,o=new H.l;o.text="Field",o.horizonAlign=O.Z.TOP_OR_LEFT;let a=new H.l;a.text="Type",a.horizonAlign=O.Z.TOP_OR_LEFT;let l={i:n,j:0,theme:new D.F,textProps:r,textTransformProps:new L._,opacityProps:new G.j},s={i:n,j:1,theme:new D.F,textProps:o,textTransformProps:new L._,opacityProps:new G.j},d={i:n,j:2,theme:new D.F,textProps:a,textTransformProps:new L._,opacityProps:new G.j};i.push(l),i.push(s),i.push(d);let c={id:t.id,infos:i},h=new Y.g(c);e.actionManager.execAction(h)}}class q{erInsertRowWorkerMap=new Map([[l.gu.ER_ENTITY,new k],[l.gu.ER_KEY_ENTITY,new X],[l.gu.ER_FIELD_FIELD,new U],[l.gu.ER_KEY_FIELD_TYPE,new _]]);enable(e){return e.type===l.Jq.TableER}handle(e,t,n,i){let r=t.getProp(M.d.TableER),o=this.erInsertRowWorkerMap.get(r.erType);if(o)return o.work(e,t,n)}}var W=n(797379);class j{type=W.yD.umlClass;work(e,t,n){let i=t.getProp(M.d.TableUML),r=[],o=new H.l;if(i.umlType===l.fq.UML_ClASS&&n<=i.propertyNum+1){o.text="+ field: type",i.propertyNum++;let n={id:t.id,props:[i]},r=new T.x(n);e.actionManager.execAction(r)}else o.text="+ method(type): type";o.horizonAlign=O.Z.TOP_OR_LEFT,o.verticalAlign=O.Z.CENTER,r.push({i:n,j:0,theme:new D.F,textProps:o,textTransformProps:new L._,opacityProps:new G.j});let a={id:t.id,infos:r},s=new Y.g(a);e.actionManager.execAction(s)}}class F{type=W.yD.umlClass;work(e,t,n){let i=[],r=new H.l;r.text="+ method(type): type",r.horizonAlign=O.Z.TOP_OR_LEFT,r.verticalAlign=O.Z.CENTER,i.push({i:n,j:0,theme:new D.F,textProps:r,textTransformProps:new L._,opacityProps:new G.j});let o={id:t.id,infos:i},a=new Y.g(o);e.actionManager.execAction(a)}}class J{umlInsertRowWorkerMap=new Map([[l.fq.UML_ClASS,new j],[l.fq.UML_INTERFACE,new F]]);enable(e){return e.type===l.Jq.TableUML}handle(e,t,n,i){let r=t.getProp(M.d.TableUML),o=this.umlInsertRowWorkerMap.get(r.umlType);if(o)return o.work(e,t,n)}}class z{enable(e){return e.type===l.Jq.Table}handle(e,t,n,i){let{tableProps:r}=t;if(i){let i=r.tableCells.filter(e=>e.i===n-1);if(0===i.length)return;let o=[];for(let e of i){let t={i:e.i+1,j:e.j,theme:e.themeProps.clone(),color:null===e.color?"":e.color,alpha:e.alpha,textTransformProps:e.textTransformProps?.clone()};o.push(t)}let a={id:t.id,infos:o},l=new Y.g(a);e.actionManager.execAction(l)}else{let i=r.tableCells.filter(e=>e.j===n-1);if(0===i.length)return;let o=[];for(let e of i){let t={i:e.i,j:e.j+1,theme:e.themeProps.clone(),color:null===e.color?"":e.color,alpha:e.alpha,textTransformProps:e.textTransformProps?.clone()};o.push(t)}let a={id:t.id,infos:o},l=new Y.g(a);e.actionManager.execAction(l)}}}(i=r||(r={}))[i.normal=0]="normal",i[i.tableER=1]="tableER",i[i.tableUML=2]="tableUML";class V extends d.d{insertRowHandlers=new Map([[r.normal,new z],[r.tableER,new q],[r.tableUML,new J]]);enable(e,t){let n=t.detect(c.c.TableInsertPoint,e);return!!n&&!n.table.lockedStatusProps.locked}handle(e,t){let{table:n,isRow:i,index:r}=t.detect(c.c.TableInsertPoint,e),o=0===r?0:r-1,a={id:n.id,index:r,num:1,length:i?n.tableProps.rows[o]:n.tableProps.columns[o],isRow:i};t.actionManager.execAction(new C.M);let l=new B.o(a);t.actionManager.execAction(l),this.updateInsertCellsInfo(t,n,i,r),t.actionManager.execAction(new A.q)}updateInsertCellsInfo(e,t,n,i){for(let r of this.insertRowHandlers.values())if(r.enable(t))return void r.handle(e,t,i,n)}}class Z extends d.d{enable(e,t){if(!e.originEvent.shiftKey)return!1;let n=t.detect(c.c.TableRowCol,e);return!!n&&!n.table.lockedStatusProps.locked}handle(e,t){t.auxiliaryManager.clearTextSelection(),t.inputManager.blur();let{table:n,isRow:i,index:r}=t.detect(c.c.TableRowCol,e),o=[];n.tableStatus.selectRows.length>0&&i&&(o=n.tableStatus.selectRows),n.tableStatus.selectCols.length>0&&!i&&(o=n.tableStatus.selectCols);let a=this.getRowColsForShift(o,r);t.actionManager.execAction(new C.M);let l=S.O.selectTableRowCol(n.id,a,i);t.actionManager.execAction(l),t.actionManager.execAction(new A.q)}getRowColsForShift(e,t){let n=Math.min(...e,t),i=Math.max(...e,t),r=[];for(let e=n;e<=i;++e)r.push(e);return r}}class $ extends d.d{enable(e,t){if(!e.originEvent.metaKey)return!1;let n=t.detect(c.c.TableRowCol,e);return!!n&&!n.table.lockedStatusProps.locked}handle(e,t){t.auxiliaryManager.clearTextSelection(),t.inputManager.blur();let{table:n,isRow:i,index:r}=t.detect(c.c.TableRowCol,e),o=[];n.tableStatus.selectRows.length>0&&i&&(o=n.tableStatus.selectRows),n.tableStatus.selectCols.length>0&&!i&&(o=n.tableStatus.selectCols);let a=[...o,r];t.actionManager.execAction(new C.M);let l=S.O.selectTableRowCol(n.id,a,i);t.actionManager.execAction(l),t.actionManager.execAction(new A.q)}}var K=n(35345),Q=n(347250),ee=n(334918);class et extends d.d{enable(e,t){return!!t.detect(c.c.LifeLine,e)}handle(e,t){let{node:n,point:i}=t.getDetector(c.c.LifeLine).result;if(!i)return;let r=t.previewElement;if(!r)return;let o=[...r.propMap.values()],a=Q.j.createActivationProps(n.baseProps.x+n.baseProps.width/2-15,i.y,t);for(let e of o)e.type===M.d.Base&&(e.x-=n.globalBaseProps.x,e.y-=n.globalBaseProps.y),e.type===M.d.Color&&(e.alpha=a.find(e=>e.type===M.d.Color).alpha),e.type===M.d.Border&&(e.borderAlpha=a.find(e=>e.type===M.d.Border).borderAlpha);let s={id:t.idGenerator.genId(l.Jq.Activation),type:l.Jq.Activation,zIndex:t.idGenerator.genZIndex(n.id),props:o,parentId:n.id};t.actionManager.execAction(new C.M),t.actionManager.execAction(new ee.C([s])),t.actionManager.execAction(new A.q),t.previewElement=null}}class en extends d.d{enable(e,t){return!!e.originEvent.metaKey&&!!t.detect(c.c.TableCell,e)}handle(e,t){t.auxiliaryManager.clearTextSelection(),t.inputManager.blur();let{table:n,i,j:r}=t.detect(c.c.TableCell,e),o=n.tableStatus.selectCells,a=o.findIndex(e=>e.i===i&&e.j===r);-1!==a?o.splice(a,1):o.push({i,j:r}),t.actionManager.execAction(new C.M);let l=S.O.selectTableCell(n.id,o);t.actionManager.execAction(l),t.actionManager.execAction(new A.q)}}class ei extends d.d{enable(e,t){return!!e.originEvent.shiftKey&&!!t.detect(c.c.TableCell,e)}handle(e,t){t.auxiliaryManager.clearTextSelection(),t.inputManager.blur();let{table:n,i,j:r}=t.detect(c.c.TableCell,e),o=n.tableStatus.selectCells,a=n.tableProps.cellMatrix,l=this.getCellsForShift(o,a,i,r);t.actionManager.execAction(new C.M);let s=S.O.selectTableCell(n.id,l);t.actionManager.execAction(s),t.actionManager.execAction(new A.q)}getCellsForShift(e,t,n,i){let r=Math.min(...e.map(e=>e.i),n),o=Math.max(...e.map(e=>e.i),n),a=Math.min(...e.map(e=>e.j),i),l=Math.max(...e.map(e=>e.j),i),s=[];for(let e=r;e<=o;e++)for(let n=a;n<=l;n++)t.getCell(e,n)?.isMerged()||s.push({i:e,j:n});return s}}var er=n(6961),eo=n(182591);class ea extends d.d{node=null;side=null;enable(e,t){let n=t.detect(c.c.ConnectAnchor,e);return!!(n&&eo.u.includes(n.node.type))&&(this.node=n.node,this.side=n.side,!0)}handle(e,t){let n=er.h.createDOByNodeSide(this.node,this.side,t);n.id=t.idGenerator.genId(this.node.type),t.actionManager.execAction(new C.M);let i=new ee.C([n]);t.actionManager.execAction(i),t.actionManager.execAction(S.O.selectNode([n.id])),t.actionManager.execAction(new A.q)}}class el extends d.d{node=null;side=null;enable(e,t){let n=t.detect(c.c.ConnectAnchor,e);return!!(n&&eo.e.includes(n.node.type))&&!n.node.lockedStatusProps.locked&&(this.node=n.node,this.side=n.side,!0)}handle(e,t){let n=null,i=null;[i,n]=er.h.createConnect2NodeDOByNodeSideWithRealId(this.node,this.side,t),t.actionManager.execAction(new C.M);let r=[];n&&r.push(n),i&&r.push(i);let o=new ee.C(r);t.actionManager.execAction(o),n?t.actionManager.execAction(S.O.selectNode([n.id])):i&&t.actionManager.execAction(S.O.selectNode([i.id])),t.actionManager.execAction(new A.q)}}var es=n(808687),ed=n(140512);class ec extends d.d{enable(e,t){let n=t.detect(c.c.MindMapCollapse,e);if(!n)return!1;let i=n.collapseRect;return!!h.G.rectContains(e.globalPoint,i)}handle(e,t){let n=t.detect(c.c.MindMapCollapse,e);n&&(t.execAction(new C.M),es.D.foldUnfoldChildNode(n.node,t),ed.R.updateMindMapTreeAndSendMsg(n.node.mindMapRoot,t),t.execAction(new A.q))}}class eh extends d.d{enable(e,t){return!!t.detect(c.c.MindMapInsert,e)}handle(e,t){let n=t.detect(c.c.MindMapInsert,e);if(!n)return;let i=n.node;t.actionManager.execAction(new C.M),es.D.insertChildNode(i,t,n.side),t.actionManager.execAction(new A.q)}}class ep extends m.K{constructor(){super(),this.registerDownHandler(new eh),this.registerDownHandler(new ec),this.registerDownHandler(new ea),this.registerDownHandler(new et),this.registerDownHandler(new b),this.registerDownHandler(new V),this.registerDownHandler(new P.f),this.registerDownHandler(new o.D),this.registerDownHandler(new Z),this.registerDownHandler(new $),this.registerDownHandler(new en),this.registerDownHandler(new v),this.registerUpHandler(new el),this.registerUpHandler(new K.m),this.registerUpHandler(new ei),this.registerUpHandler(new N),this.registerUpHandler(new w.A),this.registerUpHandler(new I.p),this.registerUpHandler(new y),this.registerUpHandler(new a.P)}}},517686:function(e,t,n){n.d(t,{P:()=>a});var i=n(175005),r=n(812575),o=n(771313);class a extends r.d{enable(e,t){return!t.detect(o.c.Node,e)}handle(e,t){t.inputManager.blur(),t.actionManager.execAction(i.O.selectNode([]))}}},35345:function(e,t,n){n.d(t,{m:()=>a});var i=n(812575),r=n(771313),o=n(78485);class a extends i.d{commentResult=null;enable(e,t){let n=t.detect(r.c.Comment,e);return n?(this.commentResult=n,!0):(t.commentManager.clearCacheComment(),t.auxiliaryManager.addOrUpdateAuxiliaryDomState(o.l.ActiveCommentPins,{type:"commentActive",activeId:""}),!1)}handle(e,t){if(!this.commentResult)return;let n={type:"commentActive",activeId:this.commentResult.comment.commentID};t.auxiliaryManager.addOrUpdateAuxiliaryDomState(o.l.ActiveCommentPins,n)}}},146238:function(e,t,n){n.d(t,{C:()=>l});var i=n(175005),r=n(944379),o=n(455360),a=n(812575);class l extends a.d{node=null;handle(e,t){t.auxiliaryManager.clearTextSelection(),t.inputManager.blur(),t.actionManager.execAction(new r.M);let n=i.O.selectNode([this.node.id]);t.actionManager.execAction(n),t.actionManager.execAction(new o.q)}}},637322:function(e,t,n){n.d(t,{D:()=>a});var i=n(771313),r=n(797615),o=n(146238);class a extends o.C{enable(e,t){if(t.detect(i.c.Comment,e)||e.originEvent.shiftKey||e.originEvent.metaKey)return!1;let n=t.detect(i.c.HoverNode,e);return!!n&&(n.type===r.Jq.Table||n.type===r.Jq.Section?this.focusTitle(t,n,e.globalPoint):!t.inSelectNodes(n)&&(this.node=n,!0))}focusTitle(e,t,n){return!!(!e.inSelectNodes(t)&&t.graphicTitle.contains(n))&&(this.node=t,!0)}}},147703:function(e,t,n){n.d(t,{p:()=>a});var i=n(771313),r=n(797615),o=n(146238);class a extends o.C{enable(e,t){if(e.originEvent.shiftKey||e.originEvent.metaKey)return!1;let n=t.getDetector(i.c.HoverNode);if(n?.detect(e,t)&&n.result){let e=n.result;if(e.type!==r.Jq.Table&&e.type!==r.Jq.Section)return!1;if(!t.inSelectNodes(e))return this.node=e,!0}return!1}}},331230:function(e,t,n){n.d(t,{f:()=>s});var i=n(175005),r=n(812575),o=n(805433),a=n(771313),l=n(808687);class s extends r.d{node=null;enable(e,t){if(t.detect(a.c.Comment,e)||!e.originEvent.shiftKey&&!e.originEvent.metaKey)return!1;let n=t.auxiliaryManager.selectManager.getSelectBounds();for(let e of t.auxiliaryManager.selectManager.selectNodes)if(e.lockedStatusProps.locked)return!1;if(o.G.rectContains2(e.globalPoint,n))return!1;let i=t.detect(a.c.HoverNode,e);return!!i&&!i.lockedStatusProps.locked&&(this.node=i,!0)}handle(e,t){let n=new Set(t.auxiliaryManager.selectManager.selectNodes);n.add(this.node);let r=[];for(let e of n)l.D.findParentInGraphicSet(e,n)||r.push(e.id);let o=i.O.selectNode(r);t.actionManager.execAction(o),t.auxiliaryManager.clearTextSelection()}}},740735:function(e,t,n){n.d(t,{A:()=>l});var i=n(175005),r=n(812575),o=n(805433),a=n(771313);class l extends r.d{node=null;enable(e,t){if(!e.originEvent.shiftKey&&!e.originEvent.metaKey)return!1;let n=t.auxiliaryManager.selectManager.getSelectBounds();if(!o.G.rectContains2(e.globalPoint,n))return!1;let i=t.detect(a.c.Node,e);if(i){for(let e of i)this.node=e;return!0}return!1}handle(e,t){let{selectNodes:n}=t.auxiliaryManager.selectManager,r=[...n].map(e=>e.id);if(t.auxiliaryManager.clearTextSelection(),t.auxiliaryManager.selectManager.include(this.node)){let e=r.filter(e=>e!==this.node.id),n=i.O.selectNode([...e]);t.actionManager.execAction(n),t.auxiliaryManager.renderToolMenu()}else{let e=i.O.selectNode([...r,this.node.id]);t.actionManager.execAction(e),t.auxiliaryManager.renderToolMenu()}}}},320564:function(e,t,n){n.d(t,{U:()=>a});var i=n(872715),r=n(889171),o=n(15921);class a{type=o.P.BottomLeft;layout(e,t,n,o){let a=[];if(a.push(e),e.y<t.y)return a.push(new r.E(e.x,t.y)),a.push(t),a;let l=new r.E(e.x,e.y+i.B);a.push(l);let s=new r.E(.5*(e.x+t.x),l.y);return a.push(s),a.push(new r.E(s.x,t.y)),a.push(t),a}}},570625:function(e,t,n){n.d(t,{z:()=>a});var i=n(872715),r=n(889171),o=n(15921);class a{type=o.P.BottomRight;layout(e,t){let n=[];if(n.push(e),t.y>e.y+i.B){let i=new r.E(e.x,t.y);return n.push(i),n.push(t),n}let o=new r.E(e.x,e.y+i.B);n.push(o);let a=new r.E(t.x,o.y);return n.push(a),n.push(t),n}}},19094:function(e,t,n){n.d(t,{T:()=>a});var i=n(872715),r=n(889171),o=n(15921);class a{type=o.P.BottomTop;layout(e,t){let n=[];if(n.push(e),e.y+i.B<t.y){let i=.5*(e.y+t.y),o=new r.E(e.x,i);return n.push(o),n.push(new r.E(t.x,o.y)),n.push(t),n}let o=new r.E(e.x,e.y+i.B);n.push(o);let a=new r.E(.5*(e.x+t.x),o.y);n.push(a);let l=new r.E(a.x,t.y-i.B);return n.push(l),n.push(new r.E(t.x,l.y)),n.push(t),n}}},15921:function(e,t,n){var i,r;n.d(t,{P:()=>i}),(r=i||(i={})).LeftLeft="LeftLeft",r.LeftTop="LeftTop",r.LeftRight="LeftRight",r.LeftBottom="LeftBottom",r.TopLeft="TopLeft",r.TopTop="TopTop",r.TopRight="TopRight",r.TopBottom="TopBottom",r.RightLeft="RightLeft",r.RightTop="RightTop",r.RightRight="RightRight",r.RightBottom="RightBottom",r.BottomLeft="BottomLeft",r.BottomTop="BottomTop",r.BottomRight="BottomRight",r.BottomBottom="BottomBottom",r.Default="Default"},707100:function(e,t,n){n.d(t,{e:()=>a});var i=n(872715),r=n(889171),o=n(15921);class a{type=o.P.LeftRight;layout(e,t){let n=[];if(n.push(e),t.x<e.x){let i=new r.E(.5*(e.x+t.x),e.y);n.push(i);let o=new r.E(i.x,t.y);return n.push(o),n.push(t),n}let o=new r.E(e.x-i.B,e.y);n.push(o);let a=new r.E(o.x,t.y-i.B);n.push(a);let l=new r.E(t.x-i.B,a.y);return n.push(l),n.push(new r.E(l.x,t.y)),n.push(t),n}}},872715:function(e,t,n){n.d(t,{B:()=>i});let i=20},320311:function(e,t,n){n.d(t,{h:()=>l});var i=n(872715),r=n(889171),o=n(15921),a=n(808687);class l{type=o.P.RightLeft;layout(e,t,n,o){let l=[];if(l.push(e),a.D.judgeHorizon(e,t))return l.push(t),l;if(t.x>e.x){let n=new r.E(.5*(e.x+t.x),e.y);return l.push(n),l.push(new r.E(n.x,t.y)),l.push(t),l}let s=n?n.type:e.y,d=new r.E(e.x+i.B,e.y);l.push(d);let c=o?.5*(s+o.globalBaseProps.y+o.globalBaseProps.height):.5*(s+t.y),h=new r.E(d.x,c);l.push(h);let p=new r.E(t.x-i.B,h.y);l.push(p);let g=new r.E(p.x,t.y);return l.push(g),l.push(t),l}}},787858:function(e,t,n){n.d(t,{v:()=>a});var i=n(872715),r=n(889171),o=n(15921);class a{type=o.P.TopBottom;layout(e,t){let n=[];if(n.push(e),t.y<e.y-i.B){let i=.5*(e.y+t.y),o=new r.E(e.x,i);return n.push(o),n.push(new r.E(t.x,o.y)),n.push(t),n}let o=new r.E(e.x,e.y-i.B);n.push(o);let a=new r.E(.5*(e.x+t.x),o.y);n.push(a);let l=new r.E(a.x,t.y+i.B);n.push(l);let s=new r.E(t.x,l.y);return n.push(s),n.push(t),n}}},422945:function(e,t,n){n.d(t,{b:()=>a});var i=n(872715),r=n(889171),o=n(15921);class a{type=o.P.TopLeft;layout(e,t){let n=[];if(n.push(e),t.y<e.y){let i=new r.E(e.x,t.y);return n.push(i),n.push(t),n}let o=new r.E(e.x,e.y-i.B);n.push(o);let a=new r.E(.5*(e.x+t.x),o.y);n.push(a);let l=new r.E(a.x,t.y);return n.push(l),n.push(t),n}}},394283:function(e,t,n){n.d(t,{q:()=>N});var i=n(797615),r=n(944379),o=n(455360),a=n(808687),l=n(318440),s=n(828226),d=n(889171),c=n(73428),h=n(304472),p=n(541340),g=n(548187),u=n(513665),x=n(105777);class f extends x.A{handle(e,t,n,i){let{nodeManager:r}=i,o=[],a=new p.d({idList:[e.id],dx:t.x,dy:t.y});for(let t of(o.push(a),r.getConnectedLines(e.id))){let e=(0,g.hB)(t,r),n=new u.x({id:t.id,props:e});o.push(n)}return o}enable(e){return!0}}class y extends x.A{handle(e,t,n,i){return[new p.d({idList:[e.id],dx:t.x,dy:t.y})]}enable(e){return e.type===i.Jq.Connector}}var P=n(615691),w=n(353741),m=n(805433),M=n(525619),T=n(771313);class b extends x.A{hoverLifeline(e,t){let{start:n,end:i}=e.getLifeLinePoint(),r=new Path2D;r.moveTo(n.x,n.y),r.lineTo(i.x,i.y),t.addOrUpdateAuxiliaryGraphic(l.T.HoverLifeline,{lifeline:e,boundColor:"#3572ff",hideRect:!0})}handleMove(e,t,n,i){let{nodeManager:r}=i,o=[],a=r.getConnectedLines(e.id);return o.push(new p.d({idList:[e.id,...a.map(e=>e.id)],dx:t.x,dy:t.y})),o}handle(e,t,n,i){let r=i.detect(T.c.ActivationLifeline,n);return r&&this.hoverLifeline(r.lifeline,i),this.handleMove(e,t,n,i)}enable(e){return e.type===i.Jq.Activation}}var C=n(800866),S=n(976780),A=n(457063);class v extends s.X{startBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};startPos=new d.E(0,0);addedDelta=new d.E(0,0);targetNodes=[];moveHandlers=[new y,new P._,new b,new f];onStart(e,t){let n=[...t.getSelectNodes()];this.targetNodes=a.D.computeMoveNodes(n,t.nodeManager),0!==this.targetNodes.length&&(this.startBounds=m.G.getBounds(n.map(e=>e.getRectNode())),this.startPos=a.D.trimPoint(t.lastDiffTypeEvent.globalPoint),this.removeRoot(this.targetNodes,e,t),this.addedDelta=new d.E(0,0),t.actionManager.execAction(new r.M))}onMove(e,t){if(t.auxiliaryManager.removeAllHoverGraphic(),t.auxiliaryManager.removeAllSelectGraphic(),0===this.targetNodes.length)return;let n=a.D.trimPoint(e.globalPoint),i=n.x-this.startPos.x,r=n.y-this.startPos.y,o=M.d.XY;e.originEvent.shiftKey&&(Math.abs(i)>Math.abs(r)?(r=0,o=M.d.X):(i=0,o=M.d.Y));let l=t.alignManager.align({alignMode:w.$.Move,alignAxis:o,startBounds:this.startBounds,startPoint:this.startPos,endPoint:n});l?.offset&&(o!==M.d.Y&&(i+=l.offset.x),o!==M.d.X&&(r+=l.offset.y));let s=new d.E(i-this.addedDelta.x,r-this.addedDelta.y);for(let n of this.targetNodes)for(let i of this.moveNode(n,s,e,t))t.actionManager.execAction(i);this.removeAuxiliaryGraphics(t),this.dragHoverOnContainer(e,t),this.addedDelta.x=i,this.addedDelta.y=r}moveNode(e,t,n,i){for(let r of this.moveHandlers)if(r.enable(e))return r.handle(e,t,n,i);return[]}onUp(e,t){if(0===this.targetNodes.length)return;let n=h.G.detect(this.targetNodes,e,t);n||(n=t.nodeManager.root),h.G.dragNodeRelationChange(this.targetNodes,n,e,t),t.alignManager.clear(),t.auxiliaryManager.refreshSelectStatus(),t.removeAuxiliaryGraphic(l.T.DragHoverContainer),t.actionManager.execAction(new o.q),this.targetNodes=[]}removeAuxiliaryGraphics(e){e.removeAuxiliaryGraphic(l.T.StretchRect),e.removeAuxiliaryGraphic(l.T.ConnectAnchor),e.removeAuxiliaryGraphic(l.T.SelectBound),e.removeAuxiliaryGraphic(l.T.SelectLineEndPoint),e.removeAuxiliaryGraphic(l.T.RotateIcon),e.removeAuxiliaryGraphic(l.T.HighlightRect),e.removeAuxiliaryGraphic(l.T.HoverConnectLine)}dragHoverOnContainer(e,t){let n=h.G.detect(this.targetNodes,e,t);if(n){let r=c.U.baseProps2Rect(n.globalBaseProps);n.type===i.Jq.Table&&(r=t.detect(T.c.TableCell,e).rect),t.addOrUpdateAuxiliaryGraphic(l.T.DragHoverContainer,{rect:r})}else t.removeAuxiliaryGraphic(l.T.DragHoverContainer)}removeRoot(e,t,n){for(let r of e){let e=r.parent.children.indexOf(r),o=n.nodeManager.root.children.length,a={id:r.id,fromPath:r.getPath(),toPath:n.nodeManager.root.getPath(!0),fromIndex:e,toIndex:o},l={type:S.d.Base,x:r.parent.toGlobalPoint(r.baseProps).x,y:r.parent.toGlobalPoint(r.baseProps).y},s={id:r.id,props:[l]};if(r.parent.type===i.Jq.Table){let{i:e,j:i,table:o}=n.detect(T.c.TableCell,t),a=o.tableProps.cellMatrix.getCell(e,i),l=[...a.children],s=l.indexOf(r.id);s>-1&&l.splice(s,1);let d={i:a.i,j:a.j,children:l},c={id:o.id,infos:[d]};n.actionManager.execAction(new A.g(c))}n.actionManager.execAction(new C.h(a)),n.actionManager.execAction(new u.x(s))}}}var E=n(867953),R=n(39533);class N extends E.W{constructor(){super([new v])}streamEnable(e,t){let n=Array.from(t.getSelectNodes());if(0===n.length||e.originEvent.ctrlKey||e.originEvent.metaKey||this.hasLockedNode(n)||1===n.length&&n[0].type===i.Jq.MindMapNode||1===n.length&&this.isResourceInContainer(n[0]))return!1;let r=R.C.getAllNodes(n);if(this.onlySelectConnectedLines(r,t))return!1;t.inputManager.blur();let o=t.auxiliaryManager.selectManager.getSelectBounds();return m.G.rectContains2(t.lastDiffTypeEvent.globalPoint,o)}hasLockedNode(e){for(let t of e)if(t.lockedStatusProps.locked)return!0;return!1}isResourceInContainer(e){return!1}onlySelectConnectedLines(e,t){return!e.some(e=>{if(e.type!==i.Jq.Connector)return!0;let{attachProps:t}=e;return!t.start.id&&!t.end.id})}}},105777:function(e,t,n){n.d(t,{A:()=>i});class i{}},615691:function(e,t,n){n.d(t,{_:()=>a});var i=n(105777),r=n(797615),o=n(541340);class a extends i.A{enable(e){return e.type===r.Jq.MindMapNode&&null===e.mindMapParent}handle(e,t,n,i){let r=[],a=new o.d({idList:[e.id],dx:t.x,dy:t.y});r.push(a);let l=e.mindMapChildren;return 0===l.length||this.computeMindMapChildren(l,t,r),r}computeMindMapChildren(e,t,n){if(0!==e.length)for(let i of e){let e=new o.d({idList:[i.id],dx:t.x,dy:t.y});n.push(e),this.computeMindMapChildren(i.mindMapChildren,t,n)}}}},113298:function(e,t,n){n.d(t,{N:()=>g});var i=n(944379),r=n(455360),o=n(828226),a=n(771313),l=n(513665),s=n(188893),d=n(976780),c=n(876834);class h extends o.X{res=null;onStart(e,t){let n=t.getDetector(a.c.CurveControlPoint);n?.detect(e,t)&&n.result&&(this.res=n.result,t.actionManager.execAction(new i.M),t.auxiliaryManager.updateSelectGraphic({type:c.q.SingleSelectConnector,hideControlPoints:!0,hideTextBox:!0}))}onMove(e,t){if(!this.res)return;t.auxiliaryManager.removeAllHoverGraphic(),t.auxiliaryManager.removeAllSelectGraphic();let{line:n}=this.res,i=n.toLocalPoint(e.globalPoint),{isPointsEdited:r}=n.lineProps,{points:o}=n.lineProps,a=3*this.res.index+3;if(this.res.isTurningPoint){let e=o[a],t=i.x-e.x,n=i.y-e.y,r=o[a-1];r.x+=t,r.y+=n;let l=o[a+1];l.x+=t,l.y+=n,e.x=i.x,e.y=i.y}else o.splice(a-1,0,i,i,i),r=!0,n.lineProps.isPointsEdited=!0,this.res.isTurningPoint=!0,this.res.index=a/3-1;let{attachProps:c}=n,h=(0,s.Q5)(n,{attachType:c.start.attachType,snapTo:c.start.snapTo,point:o[0],node:t.nodeManager.nodeMap.get(c.start.id)},{attachType:c.end.attachType,snapTo:c.end.snapTo,point:o[o.length-1],node:t.nodeManager.nodeMap.get(c.end.id)}),p={type:d.d.Line,points:h,isPointsEdited:r},g=new l.x({id:n.id,props:[p]});t.actionManager.execAction(g)}onUp(e,t){this.res&&(t.actionManager.execAction(new r.q),t.refreshSelectStatus({type:c.q.SingleSelectConnector,hideControlPoints:!1,hideTextBox:!1}),this.res=null)}}var p=n(867953);class g extends p.W{constructor(){super([new h])}streamEnable(e,t){let n=t.getDetector(a.c.CurveControlPoint);return!!(n?.detect(t.lastDiffTypeEvent,t)&&n.result?.enabled&&!n?.result.line.lockedStatusProps.locked)}}},140109:function(e,t,n){n.d(t,{u:()=>P});var i=n(944379),r=n(455360),o=n(828226),a=n(771313),l=n(889171),s=n(805433),d=n(513665),c=n(976780),h=n(15544),p=n(876834),g=n(353741),u=n(525619);let x=(e,t)=>{let n=s.G.distance(e,t);return n>=108?36:n>=48&&n<108?16:-1};class f extends o.X{res=null;onStart(e,t){let n=t.getDetector(a.c.PolyControlPoint);n?.detect(e,t)&&n.result&&(this.res=n.result,t.actionManager.execAction(new i.M),t.auxiliaryManager.updateSelectGraphic({type:p.q.SingleSelectConnector,hideControlPoints:!0,hideTextBox:!0}))}onMove(e,t){let n;if(!this.res)return;t.auxiliaryManager.removeAllHoverGraphic(),t.auxiliaryManager.removeAllSelectGraphic();let{line:i}=this.res,{points:r}=i.lineProps,o=i.getControlPoints(),a=i.toLocalPoint(e.globalPoint),s=null,{isPointsEdited:h}=i.lineProps;if(2===r.length?(n=this.getPointsWithOneControlPoint(r,a))&&(this.res.index+=2):0===this.res.index?(n=this.getPointsByFirstControlPoint(r))&&(this.res.index+=2):this.res.index===o.length-1?n=this.getPointsByLastControlPoint(r):(s=o[this.res.index],n=this.getPointsByMiddleControlPoint(r,a,{...s,x:s.x-i.globalBaseProps.x,y:s.y-i.globalBaseProps.y}),h=!0),!n)return;let p=new l.E(0,0);s?(p.x=s.x,p.y=s.y):p=n[this.res.index];let x=t.alignManager.align({alignMode:g.$.MovePoint,alignAxis:this.res.isHorizon?u.d.X:u.d.Y,startBounds:i.getBounds(),startPoint:p,endPoint:e.globalPoint,selectNodes:[i]});if(x?.offset){n[this.res.index].x+=x.offset.x,n[this.res.index].y+=x.offset.y;let e=this.res.index+1;e<=n.length-1&&(n[e].x+=x.offset.x,n[e].y+=x.offset.y)}let f={type:c.d.Line,points:n,isPointsEdited:h},y=new d.x({id:i.id,props:[f]});t.actionManager.execAction(y)}onUp(e,t){if(!this.res)return;let{line:n}=this.res,{isPointsEdited:i,points:o}=n.lineProps;if(i){let e=(0,h.IN)(o,n.attachProps.start,n.attachProps.end);e=(0,h.nQ)(e,n.attachProps.start,n.attachProps.end);let i={type:c.d.Line,points:e},r=new d.x({id:n.id,props:[i]});t.actionManager.execAction(r)}t.actionManager.execAction(new r.q),t.refreshSelectStatus({type:p.q.SingleSelectConnector,hideControlPoints:!1,hideTextBox:!1}),this.res=null}getPointsWithOneControlPoint(e,t){let n=e[0],i=e[1],r=x(n,i);if(r<0)return;let o=[];if(this.res.isHorizon){let e=n.x<i.x?1:-1,a=n.x+e*r,s=i.x-e*r,d=n.y,c=t.y;o.push(new l.E(a,d),new l.E(a,c),new l.E(s,c),new l.E(s,d))}else{let e=n.y<i.y?1:-1,a=n.x,s=t.x,d=n.y+e*r,c=i.y-e*r;o.push(new l.E(a,d),new l.E(s,d),new l.E(s,c),new l.E(a,c))}return[n,...o,i]}getPointsByFirstControlPoint(e){let t=e[0],n=e[1],i=x(t,n);if(i<0)return;let r=0,o=0;if(this.res.isHorizon){let e=t.x<n.x?1:-1;r=t.x+e*i,o=t.y}else{let e=t.y<n.y?1:-1;r=t.x,o=t.y+e*i}let a=e.slice();return a.splice(1,0,new l.E(r,o),new l.E(r,o)),a}getPointsByLastControlPoint(e){let t=e[e.length-2],n=e[e.length-1],i=x(t,n);if(i<0)return;let r=0,o=0;if(this.res.isHorizon){let e=t.x<n.x?1:-1;r=n.x-e*i,o=n.y}else{let e=t.y<n.y?1:-1;r=n.x,o=n.y-e*i}let a=e.slice();return a.splice(e.length-1,0,new l.E(r,o),new l.E(r,o)),a}getPointsByMiddleControlPoint(e,t,n){let i=0,r=0;n.isHorizon?r=t.y-n.y:i=t.x-n.x;let o=e.slice();return o[this.res.index].x+=i,o[this.res.index].y+=r,o[this.res.index+1].x+=i,o[this.res.index+1].y+=r,o}}var y=n(867953);class P extends y.W{constructor(){super([new f])}streamEnable(e,t){let n=t.getDetector(a.c.PolyControlPoint);return!!(n?.detect(t.lastDiffTypeEvent,t)&&n.result?.enabled&&!n?.result.line.lockedStatusProps.locked)}}},644003:function(e,t,n){n.d(t,{d:()=>m});var i=n(944379),r=n(455360),o=n(828226),a=n(771313),l=n(513665),s=n(976780),d=n(15544),c=n(808687),h=n(968531),p=n(876834),g=n(353741),u=n(525619),x=n(587884),f=n(937093);class y extends o.X{res=null;handler=new x.I;onStart(e,t){let n=t.getDetector(a.c.LineEdgePoint);n?.detect(e,t)&&n.result&&(this.res=n.result,this.handler.init(this.res.line,e.globalPoint,this.res.isStart),t.actionManager.execAction(new i.M),t.auxiliaryManager.updateSelectGraphic({type:p.q.SingleSelectConnector,hideControlPoints:!0,hideTextBox:!0}))}onMove(e,t){let n;if(!this.res)return;t.auxiliaryManager.removeAllHoverGraphic(),t.auxiliaryManager.removeAllSelectGraphic();let{line:i,isStart:r}=this.res,o=c.D.trimPoint(e.globalPoint),s=t.getDetector(a.c.ConnectNodeEdge);s?.detect(e,t)&&s.result&&(n=(0,h.ic)(s.result),o=s.result.node.getLineAttachPoint(n.position));let d=t.alignManager.align({alignMode:g.$.MovePoint,alignAxis:u.d.XY,startBounds:i.getBounds(),startPoint:i.points[r?0:i.points.length-1],endPoint:o,selectNodes:[i]});d?.offset&&(o.x+=d.offset.x,o.y+=d.offset.y);let p=(0,h.hR)(i,o,t.nodeManager,n,r),x=new l.x({id:i.id,props:p});t.actionManager.execAction(x)}onUp(e,t){if(!this.res)return;let n=null;(n=this.isHandleByMessgeLine(e,t)?this.handler.onUp(e,t):this.handleUp(e,t))&&n.forEach(e=>t.actionManager.execAction(e)),t.actionManager.execAction(new r.q),t.refreshSelectStatus({type:p.q.SingleSelectConnector,hideControlPoints:!1,hideTextBox:!1}),this.res=null}handleUp(e,t){let{line:n}=this.res,{isPointsEdited:i,points:r}=n.lineProps;if(n.isPolyLine()&&i){let e=(0,d.IN)(r,n.attachProps.start,n.attachProps.end);e=(0,d.nQ)(e,n.attachProps.start,n.attachProps.end);let t={type:s.d.Line,points:e};return[new l.x({id:n.id,props:[t]})]}return null}isHandleByMessgeLine(e,t){return!!this.res&&!!this.res.isStart&&this.res.line.lineType===f.SP.SimpleLine&&!!t.detect(a.c.ActivationNodeEdge,e)}}var P=n(867953),w=n(202463);class m extends P.W{constructor(){super([new y],[new w.u])}streamEnable(e,t){let n=t.getDetector(a.c.LineEdgePoint);return!(!n?.detect(t.lastDiffTypeEvent,t)||n?.result?.line.lockedStatusProps.locked)}}},587884:function(e,t,n){n.d(t,{I:()=>g});var i=n(828226),r=n(889171),o=n(353741),a=n(525619),l=n(771313),s=n(513665),d=n(800866),c=n(976780),h=n(937093),p=n(797615);class g extends i.X{line=null;startPoint=new r.E(0,0);isStart=!0;pointIndex=-1;startBase=new r.E(0,0);startPointOffset=new r.E(0,0);init(e,t,n){this.line=e,this.startPoint=t,this.isStart=n;let i=e.points;this.startBase=new r.E(e.baseProps.x,e.baseProps.y),this.startPointOffset=new r.E(this.startPoint.x-i[n?0:i.length-1].x,this.startPoint.y-i[n?0:i.length-1].y)}onStart(e,t){}onMove(e,t){if(!this.line)return null;let n=this.line,i=new r.E(e.globalPoint.x,e.globalPoint.y),l=i.x-this.startPoint.x,d=i.y-this.startPoint.y,c=t.alignManager.align({alignMode:o.$.MovePoint,alignAxis:a.d.XY,startBounds:n.getBounds(),startPoint:n.points[0],endPoint:new r.E(i.x-this.startPointOffset.x,i.y-this.startPointOffset.y),selectNodes:[n]});c?.offset&&(l+=c.offset.x,d+=c.offset.y);let h=n.baseProps;return h.x=this.startBase.x+l,h.y=this.startBase.y+d,[new s.x({id:n.id,props:[h]})]}onUp(e,t){if(!this.line)return null;let n=this.line,i=this.getDroppedActivation(n,e,t),o=n?.parent,a=i?.parent||t.nodeManager.root,l=n.points,g=new r.E(l[0].x,l[0].y),u=new r.E(l[l.length-1].x,l[l.length-1].y),x=[];this.isStart?(x.push(g),x.push(new r.E(u.x,g.y))):(x.push(new r.E(g.x,u.y)),x.push(u));let f=Math.min(g.x,u.x),y=Math.min(g.y,u.y),P=Math.max(g.x,u.x),w=Math.max(g.y,u.y),m={type:c.d.Base,x:f-(a.globalBaseProps.x||0),y:y-(a.globalBaseProps.y||0),width:P-f,height:w-y},M={type:c.d.Line,lineType:h.SP.SimpleLine,points:x.map(e=>new r.E(e.x-f,e.y-y))},T={type:c.d.LineAttach};if(i){let e=i.globalBaseProps;this.isStart?T.start={id:i.id,snapTo:p.Tq.SNAPTO_AUTO,attachType:p.J3.MAGNET_ANCHOR,position:new r.E((g.x-e.x)/e.width,(u.y-e.y)/e.height)}:T.end={id:i.id,snapTo:p.Tq.SNAPTO_AUTO,attachType:p.J3.MAGNET_ANCHOR,position:new r.E((u.x-e.x)/e.width,(u.y-e.y)/e.height)}}else this.isStart?T.start={id:"",snapTo:p.Tq.SNAPTO_AUTO,attachType:p.J3.ATTACH_NONE}:T.end={id:"",snapTo:p.Tq.SNAPTO_AUTO,attachType:p.J3.ATTACH_NONE};let b=new s.x({id:n.id,props:[m,M,T]});return[new d.h({fromPath:n.getPath(),toPath:a.getPath(!0),fromIndex:o?o.children.indexOf(n):0,toIndex:a.children.length,id:n.id}),b]}getDroppedActivation(e,t,n){return n.detect(l.c.ActivationBounds,t)?n.getDetector(l.c.ActivationBounds).result.node:n.detect(l.c.ActivationNodeEdge,t)?n.getDetector(l.c.ActivationNodeEdge).result.node:null}}},219169:function(e,t,n){n.d(t,{B:()=>c});var i=n(797615),r=n(828226),o=n(318440),a=n(460146);class l extends r.X{originPosition=null;editTextInfo=null;onStart(e,t){let{editTextInfo:n}=t.inputManager;n&&(this.editTextInfo=n);let{node:r,inputableText:o}=n,{graphicText:l}=o;if(t.inputManager.blur(),t.setCursor("text"),l instanceof a.l&&(r.type===i.Jq.Section||r.type===i.Jq.Table)){let e=t.gmlRender.canvas.getContext("2d");l.enterEdit(e);let{inputState:n}=t.inputManager,i=n.registerBlurHandler(()=>{l.exitEdit(e),i&&n.removeBlurHandler(i)})}let{globalPoint:s}=t.lastDiffTypeEvent,d=l.toLocalPoint(s),{textCursorPosition:c}=l.renderText.detect(d);this.originPosition=c}onMove(e,t){let{node:n,inputableText:i}=this.editTextInfo,{graphicText:r}=i,a=r.toLocalPoint(e.globalPoint),{textCursorPosition:l}=r.renderText.detect(a),s=t.auxiliaryManager.selectionManager.generateSelect(n,r,this.originPosition,l);0!==s.length&&t.addOrUpdateAuxiliaryGraphic(o.T.TextSelection,{selectionList:s,baseProps:r.globalBaseProps})}onUp(e,t){let{node:n,inputableText:i}=this.editTextInfo,{graphicText:r}=i,a=r.toLocalPoint(e.globalPoint),{textCursorPosition:l,fontSize:s}=r.renderText.detect(a);if(t.setCursor("default"),l.equal(this.originPosition))t.auxiliaryManager.clearTextSelection(),t.inputManager.focus(this.editTextInfo,s);else{let e=t.auxiliaryManager.selectionManager.generateSelect(n,r,this.originPosition,l);if(0===e.length)return;t.addOrUpdateAuxiliaryGraphic(o.T.TextSelection,{selectionList:e,baseProps:r.globalBaseProps}),t.inputManager.selectionFocus({...this.editTextInfo,cursorPos:this.originPosition})}this.editTextInfo=null}}var s=n(867953),d=n(771313);class c extends s.W{constructor(){super([new l])}streamEnable(e,t){let[n]=Array.from(t.getSelectNodes());if([i.Jq.Section,i.Jq.Table].includes(n?.type)){let{graphicTitle:i}=n;if(i.contains(e.globalPoint)&&t.canBeEditText())return!0}let r=t.getDetector(d.c.HoverNode);return!!r?.detect(e,t)&&t.canBeEditText()}}},618946:function(e,t,n){n.d(t,{L:()=>M});var i=n(175005),r=n(318440),o=n(944379),a=n(455360),l=n(828226),s=n(196468),d=n(808687),c=n(797615),h=n(616755);class p{startPoint=null;start(e,t){this.startPoint=t.lastDiffTypeEvent.globalPoint}handle(e,t){if(!this.startPoint)return{idList:[],selectType:h.Q.Node,cells:[],rowCols:[]};let n=this.groupRect(e,this.startPoint);this.drawGroupRect(t,n);let i=t.nodeManager.searchNodesRect(n),{graphicSet:r,tableResult:o}=this.judgeSelect(i,n);return r.size>0?{idList:this.postProcess(r),selectType:h.Q.Node,rowCols:[],cells:[]}:o?{idList:[o.node.id],selectType:h.Q.Cell,rowCols:[],cells:o.cells}:{idList:[],selectType:h.Q.Node,rowCols:[],cells:[]}}groupRect(e,t){let n=e.globalPoint.x>t.x?t.x:e.globalPoint.x,i=e.globalPoint.x<t.x?t.x:e.globalPoint.x,r=e.globalPoint.y>t.y?t.y:e.globalPoint.y;return{id:"group-rect",minX:n,maxX:i,minY:r,maxY:e.globalPoint.y<t.y?t.y:e.globalPoint.y}}postProcess(e){let t=[];for(let n of e)d.D.findParentInGraphicSet(n,e)||t.push(n.id);return t}}var g=n(73428),u=n(3981);class x extends p{drawGroupRect(e,t){e.addOrUpdateAuxiliaryGraphic(r.T.SelectGroup,{x:t.minX,y:t.minY,w:t.maxX-t.minX,h:t.maxY-t.minY})}judgeSelect(e,t){let n=new Set,i={graphicSet:n};for(let r of e)if(!r.lockedStatusProps.locked){if(0===n.size&&r instanceof u.H&&this.judgeTable(r,t,i),r instanceof s.s){d.D.overlapOolongLine(r,t)&&n.add(r);continue}if(r.type===c.Jq.Section||r.type===c.Jq.Table){d.D.rectInsideRect(r.getBounds(),t)&&n.add(r);continue}d.D.overlapRect(r.getBounds(),t)&&n.add(r)}return i}judgeTable(e,t,n){let i=0,r=new Set,o=e.globalBaseProps;for(let n of e.tableProps.cellMatrix.cells)for(let e of n){let n=g.U.baseProps2Rect(e.tableBaseProps);n.x+=o.x,n.y+=o.y,d.D.overlapRect(g.U.rect2RectNode(n),t)&&(e.isMerged()?r.add({i:e.refCell.i,j:e.refCell.j}):r.add({i:e.i,j:e.j})),i++}let a=Array.from(r);a.length>0&&(a.length<i&&(n.tableResult={selectType:h.Q.Cell,node:e,cells:a,rowCols:[]}),a.length===i&&n.graphicSet.add(e))}}var f=n(617425);class y extends p{drawGroupRect(e,t){e.addOrUpdateAuxiliaryGraphic(r.T.SelectGroup,{x:t.minX,y:t.minY,w:t.maxX-t.minX,h:t.maxY-t.minY,isPrecise:!0})}judgeSelect(e,t){let n=new Set,i={graphicSet:n};for(let r of e)if(!r.lockedStatusProps.locked){if(0===n.size&&r instanceof u.H&&this.judgeTable(r,t,i),r instanceof f.o){d.D.rectInsideRect(r.getRectNode(),t)&&n.add(r);continue}d.D.rectInsideRect(r.getBounds(),t)&&n.add(r)}return i}judgeTable(e,t,n){let i=0,r=new Set,o=e.globalBaseProps;for(let n of e.tableProps.cellMatrix.cells)for(let e of n){let n=g.U.baseProps2Rect(e.tableBaseProps);n.x+=o.x,n.y+=o.y,d.D.rectInsideRect(g.U.rect2RectNode(n),t)&&(e.isMerged()?r.add({i:e.refCell.i,j:e.refCell.j}):r.add({i:e.i,j:e.j})),i++}let a=Array.from(r);a.length>0&&(a.length<i&&(n.tableResult={selectType:h.Q.Cell,node:e,cells:a,rowCols:[]}),a.length===i&&n.graphicSet.add(e))}}var P=n(487570);class w extends l.X{startPoint=null;selectData={idList:[],selectType:h.Q.Node,cells:[],rowCols:[]};selectionHandlers=[new y,new x];currentHandler=this.selectionHandlers[1];selectHandler(e,t){let n=t.lastDiffTypeEvent.originEvent.timeStamp;if(e.originEvent.timeStamp-n>P.tS||e.originEvent.metaKey||t.docState.preciseGroupSelect){this.currentHandler=this.selectionHandlers[0],t.setCursor("crosshair");return}this.currentHandler=this.selectionHandlers[1]}onStart(e,t){this.selectHandler(e,t),this.currentHandler.start(e,t),t.actionManager.execAction(new o.M),t.actionManager.execAction(i.O.selectNode([]))}onMove(e,t){let n=this.currentHandler.handle(e,t);this.selectData=n,t.actionManager.execAction(new i.O(n)),this.removeAuxiliaryGraphics(t)}onUp(e,t){t.actionManager.execAction(new i.O(this.selectData)),t.removeAuxiliaryGraphic(r.T.SelectGroup),t.actionManager.execAction(new a.q),this.startPoint=null,this.selectData={idList:[],selectType:h.Q.Node,cells:[],rowCols:[]},t.setCursor("default")}removeAuxiliaryGraphics(e){e.removeAuxiliaryGraphic(r.T.RotateIcon),e.removeAuxiliaryGraphic(r.T.ConnectAnchor),e.removeAuxiliaryGraphic(r.T.StretchRect),e.removeAuxiliaryGraphic(r.T.SelectShapeExpand)}}var m=n(867953);class M extends m.W{constructor(){super([new w])}streamEnable(e,t){return!0}}},380470:function(e,t,n){n.d(t,{t:()=>a});var i=n(318440),r=n(771313),o=n(797615);class a{enable(e,t){let n=t.getDetector(r.c.HoverNode);return!(!(n?.detect(e,t)&&n?.result)||n.result?.lockedStatusProps.locked)}handle(e,t){let n=t.getDetector(r.c.HoverNode).result;if(!t.inSelectNodes(n)){if(n.type===o.Jq.Connector)return void t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(i.T.HoverConnectLine,{line:n});if(n.type===o.Jq.Section){n.graphicTitle.contains(e.globalPoint)&&t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(i.T.HoverBounds,{node:n}),n.graphicTitle.isEmpty()&&t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(i.T.HoverTableTitle,{table:n});return}if(n.type===o.Jq.LifelineObject)return void t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(i.T.HoverLifeline,{lifeline:n});t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(i.T.HoverBounds,{node:n})}}}},62207:function(e,t,n){n.d(t,{g:()=>d});var i=n(771313),r=n(544516),o=n(78485),a=n(752195),l=n(943451),s=n(73428);class d{enable(e,t){let n=t.getDetector(i.c.RenderText);return!!n?.detect(e,t)||(r.L.notifyRichContentInteractionCanceled(t,o.l.TextNodeHover),!1)}handle(e,t){let{editTextInfo:n}=t.getDetector(i.c.RenderText).result;if(t.translateManager.isTranslating())return void this.handleTranslatedText(n,t);let{event:a,ctx:l,graphicText:s,textNodeId:d,rowIndex:c,colIndex:h,editTextType:p}={event:e,ctx:t,editTextType:n.inputableText.type,graphicText:n.inputableText.graphicText,textNodeId:n.node.id},g=!1;s&&d&&(g=r.L.textRichContentInteractionHandler({event:a,ctx:l,graphicText:s,textNodeId:d,rowIndex:c,colIndex:h,editTextType:p,auxiliaryDomStateType:o.l.TextNodeHover}))&&l.setCursor("pointer"),g||r.L.notifyRichContentInteractionCanceled(l,o.l.TextNodeHover)}handleTranslatedText(e,t){let{node:n,inputableText:i}=e,d=i.graphicText.getRectNode(),c=t.translateManager.getOriginTextProps(n.id,i),h=i.graphicText.textProps;if((i.type===l.P.LineCaption||i.type===l.P.Title)&&(d=s.U.rect2RectNode(i.graphicText.getContentRect(!0))),!c)return void r.L.notifyRichContentInteractionCanceled(t,o.l.TextNodeHover);t.auxiliaryManager.addOrUpdateAuxiliaryDomState(o.l.TextNodeHover,{type:r.b,action:"translateHover",nodeId:n.id,leftTop:t.gmlRender.transformToLocal({x:d.minX,y:d.minY}),bottomRight:t.gmlRender.transformToLocal({x:d.maxX,y:d.maxY}),translateText:{origin:(0,a.w)(c),translated:(0,a.w)(h)}})}}},366151:function(e,t,n){n.d(t,{_:()=>c});var i=n(799473),r=n(925174),o=n(771313),a=n(578588),l=n(797615),s=n(808687),d=n(805433);class c{allowEventTypeSet=new Set([r.V.pointermove]);process(e,t){let{tool:n,paintType:r}=t.toolManager.currentTool;if(n===i.w.TEXT)return void t.setCursor("text");if(n===i.w.LINE)return void t.setCursor("crosshair");if(t.detect(o.c.Comment,e))return void t.setCursor("pointer");let c=t.detect(o.c.TableRowCol,e);if(c&&!c.table.lockedStatusProps.locked)return void t.setCursor("pointer");if(n===i.w.PEN)return void(r===l.Y_.Highlight?t.setCursor(`${a.W.PenHighlight}`):t.setCursor(`${a.W.PenMark}`));if(n===i.w.ERASER)return void t.setCursor(`${a.W.Eraser}`);let h=t.detect(o.c.MindMapCollapse,e);if(h){let n=h.collapseRect;if(d.G.rectContains(e.globalPoint,n))return void t.setCursor("pointer")}if(t.detect(o.c.MindMapInsert,e))return void t.setCursor("pointer");let p=t.getDetector(o.c.LineEdgePoint);if(p?.detect(e,t)&&!p?.result?.line.lockedStatusProps.locked)return void t.setCursor("move");let g=t.detect(o.c.PolyControlPoint,e);if(g?.enabled&&!g.line.lockedStatusProps.locked){let{isHorizon:e}=g;t.setCursor(e?`${a.W.Stretch}.1`:`${a.W.Stretch}.13`);return}let u=t.detect(o.c.CurveControlPoint,e);if(u?.enabled&&!u.line.lockedStatusProps.locked)return void t.setCursor("move");let x=t.getDetector(o.c.LineTextBox);if(!t.canBeEditText()&&x?.detect(e,t)&&!x?.result?.line.lockedStatusProps.locked)return void t.setCursor("move");let f=t.detect(o.c.LineTextBoxStretch,e);if(f&&!f?.line.lockedStatusProps.locked){let{angle:e}=f,n=s.D.computeStretchCursorIndex(e);t.setCursor(`${a.W.Stretch}.${n}`);return}let y=t.getDetector(o.c.ExpandShape);if(y&&y.detect(e,t)&&!y.result?.lockedStatusProps.locked)return void t.setCursor("pointer");if(t.getDetector(o.c.ActivationBounds)?.result)return void t.setCursor("crosshair");let P=t.detect(o.c.SingleStretch,e);if(P&&!P.node.lockedStatusProps.locked){let e=`${a.W.Stretch}.${P.cursorIndex}`;t.setCursor(e);return}let w=t.detect(o.c.Stretch,e);if(w){let e=`${a.W.Stretch}.${w.cursorIndex}`;t.setCursor(e);return}let m=t.detect(o.c.Rotate,e);if(m&&m.nodes.every(e=>!e.lockedStatusProps.locked)){let e=`${a.W.Rotate}.${m.cursorIndex}`;t.setCursor(e);return}let M=t.detect(o.c.TableRowColBoundary,e);if(M&&!M.table.lockedStatusProps.locked)return void(M.isRow?t.setCursor("row-resize"):t.setCursor("col-resize"));let T=t.detect(o.c.HoverNode,e);if(T&&!T.lockedStatusProps.locked)return(T.type===l.Jq.Section||T.type===l.Jq.Table)&&T.graphicTitle.isEmpty()&&T.graphicTitle.contains(e.globalPoint)?void t.setCursor("move"):void t.setCursor("default");let b=t.detect(o.c.LifeLine,e);if(b)return void(b.isEndPoint?t.setCursor(`${a.W.Stretch}.1`):t.setCursor("pointer"));t.setCursor("default")}}},161429:function(e,t,n){n.d(t,{h:()=>R});var i=n(925174),r=n(318440),o=n(771313);class a{enable(e,t){if(!t.docState.showSizer)return!1;let n=t.getDetector(o.c.SingleStretch);return!!(n?.detect(e,t)&&n?.result)}handle(e,t){let{node:n}=t.getDetector(o.c.SingleStretch).result;t.addOrUpdateAuxiliaryGraphic(r.T.HoverSizer,{baseProps:n.globalBaseProps})}}var l=n(182591),s=n(6961),d=n(347250),c=n(456323);class h{enable(e,t){let n=t.getDetector(o.c.ConnectAnchor);return!!(n?.detect(e,t)&&n?.result)&&!n.result.node.lockedStatusProps.locked||(t.removeAuxiliaryGraphic(r.T.PreviewShapes),!1)}handle(e,t){let{result:n}=t.getDetector(o.c.ConnectAnchor);if(t.addOrUpdateAuxiliaryGraphic(r.T.HoverAnchor,{baseProps:n.node.globalBaseProps,side:n.side,iconType:l.e.includes(n.node.type)?"arrow":"plus"}),l.e.includes(n.node.type))return void this.drawConnectAnchorPreviewShapes(n,t);this.drawAnchorPreviewShapes(n,t)}drawAnchorPreviewShapes(e,t){let n=t.auxiliaryCtx.gmlRender.canvas.getContext("2d"),i=s.h.createDOByNodeSide(e.node,e.side,t);d.j.setOpacity(i.props,.5);let o=[c.j.load(i.id,i.props,n,null,0,t.auxiliaryManager.globalConfig)];t.addOrUpdateAuxiliaryGraphic(r.T.PreviewShapes,{nodes:o})}drawConnectAnchorPreviewShapes(e,t){let n=t.auxiliaryCtx.gmlRender.canvas.getContext("2d"),[i,o]=s.h.createConnect2NodeDOByNodeSide(e.node,e.side,t);d.j.setOpacity(i.props,.5),o&&d.j.setOpacity(o.props,.5);let a=[c.j.load(i.id,i.props,n,null,0,t.auxiliaryManager.globalConfig)];o&&a.push(c.j.load(o.id,o.props,n,null,0,t.auxiliaryManager.globalConfig)),t.addOrUpdateAuxiliaryGraphic(r.T.PreviewShapes,{nodes:a})}}class p{enable(e,t){let n=t.getDetector(o.c.ConnectAnchorEdge);return!!(n?.detect(e,t)&&n?.result)&&!n.result.node.lockedStatusProps.locked}handle(e,t){let{result:n}=t.getDetector(o.c.ConnectAnchorEdge);t.addOrUpdateAuxiliaryGraphic(r.T.HoverEdgeAnchor,{baseProps:n.node.globalBaseProps,side:n.side,iconType:l.e.includes(n.node.type)?"arrow":"plus"})}}var g=n(797615);class u{detectType=o.c.RawTable;enable(e,t){let n;return(n=t.detect(o.c.TableRowCol,e))&&!n.table.lockedStatusProps.locked?(this.detectType=o.c.TableRowCol,!0):(n=t.detect(o.c.TableInsertPoint,e))&&!n.table.lockedStatusProps.locked?(this.detectType=o.c.TableInsertPoint,!0):(n=t.detect(o.c.TableRowColBoundary,e))&&!n.table.lockedStatusProps.locked?(this.detectType=o.c.TableRowColBoundary,!0):(n=t.detect(o.c.TableCell,e))&&!n.table.lockedStatusProps.locked?(this.detectType=o.c.TableCell,!0):!!(n=t.detect(o.c.RawTable,e))&&!n.table.lockedStatusProps.locked&&(this.detectType=o.c.RawTable,!0)}handle(e,t){switch(this.hoverTable(e,t),this.detectType){case o.c.TableRowCol:this.hoverTableRowCol(e,t);break;case o.c.TableInsertPoint:this.hoverTableInsertPoint(e,t);break;case o.c.TableRowColBoundary:this.hoverTableLaneBoundary(e,t);break;case o.c.TableCell:this.hoverTableCell(e,t);case o.c.RawTable:}}hoverTableInsertPoint(e,t){let n=t.getDetector(o.c.TableInsertPoint).result;return t.addOrUpdateAuxiliaryGraphic(r.T.HoverTableInsertPoint,{point:n.start,isRow:n.isRow}),!0}hoverTableLaneBoundary(e,t){let n=t.getDetector(o.c.TableRowColBoundary).result;t.addOrUpdateAuxiliaryGraphic(r.T.HoverTableRowColBoundary,{start:n.start,end:n.end,lineWidth:2})}hoverTableCell(e,t){let n=t.getDetector(o.c.TableCell).result,{table:i}=n;1===t.getSelectNodes().size&&t.inSelectNodes(i)&&t.addOrUpdateAuxiliaryGraphic(r.T.HoverTableCell,{rect:n.rect})}hoverTable(e,t){let{table:n}=t.getDetector(o.c.RawTable).result;t.addOrUpdateAuxiliaryGraphic(r.T.HoverTable,{table:n}),n.type===g.Jq.Table&&n.graphicTitle.isEmpty()&&t.addOrUpdateAuxiliaryGraphic(r.T.HoverTableTitle,{table:n})}hoverTableRowCol(e,t){let n=t.getDetector(o.c.TableRowCol).result;t.addOrUpdateAuxiliaryGraphic(r.T.HoverTableRowCol,{table:n.table,rect:n.rect,isRow:n.isRow,index:n.index})}}class x{enable(e,t){let n=t.getSelectNodes();if(1!==n.size)return!1;let i=[...n][0];if(i.lockedStatusProps.locked||![g.Jq.CompositeShape,g.Jq.StickyNote].includes(i.type)||!i.contains(e.globalPoint))return!1;let r=t.inputManager.editTextInfo;return(!r||r.node!==i)&&!i.graphicText.needRender()}handle(e,t){let n=Array.from(t.getSelectNodes());t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(r.T.HoverSelectPlaceHolder,{node:n[0],placeholder:t.auxiliaryManager.globalConfig.textConfig.placeholder})}}var f=n(380470),y=n(62207),P=n(281051),w=n(976780);class m{enable(e,t){let n=t.getDetector(o.c.LifeLine);return!!n?.detect(e,t)&&!!n.result||(t.removeAuxiliaryGraphic(r.T.PreviewShape),!1)}handle(e,t){let n=t.getDetector(o.c.LifeLine).result;n.isEndPoint?t.removeAuxiliaryGraphic(r.T.PreviewShape):this.drawHoverActivation(n,t)}drawHoverActivation(e,t){let{point:n,node:i}=e,o=d.j.createActivationProps(i.baseProps.x+i.baseProps.width/2-15,n.y,t);for(let e of o)e.type===w.d.Color&&(e.alpha=.5),e.type===w.d.Border&&(e.borderAlpha=0);let a=t.previewElement;if(null===a){let e=t.auxiliaryCtx.gmlRender.canvas.getContext("2d");(a=new P.d("preview-activation",e)).updateNodeProps(o),t.previewElement=a}else a.updateNodeProps(o);t.addOrUpdateAuxiliaryGraphic(r.T.PreviewShape,{node:a})}}class M{enable(e,t){let n=t.getDetector(o.c.LineEdgePoint);return!!n?.detect(e,t)&&!!n.result}handle(e,t){let n=t.getDetector(o.c.LineEdgePoint);t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(r.T.HoverLineEndPoint,{point:n.result.point})}}class T{enable(e,t){let n=t.getDetector(o.c.CurveControlPoint);return!!(n?.detect(e,t)&&n.result?.isTurningPoint)}handle(e,t){let n=t.getDetector(o.c.CurveControlPoint);t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(r.T.HoverLineEndPoint,{point:n.result.point})}}class b{enable(e,t){let n=t.getDetector(o.c.ActivationBounds);return!!(n?.detect(e,t)&&n?.result)||(t.auxiliaryManager.removeAuxiliaryGraphic(r.T.HoverActivationBoundsEndPoint),!1)}handle(e,t){let{point:n}=t.getDetector(o.c.ActivationBounds).result;t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(r.T.HoverActivationBoundsEndPoint,{points:[n]})}}var C=n(140512);class S{result=null;enable(e,t){let n=t.detect(o.c.MindMapCollapse,e);return!!n&&!n.node.mindMapProps.collapsed&&(this.result=n,!0)}handle(e,t){if(!this.result)return;let{node:n,collapseRect:i}=this.result,o=n.getProp(w.d.Border),a=C.R.convertToCollapseSideEnum(n.mindMapProps.layoutEnum);t.auxiliaryManager.addOrUpdateAuxiliaryGraphic(r.T.HoverMindMapCollapse,{rect:i,borderColor:o.borderColor,collapseEnum:a})}}class A{allowEventTypeSet=new Set([i.V.pointermove]);handlers=[new S,new a,new h,new p,new u,new m,new M,new b,new T,new x,new f.t,new y.g];process(e,t){for(let n of this.handlers)n.enable(e,t)&&n.handle(e,t)}}var v=n(366151),E=n(572583);class R extends E.I{constructor(e){super([new v._,new A,...e||[]])}canBeEnable(e,t){return!0}canBeExit(e,t){return!0}}},784391:function(e,t,n){n.d(t,{Y:()=>m});var i=n(808687),r=n(944379),o=n(513665),a=n(455360),l=n(889171),s=n(828226),d=n(771313),c=n(931425),h=n(196468),p=n(771584),g=n(976780),u=n(937093),x=n(548187),f=n(318440),y=n(202146);class P extends s.X{rotateInfo=null;originPos=new l.E(0,0);originAngle=0;rotateNodePropMap=new Map;dragLength=0;relatedLines=[];onStart(e,t){let n=t.getDetector(d.c.Rotate);if(this.rotateInfo=n.result,!this.rotateInfo)return;let o=i.D.trimPoint(t.lastDiffTypeEvent.globalPoint);this.originPos=o;let{rotateCenter:a}=this.rotateInfo;this.originAngle=i.D.calculateAngle(a,o),t.actionManager.execAction(new r.M);let s=t.getSelectNodes();for(let e of s){let n=e.globalBaseProps;if(e instanceof c.F||e instanceof y.W)this.rotateNodePropMap.set(e.id,{center:new l.E(n.x,n.y),angle:n.angle}),this.relatedLines.push(...t.nodeManager.getConnectedLines(e.id));else if(e instanceof h.s){let{points:t}=e,n=t[0],i=t[t.length-1];this.rotateNodePropMap.set(e.id,{startPoint:n,endPoint:i})}}if(1===s.size){let{baseProps:e}=[...s][0],t=.5*e.width,n=.5*e.height;this.dragLength=Math.sqrt(t*t+n*n)}else{let e=t.auxiliaryManager.selectManager.getSelectBounds(),n=.5*(e.maxX-e.minX),i=.5*(e.maxY-e.minY);this.dragLength=Math.sqrt(n*n+i*i)}}onMove(e,t){let n=i.D.trimPoint(e.globalPoint),{rotateCenter:r}=this.rotateInfo,a=i.D.calculateAngle(r,n)-this.originAngle,l=t.getSelectNodes();if(1!==l.size||e.originEvent.ctrlKey){if(!e.originEvent.ctrlKey){let e=i.D.trimAngle(a);10>Math.abs(e)&&(a+=0-e),10>Math.abs(e-90)&&(a+=90-e),10>Math.abs(e-180)&&(a+=180-e),10>Math.abs(e-270)&&(a+=270-e),10>Math.abs(e-360)&&(a+=360-e)}}else{let e=[...l][0],t=this.rotateNodePropMap.get(e.id).angle+a,n=i.D.trimAngle(t);10>Math.abs(n)&&(a+=0-n),10>Math.abs(n-90)&&(a+=90-n),10>Math.abs(n-180)&&(a+=180-n),10>Math.abs(n-270)&&(a+=270-n),10>Math.abs(n-360)&&(a+=360-n)}let s=p.c.generateMatrix().translate(-r.x,-r.y),d=p.c.generateMatrix().rotate(a),f=p.c.generateMatrix().translate(r.x,r.y).crossProduct(d.crossProduct(s));for(let e of l){let n=this.rotateNodePropMap.get(e.id);if(n){if(e instanceof c.F||e instanceof y.W){let i=f.crossPoint(n.center);e.parent&&(i=e.parent.toLocalPoint(i));let r={type:g.d.Base,x:i.x,y:i.y,angle:n.angle+a},l={id:e.id,props:[r]};t.actionManager.execAction(new o.x(l))}else if(e instanceof h.s){if(e.attachProps.start.id||e.attachProps.end.id)continue;let r=n.startPoint,a=n.endPoint,l=f.crossPoint(r),s=f.crossPoint(a),d=[];d=e.shapeType===u.SP.PolyLine||e.shapeType===u.SP.RightAngledPolyLine?i.D.layout(l,s):e.shapeType===u.SP.Curve?i.D.curveLayout(l,s):[l,s];let c={type:g.d.Line,points:d},h={id:e.id,props:[c]};t.actionManager.execAction(new o.x(h))}}}(0,x.X$)(this.relatedLines,t),this.removeAuxiliaryGraphics(t)}onUp(e,t){t.auxiliaryManager.selectManager.hide=!1,t.actionManager.execAction(new a.q),t.refreshSelectStatus(),this.rotateInfo=null,this.relatedLines=[]}removeAuxiliaryGraphics(e){e.removeAuxiliaryGraphic(f.T.ConnectAnchor),e.removeAuxiliaryGraphic(f.T.StretchRect),e.removeAuxiliaryGraphic(f.T.SelectShapeExpand)}}var w=n(867953);class m extends w.W{constructor(){super([new P])}streamEnable(e,t){let n=t.getDetector(d.c.Rotate);return!!n?.detect(t.lastDiffTypeEvent,t)&&(t.inputManager.blur(),!0)}}},893420:function(e,t,n){n.d(t,{U:()=>b});var i=n(513665),r=n(944379),o=n(455360),a=n(318440),l=n(828226),s=n(889171),d=n(73428),c=n(771313),h=n(581974),p=n(873411),g=n(976780),u=n(805433),x=n(166887),f=n(548187),y=n(972680),P=n(797615),w=n(451935),m=n(353741);class M extends l.X{originPos=new s.E(0,0);originPosOffset=new s.E(0,0);minStretchSize=new s.E(0,0);lastWorkSize=new s.E(0,0);target=null;relatedLines=[];stretchNodeRect=new p.s;stretchNodeBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};stretchNodeBorderWidth=1;originWidthHeightRatio=1;relatedComments=new Map;xVector=new x.O;yVector=new x.O;addedDelta=new s.E(0,0);onStart(e,t){let n=t.getDetector(c.c.SingleStretch);if(this.target=n.result,!this.target)return;let{node:i}=this.target;this.relatedLines=t.nodeManager.getConnectedLines(i.id);let{baseProps:o,themeProps:a}=i,l=i.getProp(g.d.Border);this.stretchNodeRect.x=o.x,this.stretchNodeRect.y=o.y,this.stretchNodeRect.width=o.width,this.stretchNodeRect.height=o.height,this.stretchNodeRect.angle=o.angle,this.stretchNodeBounds=i.getRectNode(),this.originWidthHeightRatio=o.width/o.height,this.stretchNodeBorderWidth=a?.borderHighPrecisionWidth||l?.borderWidth||2,this.minStretchSize=t.getStretchMinSize(i),this.originPos=new s.E(e.globalPoint.x,e.globalPoint.y),this.originPosOffset=(0,y.uI)(this.target.type,this.originPos,this.stretchNodeBounds);let d=i.globalBaseProps.angle/180*Math.PI;this.xVector=new x.O(Math.cos(d),Math.sin(d)),this.yVector=new x.O(Math.cos(d+.5*Math.PI),Math.sin(d+.5*Math.PI)),t.actionManager.execAction(new r.M),this.relatedComments.clear();let h=t.commentManager.getNodeComments(this.target.node.id),p=[];for(let e of h){let t=e.comment.x/o.width,n=e.comment.y/o.height;p.push({scaleX:t,scaleY:n,comment:e.comment})}this.relatedComments.set(i,p)}onMove(e,t){if(!this.target)return;let{node:n}=this.target,{globalPoint:r,originEvent:o}=e,{baseProps:a}=n,l=o.shiftKey||a.isUniform,c=new x.O(r.x-this.originPos.x,r.y-this.originPos.y),p=t.alignManager.align({alignMode:m.$.Stretch,alignAxis:(0,y.Xr)(this.target.type),startBounds:this.stretchNodeBounds,startPoint:new s.E(this.originPos.x-this.originPosOffset.x,this.originPos.y-this.originPosOffset.y),endPoint:new s.E(r.x-this.originPosOffset.x,r.y-this.originPosOffset.y)});p?.offset&&(c.x+=p.offset.x,c.y+=p.offset.y);let P=new d.U(this.stretchNodeRect.x,this.stretchNodeRect.y,this.stretchNodeRect.width,this.stretchNodeRect.height),w=c.dotProduct(this.xVector),M=c.dotProduct(this.yVector);if((0,y.tR)({targetNode:P,stretchType:this.target.type,isUniform:l,deltaX:w,deltaY:M,originWidthHeightRatio:this.originWidthHeightRatio}),(0,y.NR)({targetNode:P,minStretchSize:this.minStretchSize,originWidthHeightRatio:this.originWidthHeightRatio,stretchType:this.target.type,isUniform:l}),.1>Math.abs(P.width-this.lastWorkSize.x)&&.1>Math.abs(P.height-this.lastWorkSize.y))return;if(Math.abs(this.stretchNodeRect.angle)>.1){if(this.target.type===h.j.RIGHT||this.target.type===h.j.BOTTOM||this.target.type===h.j.BOTTOM_RIGHT,this.target.type===h.j.TOP_RIGHT||this.target.type===h.j.TOP){let{d:e}=u.G.computeFourPoint(this.stretchNodeRect),t=this.yVector.clone();t.multiplyScalar(-1*P.height),P.x=e.x+t.x,P.y=e.y+t.y}if(this.target.type===h.j.LEFT||this.target.type===h.j.BOTTOM_LEFT){let{b:e}=u.G.computeFourPoint(this.stretchNodeRect),t=this.xVector.clone();t.multiplyScalar(-1*P.width),P.x=e.x+t.x,P.y=e.y+t.y}if(this.target.type===h.j.TOP_LEFT){let{c:e}=u.G.computeFourPoint(this.stretchNodeRect),t=this.xVector.clone(),n=this.yVector.clone();t.multiplyScalar(-1*P.width),n.multiplyScalar(-1*P.height),P.x=e.x+t.x+n.x,P.y=e.y+t.y+n.y}}let T=[{x:P.x,y:P.y,width:P.width,height:P.height,type:g.d.Base},...(0,y.uk)({node:n,targetWidth:P.width,originBorderWidth:this.stretchNodeBorderWidth,originalWidth:this.stretchNodeRect.width})],b=(0,y.Dy)({node:n,originalWidth:this.stretchNodeRect.width,targetWidth:P.width});b&&T.push(b);let C=new i.x({id:n.id,props:T});t.actionManager.execAction(C),(0,f.X$)(this.relatedLines,t),this.updateTextNodeHeight(n,t),this.lastWorkSize.x=P.width,this.lastWorkSize.y=P.height,this.removeAuxiliaryGraphics(t),this.updateCommentPos(t,!1)}onUp(e,t){t.removeAuxiliaryGraphic(a.T.AlignStretchLine),t.actionManager.execAction(new o.q),t.refreshSelectStatus(),this.updateCommentPos(t,!0),this.target=null,this.relatedLines=[],this.lastWorkSize.x=0,this.lastWorkSize.y=0,this.originPos.x=0,this.originPos.y=0,this.stretchNodeBorderWidth=1,this.originWidthHeightRatio=1}removeAuxiliaryGraphics(e){e.removeAuxiliaryGraphic(a.T.ConnectAnchor),e.removeAuxiliaryGraphic(a.T.StretchRect),e.removeAuxiliaryGraphic(a.T.SelectShapeExpand),e.removeAuxiliaryGraphic(a.T.RotateIcon)}updateTextNodeHeight(e,t){if(e.type!==P.Jq.Text)return;let n=this.stretchNodeRect.width;if(e.baseProps.width===n)return;let{graphicText:r}=e,o=[{type:g.d.Base,height:r.getContentRect().height}];t.execAction(new i.x({id:e.id,props:o}))}updateCommentPos(e,t){if(0!==this.relatedComments.size)for(let[n,i]of this.relatedComments){let r=n.globalBaseProps;for(let o of i){let i=o.scaleX*r.width,a=o.scaleY*r.height,l={act:1,commentID:o.comment.commentID,nodeID:n.id,x:i,y:a};e.actionManager.execUnOrderAction({type:w.U.Comment,data:l},t)}}}}var T=n(867953);class b extends T.W{constructor(){super([new M])}streamEnable(e,t){let n=t.getDetector(c.c.SingleStretch);return!(!n?.detect(t.lastDiffTypeEvent,t)||n?.result?.node.lockedStatusProps.locked)&&(t.inputManager.blur(),!0)}}},983355:function(e,t,n){n.d(t,{P:()=>C});var i=n(513665),r=n(944379),o=n(455360),a=n(808687),l=n(889171),s=n(828226),d=n(771313),c=n(931425),h=n(196468),p=n(73428),g=n(771584),u=n(976780),x=n(548187),f=n(318440),y=n(451935),P=n(972680),w=n(202146),m=n(353741),M=n(805433);class T extends s.X{originPos=new l.E(0,0);originPosOffset=new l.E(0,0);minStretchSize=new l.E(0,0);lastWorkSize=new l.E(0,0);target=null;relatedLines=[];originWidthHeightRatio=1;stretchNodePropMap=new Map;stretchNodeBounds={id:"",minX:0,minY:0,maxX:0,maxY:0};relatedComments=new Map;onStart(e,t){let n=t.getDetector(d.c.Stretch);if(this.target=n.result,!this.target)return;let i=[],o=[];for(let e of(this.relatedComments.clear(),this.target.nodes)){let n=e.globalBaseProps;if(e instanceof c.F||e instanceof w.W){let r=e.getProp(u.d.Border),a=e.getProp(u.d.Theme),l=t.getStretchMinSize(e);i.push(l.x/n.width),o.push(l.y/n.height),this.stretchNodePropMap.set(e.id,{x:n.x,y:n.y,w:n.width,h:n.height,borderWidth:a?.borderHighPrecisionWidth||r?.borderWidth||2}),this.relatedLines.push(...t.nodeManager.getConnectedLines(e.id))}else if(e instanceof h.s){let n=t.getStretchMinSize(e),r=e.getRectNode();i.push(n.x/(r.maxX-r.minX)),o.push(n.y/(r.maxY-r.minY)),this.stretchNodePropMap.set(e.id,{points:e.points})}let r=t.commentManager.getNodeComments(e.id),a=[];for(let e of r){let t=e.comment.x/n.width,i=e.comment.y/n.height;a.push({scaleX:t,scaleY:i,comment:e.comment})}this.relatedComments.set(e,a)}let s=Math.max(...i),p=Math.max(...o),g=(this.target.stretchBounds.maxX-this.target.stretchBounds.minX)*s,x=(this.target.stretchBounds.maxY-this.target.stretchBounds.minY)*p;this.stretchNodeBounds=M.G.getBounds(this.target.nodes.map(e=>e.getBounds())),this.minStretchSize=new l.E(g,x),this.originWidthHeightRatio=(this.target.stretchBounds.maxX-this.target.stretchBounds.minX)/(this.target.stretchBounds.maxY-this.target.stretchBounds.minY),this.originPos=a.D.trimPoint(e.globalPoint),this.originPosOffset=(0,P.uI)(this.target.type,this.originPos,this.stretchNodeBounds),t.actionManager.execAction(new r.M)}onMove(e,t){if(!this.target)return;let n=a.D.trimPoint(e.globalPoint),r=p.U.rectNode2Rect(this.target.stretchBounds),o=new l.E(n.x-this.originPos.x,n.y-this.originPos.y),s=t.alignManager.align({alignMode:m.$.Stretch,alignAxis:(0,P.Xr)(this.target.type),startBounds:this.stretchNodeBounds,startPoint:new l.E(this.originPos.x-this.originPosOffset.x,this.originPos.y-this.originPosOffset.y),endPoint:new l.E(n.x-this.originPosOffset.x,n.y-this.originPosOffset.y)});if(s?.offset&&(o.x+=s.offset.x,o.y+=s.offset.y),(0,P.tR)({targetNode:r,stretchType:this.target.type,deltaX:o.x,deltaY:o.y,originWidthHeightRatio:this.originWidthHeightRatio,isUniform:!0}),(0,P.NR)({targetNode:r,stretchType:this.target.type,minStretchSize:this.minStretchSize,originWidthHeightRatio:this.originWidthHeightRatio,isUniform:!0}),.1>Math.abs(r.width-this.lastWorkSize.x)&&.1>Math.abs(r.height-this.lastWorkSize.y))return;let d=new l.E(r.x+.5*r.width,r.y+.5*r.height),f=new l.E(.5*(this.target.stretchBounds.minX+this.target.stretchBounds.maxX),.5*(this.target.stretchBounds.minY+this.target.stretchBounds.maxY)),y=r.width/(this.target.stretchBounds.maxX-this.target.stretchBounds.minX),M=r.height/(this.target.stretchBounds.maxY-this.target.stretchBounds.minY),T=g.c.generateMatrix().translate(-f.x,-f.y),b=g.c.generateMatrix().scale(y,M),C=g.c.generateMatrix().translate(d.x,d.y).crossProduct(b.crossProduct(T));for(let e of this.target.nodes){let n=this.stretchNodePropMap.get(e.id);if(n){if(e instanceof c.F||e instanceof w.W){let r=C.crossPoint(new l.E(n.x,n.y));e.parent&&(r=e.parent.toLocalPoint(r));let o=n.w*y,a=n.h*M,s={x:r.x,y:r.y,width:o,height:a,type:u.d.Base},d=this.stretchNodePropMap.get(e.id),c=[];d&&(c=(0,P.uk)({node:e,targetWidth:o,originBorderWidth:d.borderWidth,originalWidth:d.w}));let h=[s,...c],p=new i.x({id:e.id,props:h});t.actionManager.execAction(p)}else if(e instanceof h.s){if(e.attachProps.start.id||e.attachProps.end.id)continue;let r=[];for(let e of n.points){let t=C.crossPoint(e);r.push(t)}let o={points:r,type:u.d.Line},a=new i.x({id:e.id,props:[o]});t.actionManager.execAction(a)}}}(0,x.X$)(this.relatedLines,t),this.lastWorkSize.x=r.width,this.lastWorkSize.y=r.height,this.removeAuxiliaryGraphics(t),this.updateCommentPos(t,!1)}onUp(e,t){for(let e of this.target.nodes)e.isCached()&&e.refreshCache().then(()=>{t.renderManager.addContentDrawTask()});t.actionManager.execAction(new o.q),t.refreshSelectStatus(),this.updateCommentPos(t,!0),this.target=null,this.relatedLines=[],this.lastWorkSize.x=0,this.lastWorkSize.y=0,this.originPos.x=0,this.originPos.y=0,this.originWidthHeightRatio=1,this.stretchNodePropMap.clear()}removeAuxiliaryGraphics(e){e.removeAuxiliaryGraphic(f.T.ConnectAnchor),e.removeAuxiliaryGraphic(f.T.StretchRect),e.removeAuxiliaryGraphic(f.T.SelectShapeExpand),e.removeAuxiliaryGraphic(f.T.RotateIcon)}updateCommentPos(e,t){if(0!==this.relatedComments.size)for(let[n,i]of this.relatedComments){let r=n.globalBaseProps;for(let o of i){let i=o.scaleX*r.width,a=o.scaleY*r.height,l={act:1,commentID:o.comment.commentID,nodeID:n.id,x:i,y:a};e.actionManager.execUnOrderAction({type:y.U.Comment,data:l},t)}}}}var b=n(867953);class C extends b.W{constructor(){super([new T])}streamEnable(e,t){let n=t.getDetector(d.c.Stretch);return!!n?.detect(t.lastDiffTypeEvent,t)&&(t.inputManager.blur(),!0)}}},972680:function(e,t,n){n.d(t,{Dy:()=>h,NR:()=>g,Xr:()=>u,tR:()=>p,uI:()=>x,uk:()=>c});var i=n(797615),r=n(889171),o=n(202146),a=n(976780),l=n(525619),s=n(581974),d=n(138743);let c=({node:e,targetWidth:t,originBorderWidth:n,originalWidth:i})=>{let r=[];if(e instanceof o.W){let{themeProps:o}=e,l=e.getProp(a.d.Border);r.push({...o,borderHighPrecisionWidth:n*t/i}),l&&r.push({...l,borderWidth:n*t/i})}return r},h=({node:e,originalWidth:t,targetWidth:n})=>{if(e.type!==i.Jq.Text||n===t)return;let{sizeMode:r}=e.textProps;if(r===d.A.AUTO_WIDTH)return{type:a.d.Text,sizeMode:d.A.AUTO_HEIGHT}},p=({targetNode:e,stretchType:t,isUniform:n,deltaY:i,deltaX:r,originWidthHeightRatio:o})=>{let a=e.x,l=e.y,d=e.width,c=e.height;switch(t){case s.j.BOTTOM:e.height+=i,n&&0!==c&&(e.width=e.height*o,e.x=a+d/2-e.width/2);break;case s.j.LEFT:if(e.x+=r,e.width-=r,n&&0!==d){let t=e.width/o;e.y=l+c/2-t/2,e.height=t}break;case s.j.RIGHT:if(e.width+=r,n&&0!==d){let t=e.width/o;e.y=l+c/2-t/2,e.height=t}break;case s.j.TOP:if(e.y+=i,e.height-=i,n&&0!==c){let t=e.height*o;e.x=a+d/2-t/2,e.width=t}break;case s.j.BOTTOM_LEFT:if(e.height+=i,e.x+=r,e.width-=r,n){let t=e.height*o,n=e.width/o;o<1?(e.width=t,e.x=a+d-e.width):e.height=n}break;case s.j.BOTTOM_RIGHT:e.height+=i,e.width+=r,n&&(o<1?e.width=e.height*o:e.height=e.width/o);break;case s.j.TOP_LEFT:if(e.y+=i,e.height-=i,e.x+=r,e.width-=r,n){let t=e.height*o,n=e.width/o;o<1?e.width=t:e.height=n,e.x=a+d-e.width,e.y=l+c-e.height}break;case s.j.TOP_RIGHT:e.y+=i,e.height-=i,e.width+=r,n&&(o<1?e.width=e.height*o:e.height=e.width/o,e.y=l+c-e.height)}return e},g=e=>{let{targetNode:t,isUniform:n,stretchType:i,originWidthHeightRatio:r,minStretchSize:o}=e;if((n&&r>1||!n)&&t.width<o.x){let e=o.x-t.width;if(t.width=o.x,(i===s.j.LEFT||i===s.j.TOP_LEFT||i===s.j.BOTTOM_LEFT)&&(t.x=t.x-e),n){let e=t.width/r,n=e-t.height;(i===s.j.TOP||i===s.j.TOP_LEFT||i===s.j.TOP_RIGHT)&&(t.y=t.y-n),t.height=e}}if((n&&r<1||!n)&&t.height<o.y){let e=o.y-t.height;if(t.height=o.y,(i===s.j.TOP||i===s.j.TOP_LEFT||i===s.j.TOP_RIGHT)&&(t.y=t.y-e),n){let e=t.height*r,n=e-t.width;(i===s.j.LEFT||i===s.j.TOP_LEFT||i===s.j.BOTTOM_LEFT)&&(t.x=t.x-n),t.width=e}}return t};function u(e){switch(e){case s.j.TOP:case s.j.BOTTOM:return l.d.Y;case s.j.LEFT:case s.j.RIGHT:return l.d.X;case s.j.TOP_LEFT:case s.j.TOP_RIGHT:case s.j.BOTTOM_LEFT:case s.j.BOTTOM_RIGHT:default:return l.d.XY}}function x(e,t,n){switch(e){case s.j.TOP:return new r.E(0,t.y-n.minY);case s.j.BOTTOM:return new r.E(0,t.y-n.maxY);case s.j.LEFT:return new r.E(t.x-n.minX,0);case s.j.RIGHT:return new r.E(t.x-n.maxX,0);case s.j.TOP_LEFT:return new r.E(t.x-n.minX,t.y-n.minY);case s.j.TOP_RIGHT:return new r.E(t.x-n.minX,t.y-n.maxY);case s.j.BOTTOM_LEFT:return new r.E(t.x-n.maxX,t.y-n.minY);case s.j.BOTTOM_RIGHT:default:return new r.E(t.x-n.maxX,t.y-n.maxY)}}},963370:function(e,t,n){n.d(t,{E:()=>r}),n(808687),n(581974);var i=n(797615);let r=new Set([i.Jq.Connector,i.Jq.MindMapNode,i.Jq.Activation])},581974:function(e,t,n){n.d(t,{j:()=>r}),n(805433),n(808687);var i,r,o=n(797615);(i=r||(r={}))[i.TOP=0]="TOP",i[i.LEFT=1]="LEFT",i[i.BOTTOM=2]="BOTTOM",i[i.RIGHT=3]="RIGHT",i[i.TOP_LEFT=4]="TOP_LEFT",i[i.TOP_RIGHT=5]="TOP_RIGHT",i[i.BOTTOM_LEFT=6]="BOTTOM_LEFT",i[i.BOTTOM_RIGHT=7]="BOTTOM_RIGHT",o.Jq.Connector,o.Jq.Activation},972443:function(e,t,n){n.d(t,{a:()=>a});var i=n(828226),r=n(255078),o=n(78485);class a extends i.X{lastPoint=null;devicePixelRatio=1;onStart(e,t){this.lastPoint=e.clientPoint,this.devicePixelRatio=window.devicePixelRatio,t.setCursor("grabbing")}onMove(e,t){let n=e.clientPoint,i=(n.x-this.lastPoint.x)*this.devicePixelRatio,a=(n.y-this.lastPoint.y)*this.devicePixelRatio;r.I.scroll(-i,-a,t.gmlRender),r.I.scroll(-i,-a,t.auxiliaryCtx.gmlRender),this.lastPoint=e.clientPoint,t.renderManager.addContentDrawTask(),t.renderManager.addAuxiliaryDrawTask(),t.inputManager.editTextInfo&&t.inputManager.updateEditPositionCursor(),t.commentManager.refreshAllCommentShowInfo();let l=t.commentManager.getAllCommentShowMessage();t.auxiliaryManager.addOrUpdateAuxiliaryDomState(o.l.ShowCommentPins,l)}onUp(e,t){t.setCursor("grab"),this.lastPoint=null}}},6961:function(e,t,n){n.d(t,{h:()=>b});var i=n(797615),r=n(976780),o=n(873411),a=n(508241),l=n(873225),s=n(793720),d=n(889171),c=n(937093),h=n(891763),p=n(107671);let g={isBoundsFree(e,t){let n=e.search(t);return 0===n.length||n.every(e=>p.R.getTypeWithId(e.id)===i.Jq.Connector)},find(e,t,n){let{tree:i,mode:r="vertical",padding:o=0}=n;if(!i)return null;let a={id:"target-bound",minX:e.x,minY:e.y,maxX:e.x+t.x,maxY:e.y+t.y},l=99;if("vertical"===r){let e=a.minY,n=a.maxY,r=!0;for(;!this.isBoundsFree(i,a);){if(l<=0)return null;l--,r?(a.minY=e-t.y-o,e=a.minY):(a.minY=n+o,n=a.minY+t.y),a.maxY=a.minY+t.y,r=!r}return a}{let e=a.minX,n=a.maxX,r=!0;for(;!this.isBoundsFree(i,a);){if(l<=0)return null;l--,r?(a.minX=e-t.x-o,e=a.minX):(a.minX=n+o,n=a.minX+t.x),a.maxX=a.minX+t.x,r=!r}return a}}};var u=n(548187),x=n(15544),f=n(649356),y=n(347250),P=n(268283),w=n(931425),m=n(117866),M=n(150630),T=n(71039);let b={shouldShowPreview:e=>e.type===i.Jq.CompositeShape,getSnapTo(e){switch(e){case M.V.TOP:return i.Tq.SNAPTO_TOP;case M.V.BOTTOM:return i.Tq.SNAPTO_BOTTOM;case M.V.LEFT:return i.Tq.SNAPTO_LEFT;case M.V.RIGHT:default:return i.Tq.SNAPTO_RIGHT}},adjustSideByAngle:(e,t)=>t,getOppositeSide(e){switch(e){case M.V.TOP:return M.V.BOTTOM;case M.V.BOTTOM:return M.V.TOP;case M.V.LEFT:return M.V.RIGHT;case M.V.RIGHT:default:return M.V.LEFT}},findNearestNode:(e,t)=>e.length?e.sort((e,n)=>{let i=e.getBounds(),r=n.getBounds();switch(t){case M.V.TOP:return r.maxY-i.maxY;case M.V.BOTTOM:return i.minY-r.minY;case M.V.LEFT:return r.maxX-i.maxX;case M.V.RIGHT:default:return i.minX-r.minX}})[0]:null,findOffset(e,t,n){let r=n.nodeManager,o=r.getConnectedLines(e.id),a=this.getOppositeSide(t),l=[];for(let t of o){let{attachProps:n}=t;if(a===M.V.TOP){if(!(0,u._5)(t.id,r))continue;else if(n.start.id===e.id&&n.start.snapTo!==i.Tq.SNAPTO_TOP)continue;else if(n.end.id===e.id&&n.end.snapTo!==i.Tq.SNAPTO_TOP)continue}else if(a===M.V.BOTTOM){if(!(0,u._5)(t.id,r))continue;else if(n.start.id===e.id&&n.start.snapTo!==i.Tq.SNAPTO_BOTTOM)continue;else if(n.end.id===e.id&&n.end.snapTo!==i.Tq.SNAPTO_BOTTOM)continue}else if(a===M.V.LEFT){if(!(0,u.b8)(t.id,r))continue;else if(n.start.id===e.id&&n.start.snapTo===i.Tq.SNAPTO_LEFT)continue;else if(n.end.id===e.id&&n.end.snapTo===i.Tq.SNAPTO_LEFT)continue}else if(a===M.V.RIGHT){if(!(0,u.b8)(t.id,r))continue;else if(n.start.id===e.id&&n.start.snapTo===i.Tq.SNAPTO_RIGHT)continue;else if(n.end.id===e.id&&n.end.snapTo===i.Tq.SNAPTO_RIGHT)continue}l.push(t)}return l.length&&Math.min(...l.map(e=>(0,u.yT)(e.id,r)))||120},findPosition(e,t,n){let i=this.findOffset(e,t,n),r=e.getBounds(),a=r.maxY-r.minY,l=r.maxX-r.minX,s=new d.E(l,a),c=new d.E(r.minX,r.minY);switch(t){case M.V.TOP:c.y=r.minY-i-a;break;case M.V.BOTTOM:c.y=r.maxY+i;break;case M.V.LEFT:c.x=r.minX-i-l;break;case M.V.RIGHT:default:c.x=r.maxX+i}let h=g.find(c,s,{tree:n.nodeManager.tree,mode:t===M.V.LEFT||t===M.V.RIGHT?"vertical":"horizontal",padding:40}),p=new o.s;return h&&(p.x=h.minX,p.y=h.minY,p.width=l,p.height=a),p},findDirectConnectNode(e,t,n){let r=e.getBounds(),o=120+(r.maxY-r.minY)/2,a=120+(r.maxX-r.minX)/2,l={...r,id:"hot-bound"};switch(t){case M.V.TOP:l.minY=r.minY-o;break;case M.V.BOTTOM:l.maxY=r.maxY+o;break;case M.V.LEFT:l.minX=r.minX-a;break;case M.V.RIGHT:default:l.maxX=r.maxX+a}let s=n.nodeManager.tree.search(l),d=[];for(let o of s){if(o.id===e.id)continue;let a=n.nodeManager.nodeMap.get(o.id);if(a.type===i.Jq.Connector||(0,u.RU)(e.id,o.id,n.nodeManager))continue;let l=a.getBounds();if(t!==M.V.TOP||!(l.maxY>=r.minY)){if(t===M.V.BOTTOM&&l.minY<=r.maxY)continue;if(t===M.V.LEFT&&l.maxX>=r.minX)continue;else if(t===M.V.RIGHT&&l.minX<=r.maxX)continue;d.push(a)}}return d.length?this.findNearestNode(d,t):null},link(e,t,n,o){let a=this.getSnapTo(o),l=t.getConnectAnchors().find(e=>e.side===o),s=t.getLineAttachPoint(l.position),c=this.getOppositeSide(o),h=this.getSnapTo(c),p=n.getConnectAnchors().find(e=>e.side===c),g=n.getLineAttachPoint(p.position),u=e.props.find(e=>e.type===r.d.Base);u.x=Math.min(s.x,g.x),u.y=Math.min(s.y,g.y),u.width=Math.abs(s.x-g.x),u.height=Math.abs(s.y-g.y);let f=e.props.find(e=>e.type===r.d.Line);if(f.points=[new d.E(s.x-u.x,s.y-u.y)],Math.abs(s.x-g.x)>x.YE||Math.abs(s.y-g.y)>x.YE)if(o===M.V.LEFT||o===M.V.RIGHT){let e=(s.x+g.x)/2;f.points.push(new d.E(e-u.x,s.y-u.y)),f.points.push(new d.E(e-u.x,g.y-u.y))}else{let e=(s.y+g.y)/2;f.points.push(new d.E(s.x-u.x,e-u.y)),f.points.push(new d.E(g.x-u.x,e-u.y))}f.points.push(new d.E(g.x-u.x,g.y-u.y));let y=e.props.find(e=>e.type===r.d.LineBorder);f.padding={left:(0,m.XN)(y.lArrow,t.shapeType),right:(0,m.XN)(y.rArrow,n.shapeType)};let w=new P.j;return w.start={id:t.id,snapTo:a,attachType:i.J3.MAGNET_ANCHOR,position:l.position},w.end={id:n.id,snapTo:h,attachType:i.J3.MAGNET_ANCHOR,position:p.position},w},updateId(e,t,n,i){if(e.id=n,!t)return;let o=t.id;t.id=i;let a=e.props.find(e=>e.type===r.d.LineAttach);a?.start.id===o&&(a.start.id=i),a?.end.id===o&&(a.end.id=i)},createPreviewLineDO(e){let t=y.j.generateDefaultNodeDO("c--connect-anchor-preview-line",i.Jq.Connector),n={globalTheme:e.docState.globalTheme,isDark:e.docState.isDark},r=new o.s,d=new a.F,p=y.j.createShapeColorProps(d,f.l.CONNECT,n),g=y.j.createShapeBorderProps(d,f.l.CONNECT,n),u=new T.m;u.update({...g,lArrow:s.Y.None,rArrow:s.Y.LINE_ARROW});let x=new l.o([],c.SP.PolyLine),P=new h.l;return t.type=i.Jq.Connector,t.props.push(r),t.props.push(x),t.props.push(P),t.props.push(u),t.props.push(d),t.props.push(p),t},cloneGraphicNode(e,t,n){let o=`${e.id[0]}-connect-anchor-preview-node`,a=y.j.generateDefaultNodeDO(o,e.type);for(let t of[r.d.Border,r.d.Color,r.d.Img,r.d.Svg,r.d.TextTransform,r.d.ShapeType,r.d.Theme,r.d.ImgCrop,r.d.Flip,r.d.Title,r.d.Opacity]){let n=e.getProp(t);n&&a.props.push(n.clone())}if(e.type===i.Jq.StickyNote){let t=e.getProp(r.d.StickyNote).clone(),i=n.docState.getAuthorInfo();t.showAuthor&&i?.avatarUrl&&i?.name?t.authorInfo={name:i.name,avatarUrl:i.avatarUrl}:t.showAuthor=!1,a.props.push(t)}return a.zIndex=n.idGenerator.genZIndex(),a},createDOByNodeSide(e,t,n){let i=this.adjustSideByAngle(e,t),r=this.cloneGraphicNode(e,i,n),o=e.baseProps.clone();switch(i){case M.V.TOP:o.y=o.y-o.height-40;break;case M.V.BOTTOM:o.y=o.y+o.height+40;break;case M.V.LEFT:o.x=o.x-o.width-40;break;case M.V.RIGHT:default:o.x=o.x+o.width+40}return r.props.push(o),r},createConnect2NodeDOByNodeSide(e,t,n){let i=this.adjustSideByAngle(e,t),r=this.createPreviewLineDO(n),o=this.findDirectConnectNode(e,i,n),a=null,l=null;if(o)l=o;else{a=this.cloneGraphicNode(e,i,n);let t=this.findPosition(e,i,n);a.props.push(t),(l=new w.F(a.id,n.auxiliaryCtx.gmlRender.canvas.getContext("2d"))).updateNodeProps(a.props)}let s=this.link(r,e,l,i);return r.props.push(s),[r,a]},createConnect2NodeDOByNodeSideWithRealId(e,t,n){let[r,o]=this.createConnect2NodeDOByNodeSide(e,t,n);return this.updateId(r,o,n.idGenerator.genId(i.Jq.Connector),o?n.idGenerator.genId(e.type):""),[r,o]}}},968531:function(e,t,n){n.d(t,{$x:()=>M,E5:()=>T,Uw:()=>S,h4:()=>C,hR:()=>b,ic:()=>w,sU:()=>m});var i=n(797615),r=n(889171),o=n(501458),a=n(937093),l=n(873411),s=n(873225),d=n(508241),c=n(188893),h=n(805433),p=n(6961),g=n(347250),u=n(592235),x=n(117866),f=n(71039),y=n(793720),P=n(649356);let w=e=>{let{node:t,attachInfo:n}=e,r=n.connectAnchor?n.connectAnchor.position:t.getLineAttachPosition(n.point);return{attachType:n.connectAnchor?i.J3.MAGNET_ANCHOR:i.J3.CONTOUR,snapTo:n.connectAnchor?p.h.getSnapTo(n.connectAnchor.side):i.Tq.SNAPTO_AUTO,position:r,id:t.id}},m=e=>{let{node:t,side:n}=e,r=t.getConnectAnchors().find(e=>e.side===n);return{attachType:i.J3.MAGNET_ANCHOR,snapTo:p.h.getSnapTo(n),position:r.position,id:t.id}},M=(e,t,n)=>{let c=new l.s;c.x=t.x,c.y=t.y,c.width=0,c.height=0;let h=new s.o([new r.E,new r.E],e);[a.SP.PolyLine,a.SP.RightAngledPolyLine,a.SP.Curve].includes(e)&&h.points.push(new r.E,new r.E);let p=new d.F,u=g.j.createShapeColorProps(p,P.l.CONNECT,n),x=o.M.convertShapeCategory(i.Jq.Connector),w=g.j.createShapeBorderProps(p,x,n),m=new f.m;return m.update({...w,lArrow:y.Y.None,rArrow:y.Y.LINE_ARROW}),[c,h,m,u,p]},T=(e,t,n)=>({id:t,type:i.Jq.Connector,zIndex:n,props:e}),b=(e,t,n,r={snapTo:i.Tq.SNAPTO_AUTO,attachType:i.J3.ATTACH_NONE},o)=>{let a=e.attachProps.clone();o?a.start=r:a.end=r;let l=e.toLocalPoint(t),s=e.lineProps.clone();return s.points=(0,c.Q5)(e,{attachType:a.start.attachType,snapTo:a.start.snapTo,point:o?l:s.points[0],node:n.nodeMap.get(a.start.id)},{attachType:a.end.attachType,snapTo:a.end.snapTo,point:o?s.points[s.points.length-1]:l,node:n.nodeMap.get(a.end.id)}),[...C(e,s),a]},C=(e,t)=>{let{globalBaseProps:n}=e,i=h.G.getBoundsByPoints(t.points),o=new r.E(i.minX,i.minY),a=e.baseProps.clone();a.x=n.x+o.x,a.y=n.y+o.y,a.width=i.maxX-i.minX,a.height=i.maxY-i.minY;let l=h.G.findNoGroupParent(e);return l&&(a.x=a.x-l.globalBaseProps.x,a.y=a.y-l.globalBaseProps.y),t.points=t.points.map(e=>(e.x-=o.x,e.y-=o.y,e)),[a,t]},S=(e,t)=>{let{subTool:n}=t.toolManager.currentTool,c=u.gA[n],h=0,p=0,y=new l.s;y.x=e.x,y.y=e.y,c.lineType===a.SP.SimpleLine?p=h=u.AN/Math.sqrt(2):(h=u.A_,p=u.KK),y.width=h,y.height=p;let P=new r.E(0,p),w=new r.E(h,0),m=(0,x.N1)(c.lineType,P,w),M=new s.o(m,c.lineType),b=new f.m;b.update({lArrow:c.lArrow,rArrow:c.rArrow});let C=new d.F;C.update({connectStyleCode:c.dashType,connectTypeCode:c.lineType,connectWidthCode:a.P7.THIN});let S=o.M.convertShapeCategory(i.Jq.Connector),A=g.j.createShapeBorderProps(C,S,{globalTheme:t.docState.globalTheme,isDark:t.docState.isDark});return b.update({...A}),T([y,M,b,C],t.idGenerator.genFakeId(i.Jq.Connector),0)}},347250:function(e,t,n){n.d(t,{j:()=>H});var i=n(508241),r=n(649356),o=n(596500),a=n(459037),l=n(965732),s=n(873411),d=n(797615),c=n(501458),h=n(995363),p=n(976780),g=n(889171),u=n(561347),x=n(335342),f=n(138743),y=n(567524),P=n(224365),w=n(915602),m=n(272348),M=n(624905),T=n(797379),b=n(205186),C=n(136713),S=n(409397),A=n(29725),v=n(566103),E=n(873225),R=n(937093),N=n(793720),I=n(891763),B=n(268283),O=n(107671),D=n(180354),L=n(487570),G=n(973042);let H={createIconPreviewProps(e,t){let{iconSourceInfo:n}=e.toolManager.currentTool,{isDark:i,globalTheme:r}=e.docState;return n?(0,D.N)({point:t,globalTheme:r,isDark:i,iconSourceInfo:n}):[]},createShapeColorProps(e,t,n){let i=a.f.getInstance().getFillInfo(e,t,n),r=new o.b;return r.color=i.color,r.alpha=i.alpha,r},createShapeBorderProps(e,t,n){let i=a.f.getInstance().getBorderInfo(e,t,n),r=new l.L;return r.borderColor=i.color,r.borderWidth=i.width,r.borderAlpha=i.alpha,r.lineDashType=i.dashType,r},createShapeBaseProps(e,t,n,i){let r=new s.s;return r.x=n,r.y=i,r.width=e,r.height=t,r},createPreviewProps(e,t,n,r,o){let a=c.M.convertShapeCategory(d.Jq.CompositeShape,e),l={globalTheme:o.docState.globalTheme,isDark:o.docState.isDark},s=new i.F,p=o.auxiliaryManager.globalConfig.shapeDescriptionConfig[e]??S.m6,g=[s,this.createShapeBaseProps(p.defaultWidth,p.defaultHeight,t,n)],x=this.createShapeColorProps(s,a,l),f=this.createShapeBorderProps(s,a,l);return x.alpha=r,f.borderAlpha=r,g.push(x),g.push(f),g.push(new h.M(e)),g.push(new u.l),g.push(new w.j),g},setOpacity(e,t){let n=e.find(e=>e.type===p.d.Color),i=e.find(e=>e.type===p.d.Border);n&&(n.alpha=t),i&&(i.borderAlpha=t)},generateDefaultNodeDO:(e,t)=>({id:e,type:t,zIndex:0,props:[]}),createTextProps(e,t,n){let i=a.f.getInstance().getTextColorInfo(e,t,n),r=new u.l;return r.verticalAlign=x.Z.CENTER,r.horizonAlign=x.Z.CENTER,r.sizeMode=f.A.FIXED,r.fontColor=i.color,r.backgroundColor=i.bgColor,r},createCompositeAddData(e,t,n,r,o,a=!1){let l=c.M.convertShapeCategory(d.Jq.CompositeShape,r),s=new i.F,p=H.generateDefaultNodeDO(e,d.Jq.CompositeShape);p.zIndex=n,p.props.push(new h.M(r)),p.props.push(t),p.props.push(s);let g={globalTheme:o,isDark:a};return p.props.push(H.createShapeColorProps(s,l,g)),p.props.push(H.createShapeBorderProps(s,l,g)),p.props.push(this.createTextProps(s,l,g)),p},createTableAddData(e,t,n,r=!1){let o=[],a=O.R.getTypeWithId(e),l=new i.F,h=c.M.convertShapeCategory(d.Jq.Table),p={globalTheme:n,isDark:r};return o.push(new s.s),o.push(H.createShapeBorderProps(l,h,p)),o.push(H.createShapeColorProps(l,h,p)),o.push(new u.l),o.push(new m.N),a===d.Jq.TableER&&o.push(new b.K),a===d.Jq.TableUML&&o.push(new G.V),o.push(new P._),o.push(new w.j),o.push(new i.F),o.push(H.createTextProps(l,h,p)),{id:e,type:a,zIndex:t,props:o}},createTablePreviewProps(e,t,n,i,r=1){let o=e.toolManager.currentTool.subTool,a=e.auxiliaryManager.globalConfig.tableDescriptionConfig[o];a||(a=S.YO);let{rows:l,columns:s}=S.YO,{globalTheme:d,isDark:c}=e.docState,h=s.reduce((e,t)=>e+t,0),g=l.reduce((e,t)=>e+t,0),{props:u}=H.createTableAddData(n,i,d,c);for(let n of u){if(n.type===p.d.Base){n.x=t.x,n.y=t.y,n.width=h,n.height=g;continue}n.type===p.d.Theme&&(n.borderWidthCode=S.YO.borderWidthCode,n.borderStyleCode=S.YO.borderStyleCode),n.type===p.d.Border&&(n.borderWidth=1,n.borderAlpha=r),n.type===p.d.Text&&(n.horizonAlign=x.Z.TOP_OR_LEFT,n.verticalAlign=x.Z.TOP_OR_LEFT,n.sizeMode=f.A.AUTO_HEIGHT),n.type===p.d.Table&&this.modifyTableProps(e,n,a)}return u},createTableERPreviewProps(e,t,n,i,r=1){let o=e.toolManager.currentTool.subTool,a=e.auxiliaryManager.globalConfig.erDescriptionConfig[o],{columns:l,rows:s}=a,{globalTheme:d,isDark:c}=e.docState,h=l.reduce((e,t)=>e+t,0),g=s.reduce((e,t)=>e+t,0),{props:u}=H.createTableAddData(n,i,d,c);for(let n of u){if(n.type===p.d.Base){n.x=t.x-h/2,n.y=t.y-g/2,n.width=h,n.height=g;continue}if(n.type===p.d.Border){n.borderWidth=a.borderWidth,n.borderAlpha=r;continue}if(n.type===p.d.Text){n.horizonAlign=a.horizonAlign,n.verticalAlign=a.verticalAlign,n.sizeMode=f.A.AUTO_WIDTH;continue}if(n.type===p.d.Theme){n.fillColorCode=a.fillColorCode,n.borderWidthCode=a.borderWidthCode,n.borderStyleCode=a.borderStyleCode;continue}n.type===p.d.TableER&&(n.erType=o),n.type===p.d.Table&&this.modifyTableProps(e,n,a)}return u},createTableUMLPreviewProps(e,t,n,i,r=1){let o=e.toolManager.currentTool.subTool,a=e.auxiliaryManager.globalConfig.umlDescriptionConfig[o],{columns:l,rows:s}=a,{globalTheme:d,isDark:c}=e.docState,h=l.reduce((e,t)=>e+t,0),g=s.reduce((e,t)=>e+t,0),{props:u}=H.createTableAddData(n,i,d,c);for(let n of u){if(n.type===p.d.Base){n.x=t.x-h/2,n.y=t.y-g/2,n.width=h,n.height=g;continue}if(n.type===p.d.Border){n.borderWidth=a.borderWidth,n.borderAlpha=r;continue}if(n.type===p.d.Text){n.horizonAlign=a.horizonAlign,n.verticalAlign=a.verticalAlign,n.sizeMode=f.A.AUTO_WIDTH;continue}if(n.type===p.d.Theme){n.fillColorCode=a.fillColorCode,n.borderWidthCode=a.borderWidthCode,n.borderStyleCode=a.borderStyleCode;continue}n.type===p.d.TableUML&&(n.umlType=o,n.propertyNum=a.propertyNum),n.type===p.d.Table&&this.modifyTableProps(e,n,a)}return u},modifyTableProps(e,t,n){let{globalTheme:r,isDark:o}=e.docState,{columns:l,rows:s}=n;t.columns=n.columns,t.rows=n.rows;let{cellMatrix:h}=t,p=0;for(let n=0;n<t.rows.length;n++){let i=[],r=0;for(let o=0;o<t.columns.length;o++){let t=H.createTableCell(e,n,o,r,p,l[o],s[n],"");t.overrideCell=!1,i.push(t),r+=l[o]}h.cells.push(i),p+=s[n]}n.tableCell.forEach(e=>{let{i:t,j:n,defaultText:l,fontSize:s,bold:p,fillColorCode:g,horizonAlign:x,verticalAlign:f,rowSpan:y,colSpan:P}=e,w=h.getCell(t,n);if(w&&(l&&(w.textProps||(w.textProps=new u.l),w.textProps.text=l,w.textProps.fontSize=s,void 0!==x&&(w.textProps.horizonAlign=x),void 0!==f&&(w.textProps.verticalAlign=f),p&&(w.textProps.bold=p)),y&&P&&(w.rowSpan=y,w.colSpan=P),g)){let e=c.M.convertShapeCategory(d.Jq.Table),t=new i.F;t.fillColorCode=g,w.color=a.f.getInstance().getFillInfo(t,e,{globalTheme:r,isDark:o}).color,w.themeProps=t}})},createTableCell(e,t,n,r,o,l,h,p,g=1,x=1,f=1){let{globalTheme:m,isDark:M}=e.docState,T=new y.V(t,n);if(p){let e=new u.l;e.text=p,e.fontSize=18,T.textProps=e}T.textTransformProps=new P._;let b=new s.s;b.x=r,b.y=o,b.width=l,b.height=h,T.tableBaseProps=b,T.rowSpan=g,T.colSpan=x,T.alpha=f;let C=new i.F;C.fillColorCode=g>1||x>1?8:-1;let S=c.M.convertShapeCategory(d.Jq.Table),A=a.f.getInstance().getFillInfo(C,S,{globalTheme:m,isDark:M});return T.color=g>1||x>1?A.color:"",T.themeProps=C,T.opacityProps=new w.j,T},createLifeLinePreviewProps(e,t,n,i,r=1){let o=e.toolManager.currentTool.subTool,a=e.auxiliaryManager.globalConfig.lifelineDescriptionConfig[o],{globalTheme:l,isDark:s}=e.docState,{props:d}=H.createTimeSequenceAddData(n,i,o,l,s);for(let e of d){if(e.type===p.d.Base){e.x=t.x,e.y=t.y-e.height/2,e.width=a.lifelineWidth,e.height=a.lifelineHeight;continue}if(e.type===p.d.Lifeline){e.lifelineLength=a.lifelineLength;continue}if(e.type===p.d.ShapeType){e.shapeCode=o,e.controlPoints=[];continue}if(e.type===p.d.Text){e.horizonAlign=x.Z.CENTER,e.verticalAlign=x.Z.CENTER,e.text=a.defaultText,e.sizeMode=f.A.AUTO_HEIGHT;continue}if(e.type===p.d.Border){e.borderWidth=2,e.borderAlpha=r;continue}e.type===p.d.Theme&&(e.borderColorCode=1,e.borderStyleCode=1)}return d},createTimeSequenceAddData(e,t,n,r,o=!1){let a=[],l=new i.F,p=c.M.convertShapeCategory(d.Jq.LifelineObject,n),g={globalTheme:r,isDark:o};return a.push(new s.s),a.push(H.createShapeColorProps(l,p,g)),a.push(H.createShapeBorderProps(l,p,g)),a.push(H.createTextProps(l,p,g)),a.push(new h.M),a.push(l),a.push(new M.I),{id:e,type:d.Jq.LifelineObject,zIndex:t,props:a}},createStickyTextWithDefaultValue(e){let t=new u.l;return t.text=e,t.verticalAlign=x.Z.CENTER,t.horizonAlign=x.Z.CENTER,t.sizeMode=f.A.AUTO_HEIGHT,t},createStickyNodeProps({ctx:e,position:t,fillColorCode:n,opacity:r}){let o=[],a=new s.s;a.update({x:t.x,y:t.y,width:160,height:160}),o.push(a);let l=new i.F;l.update({fillColorCode:n}),o.push(l);let h=c.M.convertShapeCategory(d.Jq.StickyNote),p={globalTheme:e.docState.globalTheme,isDark:e.docState.isDark},g=this.createShapeColorProps(l,h,p);g.alpha=r,o.push(g),o.push(this.createStickyTextWithDefaultValue(""));let u=new A.r,x=e.docState.getAuthorInfo();return x?.id&&x.avatarUrl&&x.name?u.update({showAuthor:!0,authorInfo:{id:x.id,avatarUrl:x.avatarUrl,name:x.name}}):u.update({showAuthor:!1}),o.push(u),o},createSectionPreviewProps(e,t,n=1){let r=[],o=e.toolManager.currentTool.subTool,a=e.auxiliaryManager.globalConfig.sectionDescriptionConfig[o],l=H.createSectionBaseProps(e,o,t),s=c.M.convertShapeCategory(d.Jq.Section),h={globalTheme:e.docState.globalTheme,isDark:e.docState.isDark},p=new i.F,g=H.createShapeColorProps(p,s,h),u=H.createShapeBorderProps(p,s,h),x=H.createTextProps(p,s,h);g.alpha=n,u.borderAlpha=n,r.push(l),r.push(g),r.push(u),r.push(p);let f=new C.T;return f.fontColor=x.fontColor,f.fontBgColor=x.backgroundColor,f.titleBorderColor=u.borderColor,f.title=a?a.title:S.cL.title,r.push(f),r},findReferenceSection(e){let{nodeMap:t}=e.nodeManager,n=-1/0,i=null;for(let e of t.values())if(e.type===d.Jq.Section){let{baseProps:t}=e,r=t.x+t.width;r>n&&(n=r,i=e)}return i},createSectionBaseProps(e,t,n){let i=new s.s;if(i.x=n.x,i.y=n.y,t===T.Zv.custom){let t=H.findReferenceSection(e);return i.width=t?t.baseProps.width:S.cL.defaultWidth,i.height=t?t.baseProps.height:S.cL.defaultHeight,i}let r=e.auxiliaryManager.globalConfig.sectionDescriptionConfig[t]??S.cL;return i.width=r.defaultWidth,i.height=r.defaultHeight,i},createActivationProps(e,t,n){let r=new s.s;r.x=e,r.y=t,r.width=L.cO,r.height=L.VD;let o=new v.v;o.a=L.G8,o.b=L.G8,o.c=L.G8,o.d=L.G8;let a=new i.F,l=c.M.convertShapeCategory(d.Jq.Activation),p={globalTheme:n.docState.globalTheme,isDark:n.docState.isDark},g=this.createShapeColorProps(a,l,p),u=this.createShapeBorderProps(a,l,p);return[r,o,a,g,u,new h.M(T.DY.roundRect)]},createActivationAddData(e,t,n,r,o=!1){let a=[],l=new i.F,h=c.M.convertShapeCategory(d.Jq.Activation,n),p={globalTheme:r,isDark:o};return a.push(new s.s),a.push(H.createShapeColorProps(l,h,p)),a.push(H.createShapeBorderProps(l,h,p)),a.push(l),{id:e,type:d.Jq.Activation,zIndex:t,props:a}},createDefaultLineAddDataWithPoint(e,t){let n=`${O.R.type2NodePrefix(d.Jq.Connector)}_preview-line`,o=H.generateDefaultNodeDO(n,d.Jq.Connector),a=new s.s;a.x=e.x,a.y=e.y,a.width=0,a.height=0;let l={globalTheme:t.docState.globalTheme,isDark:t.docState.isDark},c=new i.F,h=H.createShapeColorProps(c,r.l.CONNECT,l),p=H.createShapeBorderProps(c,r.l.CONNECT,l),u=new E.o([],R.SP.SimpleLine,N.Y.None,N.Y.TRIANGLE_ARROW);u.points=[new g.E(e.x,e.y),new g.E(e.x,e.y)];let x=new B.j,f=new I.l;return o.type=d.Jq.Connector,o.props.push(a),o.props.push(c),o.props.push(h),o.props.push(p),o.props.push(u),o.props.push(x),o.props.push(f),o}}},304472:function(e,t,n){n.d(t,{G:()=>c});var i=n(800866),r=n(513665),o=n(771313),a=n(73428),l=n(976780),s=n(797615),d=n(457063);class c{static dragNodeRelationChange(e,t,n,a){let c=t.children.length,h=0;for(let p of e){if(p.parent!==t){let e=p.parent.children.indexOf(p),n=c+h,o={id:p.id,fromPath:p.getPath(),toPath:t.getPath(!0),fromIndex:e,toIndex:n},s=p.globalBaseProps,d=t.globalBaseProps,g={type:l.d.Base,x:s.x-d.x,y:s.y-d.y},u={id:p.id,props:[g]};a.actionManager.execAction(new i.h(o)),a.actionManager.execAction(new r.x(u))}if(t.type===s.Jq.Table){let{i:e,j:i}=a.detect(o.c.TableCell,n),r=t.tableProps.cellMatrix.getCell(e,i);if(r.children.includes(p.id))continue;let l=[...r.children];l.push(p.id);let s={i:e,j:i,children:l},c={id:t.id,infos:[s]};a.actionManager.execAction(new d.g(c))}h++}}static detectHoverOnLifeline(e,t,n){if(1!==e.length||e[0].type!==s.Jq.Activation)return null;let i=n.detect(o.c.ActivationLifeline,t);return i?i.lifeline:null}static detectHoverOnContainer(e,t,n){let i=n.getDetector(o.c.Node),r=new Set([...e]);if(i.detect(t,n)){for(let e of i.result)if(!r.has(e)){if(e.type===s.Jq.Section){let n=a.U.baseProps2Rect(e.globalBaseProps);if(a.U.contains(n,t.globalPoint))return e}if(e.type===s.Jq.Table){let n=a.U.baseProps2Rect(e.globalBaseProps);if(a.U.contains(n,t.globalPoint))return e}}}return null}static detect(e,t,n){let i;return(i=this.detectHoverOnLifeline(e,t,n))||(i=this.detectHoverOnContainer(e,t,n))?i:null}}},266096:function(e,t,n){n.d(t,{e:()=>s});var i=n(797615),r=n(39533),o=n(513665),a=n(678014),l=n(548187);class s{static updateLineProps(e,t){let n=(0,l.hB)(e,t.nodeManager),i=new o.x({id:e.id,props:n});t.actionManager.execAction(i)}static flattenChildNodes(e){let t=[];return e.type===i.Jq.DirectFocusGroup?e.children.forEach(e=>t.push(...this.flattenChildNodes(e))):e.type===i.Jq.Section||e.type===i.Jq.Table?(t.push(e),e.children.forEach(e=>t.push(...this.flattenChildNodes(e)))):t.push(e),t}static updateLines(e,t){e.forEach(e=>e.type===i.Jq.Connector?void this.updateLineProps(e,t):e.type===i.Jq.Section||e.type===i.Jq.Table?void this.flattenChildNodes(e).forEach(n=>{n.type===i.Jq.Connector?this.updateLineProps(e,t):t.nodeManager.getConnectedLines(n.id).forEach(e=>this.updateLineProps(e,t))}):void t.nodeManager.getConnectedLines(e.id).forEach(e=>this.updateLineProps(e,t)))}static nodeCanMove(e,t,n){if(e.lockedStatusProps.locked)return!1;if(e.type===i.Jq.Connector){let{attachProps:i}=e;if(!i.start.id||!i.end.id)return!0;let r=n.nodeMap.get(i.start.id),o=n.nodeMap.get(i.end.id);return!r||!o||t.every(e=>e.id===r.id||e.id===o.id)}return!0}static getMoveNodes=(e,t)=>{let n=r.C.getAllNodes(e),o=[];for(let e of n)this.nodeCanMove(e,n,t.nodeManager)&&o.push(e);return[...(0,r.X)(e),...o].forEach((e,n,r)=>{if(e.type===i.Jq.Connector)for(let n of t.nodeManager.getConnectedLines(e.id)){let{attachProps:t}=n;t.start.id&&t.end.id&&(t.start.id===e.id?-1!==r.findIndex(e=>e.id===t.end.id):-1!==r.findIndex(e=>e.id===t.start.id))&&(r.find(t=>e.parent?.id===t.id)||o.push(e))}}),a.v.sortGraphicsV2(o)}}},39533:function(e,t,n){n.d(t,{C:()=>r,X:()=>o});var i=n(797615);let r={getAllNodes(e){let t=[];for(let n of e)n.type===i.Jq.DirectFocusGroup?t.push(...this.getAllNodes(n.children)):t.push(n);return t}},o=e=>{let t=[];for(let n of e)n.type===i.Jq.DirectFocusGroup?t.push(...o(n.children)):(n.children.length>0&&t.push(...o(n.children)),t.push(n));return t}},180354:function(e,t,n){n.d(t,{N:()=>g});var i=n(649356),r=n(501458),o=n(873411),a=n(965732),l=n(742849),s=n(916207),d=n(635094),c=n(508241),h=n(799473),p=n(797615);function g(e){let{point:t,globalTheme:n,isDark:g,iconSourceInfo:u,opacity:x}=e,{defaultSize:f,iconSourceFormatEnum:y,iconInfo:P,iconSource:w}=u,m=[],M=new o.s;M.update({x:t.x,y:t.y,...f,isUniform:!0});let T=new c.F;if(m.push(M,T),y===h.c.IMAGE){let e=new s.x(P,p._u.FIT),t=new l.H;t.update({key:w.key,resourceType:w.type}),m.push(e,t)}else{let e=new d.K(P),t=r.M.buildSvgBorderAndFillProps({iconSourceType:w.type,category:w.type===p._g.PublicUniverseDesign?i.l.ICON_UD:i.l.ICON,theme:T,globalTheme:n,borderOpacity:x,fillOpacity:x,isDark:g});e.update(t),e.update({borderStyleItem:{lineWidth:2,position:1}});let o=new a.L,s=new l.H;s.update({key:w.key,resourceType:w.type}),m.push(e,o,s)}return m}},548187:function(e,t,n){n.d(t,{RU:()=>c,X$:()=>d,_5:()=>p,b8:()=>h,hB:()=>s,yT:()=>g});var i=n(188893),r=n(513665),o=n(797615),a=n(15544),l=n(968531);let s=(e,t)=>{let n,r,{attachProps:o}=e,a=e.lineProps.clone(),s=a.points[0];o.start.id&&(n=t.nodeMap.get(o.start.id)),n&&o.start.position&&(s=e.toLocalPoint(n.getLineAttachPoint(o.start.position))),o.end.id&&(r=t.nodeMap.get(o.end.id));let d=a.points[a.points.length-1];return r&&o.end.position&&(d=e.toLocalPoint(r.getLineAttachPoint(o.end.position))),a.points=(0,i.Q5)(e,{attachType:o.start.attachType,snapTo:o.start.snapTo,point:s,node:n},{attachType:o.end.attachType,snapTo:o.end.snapTo,point:d,node:r}),(0,l.h4)(e,a)},d=(e,t)=>{for(let n of e){let e=s(n,t.nodeManager),i=new r.x({id:n.id,props:e});t.actionManager.execAction(i)}},c=(e,t,n)=>{for(let i of n.getConnectedLines(e))if(i.attachProps.end.id===t)return!0;for(let i of n.getConnectedLines(t))if(i.attachProps.end.id===e)return!0;return!1},h=(e,t)=>{let n=t.nodeMap.get(e);if(!n||n.type!==o.Jq.Connector||!n.points?.length)return!1;let{y:i}=n.points[0];return n.points.every(e=>Math.abs(e.y-i)<a.YE)},p=(e,t)=>{let n=t.nodeMap.get(e);if(!n||n.type!==o.Jq.Connector||!n.points?.length)return!1;let{x:i}=n.points[0];return n.points.every(e=>Math.abs(e.x-i)<a.YE)},g=(e,t)=>{if(h(e,t)){let n=t.nodeMap.get(e).points.map(e=>e.x);return Math.max(...n)-Math.min(...n)}if(p(e,t)){let n=t.nodeMap.get(e).points.map(e=>e.y);return Math.max(...n)-Math.min(...n)}return 0}},988382:function(e,t,n){n.d(t,{P:()=>l});var i=n(797615),r=n(329568),o=n(567524),a=n(77375);class l{static findInsertIndex(e,t){if(!e||0===e.length)return -1;let n=0;if(t<0)return 0;for(let i=0;i<e.length;i++)if(t<(n+=e[i]))return i;return e.length}static isMergeCol(e,t,n=!1){if(t<0||t>=e.columns.length)return!1;let i=+!!n;for(let n=i;n<e.rows.length;n++){let i=e.cellMatrix.getCell(n,t);if(i.refCell.j!==t){let r=e.cellMatrix.getCell(n,i.refCell.j);if(t<i.refCell.j+r.colSpan-1)return!0}if(i.colSpan>1)return!0}return!1}static isMergeRow(e,t,n=!1){if(t<0||t>=e.rows.length)return!1;let i=+!!n;for(let n=i;n<e.columns.length;n++){let i=e.cellMatrix.getCell(t,n);if(i.refCell.i!==t){let r=e.cellMatrix.getCell(i.refCell.i,n);if(t<i.refCell.i+r.rowSpan-1)return!0}if(i.rowSpan>1)return!0}return!1}static computeMergedCol(e,t,n,i=0){n.add(t);for(let r=i;r<e.tableProps.rows.length;r++){let o=e.tableProps.cellMatrix.getCell(r,t);if(o.refCell.j!==t)for(let r=o.refCell.j;r<t;r++)n.has(r)||this.computeMergedCol(e,r,n,i);if(o.colSpan>1)for(let r=t+1;r<t+o.colSpan;r++)n.has(r)||this.computeMergedCol(e,r,n,i)}}static computeMergedRow(e,t,n,i=0){n.add(t);for(let r=i;r<e.tableProps.columns.length;r++){let o=e.tableProps.cellMatrix.getCell(t,r);if(o.refCell.i!==t)for(let r=o.refCell.i;r<t;r++)n.has(r)||this.computeMergedRow(e,r,n,i);if(o.rowSpan>1)for(let r=t+1;r<t+o.rowSpan;r++)n.has(r)||this.computeMergedRow(e,r,n,i)}}static convertTableStatusToSelectedMatrix(e,t,n){if(0===e.selectCells.length&&0===e.selectCols.length&&0===e.selectRows.length)return Array(t).fill(null).map(()=>Array(n).fill(!0));let i=Array(t).fill(null).map(()=>Array(n).fill(!1));return e.selectCells.forEach(e=>{e.i>=0&&e.i<t&&e.j>=0&&e.j<n&&(i[e.i][e.j]=!0)}),e.selectCols.forEach(e=>{if(e>=0&&e<n)for(let n=0;n<t;n++)i[n][e]=!0}),e.selectRows.forEach(e=>{if(e>=0&&e<t)for(let t=0;t<n;t++)i[e][t]=!0}),i}static getSelectedCellsFromTableStatus(e,t,n){if(0===e.selectCells.length&&0===e.selectRows.length&&0===e.selectCols.length){let e=[];for(let i=0;i<t;i++)for(let t=0;t<n;t++)e.push({i,j:t});return e}let i=new Set;return e.selectCells.forEach(e=>{e.i>=0&&e.i<t&&e.j>=0&&e.j<n&&i.add(`${e.i},${e.j}`)}),e.selectRows.forEach(e=>{if(e>=0&&e<t)for(let t=0;t<n;t++)i.add(`${e},${t}`)}),e.selectCols.forEach(e=>{if(e>=0&&e<n)for(let n=0;n<t;n++)i.add(`${n},${e}`)}),Array.from(i).map(e=>{let[t,n]=e.split(",").map(Number);return{i:t,j:n}})}static isUMLorERLike(e){let t=e.type;return t===i.Jq.TableUML||t===i.Jq.TableER}static getTableCellText(e,t,n){let i=new o.f(t,n);return e.cellTextMap.get(i.toString())||null}static initTableCellText(e,t,n){let i=new o.f(t,n),a=new r.v;e.cellTextMap.set(i.toString(),a);let l=e.tableProps.cellMatrix.getCell(t,n);return l.textProps=e.textProps.clone(),e.updateCellText(l,a),a}static getSelectRange(e){let t=-1,n=-1,i=-1,r=-1,o=e.tableStatus;if(o.hasSelectItem()){if(0!==o.selectCells.length){let a=o.selectCells;t=a[0].i,n=a[0].j;let l=e.tableProps.cellMatrix.getCell(t,n);for(let o of(i=t+l.rowSpan-1,r=n+l.colSpan-1,a)){let a=e.tableProps.cellMatrix.getCell(o.i,o.j);t=Math.min(t,o.i),n=Math.min(n,o.j),i=Math.max(i,o.i+a.rowSpan-1),r=Math.max(r,o.j+a.colSpan-1)}}let a=e.tableProps.columns.length,l=e.tableProps.rows.length;if(0!==o.selectRows.length){let e=o.selectRows;for(let o of(t=e[0],i=e[0],n=0,r=a-1,e))t=Math.min(t,o),i=Math.max(i,o)}if(0!==o.selectCols.length){let e=o.selectCols;for(let o of(n=e[0],r=e[0],t=0,i=l-1,e))n=Math.min(n,o),r=Math.max(r,o)}r=Math.min(r,a-1),i=Math.min(i,l-1)}return{minRow:t,minCol:n,maxRow:i,maxCol:r}}static getHighlightedCells(e){let t=e.tableStatus,n=e.tableProps.cellMatrix,i=e.tableProps.rows.length,r=e.tableProps.columns.length;if(!t.hasSelectItem())return new Set;let o=0!==t.selectRows.length,a=0!==t.selectCols.length,l=t.selectCells,s=new Set;if(o)for(let e of t.selectRows)for(let r=0;r<i;r++){let i=n.getCell(e,r);if(i){if(i.isMerged()||i.isRootMergeCell()){let o=n.getCell(i.refCell.i,i.refCell.j);o&&this.isSelectedRowColCoverSpan(t.selectRows,o,e,r,!0)&&s.add({i:e,j:r});continue}s.add({i:e,j:r})}}if(a)for(let e of t.selectCols)for(let i=0;i<r;i++){let r=n.getCell(i,e);if(r){if(r.isMerged()||r.isRootMergeCell()){let o=n.getCell(r.refCell.i,r.refCell.j);o&&this.isSelectedRowColCoverSpan(t.selectCols,o,i,e,!1)&&s.add({i,j:e});continue}s.add({i,j:e})}}if(!o&&!a)for(let e of l)s.add(e);return s}static getCellMergeState(e){let t=e.tableStatus;if(!t.hasSelectItem())return a.b.none;let n=e.tableProps.cellMatrix;if(0===n.cells.length||0===n.cells[0].length)return a.b.none;let i=t.selectRows,r=t.selectCols,o=0!==i.length,l=0!==r.length,s=this.getSelectRange(e),d=this.getHighlightedCells(e);if(o||l){let t=0;for(let n of d){let i=e.tableProps.cellMatrix.getCell(n.i,n.j);t+=i.rowSpan*i.colSpan}if((o?i.length*n.cells[0].length:r.length*n.cells.length)>t)return a.b.canSplit}if(1===d.size){let t=[...d][0],n=e.tableProps.cellMatrix.getCell(t.i,t.j),i=n.rowSpan,r=n.colSpan;return i>1||r>1?a.b.canSplit:a.b.none}if(o)return s.maxRow-s.minRow+1>i.length?a.b.disable:a.b.canMerge;if(l)return s.maxCol-s.minCol+1>r.length?a.b.disable:a.b.canMerge;{let t=!1,n=0;for(let i of d){let r=e.tableProps.cellMatrix.getCell(i.i,i.j),o=r.rowSpan*r.colSpan;o>1&&(t=!0),n+=o}return(s.maxRow-s.minRow+1)*(s.maxCol-s.minCol+1)===n?a.b.canMerge:t?a.b.canSplit:a.b.disable}}static isSelectedRowColCoverSpan(e,t,n,i,r){if(0===e.length||t.i!==n||t.j!==i)return!1;let o=(e,t,n)=>{if(0===n.length)return!1;let i=[];for(let n=e;n<e+t;n++)i.push(n);let r=new Set(n);return i.every(e=>r.has(e))&&n.length>=i.length};return r?o(t.i,t.rowSpan,e):o(t.j,t.colSpan,e)}static getMergedCellsByRoot(e,t,n){let i=[],r=e.tableProps.cellMatrix.clone(),o=r.getCell(t,n);for(let e=t;e<t+o.rowSpan;e++)for(let t=n;t<n+o.colSpan;t++)if(r.getCell(e,t).isMerged()){let n={i:e,j:t};i.push(n)}return i}static getSelectedCellsWithText(e){let t=[];for(let n of e){let{textProps:e}=n;e&&""!==e.text&&t.push(n)}return t}static getPreviousCell(e,t,n){let i=e.tableProps.cellMatrix,r={i:t,j:n-1};if(0===n){if(0===t)return r.i=t,r.j=n,r;r.i=t-1,r.j=e.tableProps.columns.length-1;let o=i.getCell(r.i,r.j);return o.isMerged()&&(r.i=o.refCell.i,r.j=o.refCell.j),r}let o=i.getCell(r.i,r.j);return o.isMerged()&&(r.i=o.refCell.i,r.j=o.refCell.j),r}}},544516:function(e,t,n){n.d(t,{L:()=>d,b:()=>s});var i=n(78485),r=n(889171),o=n(943451),a=n(161921);let l={[i.l.TextNodeHover]:"Hover",[i.l.TextNodeClick]:"Click"},s="textNodeInteraction";class d{static getCharClientPosByIndex(e){let{charIndex:t,graphicText:n}=e,i=n.renderText.getCharPositionByCharIndex(t),{point:r}=n.renderText.getTextPosition(i),o=n.toGlobalPoint(r),a=n.renderText.getChar(t);return{globalCharPoint:o,width:a?.char.width||0,height:a?.char.height||0}}static getCharPropsByGlobalPoint(e){let{globalPoint:t,graphicText:n}=e,i=n.detect(t,"full");if(!i.isExactMatch)return;let o=n.renderText.getCharIndex(i.textCursorPosition),a=n.renderText.getChar(o),l=n.textProps.splitTextCharProps().get(o);if(!a?.char||!l)return;let{char:s}=a,{point:d,lineHeight:c}=n.renderText.getTextPosition(i.textCursorPosition),h=n.toGlobalPoint(d);return{charProps:l,lineHeight:c,charIndex:o,leftTop:new r.E(h.x-s.width,h.y),bottomRight:new r.E(h.x,h.y+s.height)}}static getHyperlinkRange(e,t,n){let i=t,o=t,a=e.renderText.getChar(t),l=a?.line.chars[0].charIndex||0,s=a?.line.chars[a.line.chars.length-1].charIndex||0;e.textProps.textCharProps.forEach(e=>{if(e.charIndexSet.has(t)&&e.hyperlink===n)for(let t of e.charIndexSet)t<i&&t>=l&&(i=t),t>o&&t<=s&&(o=t)});let{globalCharPoint:c,width:h}=d.getCharClientPosByIndex({charIndex:i,graphicText:e}),{globalCharPoint:p,height:g}=d.getCharClientPosByIndex({charIndex:o,graphicText:e});return{startCharIndex:i,endCharIndex:o,leftTop:new r.E(c.x-h,c.y),bottomRight:new r.E(p.x,p.y+g)}}static textRichContentInteractionHandler(e){let{event:t,ctx:n,graphicText:i,textNodeId:r,auxiliaryDomStateType:c,rowIndex:h=0,colIndex:p=0,editTextType:g=o.P.Main}=e;if(n.inputManager.editTextInfo)return!1;let u=a.I.getInstance(),{globalPoint:x}=t,f=d.getCharPropsByGlobalPoint({graphicText:i,globalPoint:x});if(!f)return!1;let{charProps:y,leftTop:P,bottomRight:w,lineHeight:m,charIndex:M}=f,T={nodeId:r,lineHeight:m,leftTop:n.gmlRender.transformToLocal(P),bottomRight:n.gmlRender.transformToLocal(w)};if(y.mentionUser?.uid)return n.auxiliaryManager.addOrUpdateAuxiliaryDomState(c,{type:s,action:`mention${l[c]}`,mentionUser:{...y.mentionUser,docPermission:u.getMentionPermission(y.mentionUser.uid)??y.mentionUser.docPermission},...T}),!0;if(y.mentionDoc)return n.auxiliaryManager.addOrUpdateAuxiliaryDomState(c,{type:s,action:`mentionDoc${l[c]}`,mentionDoc:y.mentionDoc,...T}),!0;if(y.hyperlink){let{startCharIndex:e,endCharIndex:t,leftTop:r,bottomRight:o}=d.getHyperlinkRange(i,M,y.hyperlink);return n.auxiliaryManager.addOrUpdateAuxiliaryDomState(c,{type:s,action:`hyperlink${l[c]}`,hyperlinkInfo:{hyperlink:y.hyperlink,startCharIndex:e,endCharIndex:t,rowIndex:h,colIndex:p,editTextType:g},...T,leftTop:n.gmlRender.transformToLocal(r),bottomRight:n.gmlRender.transformToLocal(o)}),!0}return!1}static notifyRichContentInteractionCanceled(e,t){e.auxiliaryManager.addOrUpdateAuxiliaryDomState(t,{type:s,action:`textRichConten${l[t]}Canceled`})}static isInGraphicTextRectNode({point:e,graphicText:t,ctx:n,padding:i=0}){if(!t.hasText())return!1;let o=t.getRectNode(),a=new r.E(o.minX+i,o.minY),l=new r.E(o.maxX-i,a.y),s=new r.E(l.x,o.maxY),d=new r.E(a.x,s.y);t.baseProps.angle&&([a,l,s,d]=[d,a,l,s].map(e=>t.transform.crossPoint(e)));let c=new Path2D;c.moveTo(a.x,a.y),c.lineTo(l.x,l.y),c.lineTo(s.x,s.y),c.lineTo(d.x,d.y),c.closePath();let h=n.gmlRender.canvas.getContext("2d");h.save(),h.resetTransform();let p=h.isPointInPath(c,e.x,e.y);return h.restore(),p}}},592235:function(e,t,n){n.d(t,{AN:()=>s,A_:()=>d,KK:()=>c,gA:()=>h});var i,r,o=n(937093),a=n(793720),l=n(755928);(i=r||(r={}))[i.STRAIGHT=0]="STRAIGHT",i[i.POLYLINE=1]="POLYLINE",i[i.CURVE=2]="CURVE",i[i.NONARROW_STRAIGHT=3]="NONARROW_STRAIGHT",i[i.DASHED=4]="DASHED",i[i.TWO_WAY_STRAIGHT=5]="TWO_WAY_STRAIGHT",i[i.AGGREGATION_STRAIGHT=6]="AGGREGATION_STRAIGHT",i[i.COMPOSITION_STRAIGHT=7]="COMPOSITION_STRAIGHT",i[i.INHERITANCE_STRAIGHT=8]="INHERITANCE_STRAIGHT",i[i.DEPENDENCY_STRAIGHT=9]="DEPENDENCY_STRAIGHT",i[i.STRAIGHT_IN_MORE_SHAPE=10]="STRAIGHT_IN_MORE_SHAPE",i[i.NONARROW_STRAIGHT_IN_MORE_SHAPE=11]="NONARROW_STRAIGHT_IN_MORE_SHAPE",i[i.REALIZATION_STRAIGHT=12]="REALIZATION_STRAIGHT";let s=120,d=280,c=80;r.STRAIGHT,r.POLYLINE,r.CURVE,r.NONARROW_STRAIGHT;let h={[r.STRAIGHT_IN_MORE_SHAPE]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.LINE_ARROW},[r.STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.LINE_ARROW},[r.POLYLINE]:{lineType:o.SP.PolyLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.LINE_ARROW},[r.CURVE]:{lineType:o.SP.Curve,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.LINE_ARROW},[r.NONARROW_STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.None},[r.NONARROW_STRAIGHT_IN_MORE_SHAPE]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.None},[r.TWO_WAY_STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.LINE_ARROW,rArrow:a.Y.LINE_ARROW},[r.AGGREGATION_STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.EMPTY_DIAMOND_ARROW},[r.COMPOSITION_STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.DIAMOND_ARROW},[r.INHERITANCE_STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.None,lArrow:a.Y.None,rArrow:a.Y.EMPTY_TRIANGLE_ARROW},[r.DEPENDENCY_STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.Dash1,lArrow:a.Y.None,rArrow:a.Y.LINE_ARROW},[r.REALIZATION_STRAIGHT]:{lineType:o.SP.SimpleLine,dashType:l.N.Dash1,lArrow:a.Y.None,rArrow:a.Y.EMPTY_TRIANGLE_ARROW},[r.DASHED]:{lineType:o.SP.SimpleLine,dashType:l.N.Dash1,lArrow:a.Y.None,rArrow:a.Y.None}}},415834:function(e,t,n){n.d(t,{M:()=>p});var i=n(568971),r=n(637322),o=n(517686),a=n(331230),l=n(740735),s=n(12288),d=n(147703),c=n(35345);class h extends s.K{constructor(){super(),this.registerDownHandler(new a.f),this.registerDownHandler(new r.D),this.registerUpHandler(new c.m),this.registerUpHandler(new l.A),this.registerUpHandler(new d.p),this.registerUpHandler(new o.P)}}class p extends i.W{constructor(){super([new h])}clickEnable(e,t){return!0}}},232926:function(e,t,n){n.d(t,{u:()=>c});var i=n(572583),r=n(925174),o=n(771313);class a{allowEventTypeSet=new Set([r.V.pointermove]);process(e,t){if(t.detect(o.c.Comment,e))return void t.setCursor("pointer");t.setCursor("default")}}var l=n(380470),s=n(62207);class d{allowEventTypeSet=new Set([r.V.pointermove]);handlers=[new l.t,new s.g];process(e,t){for(let n of this.handlers)n.enable(e,t)&&n.handle(e,t)}}class c extends i.I{constructor(){super([new a,new d])}canBeEnable(e,t){return!0}canBeExit(e,t){return!0}}},771584:function(e,t,n){n.d(t,{c:()=>r});var i=n(889171);class r{a=1;b=0;c=0;d=1;e=0;f=0;static generateMatrix(){return new r}rotate(e){let t=e/180*Math.PI;return this.rotate2(t),this}rotate2(e){return this.a=Math.cos(e),this.c=-Math.sin(e),this.b=Math.sin(e),this.d=Math.cos(e),this}scale(e,t){return this.a=e,this.d=t,this}translate(e,t){return this.e=e,this.f=t,this}crossProduct(e){let t=new r;return t.a=this.a*e.a+this.c*e.b,t.c=this.a*e.c+this.c*e.d,t.e=this.a*e.e+this.c*e.f+this.e,t.b=this.b*e.a+this.d*e.b,t.d=this.b*e.c+this.d*e.d,t.f=this.b*e.e+this.d*e.f+this.f,t}crossPoint(e){return new i.E(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)}inverseMatrix(){let e=r.generateMatrix(),t=this.d/(this.a*this.d-this.b*this.c),n=-this.c/(this.a*this.d-this.b*this.c),i=-this.b/(this.a*this.d-this.b*this.c),o=this.a/(this.a*this.d-this.b*this.c);return e.a=t,e.c=n,e.e=0,e.b=i,e.d=o,e.f=0,e}clone(){let e=new r;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.e=this.e,e.f=this.f,e}}},744966:function(e,t,n){n.d(t,{Y:()=>d});var i=n(889171),r=n(629029),o=n(640285);n(119498);var a=n(937093),l=n(331945),s=n(805433);let d={getCubicBezierPoints(e){let t=[];for(let n=0;n<e.length-1;n+=3){let i=e[n],r=e[n+1],o=e[n+2],a=e[n+3];t.push({points:[i,r,o,a]})}return t},canvasLineContains(e,t,n=5){let i=o.ZP.circle(t,n);if(e.isPolyLine()){let t=o.ZP.polyline(...e.getDrawPoints()),n=r.Z.intersect(t,i);return n?.points&&n.points.length>0}if(e.shapeType===a.SP.Curve)return d.getCubicBezierPoints(e.getDrawPoints()).some(e=>{let t=o.ZP.cubicBezier(...e.points),n=r.Z.intersect(t,i);return n?.points&&n.points.length>0});let l=o.ZP.line(...e.getDrawPoints()),s=r.Z.intersect(l,i);return s?.points&&s.points.length>0},findCanvasLineIntersection(e,t){if(e.shapeType===a.SP.Curve&&t.shapeType===a.SP.Curve){let n=d.getCubicBezierPoints(e.getDrawPoints()),i=d.getCubicBezierPoints(t.getDrawPoints()),r=[];for(let e of n){let t=o.ZP.cubicBezier(...e.points);for(let e of i){let n=o.ZP.cubicBezier(...e.points);r.push(...d.pathIntersection(t,n))}}return r}if(e.shapeType===a.SP.Curve&&t.shapeType===a.SP.SimpleLine){let n=d.getCubicBezierPoints(e.getDrawPoints()),i=[],r=o.ZP.line(...t.getDrawPoints());for(let e of n){let t=o.ZP.cubicBezier(...e.points);i.push(...d.pathIntersection(t,r))}return i}if(e.shapeType===a.SP.Curve&&t.isPolyLine()){let n=d.getCubicBezierPoints(e.getDrawPoints()),i=[],r=o.ZP.polyline(...t.getDrawPoints());for(let e of n){let t=o.ZP.cubicBezier(...e.points);i.push(...d.pathIntersection(t,r))}return i}if(e.shapeType===a.SP.SimpleLine&&t.shapeType===a.SP.Curve){let n=d.getCubicBezierPoints(t.getDrawPoints()),i=[],r=o.ZP.line(...e.getDrawPoints());for(let e of n){let t=o.ZP.cubicBezier(...e.points);i.push(...d.pathIntersection(r,t,!0))}return i}if(e.shapeType===a.SP.SimpleLine&&t.shapeType===a.SP.SimpleLine){let n=o.ZP.line(...e.getDrawPoints()),i=o.ZP.line(...t.getDrawPoints());return d.pathIntersection(n,i,!0)}if(e.shapeType===a.SP.SimpleLine&&t.isPolyLine()){let n=o.ZP.line(...e.getDrawPoints()),i=o.ZP.polyline(...t.getDrawPoints());return d.pathIntersection(n,i,!0)}if(e.isPolyLine()&&t.shapeType===a.SP.Curve){let n=d.getCubicBezierPoints(t.getDrawPoints()),i=[],r=o.ZP.polyline(...e.getDrawPoints());for(let e of n){let t=o.ZP.cubicBezier(...e.points);i.push(...d.pathIntersection(r,t,!0))}return i}if(e.isPolyLine()&&t.shapeType===a.SP.SimpleLine){let n=o.ZP.polyline(...e.getDrawPoints()),i=o.ZP.line(...t.getDrawPoints());return d.pathIntersection(n,i,!0)}if(e.isPolyLine()&&t.isPolyLine()){let n=o.ZP.polyline(...e.getDrawPoints()),i=o.ZP.polyline(...t.getDrawPoints());return d.pathIntersection(n,i,!0)}return[]},pathIntersection(e,t,n=!1){let o=[],a=r.Z.intersect(e,t);if(a?.points&&a.points.length>0)for(let t of a.points){let r=new i.E(t.x,t.y),a=d.findCircleIntersection(e,{center:r,r:l.C});if(a.length<2)continue;let c=n?a[1]:a[0],h=n?a[0]:a[1],p=s.G.lineAngle(r,c),g=s.G.lineAngle(r,h),u={intersectionPoint:r,startPoint:c,endPoint:h,startAngle:p,endAngle:g};o.push(u)}return o},findCircleIntersection(e,{center:t,r:n}){let a=o.ZP.circle(t.x,t.y,n),l=r.Z.intersect(e,a),s=[];if(l?.points&&l.points.length>0)for(let e of l.points)s.push(new i.E(e.x,e.y));return s},findLineAndRectIntersect(e,t,n){let i=o.ZP.polyline([e.x,e.y,t.x,t.y]),a=o.ZP.rectangle({topLeft:{x:n.minX,y:n.minY},size:{x:n.maxX-n.minX,y:n.maxY-n.minY}}),l=r.Z.intersect(i,a);return l?.points||[]},findCurveAndRectIntersect(e,t){let n=d.getCubicBezierPoints(e.getDrawPoints()),i=o.ZP.rectangle({topLeft:{x:t.minX,y:t.minY},size:{x:t.maxX-t.minX,y:t.maxY-t.minY}});for(let e of n){let t=o.ZP.cubicBezier(...e.points);if(0!==d.pathIntersection(t,i).length)return!0}return!1}}}}]);