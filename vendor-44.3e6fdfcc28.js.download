"use strict";(window.webpackChunkweb=window.webpackChunkweb||[]).push([["85330"],{513615:function(e,t,r){function i([e,t,r],[i,a,s]){return[e+i,t+a,r+s]}function a([e,t,r],[i,a,s]){return[e-i,t-a,r-s]}function s([e,t,r],i){return[e*i,t*i,r*i]}function n([e,t,r]){return[e/Math.sqrt(e**2+t**2),t/Math.sqrt(e**2+t**2),r]}function l([e,t,r],i){return[Math.cos(i)*e-Math.sin(i)*t,Math.sin(i)*e+Math.cos(i)*t,r]}function o(e,t,r){return Math.atan2(r[1]-e[1],r[0]-e[0])-Math.atan2(t[1]-e[1],t[0]-e[0])}function h(e){return Math.atan2(Math.sin(e),Math.cos(e))}function u([e,t]){return Math.sqrt(e**2+t**2)}function d([e,t],[r,i]){return Math.sqrt((r-e)**2+(i-t)**2)}function c(e,t){if(0===t||e.length<=2)return e;let r=e[0],i=e[e.length-1],[a,s]=e.reduce(([e,t],a,s)=>{let n=function(e,t,r){let i=d(t,r);if(0===i)return d(e,t);let a=Math.max(0,Math.min(1,((e[0]-t[0])*(r[0]-t[0])+(e[1]-t[1])*(r[1]-t[1]))/i**2));return d([t[0]+a*(r[0]-t[0]),t[1]+a*(r[1]-t[1]),e[2]],e)}(a,r,i);return n>e?[n,s]:[e,t]},[0,-1]);if(!(a>=t))return[r,i];{let a=e[s];return[...c([r,...e.slice(1,s),a],t).slice(0,-1),a,...c([a,...e.slice(s,-1),i],t).slice(1)]}}r.d(t,{M:()=>p}),Object.defineProperty({},"LaserPointer",{get:()=>p,set:void 0,enumerable:!0,configurable:!0});class p{static{this.defaults={size:2,streamline:.45,simplify:.1,simplifyPhase:"output",keepHead:!1,sizeMapping:()=>1}}static{this.constants={cornerDetectionMaxAngle:75,cornerDetectionVariance:e=>e>35?.5:1,maxTailLength:50}}constructor(e){this.originalPoints=[],this.stablePoints=[],this.tailPoints=[],this.isFresh=!0,this.options=Object.assign({},p.defaults,e)}get lastPoint(){return this.tailPoints[this.tailPoints.length-1]??this.stablePoints[this.stablePoints.length-1]}addPoint(e){let t=this.originalPoints[this.originalPoints.length-1];if(!t||t[0]!==e[0]||t[1]!==e[1]){var r,n,l;if(this.originalPoints.push(e),this.isFresh){this.isFresh=!1,this.stablePoints.push(e);return}this.options.streamline>0&&(r=this.lastPoint,n=e,l=1-this.options.streamline,e=i(r,s(a(n,r),l))),this.tailPoints.push(e),function(e){if(e.length<2)return 0;let t=0;for(let r=1;r<=e.length-1;r++)t+=d(e[r-1],e[r]);return t+d(e[e.length-2],e[e.length-1])}(this.tailPoints)>p.constants.maxTailLength&&this.stabilizeTail()}}close(){this.stabilizeTail()}stabilizeTail(){if(this.options.simplify>0&&"tail"==this.options.simplifyPhase)throw Error("Not implemented yet");this.stablePoints.push(...this.tailPoints),this.tailPoints=[]}getSize(e,t,r,i,a){return(e??this.options.size)*this.options.sizeMapping({pressure:t,runningLength:a,currentIndex:r,totalLength:i})}getStrokeOutline(e){if(this.isFresh)return[];let t=[...this.stablePoints,...this.tailPoints];this.options.simplify>0&&"input"===this.options.simplifyPhase&&(t=c(t,this.options.simplify));let r=t.length;if(0===r)return[];if(1===r){let a=t[0],n=this.getSize(e,a[2],0,r,0);if(n<.5)return[];let o=[];for(let e=0;e<=2*Math.PI;e+=Math.PI/16)o.push(i(a,s(l([1,0,0],e),n)));return o.push(i(a,s([1,0,0],this.getSize(e,a[2],0,r,0)))),o}if(2===r){let a=t[0],n=t[1],h=this.getSize(e,a[2],0,r,0),u=this.getSize(e,n[2],0,r,0);if(h<.5||u<.5)return[];let d=[],c=o(a,[a[0],a[1]-100,a[2]],n);for(let e=c;e<=Math.PI+c;e+=Math.PI/16)d.push(i(a,s(l([1,0,0],e),h)));for(let e=Math.PI+c;e<=2*Math.PI+c;e+=Math.PI/16)d.push(i(n,s(l([1,0,0],e),u)));return d.push(d[0]),d}let g=[],f=[],b=0,y=0,m=0,x=0;for(let c=1;c<r-1;c++){let w=t[c-1],E=t[c],A=t[c+1],S=E[2],O=d(w,E);x+=O,b=y+(O-y)*.2;let k=this.getSize(e,S,c,r,x);if(0===k){m=c+1;continue}let I=n(a(w,E)),T=n(a(A,E)),v=l(I,Math.PI/2),N=l(I,-Math.PI/2),P=l(T,Math.PI/2),L=l(T,-Math.PI/2),D=i(E,s(v,k)),C=i(E,s(N,k)),M=i(E,s(P,k)),$=i(E,s(L,k)),_=i(v,L),Y=i(N,P),X=i(E,s(0===u(_)?I:n(_),k)),R=i(E,s(0===u(Y)?T:n(Y),k)),z=h(o(E,w,A));if(Math.abs(z)<p.constants.cornerDetectionMaxAngle/180*Math.PI*p.constants.cornerDetectionVariance(b)){let e=Math.abs(h(Math.PI-z));if(0===e)continue;if(z<0){f.push(C,R);for(let t=0;t<=e;t+=e/4)g.push(i(E,l(s(v,k),t)));for(let t=e;t>=0;t-=e/4)f.push(i(E,l(s(v,k),t)));f.push(R,M)}else{g.push(D,X);for(let t=0;t<=e;t+=e/4)f.push(i(E,l(s(v,-k),-t)));for(let t=e;t>=0;t-=e/4)g.push(i(E,l(s(v,-k),-t)));g.push(X,$)}}else g.push(X),f.push(R);y=b}if(m>=r-2)if(!this.options.keepHead)return[];else{let e=t[r-1],a=[];for(let t=0;t<=2*Math.PI;t+=Math.PI/16)a.push(i(e,s(l([1,0,0],t),this.options.size)));return a.push(i(e,s([1,0,0],this.options.size))),a}let w=t[m],E=t[m+1],A=t[r-2],S=t[r-1],O=n(a(E,w)),k=n(a(A,S)),I=l(O,-Math.PI/2),T=l(k,Math.PI/2),v=this.getSize(e,w[2],0,r,0),N=[],P=this.options.keepHead?this.options.size:this.getSize(e,A[2],r-2,r,x),L=[];if(v>1){for(let e=0;e<=Math.PI;e+=Math.PI/16)N.unshift(i(w,l(s(I,v),-e)));N.unshift(i(w,s(I,-v)))}else N.push(w);for(let e=0;e<=3*Math.PI;e+=Math.PI/16)L.push(i(S,l(s(T,-P),-e)));let D=[...N,...g,...L.reverse(),...f.reverse()];return(N.length>0&&D.push(N[0]),this.options.simplify>0&&"output"===this.options.simplifyPhase)?c(D,this.options.simplify):D}}},991760:function(e,t){t.removeMarkdown=void 0,t.removeMarkdown=function(e,t){void 0===t&&(t={listUnicodeChar:""}),(t=t||{}).listUnicodeChar=!!t.hasOwnProperty("listUnicodeChar")&&t.listUnicodeChar,t.stripListLeaders=!t.hasOwnProperty("stripListLeaders")||t.stripListLeaders,t.gfm=!t.hasOwnProperty("gfm")||t.gfm,t.useImgAltText=!t.hasOwnProperty("useImgAltText")||t.useImgAltText,t.preserveLinks=!!t.hasOwnProperty("preserveLinks")&&t.preserveLinks;var r=e||"";r=r.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*$/gm,"");try{t.stripListLeaders&&(r=t.listUnicodeChar?r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,t.listUnicodeChar+" $1"):r.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),t.gfm&&(r=r.replace(/\n={2,}/g,"\n").replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/`{3}.*\n/g,"")),t.preserveLinks&&(r=r.replace(/\[(.*?)\][\[\(](.*?)[\]\)]/g,"$1 ($2)")),r=r.replace(/<[^>]*>/g,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,t.useImgAltText?"$1":"").replace(/\[(.*?)\][\[\(].*?[\]\)]/g,"$1").replace(/^\s{0,3}>\s?/g,"").replace(/(^|\n)\s{0,3}>\s?/g,"\n\n").replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} {0,}(\n)?\s{0,}$/gm,"$1$2$3").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,"$2").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/\n{2,}/g,"\n\n")}catch(t){return console.error(t),e}return r}},893405:function(e){var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=Object.defineProperty,a=Object.getOwnPropertyDescriptor,s=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===r.call(e)},n=function(e){if(!e||"[object Object]"!==r.call(e))return!1;var i,a=t.call(e,"constructor"),s=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!a&&!s)return!1;for(i in e);return void 0===i||t.call(e,i)},l=function(e,t){i&&"__proto__"===t.name?i(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},o=function(e,r){if("__proto__"===r){if(!t.call(e,r))return;else if(a)return a(e,r).value}return e[r]};e.exports=function e(){var t,r,i,a,h,u,d=arguments[0],c=1,p=arguments.length,g=!1;for("boolean"==typeof d&&(g=d,d=arguments[1]||{},c=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});c<p;++c)if(t=arguments[c],null!=t)for(r in t)i=o(d,r),d!==(a=o(t,r))&&(g&&a&&(n(a)||(h=s(a)))?(h?(h=!1,u=i&&s(i)?i:[]):u=i&&n(i)?i:{},l(d,{name:r,newValue:e(g,u,a)})):void 0!==a&&l(d,{name:r,newValue:a}));return d}},388975:function(e,t,r){r.r(t),r.d(t,{parseMermaidToExcalidraw:()=>B});let i={rect:"rectangle",circle:"ellipse"},a={startOnLoad:!1,flowchart:{curve:"linear"},themeVariables:{fontSize:"25px"},maxEdges:500,maxTextSize:5e4};class s{constructor({converter:e}){this.convert=(e,t)=>this.converter(e,{...t,fontSize:t.fontSize||20}),this.converter=e}}(n=o||(o={})).ROUND="round",n.STADIUM="stadium",n.DOUBLECIRCLE="doublecircle",n.CIRCLE="circle",n.DIAMOND="diamond",(h||(h={})).COLOR="color",(l=u||(u={})).FILL="fill",l.STROKE="stroke",l.STROKE_WIDTH="stroke-width",l.STROKE_DASHARRAY="stroke-dasharray";var n,l,o,h,u,d=r(991760);let c={arrow_circle:{endArrowhead:"dot"},arrow_cross:{endArrowhead:"bar"},arrow_open:{endArrowhead:null,startArrowhead:null},double_arrow_circle:{endArrowhead:"dot",startArrowhead:"dot"},double_arrow_cross:{endArrowhead:"bar",startArrowhead:"bar"},double_arrow_point:{endArrowhead:"arrow",startArrowhead:"arrow"}},p=e=>{let t=e.text;return"markdown"===e.labelType&&(t=(0,d.removeMarkdown)(e.text)),g(t)},g=e=>e.replace(/\s?(fa|fab):[a-zA-Z0-9-]+/g,""),f=new s({converter:(e,t)=>{let r=[],i=t.fontSize,{getGroupIds:a,getParentId:s}=(e=>{let t={};e.subGraphs.map(r=>{r.nodeIds.forEach(i=>{t[r.id]={id:r.id,parent:null,isLeaf:!1},t[i]={id:i,parent:r.id,isLeaf:void 0!==e.vertices[i]}})});let r={};return[...Object.keys(e.vertices),...e.subGraphs.map(e=>e.id)].forEach(e=>{if(!t[e])return;let i=t[e],a=[];for(i.isLeaf||a.push(`subgraph_group_${i.id}`);;)if(i.parent)a.push(`subgraph_group_${i.parent}`),i=t[i.parent];else break;r[e]=a}),{getGroupIds:e=>r[e]||[],getParentId:e=>t[e]?t[e].parent:null}})(e);return e.subGraphs.reverse().forEach(e=>{let t=a(e.id),s={id:e.id,type:"rectangle",groupIds:t,x:e.x,y:e.y,width:e.width,height:e.height,label:{groupIds:t,text:p(e),fontSize:i,verticalAlign:"top"}};r.push(s)}),Object.values(e.vertices).forEach(e=>{if(!e)return;let t=a(e.id),s=(e=>{let t={};return Object.keys(e).forEach(r=>{switch(r){case u.FILL:t.backgroundColor=e[r],t.fillStyle="solid";break;case u.STROKE:t.strokeColor=e[r];break;case u.STROKE_WIDTH:t.strokeWidth=Number(e[r]?.split("px")[0]);break;case u.STROKE_DASHARRAY:t.strokeStyle="dashed"}}),t})(e.containerStyle),n=(e=>{let t={};return Object.keys(e).forEach(r=>{r===h.COLOR&&(t.strokeColor=e[r])}),t})(e.labelStyle),l={id:e.id,type:"rectangle",groupIds:t,x:e.x,y:e.y,width:e.width,height:e.height,strokeWidth:2,label:{groupIds:t,text:p(e),fontSize:i,...n},link:e.link||null,...s};switch(e.type){case o.STADIUM:case o.ROUND:l={...l,roundness:{type:3}};break;case o.DOUBLECIRCLE:{t.push(`doublecircle_${e.id}}`);let a={type:"ellipse",groupIds:t,x:e.x+5,y:e.y+5,width:e.width-10,height:e.height-10,strokeWidth:2,roundness:{type:3},label:{groupIds:t,text:p(e),fontSize:i}};l={...l,groupIds:t,type:"ellipse"},r.push(a);break}case o.CIRCLE:l.type="ellipse";break;case o.DIAMOND:l.type="diamond"}r.push(l)}),e.edges.forEach(e=>{let t=[],n=s(e.start),l=s(e.end);n&&n===l&&(t=a(n));let{startX:o,startY:h,reflectionPoints:u}=e,d=u.map(e=>[e.x-u[0].x,e.y-u[0].y]),g=c[e.type],f={id:`${e.start}_${e.end}`,type:"arrow",groupIds:t,x:o,y:h,strokeWidth:"thick"===e.stroke?4:2,strokeStyle:"dotted"===e.stroke?"dashed":void 0,points:d,...e.text?{label:{text:p(e),fontSize:i,groupIds:t}}:{},roundness:{type:2},...g},b=r.find(t=>t.id===e.start),y=r.find(t=>t.id===e.end);b&&y&&(f.start={id:b.id||""},f.end={id:y.id||""},r.push(f))}),{elements:r}}});var b=r(606261);let y=new s({converter:e=>{let t=(0,b.x0)(),{width:r,height:i}=e;return{files:{[t]:{id:t,mimeType:e.mimeType,dataURL:e.dataURL}},elements:[{type:"image",x:0,y:0,width:r,height:i,status:"saved",fileId:t}]}}}),m=e=>e.replace(/\\n/g,"\n"),x=e=>{let t={type:"line",x:e.startX,y:e.startY,points:[[0,0],[e.endX-e.startX,e.endY-e.startY]],width:e.endX-e.startX,height:e.endY-e.startY,strokeStyle:e.strokeStyle||"solid",strokeColor:e.strokeColor||"#000",strokeWidth:e.strokeWidth||1};return e.groupId&&Object.assign(t,{groupIds:[e.groupId]}),e.id&&Object.assign(t,{id:e.id}),t},w=e=>{let t={type:"text",x:e.x,y:e.y,width:e.width,height:e.height,text:m(e.text)||"",fontSize:e.fontSize,verticalAlign:"middle"};return e.groupId&&Object.assign(t,{groupIds:[e.groupId]}),e.id&&Object.assign(t,{id:e.id}),t},E=e=>{let t={};"rectangle"===e.type&&"activation"===e.subtype&&(t={backgroundColor:"#e9ecef",fillStyle:"solid"});let r={id:e.id,type:e.type,x:e.x,y:e.y,width:e.width,height:e.height,label:{text:m(e?.label?.text||""),fontSize:e?.label?.fontSize,verticalAlign:e.label?.verticalAlign||"middle",strokeColor:e.label?.color||"#000",groupIds:e.groupId?[e.groupId]:[]},strokeStyle:e?.strokeStyle,strokeWidth:e?.strokeWidth,strokeColor:e?.strokeColor,backgroundColor:e?.bgColor,fillStyle:"solid",...t};return e.groupId&&Object.assign(r,{groupIds:[e.groupId]}),r},A=e=>{let t={type:"arrow",x:e.startX,y:e.startY,points:e.points||[[0,0],[e.endX-e.startX,e.endY-e.startY]],width:e.endX-e.startX,height:e.endY-e.startY,strokeStyle:e?.strokeStyle||"solid",endArrowhead:e?.endArrowhead||null,startArrowhead:e?.startArrowhead||null,label:{text:m(e?.label?.text||""),fontSize:16},roundness:{type:2},start:e.start,end:e.end};return e.groupId&&Object.assign(t,{groupIds:[e.groupId]}),t},S=new s({converter:e=>{let t=[],r=[];if(Object.values(e.nodes).forEach(e=>{e&&e.length&&e.forEach(e=>{let i;switch(e.type){case"line":i=x(e);break;case"rectangle":case"ellipse":i=E(e);break;case"text":i=w(e);break;default:throw`unknown type ${e.type}`}"rectangle"===e.type&&e?.subtype==="activation"?r.push(i):t.push(i)})}),Object.values(e.lines).forEach(e=>{e&&t.push(x(e))}),Object.values(e.arrows).forEach(e=>{e&&(t.push(A(e)),e.sequenceNumber&&t.push(E(e.sequenceNumber)))}),t.push(...r),e.loops){let{lines:r,texts:i,nodes:a}=e.loops;r.forEach(e=>{t.push(x(e))}),i.forEach(e=>{t.push(w(e))}),a.forEach(e=>{t.push(E(e))})}return e.groups&&e.groups.forEach(e=>{let{actorKeys:r,name:i}=e,a=1/0,s=1/0,n=0,l=0;if(!r.length)return;t.filter(e=>{if(e.id){let t=e.id.indexOf("-"),i=e.id.substring(0,t);return r.includes(i)}}).forEach(e=>{if(void 0===e.x||void 0===e.y||void 0===e.width||void 0===e.height)throw Error(`Actor attributes missing ${e}`);a=Math.min(a,e.x),s=Math.min(s,e.y),n=Math.max(n,e.x+e.width),l=Math.max(l,e.y+e.height)});let o=a-10,h=s-10,u=n-a+20,d=l-s+20,c=(0,b.x0)(),p=E({type:"rectangle",x:o,y:h,width:u,height:d,bgColor:e.fill,id:c});t.unshift(p);let g=(0,b.x0)(),f=[c];t.forEach(e=>{if("frame"!==e.type){if(void 0===e.x||void 0===e.y||void 0===e.width||void 0===e.height)throw Error(`Element attributes missing ${e}`);if(e.x>=a&&e.x+e.width<=n&&e.y>=s&&e.y+e.height<=l){let t=e.id||(0,b.x0)();e.id||Object.assign(e,{id:t}),f.push(t)}}}),t.push({type:"frame",id:g,name:i,children:f})}),{elements:t}}}),O=new s({converter:e=>{let t=[];return Object.values(e.nodes).forEach(e=>{e&&e.length&&e.forEach(e=>{let r;switch(e.type){case"line":r=x(e);break;case"rectangle":case"ellipse":r=E(e);break;case"text":r=w(e);break;default:throw`unknown type ${e.type}`}t.push(r)})}),Object.values(e.lines).forEach(e=>{e&&t.push(x(e))}),Object.values(e.arrows).forEach(e=>{if(!e)return;let r=A(e);t.push(r)}),Object.values(e.text).forEach(e=>{let r=w(e);t.push(r)}),Object.values(e.namespaces).forEach(r=>{let i=Object.keys(r.classes),a=[...i],s=[...e.lines,...e.arrows,...e.text];i.forEach(e=>{let t=s.filter(t=>t.metadata&&t.metadata.classId===e).map(e=>e.id);t.length&&a.push(...t)});let n={type:"frame",id:(0,b.x0)(),name:r.id,children:a};t.push(n)}),{elements:t}}});var k=r(773137);let I=e=>{let t=(e=v(e)).replace(/#(\d+);/g,"&#$1;").replace(/#([a-z]+);/g,"&$1;"),r=document.createElement("textarea");return r.innerHTML=t,r.value},T=e=>{let t=e.getAttribute("transform"),r=t?.match(/translate\(([ \d.-]+),\s*([\d.-]+)\)/),i=0,a=0;return r&&(i=Number(r[1]),a=Number(r[2])),{transformX:i,transformY:a}},v=function(e){return e.replace(/ﬂ°°/g,"#").replace(/ﬂ°/g,"&").replace(/¶ß/g,";")},N=(e,t={x:0,y:0})=>{if("path"!==e.tagName.toLowerCase())throw Error(`Invalid input: Expected an HTMLElement of tag "path", got ${e.tagName}`);let r=e.getAttribute("d");if(!r)throw Error('Path element does not contain a "d" attribute');let i=r.split(/(?=[LM])/),a=i[0].substring(1).split(",").map(e=>parseFloat(e)),s=i[i.length-1].substring(1).split(",").map(e=>parseFloat(e)),n=i.map(e=>{let t=e.substring(1).split(",").map(e=>parseFloat(e));return{x:t[0],y:t[1]}}).filter((e,t,r)=>{if(0===t||t===r.length-1)return!0;if(e.x===r[t-1].x&&e.y===r[t-1].y)return!1;if(t===r.length-2&&(r[t-1].x===e.x||r[t-1].y===e.y)){let t=r[r.length-1];return Math.hypot(t.x-e.x,t.y-e.y)>20}return e.x!==r[t-1].x||e.y!==r[t-1].y}).map(e=>({x:e.x+t.x,y:e.y+t.y}));return{startX:a[0]+t.x,startY:a[1]+t.y,endX:s[0]+t.x,endY:s[1]+t.y,reflectionPoints:n}},P=(e,t)=>{if(!e)throw Error("Element not found");let r=e.parentElement?.parentElement,i=e.childNodes[0],a={x:0,y:0};if(i){let{transformX:e,transformY:t}=T(i),r=i.getBBox();a={x:Number(i.getAttribute("x"))||e+r.x||0,y:Number(i.getAttribute("y"))||t+r.y||0}}let{transformX:s,transformY:n}=T(e),l={x:s+a.x,y:n+a.y};for(;r&&r.id!==t.id;){if("root"===r.classList.value&&r.hasAttribute("transform")){let{transformX:e,transformY:t}=T(r);l.x+=e,l.y+=t}r=r.parentElement}return l},L=(e,t,r,i,a)=>{let s={};return s.type="arrow",s.startX=e,s.startY=t,s.endX=r,s.endY=i,Object.assign(s,{...a}),s},D=(e,t,r,i)=>({type:"text",x:e,y:t,text:r,width:i?.width||20,height:i?.height||20,fontSize:i?.fontSize||20,id:i?.id,groupId:i?.groupId,metadata:i?.metadata}),C=(e,t,r)=>{let i={},a=Number(e.getAttribute("x")),s=Number(e.getAttribute("y"));i.type="text",i.text=I(t),r?.id&&(i.id=r.id),r?.groupId&&(i.groupId=r.groupId);let n=e.getBBox();return i.width=n.width,i.height=n.height,i.x=a-n.width/2,i.y=s,i.fontSize=parseInt(getComputedStyle(e).fontSize),i},M=(e,t,r={})=>{let i={};i.type=t;let{label:a,subtype:s,id:n,groupId:l}=r;i.id=n,l&&(i.groupId=l),a&&(i.label={text:I(a.text),fontSize:16,verticalAlign:a?.verticalAlign});let o=e.getBBox();switch(i.x=o.x,i.y=o.y,i.width=o.width,i.height=o.height,i.subtype=s,s){case"highlight":let h=e.getAttribute("fill");h&&(i.bgColor=h);break;case"note":i.strokeStyle="dashed"}return i},$=(e,t,r,i,a,s)=>{let n={};return n.startX=t,n.startY=r,n.endX=i,s?.groupId&&(n.groupId=s.groupId),s?.id&&(n.id=s.id),n.endY=a,n.strokeColor=e.getAttribute("stroke"),n.strokeWidth=Number(e.getAttribute("stroke-width")),n.type="line",n},_={0:"SOLID",1:"DOTTED",3:"SOLID_CROSS",4:"DOTTED_CROSS",5:"SOLID_OPEN",6:"DOTTED_OPEN",24:"SOLID_POINT",25:"DOTTED_POINT"},Y={SOLID:0,DOTTED:1,NOTE:2,SOLID_CROSS:3,DOTTED_CROSS:4,SOLID_OPEN:5,DOTTED_OPEN:6,SOLID_POINT:24,DOTTED_POINT:25,CRITICAL_START:27},X=(e,t,r)=>{if(!e)throw"root node not found";let a=(0,b.x0)(),s=Array.from(e.children),n=[];return s.forEach((e,s)=>{let l,o=`${r?.id}-${s}`;switch(e.tagName){case"line":let h=Number(e.getAttribute("x1")),u=Number(e.getAttribute("y1")),d=Number(e.getAttribute("x2")),c=Number(e.getAttribute("y2"));l=$(e,h,u,d,c,{groupId:a,id:o});break;case"text":l=C(e,t,{groupId:a,id:o});break;case"circle":l=M(e,"ellipse",{label:e.textContent?{text:e.textContent}:void 0,groupId:a,id:o});default:l=M(e,i[e.tagName],{label:e.textContent?{text:e.textContent}:void 0,groupId:a,id:o})}n.push(l)}),n},R={AGGREGATION:0,EXTENSION:1,COMPOSITION:2,DEPENDENCY:3},z={LINE:0,DOTTED_LINE:1},j=e=>{let t;switch(e){case R.AGGREGATION:t="diamond_outline";break;case R.COMPOSITION:t="diamond";break;case R.EXTENSION:t="triangle_outline";break;case"none":t=null;break;case R.DEPENDENCY:default:t="arrow"}return t},q=async(e,t=a)=>{let r;k.N.initialize({...a,...t});let i=await k.N.mermaidAPI.getDiagramFromText(e.replace(/style.*:\S*#.*;/g,e=>e.substring(0,e.length-1)).replace(/classDef.*:\S*#.*;/g,e=>e.substring(0,e.length-1)).replace(/#\w+;/g,e=>{let t=e.substring(1,e.length-1);return/^\+?\d+$/.test(t)?`\u{FB02}\xb0\xb0${t}\xb6\xdf`:`\u{FB02}\xb0${t}\xb6\xdf`})),{svg:s}=await k.N.render("mermaid-to-excalidraw",e),n=document.createElement("div");switch(n.setAttribute("style","opacity: 0; position: relative; z-index: -1;"),n.innerHTML=s,n.id="mermaid-diagram",document.body.appendChild(n),i.type){case"flowchart-v2":r=((e,t)=>{e.parse();let r=e.parser.yy,i=r.getVertices();Object.keys(i).forEach(e=>{i[e]=((e,t)=>{let r,i=t.querySelector(`[id*="flowchart-${e.id}-"]`);if(!i)return;i.parentElement?.tagName.toLowerCase()==="a"&&(r=i.parentElement.getAttribute("xlink:href"));let a=P(r?i.parentElement:i,t),s=i.getBBox(),n={width:s.width,height:s.height},l=i.querySelector(".label-container")?.getAttribute("style"),o=i.querySelector(".label")?.getAttribute("style"),h={};l?.split(";").forEach(e=>{if(!e)return;let t=e.split(":")[0].trim(),r=e.split(":")[1].trim();h[t]=r});let u={};return o?.split(";").forEach(e=>{if(!e)return;let t=e.split(":")[0].trim(),r=e.split(":")[1].trim();u[t]=r}),{id:e.id,labelType:e.labelType,text:I(e.text),type:e.type,link:r||void 0,...a,...n,containerStyle:h,labelStyle:u}})(i[e],t)});let a=new Map,s=r.getEdges().filter(e=>t.querySelector(`[id*="L-${e.start}-${e.end}"]`)).map(e=>{let r=`${e.start}-${e.end}`,i=a.get(r)||0;a.set(r,i+1);let s=t.querySelector(`[id*="L-${e.start}-${e.end}-${i}"]`);if(!s)throw Error("Edge element not found");let n=P(s,t),l=N(s,n);return e.length=void 0,{...e,...l,text:I(e.text)}});return{type:"flowchart",subGraphs:r.getSubGraphs().map(e=>((e,t)=>{let r=e.nodes.map(e=>e.startsWith("flowchart-")?e.split("-")[1]:e),i=t.querySelector(`[id='${e.id}']`);if(!i)throw Error("SubGraph element not found");let a=P(i,t),s=i.getBBox(),n={width:s.width,height:s.height};return e.classes=void 0,e.dir=void 0,{...e,nodeIds:r,...a,...n,text:I(e.title)}})(e,t)),vertices:i,edges:s}})(i,n);break;case"sequence":r=((e,t)=>{e.parse();let r=e.parser.yy,i=[],a=r.getBoxes(),s=(e=>{let t=Array.from(e.querySelectorAll(".rect")).filter(e=>e.parentElement?.tagName!=="g"),r=[];return t.forEach(e=>{let t=M(e,"rectangle",{label:{text:""},subtype:"highlight"});r.push(t)}),r})(t),{nodes:n,lines:l}=((e,t)=>{let r=Array.from(t.querySelectorAll(".actor-top")),i=Array.from(t.querySelectorAll(".actor-bottom")),a=[],s=[];return Object.values(e).forEach((e,t)=>{let n=r.find(t=>t.getAttribute("name")===e.name),l=i.find(t=>t.getAttribute("name")===e.name);if(!n||!l)throw"root not found";let o=e.description;if("participant"===e.type){let t=M(n,"rectangle",{id:`${e.name}-top`,label:{text:o},subtype:"actor"});if(!t)throw"Top Node element not found!";a.push([t]);let r=M(l,"rectangle",{id:`${e.name}-bottom`,label:{text:o},subtype:"actor"});a.push([r]);let i=n?.parentElement?.previousElementSibling;if(i?.tagName!=="line")throw"Line not found";let h=Number(i.getAttribute("x1"));if(!t.height)throw"Top node element height is null";let u=t.y+t.height,d=r.y,c=Number(i.getAttribute("x2")),p=$(i,h,u,c,d);s.push(p)}else if("actor"===e.type){let t=X(n,o,{id:`${e.name}-top`});a.push(t);let r=X(l,o,{id:`${e.name}-bottom`});a.push(r);let i=n.previousElementSibling;if(i?.tagName!=="line")throw"Line not found";let h=Number(i.getAttribute("x1")),u=Number(i.getAttribute("y1")),d=Number(i.getAttribute("x2")),c=r.find(e=>"ellipse"===e.type);if(c){let e=$(i,h,u,d,c.y);s.push(e)}}}),{nodes:a,lines:s}})(r.getActors(),t),o=r.getMessages(),h=((e,t)=>{let r=[],i=Array.from(t.querySelectorAll('[class*="messageLine"]')),a=Object.keys(_),s=e.filter(e=>a.includes(e.type.toString()));return i.forEach((e,t)=>{let i=s[t],a=_[i.type],n=((e,t)=>{let r={};t?.label&&(r.label={text:I(t.label),fontSize:16});let i=e.tagName;if("line"===i)r.startX=Number(e.getAttribute("x1")),r.startY=Number(e.getAttribute("y1")),r.endX=Number(e.getAttribute("x2")),r.endY=Number(e.getAttribute("y2"));else if("path"===i){let t=e.getAttribute("d");if(!t)throw Error('Path element does not contain a "d" attribute');let i=t.split(/(?=[LC])/),a=i[0].substring(1).split(",").map(e=>parseFloat(e)),s=[];i.forEach(e=>{let t=e.substring(1).trim().split(" ").map(e=>{let[t,r]=e.split(",");return[parseFloat(t)-a[0],parseFloat(r)-a[1]]});s.push(...t)});let n=s[s.length-1];r.startX=a[0],r.startY=a[1],r.endX=n[0],r.endY=n[1],r.points=s}return t?.label&&(r.startY=r.startY-10,r.endY=r.endY-10),r.strokeColor=e.getAttribute("stroke"),r.strokeWidth=Number(e.getAttribute("stroke-width")),r.type="arrow",r.strokeStyle=t?.strokeStyle||"solid",r.startArrowhead=t?.startArrowhead||null,r.endArrowhead=t?.endArrowhead||null,r})(e,{label:i?.message,strokeStyle:(e=>{let t;switch(e){case Y.SOLID:case Y.SOLID_CROSS:case Y.SOLID_OPEN:case Y.SOLID_POINT:t="solid";break;case Y.DOTTED:case Y.DOTTED_CROSS:case Y.DOTTED_OPEN:case Y.DOTTED_POINT:t="dotted";break;default:t="solid"}return t})(i.type),endArrowhead:"SOLID_OPEN"===a||"DOTTED_OPEN"===a?null:"arrow"});if(e.nextElementSibling?.classList.contains("sequenceNumber")){let t=e.nextElementSibling?.textContent;if(!t)throw Error("sequence number not present");let r={type:"rectangle",x:n.startX-10,y:n.startY-15,label:{text:t,fontSize:14},bgColor:"#e9ecef",height:30,subtype:"sequence"};Object.assign(n,{sequenceNumber:r})}r.push(n)}),r})(o,t),u=((e,t)=>{let r=Array.from(t.querySelectorAll(".note")).map(e=>e.parentElement),i=e.filter(e=>e.type===Y.NOTE),a=[];return r.forEach((e,t)=>{if(!e)return;let r=M(e.firstChild,"rectangle",{label:{text:i[t].message},subtype:"note"});a.push(r)}),a})(o,t),d=(e=>{let t=Array.from(e.querySelectorAll("[class*=activation]")),r=[];return t.forEach(e=>{let t=M(e,"rectangle",{label:{text:""},subtype:"activation"});r.push(t)}),r})(t),c=((e,t)=>{let r=Array.from(t.querySelectorAll(".loopLine")),i=[],a=[],s=[];r.forEach(e=>{let t=Number(e.getAttribute("x1")),r=Number(e.getAttribute("y1")),a=Number(e.getAttribute("x2")),s=Number(e.getAttribute("y2")),n=$(e,t,r,a,s);n.strokeStyle="dotted",n.strokeColor="#adb5bd",n.strokeWidth=2,i.push(n)});let n=Array.from(t.querySelectorAll(".loopText")),l=e.filter(e=>e.type===Y.CRITICAL_START).map(e=>e.message);n.forEach(e=>{let t=e.textContent||"",r=C(e,t),i=t.match(/\[(.*?)\]/)?.[1]||"";l.includes(i)&&(r.x+=16),a.push(r)});let o=Array.from(t?.querySelectorAll(".labelBox")),h=Array.from(t?.querySelectorAll(".labelText"));return o.forEach((e,t)=>{let r=M(e,"rectangle",{label:{text:h[t]?.textContent||""}});r.strokeColor="#adb5bd",r.bgColor="#e9ecef",r.width=void 0,s.push(r)}),{lines:i,texts:a,nodes:s}})(o,t);return i.push(s),i.push(...n),i.push(u),i.push(d),{type:"sequence",lines:l,arrows:h,nodes:i,loops:c,groups:a}})(i,n);break;case"classDiagram":r=((e,t)=>{e.parse();let r=e.parser.yy,i=r.getDirection(),a=[],s=[],n=[],l=[],o=r.getNamespaces(),h=r.getClasses();if(Object.keys(h).length){let e=((e,t)=>{let r=[],i=[],a=[];return Object.values(e).forEach(e=>{let{domId:s,id:n}=e,l=(0,b.x0)(),o=t.querySelector(`[data-id=${n}]`);if(!o)throw Error(`DOM Node with id ${s} not found`);let{transformX:h,transformY:u}=T(o),d=M(o.firstChild,"rectangle",{id:n,groupId:l});d.x+=h,d.y+=u,d.metadata={classId:n},r.push(d),Array.from(o.querySelectorAll(".divider")).forEach(e=>{let t=Number(e.getAttribute("x1")),r=Number(e.getAttribute("y1")),a=Number(e.getAttribute("x2")),s=Number(e.getAttribute("y2")),o=$(e,t,r,a,s,{groupId:l,id:(0,b.x0)()});o.startX+=h,o.startY+=u,o.endX+=h,o.endY+=u,o.metadata={classId:n},i.push(o)});let c=o.querySelector(".label")?.children;if(!c)throw"label nodes not found";Array.from(c).forEach(e=>{let t=e.textContent;if(!t)return;let r=(0,b.x0)(),{transformX:i,transformY:s}=T(e),o=e.getBBox(),d=D(h+i,u+s+10,t,{width:o.width,height:o.height,id:r,groupId:l,metadata:{classId:n}});a.push(d)})}),{nodes:r,lines:i,text:a}})(h,t);a.push(e.nodes),s.push(...e.lines),n.push(...e.text),l.push(...e.nodes)}let{arrows:u,text:d}=((e,t,r,i)=>{let a=r.querySelector(".edgePaths")?.children;if(!a)throw Error("No Edges found!");let s=[],n=[];return e.forEach((e,r)=>{let l,o,{id1:h,id2:u,relation:d}=e,c=t.find(e=>e.id===h),p=t.find(e=>e.id===u),g=(e=>{let t;switch(e){case z.LINE:t="solid";break;case z.DOTTED_LINE:t="dotted";break;default:t="solid"}return t})(d.lineType),f=j(d.type1),b=j(d.type2),y=N(a[r]),m=((e,t)=>{let r=["triangle_outline","diamond","diamond_outline"],i=t.startArrowhead&&r.includes(t.startArrowhead),a=t.endArrowhead&&r.includes(t.endArrowhead);return(a||i)&&(i&&("LR"===e?t.startX-=16:"RL"===e?t.startX+=16:"TB"===e?t.startY-=16:"BT"===e&&(t.startY+=16)),a&&("LR"===e?t.endX+=16:"RL"===e?t.endX-=16:"TB"===e?t.endY+=16:"BT"===e&&(t.endY-=16))),t})(i,L(y.startX,y.startY,y.endX,y.endY,{strokeStyle:g,startArrowhead:f,endArrowhead:b,label:e.title?{text:e.title}:void 0,start:{type:"rectangle",id:c.id},end:{type:"rectangle",id:p.id}}));s.push(m);let{relationTitle1:x,relationTitle2:w}=e;if(x&&"none"!==x){switch(i){case"TB":l=m.startX-20,m.endX<m.startX&&(l-=15),o=m.startY+15;break;case"BT":l=m.startX+20,m.endX>m.startX&&(l+=15),o=m.startY-15;break;case"LR":l=m.startX+20,o=m.startY+15,m.endY>m.startY&&(o+=15);break;case"RL":l=m.startX-20,o=m.startY-15,m.startY>m.endY&&(o-=15);break;default:l=m.startX-20,o=m.startY+15}let e=D(l,o,x,{fontSize:16});n.push(e)}if(w&&"none"!==w){switch(i){case"TB":l=m.endX+20,m.endX<m.startX&&(l+=15),o=m.endY-15;break;case"BT":l=m.endX-20,m.endX>m.startX&&(l-=15),o=m.endY+15;break;case"LR":l=m.endX-20,o=m.endY-15,m.endY>m.startY&&(o-=15);break;case"RL":l=m.endX+20,o=m.endY+15,m.startY>m.endY&&(o+=15);break;default:l=m.endX+20,o=m.endY-15}let e=D(l,o,w,{fontSize:16});n.push(e)}}),{arrows:s,text:n}})(r.getRelations(),l,t,i),{notes:c,connectors:p}=((e,t,r)=>{let i=[],a=[];return e.forEach(e=>{let{id:s,text:n,class:l}=e,o=t.querySelector(`#${s}`);if(!o)throw Error(`Node with id ${s} not found!`);let{transformX:h,transformY:u}=T(o),d=M(o.firstChild,"rectangle",{id:s,subtype:"note",label:{text:n}});if(Object.assign(d,{x:d.x+h,y:d.y+u}),i.push(d),l){let e=r.find(e=>e.id===l);if(!e)throw Error(`class node with id ${l} not found!`);let t=d.x+(d.width||0)/2,i=L(t,d.y+(d.height||0),t,e.y,{strokeStyle:"dotted",startArrowhead:null,endArrowhead:null,start:{id:d.id,type:"rectangle"},end:{id:e.id,type:"rectangle"}});a.push(i)}}),{notes:i,connectors:a}})(r.getNotes(),t,l);return a.push(c),u.push(...p),n.push(...d),{type:"class",nodes:a,lines:s,arrows:u,text:n,namespaces:o}})(i,n);break;default:r=(e=>{let t=e.querySelector("svg");if(!t)throw Error("SVG element not found");let r=t.getBoundingClientRect(),i=r.width,a=r.height;t.setAttribute("width",`${i}`),t.setAttribute("height",`${a}`);let s=btoa(unescape(encodeURIComponent(t.outerHTML)));return{type:"graphImage",mimeType:"image/svg+xml",dataURL:`data:image/svg+xml;base64,${s}`,width:i,height:a}})(n)}return n.remove(),r},B=async(e,t)=>{let r=t||{},i=parseInt(r.themeVariables?.fontSize??"")||20;return((e,t={})=>{switch(e.type){case"graphImage":return y.convert(e,t);case"flowchart":return f.convert(e,t);case"sequence":return S.convert(e,t);case"class":return O.convert(e,t);default:throw Error(`graphToExcalidraw: unknown graph type "${e.type}, only flowcharts are supported!"`)}})(await q(e,{...r,themeVariables:{...r.themeVariables,fontSize:`${1.25*i}px`}}),{fontSize:i})}}}]);