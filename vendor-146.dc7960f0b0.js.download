"use strict";(window.webpackChunkweb=window.webpackChunkweb||[]).push([["7716"],{121912:function(e,t,s){var r=s(350129),n=s(281088),i=function(e,t,s){for(var r,n=e;null!=(r=n.next);n=r)if(r.key===t)return n.next=r.next,s||(r.next=e.next,e.next=r),r},a=function(e,t){if(e){var s=i(e,t);return s&&s.value}},o=function(e,t,s){var r=i(e,t);r?r.value=s:e.next={key:t,next:e.next,value:s}},c=function(e,t){if(e)return i(e,t,!0)};e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new n("Side channel does not contain "+r(e))},delete:function(t){var s=e&&e.next,r=c(e,t);return r&&s&&s===r&&(e=void 0),!!r},get:function(t){return a(e,t)},has:function(t){var s;return!!(s=e)&&!!i(s,t)},set:function(t,s){e||(e={next:void 0}),o(e,t,s)}};return t}},693200:function(e,t,s){var r=s(794687),n=s(604823),i=s(350129),a=s(281088),o=r("%Map%",!0),c=n("Map.prototype.get",!0),h=n("Map.prototype.set",!0),l=n("Map.prototype.has",!0),u=n("Map.prototype.delete",!0),p=n("Map.prototype.size",!0);e.exports=!!o&&function(){var e,t={assert:function(e){if(!t.has(e))throw new a("Side channel does not contain "+i(e))},delete:function(t){if(e){var s=u(e,t);return 0===p(e)&&(e=void 0),s}return!1},get:function(t){if(e)return c(e,t)},has:function(t){return!!e&&l(e,t)},set:function(t,s){e||(e=new o),h(e,t,s)}};return t}},659111:function(e,t,s){var r=s(794687),n=s(604823),i=s(350129),a=s(693200),o=s(281088),c=r("%WeakMap%",!0),h=n("WeakMap.prototype.get",!0),l=n("WeakMap.prototype.set",!0),u=n("WeakMap.prototype.has",!0),p=n("WeakMap.prototype.delete",!0);e.exports=c?function(){var e,t,s={assert:function(e){if(!s.has(e))throw new o("Side channel does not contain "+i(e))},delete:function(s){if(c&&s&&("object"==typeof s||"function"==typeof s)){if(e)return p(e,s)}else if(a&&t)return t.delete(s);return!1},get:function(s){return c&&s&&("object"==typeof s||"function"==typeof s)&&e?h(e,s):t&&t.get(s)},has:function(s){return c&&s&&("object"==typeof s||"function"==typeof s)&&e?u(e,s):!!t&&t.has(s)},set:function(s,r){c&&s&&("object"==typeof s||"function"==typeof s)?(e||(e=new c),l(e,s,r)):a&&(t||(t=a()),t.set(s,r))}};return s}:a},510511:function(e,t,s){var r=s(281088),n=s(350129),i=s(121912),a=s(693200),o=s(659111)||a||i;e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new r("Side channel does not contain "+n(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,s){e||(e=o()),e.set(t,s)}};return t}},549808:function(e,t,s){s.d(t,{Bz:()=>ed,E9:()=>S,Hd:()=>g,Q2:()=>p,_X:()=>em});var r,n=s(173656);function i(e,...t){return t.forEach(t=>{for(let s in t)e[s]=t[s]}),e}var a=/\$(\d+)|\${(\d+):\/(downcase|upcase)}/g,o=class{static hasCaptures(e){return null!==e&&(a.lastIndex=0,a.test(e))}static replaceCaptures(e,t,s){return e.replace(a,(e,r,n,i)=>{let a=s[parseInt(r||n,10)];if(!a)return e;{let e=t.substring(a.start,a.end);for(;"."===e[0];)e=e.substring(1);switch(i){case"downcase":return e.toLowerCase();case"upcase":return e.toUpperCase();default:return e}}})}};function c(e,t){if(null===e&&null===t)return 0;if(!e)return -1;if(!t)return 1;let s=e.length,r=t.length;if(s===r){for(let r=0;r<s;r++){var n,i;let s=(n=e[r],n<(i=t[r])?-1:+(n>i));if(0!==s)return s}return 0}return s-r}function h(e){return!!(/^#[0-9a-f]{6}$/i.test(e)||/^#[0-9a-f]{8}$/i.test(e)||/^#[0-9a-f]{3}$/i.test(e)||/^#[0-9a-f]{4}$/i.test(e))}function l(e){return e.replace(/[\-\\\{\}\*\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&")}var u=class{constructor(e){this.fn=e}cache=new Map;get(e){if(this.cache.has(e))return this.cache.get(e);let t=this.fn(e);return this.cache.set(e,t),t}},p=class{constructor(e,t,s){this._colorMap=e,this._defaults=t,this._root=s}static createFromRawTheme(e,t){return this.createFromParsedTheme(function(e){if(!e||!e.settings||!Array.isArray(e.settings))return[];let t=e.settings,s=[],r=0;for(let e=0,n=t.length;e<n;e++){let n,i=t[e];if(!i.settings)continue;if("string"==typeof i.scope){let e=i.scope;n=(e=(e=e.replace(/^[,]+/,"")).replace(/[,]+$/,"")).split(",")}else n=Array.isArray(i.scope)?i.scope:[""];let a=-1;if("string"==typeof i.settings.fontStyle){a=0;let e=i.settings.fontStyle.split(" ");for(let t=0,s=e.length;t<s;t++)switch(e[t]){case"italic":a|=1;break;case"bold":a|=2;break;case"underline":a|=4;break;case"strikethrough":a|=8}}let o=null;"string"==typeof i.settings.foreground&&h(i.settings.foreground)&&(o=i.settings.foreground);let c=null;"string"==typeof i.settings.background&&h(i.settings.background)&&(c=i.settings.background);for(let t=0,i=n.length;t<i;t++){let i=n[t].trim().split(" "),h=i[i.length-1],l=null;i.length>1&&(l=i.slice(0,i.length-1)).reverse(),s[r++]=new _(h,l,e,a,o,c)}}return s}(e),t)}static createFromParsedTheme(e,t){return function(e,t){e.sort((e,t)=>{var s,r;let n=(s=e.scope,s<(r=t.scope)?-1:+(s>r));return 0!==n||0!==(n=c(e.parentScopes,t.parentScopes))?n:e.index-t.index});let s=0,r="#000000",n="#ffffff";for(;e.length>=1&&""===e[0].scope;){let t=e.shift();-1!==t.fontStyle&&(s=t.fontStyle),null!==t.foreground&&(r=t.foreground),null!==t.background&&(n=t.background)}let i=new f(t),a=new m(s,i.getId(r),i.getId(n)),o=new C(new y(0,null,-1,0,0),[]);for(let t=0,s=e.length;t<s;t++){let s=e[t];o.insert(0,s.scope,s.parentScopes,s.fontStyle,i.getId(s.foreground),i.getId(s.background))}return new p(i,a,o)}(e,t)}_cachedMatchRoot=new u(e=>this._root.match(e));getColorMap(){return this._colorMap.getColorMap()}getDefaults(){return this._defaults}match(e){if(null===e)return this._defaults;let t=e.scopeName,s=this._cachedMatchRoot.get(t).find(t=>(function(e,t){if(0===t.length)return!0;for(let n=0;n<t.length;n++){var s,r;let i=t[n],a=!1;if(">"===i){if(n===t.length-1)return!1;i=t[++n],a=!0}for(;e&&(s=e.scopeName,!((r=i)===s||s.startsWith(r)&&"."===s[r.length]));){if(a)return!1;e=e.parent}if(!e)return!1;e=e.parent}return!0})(e.parent,t.parentScopes));return s?new m(s.fontStyle,s.foreground,s.background):null}},d=class e{constructor(e,t){this.parent=e,this.scopeName=t}static push(t,s){for(let r of s)t=new e(t,r);return t}static from(...t){let s=null;for(let r=0;r<t.length;r++)s=new e(s,t[r]);return s}push(t){return new e(this,t)}getSegments(){let e=this,t=[];for(;e;)t.push(e.scopeName),e=e.parent;return t.reverse(),t}toString(){return this.getSegments().join(" ")}extends(e){return this===e||null!==this.parent&&this.parent.extends(e)}getExtensionIfDefined(e){let t=[],s=this;for(;s&&s!==e;)t.push(s.scopeName),s=s.parent;return s===e?t.reverse():void 0}},m=class{constructor(e,t,s){this.fontStyle=e,this.foregroundId=t,this.backgroundId=s}},_=class{constructor(e,t,s,r,n,i){this.scope=e,this.parentScopes=t,this.index=s,this.fontStyle=r,this.foreground=n,this.background=i}},g=((r=g||{})[r.NotSet=-1]="NotSet",r[r.None=0]="None",r[r.Italic=1]="Italic",r[r.Bold=2]="Bold",r[r.Underline=4]="Underline",r[r.Strikethrough=8]="Strikethrough",r),f=class{_isFrozen;_lastColorId;_id2color;_color2id;constructor(e){if(this._lastColorId=0,this._id2color=[],this._color2id=Object.create(null),Array.isArray(e)){this._isFrozen=!0;for(let t=0,s=e.length;t<s;t++)this._color2id[e[t]]=t,this._id2color[t]=e[t]}else this._isFrozen=!1}getId(e){if(null===e)return 0;e=e.toUpperCase();let t=this._color2id[e];if(t)return t;if(this._isFrozen)throw Error(`Missing color in color map - ${e}`);return t=++this._lastColorId,this._color2id[e]=t,this._id2color[t]=e,t}getColorMap(){return this._id2color.slice(0)}},k=Object.freeze([]),y=class e{scopeDepth;parentScopes;fontStyle;foreground;background;constructor(e,t,s,r,n){this.scopeDepth=e,this.parentScopes=t||k,this.fontStyle=s,this.foreground=r,this.background=n}clone(){return new e(this.scopeDepth,this.parentScopes,this.fontStyle,this.foreground,this.background)}static cloneArr(e){let t=[];for(let s=0,r=e.length;s<r;s++)t[s]=e[s].clone();return t}acceptOverwrite(e,t,s,r){this.scopeDepth>e?console.log("how did this happen?"):this.scopeDepth=e,-1!==t&&(this.fontStyle=t),0!==s&&(this.foreground=s),0!==r&&(this.background=r)}},C=class e{constructor(e,t=[],s={}){this._mainRule=e,this._children=s,this._rulesWithParentScopes=t}_rulesWithParentScopes;static _cmpBySpecificity(e,t){if(e.scopeDepth!==t.scopeDepth)return t.scopeDepth-e.scopeDepth;let s=0,r=0;for(;">"===e.parentScopes[s]&&s++,">"===t.parentScopes[r]&&r++,!(s>=e.parentScopes.length)&&!(r>=t.parentScopes.length);){let n=t.parentScopes[r].length-e.parentScopes[s].length;if(0!==n)return n;s++,r++}return t.parentScopes.length-e.parentScopes.length}match(t){if(""!==t){let e,s,r=t.indexOf(".");if(-1===r?(e=t,s=""):(e=t.substring(0,r),s=t.substring(r+1)),this._children.hasOwnProperty(e))return this._children[e].match(s)}let s=this._rulesWithParentScopes.concat(this._mainRule);return s.sort(e._cmpBySpecificity),s}insert(t,s,r,n,i,a){let o,c,h;if(""===s)return void this._doInsertHere(t,r,n,i,a);let l=s.indexOf(".");-1===l?(o=s,c=""):(o=s.substring(0,l),c=s.substring(l+1)),this._children.hasOwnProperty(o)?h=this._children[o]:(h=new e(this._mainRule.clone(),y.cloneArr(this._rulesWithParentScopes)),this._children[o]=h),h.insert(t+1,c,r,n,i,a)}_doInsertHere(e,t,s,r,n){if(null===t)return void this._mainRule.acceptOverwrite(e,s,r,n);for(let i=0,a=this._rulesWithParentScopes.length;i<a;i++){let a=this._rulesWithParentScopes[i];if(0===c(a.parentScopes,t))return void a.acceptOverwrite(e,s,r,n)}-1===s&&(s=this._mainRule.fontStyle),0===r&&(r=this._mainRule.foreground),0===n&&(n=this._mainRule.background),this._rulesWithParentScopes.push(new y(e,t,s,r,n))}},S=class e{static toBinaryStr(e){return e.toString(2).padStart(32,"0")}static print(t){let s=e.getLanguageId(t),r=e.getTokenType(t),n=e.getFontStyle(t);console.log({languageId:s,tokenType:r,fontStyle:n,foreground:e.getForeground(t),background:e.getBackground(t)})}static getLanguageId(e){return(255&e)>>>0}static getTokenType(e){return(768&e)>>>8}static containsBalancedBrackets(e){return(1024&e)!=0}static getFontStyle(e){return(30720&e)>>>11}static getForeground(e){return(0xff8000&e)>>>15}static getBackground(e){return(0xff000000&e)>>>24}static set(t,s,r,n,i,a,o){let c=e.getLanguageId(t),h=e.getTokenType(t),l=+!!e.containsBalancedBrackets(t),u=e.getFontStyle(t),p=e.getForeground(t),d=e.getBackground(t);return 0!==s&&(c=s),8!==r&&(h=r),null!==n&&(l=+!!n),-1!==i&&(u=i),0!==a&&(p=a),0!==o&&(d=o),(0|c|h<<8|l<<10|u<<11|p<<15|d<<24)>>>0}};function b(e,t){var s;let r,n,i=[],a=(s=e,n=(r=/([LR]:|[\w\.:][\w\.:\-]*|[\,\|\-\(\)])/g).exec(s),{next:()=>{if(!n)return null;let e=n[0];return n=r.exec(s),e}}),o=a.next();for(;null!==o;){let e=0;if(2===o.length&&":"===o.charAt(1)){switch(o.charAt(0)){case"R":e=1;break;case"L":e=-1;break;default:console.log(`Unknown priority ${o} in scope selector`)}o=a.next()}let t=h();if(i.push({matcher:t,priority:e}),","!==o)break;o=a.next()}return i;function c(){if("-"===o){o=a.next();let e=c();return t=>!!e&&!e(t)}if("("===o){o=a.next();let e=function(){let e=[],t=h();for(;t&&(e.push(t),"|"===o||","===o);){do o=a.next();while("|"===o||","===o);t=h()}return t=>e.some(e=>e(t))}();return")"===o&&(o=a.next()),e}if(w(o)){let e=[];do e.push(o),o=a.next();while(w(o));return s=>t(e,s)}return null}function h(){let e=[],t=c();for(;t;)e.push(t),t=c();return t=>e.every(e=>e(t))}}function w(e){return!!e&&!!e.match(/[\w\.:]+/)}function A(e){"function"==typeof e.dispose&&e.dispose()}var P=class{constructor(e){this.scopeName=e}toKey(){return this.scopeName}},R=class{constructor(e,t){this.scopeName=e,this.ruleName=t}toKey(){return`${this.scopeName}#${this.ruleName}`}},I=class{_references=[];_seenReferenceKeys=new Set;get references(){return this._references}visitedRule=new Set;add(e){let t=e.toKey();this._seenReferenceKeys.has(t)||(this._seenReferenceKeys.add(t),this._references.push(e))}},N=class{constructor(e,t){this.repo=e,this.initialScopeName=t,this.seenFullScopeRequests.add(this.initialScopeName),this.Q=[new P(this.initialScopeName)]}seenFullScopeRequests=new Set;seenPartialScopeRequests=new Set;Q;processQueue(){let e=this.Q;this.Q=[];let t=new I;for(let s of e)!function(e,t,s,r){let n=s.lookup(e.scopeName);if(!n){if(e.scopeName===t)throw Error(`No grammar provided for <${t}>`);return}let i=s.lookup(t);e instanceof P?v({baseGrammar:i,selfGrammar:n},r):G(e.ruleName,{baseGrammar:i,selfGrammar:n,repository:n.repository},r);let a=s.injections(e.scopeName);if(a)for(let e of a)r.add(new P(e))}(s,this.initialScopeName,this.repo,t);for(let e of t.references)if(e instanceof P){if(this.seenFullScopeRequests.has(e.scopeName))continue;this.seenFullScopeRequests.add(e.scopeName),this.Q.push(e)}else{if(this.seenFullScopeRequests.has(e.scopeName)||this.seenPartialScopeRequests.has(e.toKey()))continue;this.seenPartialScopeRequests.add(e.toKey()),this.Q.push(e)}}};function G(e,t,s){t.repository&&t.repository[e]&&x([t.repository[e]],t,s)}function v(e,t){e.selfGrammar.patterns&&Array.isArray(e.selfGrammar.patterns)&&x(e.selfGrammar.patterns,{...e,repository:e.selfGrammar.repository},t),e.selfGrammar.injections&&x(Object.values(e.selfGrammar.injections),{...e,repository:e.selfGrammar.repository},t)}function x(e,t,s){for(let r of e){if(s.visitedRule.has(r))continue;s.visitedRule.add(r);let e=r.repository?i({},t.repository,r.repository):t.repository;Array.isArray(r.patterns)&&x(r.patterns,{...t,repository:e},s);let n=r.include;if(!n)continue;let a=$(n);switch(a.kind){case 0:v({...t,selfGrammar:t.baseGrammar},s);break;case 1:v(t,s);break;case 2:G(a.ruleName,{...t,repository:e},s);break;case 3:case 4:let o=a.scopeName===t.selfGrammar.scopeName?t.selfGrammar:a.scopeName===t.baseGrammar.scopeName?t.baseGrammar:void 0;if(o){let r={baseGrammar:t.baseGrammar,selfGrammar:o,repository:e};4===a.kind?G(a.ruleName,r,s):v(r,s)}else 4===a.kind?s.add(new R(a.scopeName,a.ruleName)):s.add(new P(a.scopeName))}}}var E=class{kind=0},T=class{kind=1},L=class{constructor(e){this.ruleName=e}kind=2},M=class{constructor(e){this.scopeName=e}kind=3},B=class{constructor(e,t){this.scopeName=e,this.ruleName=t}kind=4};function $(e){if("$base"===e)return new E;if("$self"===e)return new T;let t=e.indexOf("#");return -1===t?new M(e):0===t?new L(e.substring(1)):new B(e.substring(0,t),e.substring(t+1))}var j=/\\(\d+)/,W=/\\(\d+)/g;Symbol("RuleId");var O=class{$location;id;_nameIsCapturing;_name;_contentNameIsCapturing;_contentName;constructor(e,t,s,r){this.$location=e,this.id=t,this._name=s||null,this._nameIsCapturing=o.hasCaptures(this._name),this._contentName=r||null,this._contentNameIsCapturing=o.hasCaptures(this._contentName)}get debugName(){let e=this.$location?`${function e(t){let s=~t.lastIndexOf("/")||~t.lastIndexOf("\\");return 0===s?t:~s==t.length-1?e(t.substring(0,t.length-1)):t.substr(~s+1)}(this.$location.filename)}:${this.$location.line}`:"unknown";return`${this.constructor.name}#${this.id} @ ${e}`}getName(e,t){return this._nameIsCapturing&&null!==this._name&&null!==e&&null!==t?o.replaceCaptures(this._name,e,t):this._name}getContentName(e,t){return this._contentNameIsCapturing&&null!==this._contentName?o.replaceCaptures(this._contentName,e,t):this._contentName}},F=class extends O{retokenizeCapturedWithRuleId;constructor(e,t,s,r,n){super(e,t,s,r),this.retokenizeCapturedWithRuleId=n}dispose(){}collectPatterns(e,t){throw Error("Not supported!")}compile(e,t){throw Error("Not supported!")}compileAG(e,t,s,r){throw Error("Not supported!")}},D=class extends O{_match;captures;_cachedCompiledPatterns;constructor(e,t,s,r,n){super(e,t,s,null),this._match=new K(r,this.id),this.captures=n,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugMatchRegExp(){return`${this._match.source}`}collectPatterns(e,t){t.push(this._match)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,s,r){return this._getCachedCompiledPatterns(e).compileAG(e,s,r)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new H,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},q=class extends O{hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,s,r,n){super(e,t,s,r),this.patterns=n.patterns,this.hasMissingPatterns=n.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}collectPatterns(e,t){for(let s of this.patterns)e.getRule(s).collectPatterns(e,t)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,s,r){return this._getCachedCompiledPatterns(e).compileAG(e,s,r)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new H,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},z=class extends O{_begin;beginCaptures;_end;endHasBackReferences;endCaptures;applyEndPatternLast;hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,s,r,n,i,a,o,c,h){super(e,t,s,r),this._begin=new K(n,this.id),this.beginCaptures=i,this._end=new K(a||"\uFFFF",-1),this.endHasBackReferences=this._end.hasBackReferences,this.endCaptures=o,this.applyEndPatternLast=c||!1,this.patterns=h.patterns,this.hasMissingPatterns=h.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugEndRegExp(){return`${this._end.source}`}getEndWithResolvedBackReferences(e,t){return this._end.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e,t).compile(e)}compileAG(e,t,s,r){return this._getCachedCompiledPatterns(e,t).compileAG(e,s,r)}_getCachedCompiledPatterns(e,t){if(!this._cachedCompiledPatterns){for(let t of(this._cachedCompiledPatterns=new H,this.patterns))e.getRule(t).collectPatterns(e,this._cachedCompiledPatterns);this.applyEndPatternLast?this._cachedCompiledPatterns.push(this._end.hasBackReferences?this._end.clone():this._end):this._cachedCompiledPatterns.unshift(this._end.hasBackReferences?this._end.clone():this._end)}return this._end.hasBackReferences&&(this.applyEndPatternLast?this._cachedCompiledPatterns.setSource(this._cachedCompiledPatterns.length()-1,t):this._cachedCompiledPatterns.setSource(0,t)),this._cachedCompiledPatterns}},U=class extends O{_begin;beginCaptures;whileCaptures;_while;whileHasBackReferences;hasMissingPatterns;patterns;_cachedCompiledPatterns;_cachedCompiledWhilePatterns;constructor(e,t,s,r,n,i,a,o,c){super(e,t,s,r),this._begin=new K(n,this.id),this.beginCaptures=i,this.whileCaptures=o,this._while=new K(a,-2),this.whileHasBackReferences=this._while.hasBackReferences,this.patterns=c.patterns,this.hasMissingPatterns=c.hasMissingPatterns,this._cachedCompiledPatterns=null,this._cachedCompiledWhilePatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null),this._cachedCompiledWhilePatterns&&(this._cachedCompiledWhilePatterns.dispose(),this._cachedCompiledWhilePatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugWhileRegExp(){return`${this._while.source}`}getWhileWithResolvedBackReferences(e,t){return this._while.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,s,r){return this._getCachedCompiledPatterns(e).compileAG(e,s,r)}_getCachedCompiledPatterns(e){if(!this._cachedCompiledPatterns)for(let t of(this._cachedCompiledPatterns=new H,this.patterns))e.getRule(t).collectPatterns(e,this._cachedCompiledPatterns);return this._cachedCompiledPatterns}compileWhile(e,t){return this._getCachedCompiledWhilePatterns(e,t).compile(e)}compileWhileAG(e,t,s,r){return this._getCachedCompiledWhilePatterns(e,t).compileAG(e,s,r)}_getCachedCompiledWhilePatterns(e,t){return this._cachedCompiledWhilePatterns||(this._cachedCompiledWhilePatterns=new H,this._cachedCompiledWhilePatterns.push(this._while.hasBackReferences?this._while.clone():this._while)),this._while.hasBackReferences&&this._cachedCompiledWhilePatterns.setSource(0,t||"\uFFFF"),this._cachedCompiledWhilePatterns}},Q=class e{static createCaptureRule(e,t,s,r,n){return e.registerRule(e=>new F(t,e,s,r,n))}static getCompiledRuleId(t,s,r){return t.id||s.registerRule(n=>{if(t.id=n,t.match)return new D(t.$vscodeTextmateLocation,t.id,t.name,t.match,e._compileCaptures(t.captures,s,r));if(void 0===t.begin){t.repository&&(r=i({},r,t.repository));let n=t.patterns;return void 0===n&&t.include&&(n=[{include:t.include}]),new q(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,e._compilePatterns(n,s,r))}return t.while?new U(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,t.begin,e._compileCaptures(t.beginCaptures||t.captures,s,r),t.while,e._compileCaptures(t.whileCaptures||t.captures,s,r),e._compilePatterns(t.patterns,s,r)):new z(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,t.begin,e._compileCaptures(t.beginCaptures||t.captures,s,r),t.end,e._compileCaptures(t.endCaptures||t.captures,s,r),t.applyEndPatternLast,e._compilePatterns(t.patterns,s,r))}),t.id}static _compileCaptures(t,s,r){let n=[];if(t){let i=0;for(let e in t){if("$vscodeTextmateLocation"===e)continue;let t=parseInt(e,10);t>i&&(i=t)}for(let e=0;e<=i;e++)n[e]=null;for(let i in t){if("$vscodeTextmateLocation"===i)continue;let a=parseInt(i,10),o=0;t[i].patterns&&(o=e.getCompiledRuleId(t[i],s,r)),n[a]=e.createCaptureRule(s,t[i].$vscodeTextmateLocation,t[i].name,t[i].contentName,o)}}return n}static _compilePatterns(t,s,r){let n=[];if(t)for(let i=0,a=t.length;i<a;i++){let a=t[i],o=-1;if(a.include){let t=$(a.include);switch(t.kind){case 0:case 1:o=e.getCompiledRuleId(r[a.include],s,r);break;case 2:let n=r[t.ruleName];n&&(o=e.getCompiledRuleId(n,s,r));break;case 3:case 4:let i=t.scopeName,c=4===t.kind?t.ruleName:null,h=s.getExternalGrammar(i,r);if(h)if(c){let t=h.repository[c];t&&(o=e.getCompiledRuleId(t,s,h.repository))}else o=e.getCompiledRuleId(h.repository.$self,s,h.repository)}}else o=e.getCompiledRuleId(a,s,r);if(-1!==o){let e=s.getRule(o),t=!1;if((e instanceof q||e instanceof z||e instanceof U)&&e.hasMissingPatterns&&0===e.patterns.length&&(t=!0),t)continue;n.push(o)}}return{patterns:n,hasMissingPatterns:(t?t.length:0)!==n.length}}},K=class e{source;ruleId;hasAnchor;hasBackReferences;_anchorCache;constructor(e,t){if(e&&"string"==typeof e){let t=e.length,s=0,r=[],n=!1;for(let i=0;i<t;i++)if("\\"===e.charAt(i)&&i+1<t){let t=e.charAt(i+1);"z"===t?(r.push(e.substring(s,i)),r.push("$(?!\\n)(?<!\\n)"),s=i+2):("A"===t||"G"===t)&&(n=!0),i++}this.hasAnchor=n,0===s?this.source=e:(r.push(e.substring(s,t)),this.source=r.join(""))}else this.hasAnchor=!1,this.source=e;this.hasAnchor?this._anchorCache=this._buildAnchorCache():this._anchorCache=null,this.ruleId=t,"string"==typeof this.source?this.hasBackReferences=j.test(this.source):this.hasBackReferences=!1}clone(){return new e(this.source,this.ruleId)}setSource(e){this.source!==e&&(this.source=e,this.hasAnchor&&(this._anchorCache=this._buildAnchorCache()))}resolveBackReferences(e,t){if("string"!=typeof this.source)throw Error("This method should only be called if the source is a string");let s=t.map(t=>e.substring(t.start,t.end));return W.lastIndex=0,this.source.replace(W,(e,t)=>l(s[parseInt(t,10)]||""))}_buildAnchorCache(){let e,t,s,r;if("string"!=typeof this.source)throw Error("This method should only be called if the source is a string");let n=[],i=[],a=[],o=[];for(e=0,t=this.source.length;e<t;e++)s=this.source.charAt(e),n[e]=s,i[e]=s,a[e]=s,o[e]=s,"\\"===s&&e+1<t&&("A"===(r=this.source.charAt(e+1))?(n[e+1]="\uFFFF",i[e+1]="\uFFFF",a[e+1]="A",o[e+1]="A"):"G"===r?(n[e+1]="\uFFFF",i[e+1]="G",a[e+1]="\uFFFF",o[e+1]="G"):(n[e+1]=r,i[e+1]=r,a[e+1]=r,o[e+1]=r),e++);return{A0_G0:n.join(""),A0_G1:i.join(""),A1_G0:a.join(""),A1_G1:o.join("")}}resolveAnchors(e,t){if(!this.hasAnchor||!this._anchorCache||"string"!=typeof this.source)return this.source;if(e)if(t)return this._anchorCache.A1_G1;else return this._anchorCache.A1_G0;return t?this._anchorCache.A0_G1:this._anchorCache.A0_G0}},H=class{_items;_hasAnchors;_cached;_anchorCache;constructor(){this._items=[],this._hasAnchors=!1,this._cached=null,this._anchorCache={A0_G0:null,A0_G1:null,A1_G0:null,A1_G1:null}}dispose(){this._disposeCaches()}_disposeCaches(){this._cached&&(this._cached.dispose(),this._cached=null),this._anchorCache.A0_G0&&(this._anchorCache.A0_G0.dispose(),this._anchorCache.A0_G0=null),this._anchorCache.A0_G1&&(this._anchorCache.A0_G1.dispose(),this._anchorCache.A0_G1=null),this._anchorCache.A1_G0&&(this._anchorCache.A1_G0.dispose(),this._anchorCache.A1_G0=null),this._anchorCache.A1_G1&&(this._anchorCache.A1_G1.dispose(),this._anchorCache.A1_G1=null)}push(e){this._items.push(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}unshift(e){this._items.unshift(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}length(){return this._items.length}setSource(e,t){this._items[e].source!==t&&(this._disposeCaches(),this._items[e].setSource(t))}compile(e){if(!this._cached){let t=this._items.map(e=>e.source);this._cached=new X(e,t,this._items.map(e=>e.ruleId))}return this._cached}compileAG(e,t,s){if(!this._hasAnchors)return this.compile(e);if(t)if(s)return this._anchorCache.A1_G1||(this._anchorCache.A1_G1=this._resolveAnchors(e,t,s)),this._anchorCache.A1_G1;else return this._anchorCache.A1_G0||(this._anchorCache.A1_G0=this._resolveAnchors(e,t,s)),this._anchorCache.A1_G0;return s?(this._anchorCache.A0_G1||(this._anchorCache.A0_G1=this._resolveAnchors(e,t,s)),this._anchorCache.A0_G1):(this._anchorCache.A0_G0||(this._anchorCache.A0_G0=this._resolveAnchors(e,t,s)),this._anchorCache.A0_G0)}_resolveAnchors(e,t,s){return new X(e,this._items.map(e=>e.resolveAnchors(t,s)),this._items.map(e=>e.ruleId))}},X=class{constructor(e,t,s){this.regExps=t,this.rules=s,this.scanner=e.createOnigScanner(t)}scanner;dispose(){"function"==typeof this.scanner.dispose&&this.scanner.dispose()}toString(){let e=[];for(let t=0,s=this.rules.length;t<s;t++)e.push("   - "+this.rules[t]+": "+this.regExps[t]);return e.join("\n")}findNextMatchSync(e,t,s){let r=this.scanner.findNextMatchSync(e,t,s);return r?{ruleId:this.rules[r.index],captureIndices:r.captureIndices}:null}},V=class{constructor(e,t){this.languageId=e,this.tokenType=t}},Y=class e{_defaultAttributes;_embeddedLanguagesMatcher;constructor(e,t){this._defaultAttributes=new V(e,8),this._embeddedLanguagesMatcher=new J(Object.entries(t||{}))}getDefaultAttributes(){return this._defaultAttributes}getBasicScopeAttributes(t){return null===t?e._NULL_SCOPE_METADATA:this._getBasicScopeAttributes.get(t)}static _NULL_SCOPE_METADATA=new V(0,0);_getBasicScopeAttributes=new u(e=>new V(this._scopeToLanguage(e),this._toStandardTokenType(e)));_scopeToLanguage(e){return this._embeddedLanguagesMatcher.match(e)||0}_toStandardTokenType(t){let s=t.match(e.STANDARD_TOKEN_TYPE_REGEXP);if(!s)return 8;switch(s[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"meta.embedded":return 0}throw Error("Unexpected match for standard token type!")}static STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|meta\.embedded)\b/},J=class{values;scopesRegExp;constructor(e){if(0===e.length)this.values=null,this.scopesRegExp=null;else{this.values=new Map(e);let t=e.map(([e,t])=>l(e));t.sort(),t.reverse(),this.scopesRegExp=RegExp(`^((${t.join(")|(")}))($|\\.)`,"")}}match(e){if(!this.scopesRegExp)return;let t=e.match(this.scopesRegExp);if(t)return this.values.get(t[1])}};void 0!==n&&n.env.VSCODE_TEXTMATE_DEBUG;var Z=class{constructor(e,t){this.stack=e,this.stoppedEarly=t}};function ee(e,t,s,r,n,i,a,o){let c=t.content.length,h=!1,l=-1;if(a){let a=function(e,t,s,r,n,i){let a=n.beginRuleCapturedEOL?0:-1,o=[];for(let t=n;t;t=t.pop()){let s=t.getRule(e);s instanceof U&&o.push({rule:s,stack:t})}for(let d=o.pop();d;d=o.pop()){var c,h,l,u,p;let{ruleScanner:o,findOptions:m}=(c=d.rule,h=e,l=d.stack.endRule,u=s,p=r===a,{ruleScanner:c.compileWhileAG(h,l,u,p),findOptions:0}),_=o.findNextMatchSync(t,r,m);if(_){if(-2!==_.ruleId){n=d.stack.pop();break}_.captureIndices&&_.captureIndices.length&&(i.produce(d.stack,_.captureIndices[0].start),es(e,t,s,d.stack,i,d.rule.whileCaptures,_.captureIndices),i.produce(d.stack,_.captureIndices[0].end),a=_.captureIndices[0].end,_.captureIndices[0].end>r&&(r=_.captureIndices[0].end,s=!1))}else{n=d.stack.pop();break}}return{stack:n,linePos:r,anchorPosition:a,isFirstLine:s}}(e,t,s,r,n,i);n=a.stack,r=a.linePos,s=a.isFirstLine,l=a.anchorPosition}let u=Date.now();for(;!h;){if(0!==o&&Date.now()-u>o)return new Z(n,!0);!function(){let a=function(e,t,s,r,n,i){let a=function(e,t,s,r,n,i){let{ruleScanner:a,findOptions:o}=et(n.getRule(e),e,n.endRule,s,r===i),c=a.findNextMatchSync(t,r,o);return c?{captureIndices:c.captureIndices,matchedRuleId:c.ruleId}:null}(e,t,s,r,n,i),o=e.getInjections();if(0===o.length)return a;let c=function(e,t,s,r,n,i,a){let o,c=Number.MAX_VALUE,h=null,l=0,u=i.contentNameScopesList.getScopeNames();for(let i=0,p=e.length;i<p;i++){let p=e[i];if(!p.matcher(u))continue;let{ruleScanner:d,findOptions:m}=et(t.getRule(p.ruleId),t,null,r,n===a),_=d.findNextMatchSync(s,n,m);if(!_)continue;let g=_.captureIndices[0].start;if(!(g>=c)&&(c=g,h=_.captureIndices,o=_.ruleId,l=p.priority,c===n))break}return h?{priorityMatch:-1===l,captureIndices:h,matchedRuleId:o}:null}(o,e,t,s,r,n,i);if(!c)return a;if(!a)return c;let h=a.captureIndices[0].start,l=c.captureIndices[0].start;return l<h||c.priorityMatch&&l===h?c:a}(e,t,s,r,n,l);if(!a){i.produce(n,c),h=!0;return}let o=a.captureIndices,u=a.matchedRuleId,p=!!o&&o.length>0&&o[0].end>r;if(-1===u){let a=n.getRule(e);i.produce(n,o[0].start),n=n.withContentNameScopesList(n.nameScopesList),es(e,t,s,n,i,a.endCaptures,o),i.produce(n,o[0].end);let u=n;if(n=n.parent,l=u.getAnchorPos(),!p&&u.getEnterPos()===r){n=u,i.produce(n,c),h=!0;return}}else{let a=e.getRule(u);i.produce(n,o[0].start);let d=n,m=a.getName(t.content,o),_=n.contentNameScopesList.pushAttributed(m,e);if(n=n.push(u,r,l,o[0].end===c,null,_,_),a instanceof z){es(e,t,s,n,i,a.beginCaptures,o),i.produce(n,o[0].end),l=o[0].end;let r=a.getContentName(t.content,o),u=_.pushAttributed(r,e);if(n=n.withContentNameScopesList(u),a.endHasBackReferences&&(n=n.withEndRule(a.getEndWithResolvedBackReferences(t.content,o))),!p&&d.hasSameRuleAs(n)){n=n.pop(),i.produce(n,c),h=!0;return}}else if(a instanceof U){es(e,t,s,n,i,a.beginCaptures,o),i.produce(n,o[0].end),l=o[0].end;let r=a.getContentName(t.content,o),u=_.pushAttributed(r,e);if(n=n.withContentNameScopesList(u),a.whileHasBackReferences&&(n=n.withEndRule(a.getWhileWithResolvedBackReferences(t.content,o))),!p&&d.hasSameRuleAs(n)){n=n.pop(),i.produce(n,c),h=!0;return}}else if(es(e,t,s,n,i,a.captures,o),i.produce(n,o[0].end),n=n.pop(),!p){n=n.safePop(),i.produce(n,c),h=!0;return}}o[0].end>r&&(r=o[0].end,s=!1)}()}return new Z(n,!1)}function et(e,t,s,r,n){return{ruleScanner:e.compileAG(t,s,r,n),findOptions:0}}function es(e,t,s,r,n,i,a){if(0===i.length)return;let o=t.content,c=Math.min(i.length,a.length),h=[],l=a[0].end;for(let t=0;t<c;t++){let c=i[t];if(null===c)continue;let u=a[t];if(0===u.length)continue;if(u.start>l)break;for(;h.length>0&&h[h.length-1].endPos<=u.start;)n.produceFromScopes(h[h.length-1].scopes,h[h.length-1].endPos),h.pop();if(h.length>0?n.produceFromScopes(h[h.length-1].scopes,u.start):n.produce(r,u.start),c.retokenizeCapturedWithRuleId){let t=c.getName(o,a),i=r.contentNameScopesList.pushAttributed(t,e),h=c.getContentName(o,a),l=i.pushAttributed(h,e),p=r.push(c.retokenizeCapturedWithRuleId,u.start,-1,!1,null,i,l),d=e.createOnigString(o.substring(0,u.end));ee(e,d,s&&0===u.start,u.start,p,n,!1,0),A(d);continue}let p=c.getName(o,a);if(null!==p){let t=(h.length>0?h[h.length-1].scopes:r.contentNameScopesList).pushAttributed(p,e);h.push(new er(t,u.end))}}for(;h.length>0;)n.produceFromScopes(h[h.length-1].scopes,h[h.length-1].endPos),h.pop()}var er=class{scopes;endPos;constructor(e,t){this.scopes=e,this.endPos=t}};function en(e,t,s,r,n){let i=b(t,ei),a=Q.getCompiledRuleId(s,r,n.repository);for(let s of i)e.push({debugSelector:t,matcher:s.matcher,ruleId:a,grammar:n,priority:s.priority})}function ei(e,t){if(t.length<e.length)return!1;let s=0;return e.every(e=>{for(let r=s;r<t.length;r++)if(function(e,t){if(!e)return!1;if(e===t)return!0;let s=t.length;return e.length>s&&e.substr(0,s)===t&&"."===e[s]}(t[r],e))return s=r+1,!0;return!1})}var ea=class{constructor(e,t,s,r,n,i,a,o){if(this._rootScopeName=e,this.balancedBracketSelectors=i,this._onigLib=o,this._basicScopeAttributesProvider=new Y(s,r),this._rootId=-1,this._lastRuleId=0,this._ruleId2desc=[null],this._includedGrammars={},this._grammarRepository=a,this._grammar=eo(t,null),this._injections=null,this._tokenTypeMatchers=[],n)for(let e of Object.keys(n))for(let t of b(e,ei))this._tokenTypeMatchers.push({matcher:t.matcher,type:n[e]})}_rootId;_lastRuleId;_ruleId2desc;_includedGrammars;_grammarRepository;_grammar;_injections;_basicScopeAttributesProvider;_tokenTypeMatchers;get themeProvider(){return this._grammarRepository}dispose(){for(let e of this._ruleId2desc)e&&e.dispose()}createOnigScanner(e){return this._onigLib.createOnigScanner(e)}createOnigString(e){return this._onigLib.createOnigString(e)}getMetadataForScope(e){return this._basicScopeAttributesProvider.getBasicScopeAttributes(e)}_collectInjections(){let e=[],t=this._rootScopeName,s=({lookup:e=>e===this._rootScopeName?this._grammar:this.getExternalGrammar(e),injections:e=>this._grammarRepository.injections(e)}).lookup(t);if(s){let r=s.injections;if(r)for(let t in r)en(e,t,r[t],this,s);let n=this._grammarRepository.injections(t);n&&n.forEach(t=>{let s=this.getExternalGrammar(t);if(s){let t=s.injectionSelector;t&&en(e,t,s,this,s)}})}return e.sort((e,t)=>e.priority-t.priority),e}getInjections(){return null===this._injections&&(this._injections=this._collectInjections()),this._injections}registerRule(e){let t=++this._lastRuleId,s=e(t);return this._ruleId2desc[t]=s,s}getRule(e){return this._ruleId2desc[e]}getExternalGrammar(e,t){if(this._includedGrammars[e])return this._includedGrammars[e];if(this._grammarRepository){let s=this._grammarRepository.lookup(e);if(s)return this._includedGrammars[e]=eo(s,t&&t.$base),this._includedGrammars[e]}}tokenizeLine(e,t,s=0){let r=this._tokenize(e,t,!1,s);return{tokens:r.lineTokens.getResult(r.ruleStack,r.lineLength),ruleStack:r.ruleStack,stoppedEarly:r.stoppedEarly}}tokenizeLine2(e,t,s=0){let r=this._tokenize(e,t,!0,s);return{tokens:r.lineTokens.getBinaryResult(r.ruleStack,r.lineLength),ruleStack:r.ruleStack,stoppedEarly:r.stoppedEarly}}_tokenize(e,t,s,r){let n;if(-1===this._rootId&&(this._rootId=Q.getCompiledRuleId(this._grammar.repository.$self,this,this._grammar.repository),this.getInjections()),t&&t!==eh.NULL)n=!1,t.reset();else{let e;n=!0;let s=this._basicScopeAttributesProvider.getDefaultAttributes(),r=this.themeProvider.getDefaults(),i=S.set(0,s.languageId,s.tokenType,null,r.fontStyle,r.foregroundId,r.backgroundId),a=this.getRule(this._rootId).getName(null,null);e=a?ec.createRootAndLookUpScopeName(a,i,this):ec.createRoot("unknown",i),t=new eh(null,this._rootId,-1,-1,!1,null,e,e)}e+="\n";let i=this.createOnigString(e),a=i.content.length,o=new eu(s,e,this._tokenTypeMatchers,this.balancedBracketSelectors),c=ee(this,i,n,0,t,o,!0,r);return A(i),{lineLength:a,lineTokens:o,ruleStack:c.stack,stoppedEarly:c.stoppedEarly}}};function eo(e,t){return(e=function e(t){return Array.isArray(t)?function(t){let s=[];for(let r=0,n=t.length;r<n;r++)s[r]=e(t[r]);return s}(t):t instanceof RegExp?t:"object"==typeof t?function(t){let s={};for(let r in t)s[r]=e(t[r]);return s}(t):t}(e)).repository=e.repository||{},e.repository.$self={$vscodeTextmateLocation:e.$vscodeTextmateLocation,patterns:e.patterns,name:e.scopeName},e.repository.$base=t||e.repository.$self,e}var ec=class e{constructor(e,t,s){this.parent=e,this.scopePath=t,this.tokenAttributes=s}static fromExtension(t,s){let r=t,n=t?.scopePath??null;for(let t of s)r=new e(r,n=d.push(n,t.scopeNames),t.encodedTokenAttributes);return r}static createRoot(t,s){return new e(null,new d(null,t),s)}static createRootAndLookUpScopeName(t,s,r){let n=r.getMetadataForScope(t),i=new d(null,t),a=r.themeProvider.themeMatch(i),o=e.mergeAttributes(s,n,a);return new e(null,i,o)}get scopeName(){return this.scopePath.scopeName}toString(){return this.getScopeNames().join(" ")}equals(t){return e.equals(this,t)}static equals(e,t){for(;;){if(e===t||!e&&!t)return!0;if(!e||!t||e.scopeName!==t.scopeName||e.tokenAttributes!==t.tokenAttributes)return!1;e=e.parent,t=t.parent}}static mergeAttributes(e,t,s){let r=-1,n=0,i=0;return null!==s&&(r=s.fontStyle,n=s.foregroundId,i=s.backgroundId),S.set(e,t.languageId,t.tokenType,null,r,n,i)}pushAttributed(t,s){if(null===t)return this;if(-1===t.indexOf(" "))return e._pushAttributed(this,t,s);let r=t.split(/ /g),n=this;for(let t of r)n=e._pushAttributed(n,t,s);return n}static _pushAttributed(t,s,r){let n=r.getMetadataForScope(s),i=t.scopePath.push(s),a=r.themeProvider.themeMatch(i),o=e.mergeAttributes(t.tokenAttributes,n,a);return new e(t,i,o)}getScopeNames(){return this.scopePath.getSegments()}getExtensionIfDefined(e){let t=[],s=this;for(;s&&s!==e;)t.push({encodedTokenAttributes:s.tokenAttributes,scopeNames:s.scopePath.getExtensionIfDefined(s.parent?.scopePath??null)}),s=s.parent;return s===e?t.reverse():void 0}},eh=class e{constructor(e,t,s,r,n,i,a,o){this.parent=e,this.ruleId=t,this.beginRuleCapturedEOL=n,this.endRule=i,this.nameScopesList=a,this.contentNameScopesList=o,this.depth=this.parent?this.parent.depth+1:1,this._enterPos=s,this._anchorPos=r}_stackElementBrand=void 0;static NULL=new e(null,0,0,0,!1,null,null,null);_enterPos;_anchorPos;depth;equals(t){return null!==t&&e._equals(this,t)}static _equals(e,t){return e===t||!!this._structuralEquals(e,t)&&ec.equals(e.contentNameScopesList,t.contentNameScopesList)}static _structuralEquals(e,t){for(;;){if(e===t||!e&&!t)return!0;if(!e||!t||e.depth!==t.depth||e.ruleId!==t.ruleId||e.endRule!==t.endRule)return!1;e=e.parent,t=t.parent}}clone(){return this}static _reset(e){for(;e;)e._enterPos=-1,e._anchorPos=-1,e=e.parent}reset(){e._reset(this)}pop(){return this.parent}safePop(){return this.parent?this.parent:this}push(t,s,r,n,i,a,o){return new e(this,t,s,r,n,i,a,o)}getEnterPos(){return this._enterPos}getAnchorPos(){return this._anchorPos}getRule(e){return e.getRule(this.ruleId)}toString(){let e=[];return this._writeString(e,0),"["+e.join(",")+"]"}_writeString(e,t){return this.parent&&(t=this.parent._writeString(e,t)),e[t++]=`(${this.ruleId}, ${this.nameScopesList?.toString()}, ${this.contentNameScopesList?.toString()})`,t}withContentNameScopesList(e){return this.contentNameScopesList===e?this:this.parent.push(this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,this.endRule,this.nameScopesList,e)}withEndRule(t){return this.endRule===t?this:new e(this.parent,this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,t,this.nameScopesList,this.contentNameScopesList)}hasSameRuleAs(e){let t=this;for(;t&&t._enterPos===e._enterPos;){if(t.ruleId===e.ruleId)return!0;t=t.parent}return!1}toStateStackFrame(){return{ruleId:this.ruleId,beginRuleCapturedEOL:this.beginRuleCapturedEOL,endRule:this.endRule,nameScopesList:this.nameScopesList?.getExtensionIfDefined(this.parent?.nameScopesList??null)??[],contentNameScopesList:this.contentNameScopesList?.getExtensionIfDefined(this.nameScopesList)??[]}}static pushFrame(t,s){let r=ec.fromExtension(t?.nameScopesList??null,s.nameScopesList);return new e(t,s.ruleId,s.enterPos??-1,s.anchorPos??-1,s.beginRuleCapturedEOL,s.endRule,r,ec.fromExtension(r,s.contentNameScopesList))}},el=class{balancedBracketScopes;unbalancedBracketScopes;allowAny=!1;constructor(e,t){this.balancedBracketScopes=e.flatMap(e=>"*"===e?(this.allowAny=!0,[]):b(e,ei).map(e=>e.matcher)),this.unbalancedBracketScopes=t.flatMap(e=>b(e,ei).map(e=>e.matcher))}get matchesAlways(){return this.allowAny&&0===this.unbalancedBracketScopes.length}get matchesNever(){return 0===this.balancedBracketScopes.length&&!this.allowAny}match(e){for(let t of this.unbalancedBracketScopes)if(t(e))return!1;for(let t of this.balancedBracketScopes)if(t(e))return!0;return this.allowAny}},eu=class{constructor(e,t,s,r){this.balancedBracketSelectors=r,this._emitBinaryTokens=e,this._tokenTypeOverrides=s,this._lineText=null,this._tokens=[],this._binaryTokens=[],this._lastTokenEndIndex=0}_emitBinaryTokens;_lineText;_tokens;_binaryTokens;_lastTokenEndIndex;_tokenTypeOverrides;produce(e,t){this.produceFromScopes(e.contentNameScopesList,t)}produceFromScopes(e,t){if(this._lastTokenEndIndex>=t)return;if(this._emitBinaryTokens){let s=e?.tokenAttributes??0,r=!1;if(this.balancedBracketSelectors?.matchesAlways&&(r=!0),this._tokenTypeOverrides.length>0||this.balancedBracketSelectors&&!this.balancedBracketSelectors.matchesAlways&&!this.balancedBracketSelectors.matchesNever){let t=e?.getScopeNames()??[];for(let e of this._tokenTypeOverrides)e.matcher(t)&&(s=S.set(s,0,e.type,null,-1,0,0));this.balancedBracketSelectors&&(r=this.balancedBracketSelectors.match(t))}if(r&&(s=S.set(s,0,8,r,-1,0,0)),this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-1]===s){this._lastTokenEndIndex=t;return}this._binaryTokens.push(this._lastTokenEndIndex),this._binaryTokens.push(s),this._lastTokenEndIndex=t;return}let s=e?.getScopeNames()??[];this._tokens.push({startIndex:this._lastTokenEndIndex,endIndex:t,scopes:s}),this._lastTokenEndIndex=t}getResult(e,t){return this._tokens.length>0&&this._tokens[this._tokens.length-1].startIndex===t-1&&this._tokens.pop(),0===this._tokens.length&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._tokens[this._tokens.length-1].startIndex=0),this._tokens}getBinaryResult(e,t){this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-2]===t-1&&(this._binaryTokens.pop(),this._binaryTokens.pop()),0===this._binaryTokens.length&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._binaryTokens[this._binaryTokens.length-2]=0);let s=new Uint32Array(this._binaryTokens.length);for(let e=0,t=this._binaryTokens.length;e<t;e++)s[e]=this._binaryTokens[e];return s}},ep=class{constructor(e,t){this._onigLib=t,this._theme=e}_grammars=new Map;_rawGrammars=new Map;_injectionGrammars=new Map;_theme;dispose(){for(let e of this._grammars.values())e.dispose()}setTheme(e){this._theme=e}getColorMap(){return this._theme.getColorMap()}addGrammar(e,t){this._rawGrammars.set(e.scopeName,e),t&&this._injectionGrammars.set(e.scopeName,t)}lookup(e){return this._rawGrammars.get(e)}injections(e){return this._injectionGrammars.get(e)}getDefaults(){return this._theme.getDefaults()}themeMatch(e){return this._theme.match(e)}grammarForScopeName(e,t,s,r,n){if(!this._grammars.has(e)){let i=this._rawGrammars.get(e);if(!i)return null;this._grammars.set(e,new ea(e,i,t,s,r,n,this,this._onigLib))}return this._grammars.get(e)}},ed=class{_options;_syncRegistry;_ensureGrammarCache;constructor(e){this._options=e,this._syncRegistry=new ep(p.createFromRawTheme(e.theme,e.colorMap),e.onigLib),this._ensureGrammarCache=new Map}dispose(){this._syncRegistry.dispose()}setTheme(e,t){this._syncRegistry.setTheme(p.createFromRawTheme(e,t))}getColorMap(){return this._syncRegistry.getColorMap()}loadGrammarWithEmbeddedLanguages(e,t,s){return this.loadGrammarWithConfiguration(e,t,{embeddedLanguages:s})}loadGrammarWithConfiguration(e,t,s){return this._loadGrammar(e,t,s.embeddedLanguages,s.tokenTypes,new el(s.balancedBracketSelectors||[],s.unbalancedBracketSelectors||[]))}loadGrammar(e){return this._loadGrammar(e,0,null,null,null)}_loadGrammar(e,t,s,r,n){let i=new N(this._syncRegistry,e);for(;i.Q.length>0;)i.Q.map(e=>this._loadSingleGrammar(e.scopeName)),i.processQueue();return this._grammarForScopeName(e,t,s,r,n)}_loadSingleGrammar(e){this._ensureGrammarCache.has(e)||(this._doLoadSingleGrammar(e),this._ensureGrammarCache.set(e,!0))}_doLoadSingleGrammar(e){let t=this._options.loadGrammar(e);if(t){let s="function"==typeof this._options.getInjections?this._options.getInjections(e):void 0;this._syncRegistry.addGrammar(t,s)}}addGrammar(e,t=[],s=0,r=null){return this._syncRegistry.addGrammar(e,t),this._grammarForScopeName(e.scopeName,s,r)}_grammarForScopeName(e,t=0,s=null,r=null,n=null){return this._syncRegistry.grammarForScopeName(e,t,s,r,n)}},em=eh.NULL}}]);