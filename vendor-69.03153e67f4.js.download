"use strict";(window.webpackChunkweb=window.webpackChunkweb||[]).push([["85821"],{768113:function(e,t,i){i.d(t,{G_:()=>u,Vx:()=>l,eu:()=>o.s0l,go:()=>r,iE:()=>h});var s,r,n=i(777179),a=i.n(n),o=i(193478),c=i(684088);(s=r||(r={})).ZhCn="zh_CN",s.EnUs="en_US",s.JaJp="ja_JP",s.Rw="rw",s.Es="es_ES",s.It="it_IT",s.De="de_DE",s.Fr="fr_FR",s.PtBr="pt_BR",s.Id="id_ID",s.ViVn="vi_VN",s.Th="th_TH",s.KoKr="ko_KR",s.Ru="ru_RU",s.HiIn="hi_IN",s.MsMy="ms_MY";let d={domains:{}};function l(e){(0,c.v)(d,e)}function h(e){let t=d[e];return a()(t)}function u(e){return e.reduce((e,t)=>{let i=h(t);return void 0!==i&&(e[t]=i),e},{})}},730948:function(e,t,i){let s;i.d(t,{KI:()=>y,bm:()=>c.s0l});var r=i(47324),n=i(768113),a=i(222703),o=i(263504),c=i(193478),d=i(684088),l=i(560400);let h=a.jb.getLogger("domain"),u={},p=new r.EventEmitter,g={lark_domains_v3:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=c.s0l[s];r&&(t[r]=Object.keys(i.domains))}),t},biz_domain_config:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=c.s0l[s];r&&(t[r]=i),t[e]=i}),t}};function f(e){let t={};Object.entries(g).forEach(([i,s])=>{let r=e[i];r&&(0,d.v)(t,s(r))}),(0,d.v)(u,t),p.emit("CHANGE",u)}function m(e){if((0,l.x)("domain","settings","2.0.0"),s)return s;let t=(0,n.iE)("domains");t&&(0,d.v)(u,t),e&&(0,d.v)(u,e);let i="";return Object.entries(u).forEach(([e,t])=>{i+=`${e}: [${t&&t.map?t.map(e=>e.length).join(","):t}]`}),h.info("domains startup update data:",i),s=(0,o.Gw)().then(f),(0,o.z2)(f),s}function y(e){return(function(e){s||m();let t=w(e);return t.length?Promise.resolve(t):s.then(()=>w(e))})(e).then(e=>e[0])}function w(e){s||m();let t=(0,n.iE)("domains");if(t&&t[e])return t[e];let i=u[e];return i||h.warn(`domain::getDomains: domain not found: ${e}`),i||[]}},849229:function(e,t,i){i.d(t,{L:()=>s,V:()=>n});var s,r=i(47324);(s||(s={})).Unauthorized="Unauthorized";let n=new r.EventEmitter},222703:function(e,t,i){i.d(t,{jb:()=>o});var s=i(47324),r=i(560400),n=i(456550);let a=new s.EventEmitter,o={getLogger(e,t){(0,r.x)("log","logger","2.0.0");let i=(0,n.jl)({name:e,dblimit:t,onDBLimited(e){a.emit("log_max_row_length",e)},debug:!1}),s={info:()=>void 0,warn:()=>void 0,error:()=>void 0,debug:()=>void 0};for(let e of["info","warn","error","debug"])s[e]=(...t)=>{let s=Array.prototype.map.call(t,t=>"error"===e&&t instanceof Error?`
    Error: ${t.message}.
    Stack: ${t.stack}`:String(JSON.stringify(t)).replace(/^"|"$/g,"")).join(" ");i[e](s)};return s},on(e,t){a.on(e,t)},once(e,t){a.once(e,t)},off(e,t){a.off(e,t)}};o.getLogger("")},456550:function(e,t,i){let s,r,n;i.d(t,{Bm:()=>$,HA:()=>O,yP:()=>c.yP,jl:()=>D,ZP:()=>W,kn:()=>b});var a,o,c=i(559034),d=i(481105),l=i(370163);let h=/SpaceApp/i.test(navigator.userAgent);function u(){return h?"feishu_docs_client":l.default.isFeed||l.default.isLark?"lark":l.default.isDocs?"doc_app":"web"}function p(){let e="others";return l.default.isWechat?e=o.WECHAT:l.default.isQQ?e=o.QQ:l.default.isWeibo?e=o.WEIBO:l.default.isToutiao?e=o.TOUTIAO:l.default.isMobile&&!l.default.isLark?e=o.MOBILE_WEB:!l.default.isMobile&&(l.default.isMac||l.default.isWindows)?e=o.PC_WEB:h&&(e=o.PC_WEB),e}function g(){let e,t,i,s=screen.width,r=screen.height,{appVersion:n}=window.navigator,{userAgent:a}=window.navigator,{language:o}=window.navigator,{referrer:c}=document,d=c?function(e){let t=document.createElement("a");return t.href=e,t}(c).hostname:"",l="",h="",u="",p=`${parseFloat(n)}`;-1!==(e=a.indexOf("Opera"))&&(u="Opera",p=a.substring(e+6),-1!==(e=a.indexOf("Version"))&&(p=a.substring(e+8))),-1!==(e=a.indexOf("Edge"))?(u="Microsoft Edge",p=a.substring(e+5)):-1!==(e=a.indexOf("MSIE"))?(u="Microsoft Internet Explorer",p=a.substring(e+5)):-1!==(e=a.indexOf("Chrome"))?(u="Chrome",p=a.substring(e+7)):-1!==(e=a.indexOf("Safari"))?(u="Safari",p=a.substring(e+7),-1!==(e=a.indexOf("Version"))&&(p=a.substring(e+8))):-1!==(e=a.indexOf("Firefox"))&&(u="Firefox",p=a.substring(e+8)),-1!==(t=p.indexOf(";"))&&(p=p.substring(0,t)),-1!==(t=p.indexOf(" "))&&(p=p.substring(0,t)),-1!==(t=p.indexOf(")"))&&(p=p.substring(0,t));let g=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(n)?"wap":"web",f=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}];for(let e=0;e<f.length;e++){let t=f[e];if(t.r.test(a)){l=t.s;break}}function m(e,t){let i=e.exec(t);return i&&i[1]?i[1]:""}switch(/Windows/.test(l)&&(h=m(/Windows (.*)/,l),l="windows"),l){case"Mac OS X":h=m(/Mac OS X (10[\.\_\d]+)/,a),l="mac";break;case"Android":(i=m(/Android ([\.\_\d]+)/,a))||(i=m(/Android\/([\.\_\d]+)/,a)),h=i,l="android";break;case"iOS":h=(h=(/OS (\d+)_(\d+)_?(\d+)?/.exec(n)||[""])[0])?`${h[1]}.${h[2]}.${h[3]||0}`:"",l="ios";break;case"windows":break;default:l="",h=""}let y=new Date().getTimezoneOffset(),w=parseInt(`${-y/60}`,10);return{browser:u,browser_version:p,platform:g,os_name:l,os_version:h,resolution:`${s}x${r}`,device_model:function(e){let t="";try{if("android"===e)navigator.userAgent.split(";").forEach(function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))});else if("ios"===e||"mac"===e){let e=navigator.userAgent.replace("Mozilla/5.0 (",""),i=e.indexOf(";");t=e.slice(0,i)}}catch(e){}return t.trim()}(l),language:o,referrer:c,referrer_host:d,sdk_version:"3.4.1",timezone:w,tz_offset:60*y}}(a=o||(o={})).MOBILE_WEB="mobile_web",a.PC_WEB="pc_web",a.WECHAT="weixin_web",a.QQ="qq_web",a.WEIBO="weibo_web",a.TOUTIAO="toutiao_web",a.OTHERS="others",g(),u(),p();var f=i(820318);let m=function(){},y=(e,t,i)=>{let{url:s,data:r,success:n=m,fail:a=m,getResponseText:o=m,withCredentials:c=!1}=t,d=new i;d.withCredentials=c,d.open(e,s,!0),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){o?.(this.responseText);try{if(this.responseText){let e=JSON.parse(this.responseText);n(e)}else n({})}catch(e){a(e)}},d.onerror=function(){a(Error("Network request failed"))},d.onabort=function(){a(Error("Network request aborted"))},d.send(r)},w={cn:"https://slardar-bd.feishu.cn",va:"https://mon-va.byteoversea.com",sg:"https://mon-va.byteoversea.com"};var S=i(560400);class v{ready;precollectEvents=[];precollectLogs=[];uid;constructor(e){if(e.hasOwnProperty("region")&&((0,S.x)("ISlardarArgs.region","ISlardarArgs.domain","2.0.0"),console.warn("Please use biz_domain_config.tt_slardar in settings to set ISlardarArgs.domain field")),void 0===e.region&&void 0===e.domain)throw Error('"region" and "domain" fields must has one.');this.ready=!1,this.uid=e.uid,(async()=>{try{await this.slardarInit(e),this.ready=!0,this.sendPrecollect()}catch(e){console.error("Failed to init slardar instance: ",e)}})()}sendEvents(e){if(!e.length)return;let t=e.map(e=>this.buildEvent(e[0],e[1]));this.sendEventsWithReadyCheck(t)}sendLogs(e){if(!e.length)return;let t=e.map(e=>this.buildLog(e));this.sendLogsWithReadyCheck(t)}async slardarInit(e){let t="";this.uid&&(t=await (0,d.XY)(this.uid)),f.ZP.on("beforeSend",e=>({...e,common:{...e.common,..."object"==typeof window&&window.location?{url:location.href,protocol:location.protocol.slice(0,-1),domain:location.hostname,path:location.pathname,query:location.search.substring(1)}:{}}}));let i=(()=>{let e=(()=>{if("function"==typeof XMLHttpRequest)return XMLHttpRequest})();return e?{get(t){y("GET",t,e)},post(t){y("POST",t,e)}}:{get:m,post:m}})();await f.ZP.init({transport:i,userId:t,bid:e.bid,release:e.version,env:e.env,domain:e.domain||w[e.region]}),f.ZP.start()}buildEvent(e,{category:t,metrics:i}={}){return{name:e,metrics:function(e){let t={};return Object.keys(e).forEach(i=>t[i]=Number(e[i])),t}(i),categories:function(e){let t={};return Object.keys(e).forEach(i=>t[i]=String(e[i])),t}(t)}}buildLog(e){return{extra:{...e.context,stack:e.stack||""},content:e.message,level:e.context?.level}}sendPrecollect(){this.ready&&(0!==this.precollectEvents.length&&(this.sendEventsWithReadyCheck(this.precollectEvents),this.precollectEvents.splice(0)),0!==this.precollectLogs.length&&(this.sendLogsWithReadyCheck(this.precollectLogs),this.precollectLogs.splice(0)))}sendEventsWithReadyCheck(e){e.length&&(this.ready?e.forEach(e=>{f.ZP.sendEvent?.(e)}):this.precollectEvents=[...this.precollectEvents,...e])}sendLogsWithReadyCheck(e){e.length&&(this.ready?e.forEach(e=>{f.ZP.sendLog?.(e)}):this.precollectLogs=[...this.precollectLogs,...e])}}class b{slardar;stopped=!1;constructor(e){this.slardar=new v(e)}async export(e,t){try{if(!e.length||this.stopped)return;let i=[],s=[];e.forEach(e=>{e.level>=c.in.Warn&&s.push({message:e.message,stack:e.stack,context:function(e){let t={};return Object.keys(e).forEach(i=>t[i]=String(e[i])),t}({...e.attributes,...e.data,level:e.level,type:e.type})}),e.metrics&&Object.keys(e.metrics).length&&i.push([e.attributes.spanName,{category:e.attributes,metrics:e.metrics,context:{...e.data,status:e.status}}])}),this.slardar.sendEvents(i),this.slardar.sendLogs(s),t(c.Dx.SUCCESS)}catch(e){console.error(e)}}shutdown(){this.stopped=!0}}var E=i(724410);let P="lark_web_core_log_v2",k=function(e){let t=new Date,[i,s]=[t.getMonth()+1,t.getDate()].map(e=>e<10?`0${e}`:e);return`${t.getFullYear()}${i}${s}`}();function _(e){return new Promise((t,i)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>i(e.error)})}function L(e){var t,i;return t=[k],i=([t])=>e(t),(s?Promise.resolve(s):r=r||(0,E.zh)(P).then(e=>{if(!e.objectStoreNames.contains(k)){let t=e.version+1;return e.close(),(0,E.zh)(P,t,e=>{e.createObjectStore(k,{keyPath:"id",autoIncrement:!0}),Array.from(e.objectStoreNames).sort((e,t)=>e>t?-1:1).forEach((t,i)=>{i>=7&&e.deleteObjectStore(t)})})}return e}).then(e=>s=e)).then(e=>new Promise((s,r)=>{let n=e.transaction(t,"readwrite");n.onabort=()=>r(n.error),n.onerror=()=>r(n.error),i(t.map(e=>n.objectStore(e))).then(s,r)}))}class O{onLimited;length=0;limit=1e5;stopped=!1;constructor(e){e&&e.limit&&(this.limit=e.limit),e&&e.onLimited&&(this.onLimited=e.onLimited)}async export(e,t){try{if(!e.length||this.stopped)return;this.length||(this.length=await L(e=>_(e.count()))),await L(t=>{let i=[];this.length>=this.limit&&(e.push({name:"DBError",type:c.tw.Log,level:c.in.Warn,traceFlags:e[0].traceFlags,status:c.yP.OUT_OF_RANGE,message:`\u{65E5}\u{5FD7}\u{8D85}\u{51FA}\u{4E86}\u{6BCF}\u{65E5}\u{6570}\u{91CF}\u{9650}\u{5236}\u{FF0C}${this.limit}`,attributes:e[0].attributes,data:e[0].data,time:Date.now()}),this.onLimited&&this.onLimited(this.length));for(let s=0;s<e.length;s++){let r={...e[s],time:new Date().toISOString()};i.push(_(t.add(r))),this.length++}return Promise.all(i)}),t(c.Dx.SUCCESS)}catch(e){console.error(`[web-core] \u{65E5}\u{5FD7}\u{5199}\u{5165} indexdb \u{5931}\u{8D25}\u{FF0C}${e&&e.message}`)}}shutdown(){this.stopped=!0}}class C{options;reportURL;constructor(e){this.options=e,this.reportURL=this.options.reportURL}reportEvent(e){fetch(this.reportURL,{headers:{"Content-Type":"application/json"},method:"post",mode:"cors",body:JSON.stringify(e)})}}let T={cn:"https://mcs-bd.feishu.cn",sg:"https://sgali-mcs.byteoversea.com",va:"https://maliva-mcs.byteoversea.com"};async function I(e,t,i){let s=`__lite_tea_cache_token_${t}`,r=localStorage.getItem(s);if(r)try{let{web_id:e,ssid:t,timestamp:n,user_unique_id:a}=JSON.parse(r);if(Date.now()-n<7776e5&&i===a)return localStorage.setItem(s,JSON.stringify({web_id:e,ssid:t,user_unique_id:i,timestamp:Date.now()})),{web_id:e,ssid:t}}catch(e){}let n=`${e}/v1/user/webid`,a=await fetch(n,{headers:{"Content-Type":"application/json",Accept:"application/json"},method:"post",mode:"cors",body:JSON.stringify({app_id:t,referer:document.referrer,url:location.href,user_agent:navigator.userAgent,user_unique_id:""})}),{web_id:o}=await a.json(),c=`${e}/v1/user/ssid`,d=await fetch(c,{headers:{"Content-Type":"application/json",Accept:"application/json"},method:"post",mode:"cors",body:JSON.stringify({app_id:t,web_id:o,user_unique_id:i})}),{ssid:l}=await d.json();return localStorage.setItem(s,JSON.stringify({web_id:o,ssid:l,user_unique_id:i,timestamp:Date.now()})),{web_id:o,ssid:l}}var A=i(65802);class N{header;reporter;ready;precollectEvents=[];report_delay;uid;enable=!0;user={};env="";options;constructor(e){var t;if(e.hasOwnProperty("channel")&&((0,S.x)("ITeaArgs.channel","ITeaArgs.domain","2.0.0"),console.warn("Please use biz_domain_config.tt_tea in settings to set ITeaArgs.domain field")),void 0===e.channel&&void 0===e.domain)throw Error('"channel" and "domain" fields must has one.');this.ready=!1,this.report_delay=e.report_delay||100,this.uid=e.uid,this.env=e.env||"production",this.enable=e.hasOwnProperty("enable")?!!e.enable:"production"===this.env;let{header:i,app_id:s}=e,r=Object.assign({},i&&i.custom||{},{platform:u(),sub_platform:p()});this.header=Object.assign(g(),i,{app_id:s,custom:JSON.stringify(r)}),this.options=e,this.reporter=new C({reportURL:(t=this.options.domain||T[e.channel],`${t}/v1/list`)}),(async()=>{try{if(!this.enable)return;this.uid&&(this.user.user_unique_id=await (0,d.XY)(this.uid||(0,A.V)()));let{web_id:e,ssid:t}=await I(this.options.domain||T[this.options.channel],this.options.app_id,this.user.user_unique_id);this.user.web_id=e,this.user.ssid=t,this.ready=!0,this._reportPrecollectEvents()}catch(e){console.error("Failed to init tea instance: ",e)}})()}track(e,t){this.batchTrack([[e,t]])}batchTrack(e){if(!this.enable||!e.length)return;let t=e.map(e=>this._buildEvent(e[0],e[1]));if(this.ready){let e=[{events:[...t],header:this.header,user:this.user}];setTimeout(()=>this.reporter.reportEvent(e),this.report_delay)}else this.precollectEvents=[...this.precollectEvents,...t]}_buildEvent(e,t){return{event:e,params:JSON.stringify({...t,_staging_flag:this.options._staging_flag||0,event_index:x()}),local_time_ms:Date.now()}}_reportPrecollectEvents(){if(0===this.precollectEvents.length)return;let e=[{events:this.precollectEvents,header:this.header,user:this.user}];setTimeout(()=>{this.reporter.reportEvent(e),this.precollectEvents.splice(0)},this.report_delay)}}let x=(n=Number(Date.now())+Number(`${Math.random()}`.slice(2,8)),()=>n+=1);class ${tea;stopped=!1;constructor(e){this.tea=new N(e)}async export(e,t){try{if(!e.length||this.stopped)return;let i=e.filter(e=>e.type===c.tw.Event||e.type===c.tw.Tracing&&e.name.endsWith("start")).map(e=>[e.name,{...e.attributes,...e.data}]);this.tea.batchTrack(i),t(c.Dx.SUCCESS)}catch(e){console.error(e)}}shutdown(){this.stopped=!0}}function D(e={}){let t=new c.pM({flushDelay:e.flushDelay});return(t.logger.setAttributes({lib:"@lark/web-core@1.2.1",logger:"lark-web-core",...e.attributes}),t.setExporter(c.in.Debug,new O({limit:e.dblimit,onLimited:e.onDBLimited})),e&&e.debug&&t.setExporter(c.in.Debug,new c.J),e.name)?t.logger.startSpan(e.name):t.logger}var W=D()},92151:function(e,t,i){i.d(t,{WY:()=>N});var s,r,n,a,o,c,d,l,h,u,p,g,f,m,y,w,S=i(768113),v=i(222703);function b(){let e=(0,S.iE)("domains")||{};if(e[S.eu.API])return{api:(e[S.eu.API]||[""])[0],long:(e[S.eu.LONG]||[])[0]};throw"APINotProvided"}v.jb.getLogger("Net");var E=i(897165),P=i(817837);class k extends Error{code;message;displayMessage;constructor(e,t,i){super(t),this.code=e,this.displayMessage=i||t,this.message=t}}var _=i(642388);(s=h||(h={}))[s.Offline=1]="Offline",s[s.Online2G=2]="Online2G",s[s.Online3G=3]="Online3G",s[s.Online4G=4]="Online4G",s[s.OnlineWifi=5]="OnlineWifi",s[s.OnlineWired=6]="OnlineWired",(r=u||(u={}))[r.Opening=1]="Opening",r[r.Success=2]="Success",r[r.Closed=3]="Closed",(n=p||(p={}))[n.Lark=1]="Lark",n[n.InitLastSid=9e3]="InitLastSid",(a=g||(g={}))[a.Default=1]="Default",a[a.InitLastSid=3]="InitLastSid";let L={77:"3.20.0",7600:"3.15.0",7601:"3.15.0",5080:"3.15.0",5018:"3.15.0"};var O=i(65802),C=i(456550);(o=f||(f={}))[o.PB=1]="PB",o[o.JSON=2]="JSON";class T{isError;error;code;data;reqId;isClientErr(){return!!this.code&&this.code>=400&&this.code<500}unwrap=()=>{if(this.isError)throw this.error;return this.data};expect=e=>{if(this.isError)throw e(this.error),this.error;return this.data};result=()=>{let e=this.isError?this.error:void 0;return{data:this.data,err:e}};isUnauthorized(){return 401===this.code}}async function I(e,t){if(!e.ok){if(![400,403,900].includes(e.status)){let t=await e.text();return new k(e.code,t)}if(t===f.PB){let t=new Uint8Array(await e.arrayBuffer()),i=E.T.decode(t);return new k(i.code,i.message,i.userErrMessage)}if(t!==f.JSON)return e.error;{let t=await e.json()||{};return new k(t.code,t.message)}}}async function A(e){let t,i=new T;i.isError=!0;try{let s=e.commandVersion||"2.7.0";L[e.cmd]&&(s=L[e.cmd]);let r=function(e){e.cid||(e.cid=(0,O.V)());let t={cmd:e.cmd,payloadType:1,payload:e.payload,cid:e.cid};return Object.prototype.hasOwnProperty.call(e,"payloadType")&&(t.payloadType=e.payloadType),P.s.encode(t)}(e),{appId:n,appVersion:a}=e.options||function(){let{appId:e,appVersion:t}=(0,S.G_)(["appId","appVersion"]);return{appId:e,appVersion:t}}();if(!(e.url||b().api))throw Error("Must provide url or init default url.");let o=await (0,_.a)({name:`http-lark-api-cmd-${e.cmd}`,url:e.url||`https://${b().api}/im/gateway/`,method:"POST",data:r,logger:e.logger,headers:{"content-type":"application/x-protobuf","x-Source":"web","x-command":e.cmd.toString(),"x-web-version":a,"x-command-version":s,"X-AppID":(n||0).toString(),locale:e.locale||function(){let e=(0,S.iE)("locale")||S.go.ZhCn;if(e)return e;throw"LocaleNotProvided"}(),...e.headers||{}},credentials:e.credentials,signal:e.signal});if(i.code=o.status,t=o.headers.get("x-tt-logid"),o.ok){let e=await o.arrayBuffer();i.data=P.s.decode(new Uint8Array(e)),i.isError=!1}else{let s=await I(o,f.PB);i.error=s;let r="";s&&(r=`, message=${s.displayMessage}:${s.code}:${s.message}`),e.logger.error("send packet response error:",{attributes:{logId:t,errMsg:r,cmd:e.cmd,status:o.status}})}}catch(s){i.error||(i.error=new k(0,s&&s.message||s)),i.code||(i.code=422),e.logger.error("send packet error:",{attributes:{logId:t,cmd:e.cmd,errMsg:s,status:i.code}})}return i.reqId=e.cid||"",i}async function N(e){let t,{cmd:i,requestCodec:s,responseCodec:r,cid:n,logger:a=C.ZP}=e,o=a.startSpan(`lark-api-cmd-${i}`,{parent:a.manager.tracer.createSpanContext({traceId:n}),attributes:{cmd:i}});e.cid=o.span.context.spanId;let c=2!==e.payloadType?s.encode(e.payload):new TextEncoder().encode(JSON.stringify(e.payload)),d=await A({...e,payload:c,logger:o});if(d.isError)return o.endSpan({status:C.yP.UNKNOWN}),d;let{data:l}=d;return l&&l.payload&&(t=2!==l.payloadType?r.decode(l.payload):JSON.parse(new TextDecoder("utf-8").decode(l.payload))),o.endSpan({status:C.yP.OK}),d.data=t,d}var x=i(47324),$=i(126266),D=i(668643);i(744191),i(365819);var W=i(749510),M=i(298570);(c=m||(m={}))[c.Low=0]="Low",c[c.Middle=1]="Middle",c[c.High=2]="High";var j=i(481105),U=i(680771);let R={sass:"5f45da0e6c7a17dcba80494ef0ab9b21",ka31:"29cd5e7f9de36d4620dee45299e6d088",kastaging:"0036e93a4fc4e5af8acafd200e538391",kami:"0036e93a4fc4e5af8acafd200e538391",kap:"0036e93a4fc4e5af8acafd200e538391",kacrc:"82e450f4f5cdcbae7647dbb82a7fdfef"},F="web_did",B=new Set([2102,2210,2306,2215,89343,89344,6,41,30002,30003]);var G=i(119191),Z=i(730948);let q=(0,G.B)("lark_web_core_frontier");async function z(){let e=await q.getItem(F)||"",t=await (0,Z.KI)(Z.bm.PASSPORT),i=`https://${t}/suite/passport/frontier_ticket/`,s=await (0,_.a)({method:"GET",url:(0,U.X)(i,{local_device_id:e})},!1),{device_id:r,ticket:n}=await s.json();return r&&q.setItem(F,r),{deviceId:r,ticket:n}}var V=i(250475),H=i(849229);async function J(){let{userId:e}=await (0,V.yr)(),t=!!e;return t||H.V.emit(H.L.Unauthorized),t}let K=v.jb.getLogger("Socket");class X{netStatus=y.Online;ws;autoRetry=!0;retryLimit=3;retryCount=0;retryTimer=null;protocol="wss:";host;path="/ws/v2";wsURL;wsListeners={open:[],close:[],error:[],message:[]};sendMessageCache=[];constructor(e){e=e||{},this.host=e.host||this.host,this.protocol=e.protocol||this.protocol,this.path=e.path||this.path,this.autoRetry="autoRetry"in e?!!e.autoRetry:this.autoRetry,this.retryLimit=e.retryLimit||this.retryLimit,this.connect()}close(){this.ws&&this.ws.readyState!==WebSocket.CLOSING&&this.ws.close()}send(e){if(!this.ws){K.info("socket not created"),this.sendMessageCache.push(e);return}switch(this.ws.readyState){case WebSocket.OPEN:this.ws.send(e);break;case WebSocket.CONNECTING:this.sendMessageCache.push(e);break;case WebSocket.CLOSING:case WebSocket.CLOSED:K.info("socket has been closed, drop the message")}}addEventListener(e,t){this.wsListeners[e].push(t)}async connect(){if(K.info("connect to socket"),!this.ws){K.info("first connect"),await this.buildSocketURL(),this.createNewSocket(),this.startNetDetector();return}let{readyState:e}=this.ws;if(e===WebSocket.OPEN||e===WebSocket.CONNECTING)return void K.info("socket already connect");if(e===WebSocket.CLOSED){K.info("socket closed, create new socket"),this.createNewSocket();return}}onNetStatusChange(e){e!==this.netStatus&&(K.info(`net status changed from ${this.netStatus} to ${e}`),this.netStatus=e,e===y.Online&&this.createNewSocket())}startNetDetector(){self.addEventListener("online",()=>{this.onNetStatusChange(y.Online),K.debug("online")}),self.addEventListener("offline",()=>{this.onNetStatusChange(y.Offline),K.debug("offline")})}buildAccessKey(e){let t=(0,S.iE)("channel"),i=(0,S.iE)("appKey");if(!t&&!i)throw"Either channel or appKey should be provided";i=i||t&&R[t]||R.sass;let s=`2${i}${e}f8a69f1719916z`;return(0,j.FB)(s)}async buildSocketURL(){this.host=this.host||await this.getWSHost();let{deviceId:e,ticket:t}=await z(),i={access_key:this.buildAccessKey(e),aid:1,ticket:t,device_id:e,fpid:2,accept_encoding:"gzip",request_id:(0,O.V)()},s=`${this.protocol}//${this.host}${this.path}`;this.wsURL=(0,U.X)(s,i)}resetRetryState(){this.retryCount=0,this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null}retry(){return!!this.autoRetry&&(this.netStatus===y.Offline?(this.resetRetryState(),!1):this.retryTimer?(K.info("auto retry drop, there is a retry request queued"),!0):(this.retryCount+=1,this.retryCount>this.retryLimit)?(K.info(`auto retry exceed limit, stop retry, count=${this.retryCount}, limit=${this.retryLimit}`),this.resetRetryState(),!1):(this.retryTimer=setTimeout(()=>{K.info(`auto retry start, count=${this.retryCount}`),this.createNewSocket(),this.retryTimer=null}),!0))}async createNewSocket(){K.info("create new socket"),this.ws&&(this.ws.removeEventListener("open",this.onSocketOpen),this.ws.removeEventListener("close",this.onSocketClose),this.ws.removeEventListener("error",this.onSocketError),this.ws.close()),this.ws=new WebSocket(this.wsURL),this.ws.binaryType="arraybuffer",this.ws.addEventListener("open",this.onSocketOpen),this.ws.addEventListener("close",this.onSocketClose),this.ws.addEventListener("error",this.onSocketError),this.ws.addEventListener("open",e=>this.wsListeners.open.forEach(t=>t(e))),this.ws.addEventListener("close",e=>this.wsListeners.close.forEach(t=>t(e))),this.ws.addEventListener("error",e=>this.wsListeners.error.forEach(t=>t(e))),this.ws.addEventListener("message",e=>this.wsListeners.message.forEach(t=>t(e)))}onSocketOpen=()=>{K.info("socket open"),this.resetRetryState(),this.sendMessageCache.forEach(e=>{this.ws.send(e)}),this.sendMessageCache=[]};onSocketClose=e=>{switch(K.info(`socket close, code=${e.code}, reason=${e.reason}`),e.code){case 4301:case 4302:case 4303:K.error(`Session expired, code is: ${e.code}, reason is ${e.reason}`),H.V.emit(H.L.Unauthorized);case 4304:this.buildSocketURL(),this.retry()||(K.error(`Ticket invalid, code is: ${e.code}, reason is ${e.reason}`),H.V.emit(H.L.Unauthorized));break;default:this.retry()||J().then(e=>e&&this.reconnect(),()=>this.reconnect())}};reconnect(){setTimeout(()=>this.connect(),3e4)}onSocketError=()=>{K.warn("socket error.")};getWSHost(){return(0,Z.KI)(Z.bm.LONG)}}(d=y||(y={}))[d.Online=0]="Online",d[d.Offline=1]="Offline";var Y=i(147010),Q=i(485697),ee=i(740203),et=i(446065),ei=i(896994),es=i(436181);async function er(e){return N({cmd:70006,requestCodec:Y.F,responseCodec:Q.D,payload:{pipeInfos:e}})}function en(e){return N({cmd:70007,requestCodec:ee.j,responseCodec:et.O,payload:{infos:e}})}function ea(e){return N({cmd:70003,requestCodec:ei.Q,responseCodec:es.j,payload:{supportTypes:e}})}var eo=i(529416),ec=i.n(eo);let ed=new(ec())(1e3),el=new(ec())(1e3),eh=new Map;function eu(e,t="0"){eh.set(e,t||"0")}function ep(e,t=3,i){let s=t,r=async(...n)=>{let a=await e(...n);return a.isError?--s>=0?a:(i&&i(a,t-s),r(...n)):(s=0,a)};return r}let eg=v.jb.getLogger("Pipeline"),ef=e=>(t,i)=>{let s=t.error?t.error.message:"";eg.warn(`${e} failed, current retry number: ${i}, message: ${s}`)},em="MESSAGE",ey="CHAT";class ew{firstSyncSuccessed=!1;lastChangelistCursor=`${Date.now()-1e3}000000`;syncState=1;handlePacket;retryPullChangeLists=ep(en,3,ef("pullChangeLists"));retryPullAllUnsupportedPipe=ep(ea,3,ef("pullAllUnsupportedPipe"));retryPullMultiPipePackets=ep(er,3,ef("pullMultiPipePackets"));setPacketHandler(e){this.handlePacket=e}async syncPipes(e=[]){let t,i=[...new Set([...e,"USER"])];if(eg.debug("Start to sync pipes"),!this.firstSyncSuccessed)return this.syncFirst(i);if(0===this.syncState)return void eg.debug("doesn't sync for it is syncing: cur_cursor={}",this.lastChangelistCursor);this.syncState=0,e.includes(ey)&&(t=this.doPullChangeList([{cursor:$.Z.fromString(this.lastChangelistCursor),changeListIdentity:{changeListType:"CHAT"}}],e));let s=this.doPullPipeline([...eh.entries()].map(([e,t])=>({pipeEntity:{type:e},cursorSid:$.Z.fromString(t)})),e);await Promise.all([t,s]),this.syncState=1}getSyncState(){return this.syncState}isSyncing(){return 0===this.syncState}useChangeLists(e=[]){return e.includes(ey)||e.includes(em)}async syncFirst(e){if(this.firstSyncSuccessed)return;let t=[];this.useChangeLists()&&t.push(this.retryPullChangeLists([{cursor:$.Z.fromString(this.lastChangelistCursor),changeListIdentity:{changeListType:ey}}]).then(e=>{if(!e.isError&&e.data&&e.data.changeLists){let{changeLists:t}=e.data,{lastCursor:i}=t[t.length-1];return i&&(this.lastChangelistCursor=i.toString()),!0}return!1})),t.push(this.retryPullAllUnsupportedPipe([]).then(t=>{if(!t.isError&&t.data&&t.data.infos){let i=new Map(t.data.infos.map(e=>[e.pipeType,e.lastSid.toString()]));return e.forEach(e=>{eu(e,i.get(e))}),!0}return!1})),(await Promise.all(t)).every(e=>!0===e)&&(this.firstSyncSuccessed=!0)}async doPullChangeList(e,t){let i,s=await this.retryPullChangeLists(e),{lastChangelistCursor:r}=this;if(s.isError)return eg.warn("doPullChangeList error"),r;let n=s.data&&s.data.changeLists;if(!n)return eg.warn("doPullChangeList no data"),r;let a=e[0]?e[0].cursor:r,o=Promise.all(n.map(e=>{let i,s;a=e.lastCursor;let n=(e.subChangeListLastCursor||[]).filter(e=>!e.subChangeListIdentity||!t.includes(e.subChangeListIdentity.changeListType||"")).map(e=>({cursor:$.Z.fromString(r),changeListIdentity:e.subChangeListIdentity}));if(n.length&&(i=this.doPullChangeList(n,t)),e.changeListIdentity&&e.changeListIdentity.changeListType&&t.includes(e.changeListIdentity.changeListType)){let{changeListIdentity:i}=e,r=Object.keys(e.pipeLastSid||{}).map(e=>{let t;if(i.changeListType===em&&(t=ed.get(e)),i.changeListType===ey&&(t=el.get(e)||"0"),void 0!==t)return{pipeEntity:{type:i.changeListType,id:$.Z.fromString(e)},cursorSid:$.Z.fromString(t)}}).filter(e=>e);r.length&&(s=this.doPullPipeline(r,t))}return Promise.all([i,s])})),c=n.filter(e=>e.hasMore).map(e=>({cursor:e.lastCursor,changeListIdentity:e.changeListIdentity}));return c.length&&(i=this.doPullChangeList(c,t)),await Promise.all([o,i]),a?a.toString():r}async doPullPipeline(e,t){let i=e.filter(e=>{var i,s;if(e.pipeEntity.type===em){let t=$.Z.fromValue(e.cursorSid),s=(i=String(e.pipeEntity.id),ed.get(i));return void 0!==s&&!t.equals(s)}if(e.pipeEntity.type===ey){let t=$.Z.fromValue(e.cursorSid),i=(s=String(e.pipeEntity.id),el.get(s));return void 0===i||!t.equals(i)}return t.includes(e.pipeEntity.type)});if(!i.length)return;let s=await this.retryPullMultiPipePackets(i);if(s.isError||!s.data||!s.data.pipePackets)return;let r=[],n=[];s.data.pipePackets.forEach(e=>{e.pipeEntity.type===em&&e.pipeEntity.id?r.push({id:e.pipeEntity.id.toString(),sid:e.lastSid?e.lastSid.toString():void 0}):e.pipeEntity.type===ey&&e.pipeEntity.id?n.push({id:e.pipeEntity.id.toString(),sid:e.lastSid?e.lastSid.toString():void 0}):eu(e.pipeEntity.type,e.lastSid&&e.lastSid.toString()),(e.packets||[]).forEach(e=>{eg.debug("handle packet",e.cid,e.cmd),this.handlePacket(e)})}),r.forEach(e=>ed.set(e.id,e.messagePipeVersion||e.sid||"0")),n.forEach(e=>el.set(e.id,e.sid||"0"));let a=s.data.pipePackets.filter(e=>e.hasMore).map(e=>({pipeEntity:e.pipeEntity,cursorSid:e.lastSid}));a.length&&this.doPullPipeline(a,t)}}let eS=new ew,ev="lark_web_core_frontier__last_sid",eb=localStorage.getItem(ev)||"";class eE{beat;dead;interval=3e4;timeout=1e4;living=!0;timer;interTimer;constructor({beat:e,dead:t,interval:i,timeout:s}){this.beat=e,this.dead=t,i&&(this.interval=i),s&&(this.timeout=s),this.interTimer=setInterval(()=>this.detect(),this.interval)}live(){this.living=!0,this.timer&&clearTimeout(this.timer)}destroy(){this.interTimer&&clearInterval(this.interTimer),this.timer&&clearTimeout(this.timer)}detect(){this.beat(),this.timer=setTimeout(()=>{this.living&&(this.dead(),this.living=!1),this.timer&&clearTimeout(this.timer)},this.timeout)}}let eP=v.jb.getLogger("Frontier");(l=w||(w={}))[l.WS=1]="WS",l[l.PIPE=2]="PIPE";class ek{socket;pipeTypes=[];emitter=new x.EventEmitter;listenersMap=new Map;cachedPushPackets=[];emittedSids=new Set;heartBeat;startup(e={}){let{socket:t,pipeTypes:i}=e;i&&(this.pipeTypes=i),t&&t instanceof WebSocket||(this.createSocket(),this.heartBeat=new eE({beat:()=>this.send({cmd:4}),dead:()=>{this.socket.close()}})),this.socket.addEventListener("message",this.handleWSMessage)}shutdown(){this.socket.close(),this.emitter.removeAllListeners(),this.listenersMap.clear(),this.emittedSids.clear(),this.cachedPushPackets=[],this.heartBeat&&this.heartBeat.destroy()}send(e){if(!this.socket)throw"SocketNotProvided";if("object"==typeof e&&"number"==typeof e.cmd){let{cmd:t,codec:i,payload:s,sid:r}=e,n=i&&s&&i.encode(s),a=function(e,t,i,s={}){let r=$.Z.fromNumber(Date.now());return D.s.encode({seqid:r,logid:r,service:1,method:1,headers:[{key:"x-request-time",value:r.multiply(1e3).toString()},...Object.entries(s).map(([e,t])=>({key:e,value:t}))],...{payloadType:"pb",payload:i}})}(0,1,P.s.encode({cmd:t,payloadType:1,payload:n,sid:r}));this.socket.send(a)}else this.socket.send(e)}on(e,t,i){if("function"==typeof this.listenersMap.get(t))return eP.warn(`duplicated listener for cmd ${e}: `,t),()=>this.off(e,t);let{codec:s}=i||{};if(!s)throw"CodecNotProvided";let r=({data:e,source:i})=>{t(s.decode(e),i)};return this.emitter.on(String(e),r),this.listenersMap.set(t,r),()=>this.off(e,t)}off(e,t){let i=this.listenersMap.get(t);i&&"function"==typeof i&&(this.emitter.off(String(e),i),this.listenersMap.delete(t))}getDeviceId(){return z().then(e=>e.deviceId)}createSocket=()=>{let e=b().long;this.socket=new X({host:e}),eS.setPacketHandler(e=>this.handlePacket(e,w.PIPE)),this.socket.addEventListener("open",async()=>{await eS.syncPipes(this.pipeTypes),this.flushMessages()})};flushMessages=()=>{if(this.cachedPushPackets.length>0){let{cachedPushPackets:e}=this;this.cachedPushPackets=[],e.forEach(e=>this.handlePacket(e,w.WS))}};handleWSMessage=e=>{let t;this.heartBeat&&this.heartBeat.live();try{t=function(e){let t=D.s.decode(e);return P.s.decode(t.payload)}(new Uint8Array(e.data))}catch(e){eP.warn("WS message is not a pb packet");return}this.send({cmd:1,sid:t.sid});let{sid:i}=t;return i?(eP.debug("receive ws packet, sid is ",i),eS.isSyncing())?void(B.has(t.cmd)?this.handlePacket(t,w.WS):this.cachedPushPackets.push(t)):void(this.flushMessages(),this.handlePacket(t,w.WS)):void eP.warn("received empty sid")};handlePushSid=e=>{var t;let{sid:i}=e;if(!i)return void eP.warn("receive push sid empty");eP.debug("receive push sid, start pull, sid=",i),(t=[i],N({cmd:12001,requestCodec:W.z,responseCodec:M.D,payload:{sids:t}})).then(e=>{let{packets:t}=e.data||{};Object.values(t||{}).forEach(e=>{eP.debug(`handle packet than pull by sid, cmd=${e.cmd}, status=${e.status}, sid=${e.sid}, cid=${e.cid}`),this.handlePacket(e,w.WS,!1)})})};handlePacket=(e,t,i=!0)=>{let{sid:s}=e;return s?(i&&function(e){let t=eb=localStorage.getItem(ev)||eb,i=$.Z.fromString(e);(!t||$.Z.fromString(t).lessThan(i))&&(eb=e,localStorage.setItem(ev,e))}(s),6e3===e.cmd)?void this.handlePushSid(e):this.emittedSids.has(s)?void eP.debug("sid already emitted: ",s):void(this.emitter.emit(String(e.cmd),{data:e.payload,source:t})&&eP.debug(`emit packet: source=${t} cmd=${e.cmd} sid=${s}`),this.emittedSids.add(s)):void eP.warn("received empty sid")}}new ek},642388:function(e,t,i){i.d(t,{a:()=>o});var s=i(680771),r=i(849229),n=i(456550);let a="x-request-id";async function o(e,t=!1){var i;let{headers:c,data:d,method:l,logger:h=n.ZP,signal:u}=e,{url:p,name:g}=e,f=new URL(p);g||(g=`${f.host}${f.pathname}`);let m=h.startSpan(g,{parent:h.manager.tracer.createSpanContext({traceId:c&&c[a]}),attributes:{protocol:f.protocol,host:f.host,method:l}}),y={method:l,headers:function(e,t){let i=t||{};return i[a]=e.span.context.spanId,i}(m,c),mode:"cors",credentials:e.credentials?e.credentials:"include",signal:u};if(d)switch(l){case"GET":p=(0,s.X)(p,d);break;case"POST":y.body=d}let w=await fetch(p,y);return m.endSpan({status:(i=w.status)>=200&&i<400?n.yP.OK:i>=400&&i<500?n.yP.INVALID_ARGUMENT:i>=500?n.yP.INTERNAL:n.yP.OK,data:{status:w.status,logId:w.headers.get("x-tt-logid"),traceTag:w.headers.get("x-tt-trace-tag")}}),401===w.status&&t&&r.V.emit(r.L.Unauthorized),w}},250475:function(e,t,i){i.d(t,{TK:()=>l,yr:()=>d});var s=i(357337);i(996678);var r=i(358298);i(849229);var n=i(768113),a=i(730948);async function o(e){let t=e;if(!t){let{locale:e,isOversea:i,passport:s}=(0,n.G_)(["locale","isOversea","passport"]);t=Object.fromEntries(Object.entries(t=Object.assign({locale:e?e.replace("_","-"):void 0,isOversea:i,appId:12},s)).filter(([e,t])=>void 0!==t))}if(!t.origin){let e=await (0,a.KI)(a.bm.API);t.origin=`//${e}`}(0,r.default)(t)}function c(){return(0,s.default)().then(e=>{let{user:t}=e;return{userId:t.id,tenantId:t.tenant.id,...t}})}async function d(){return await o(),c()}async function l(e){let{baseUrl:t,requestId:i,appId:s=12,...r}=e,n=s;return[161471,161472].includes(s)&&(n=12),await o({...r,appId:n,origin:t}),c()}},263504:function(e,t,i){let s,r;i.d(t,{Gw:()=>P,z2:()=>_,rA:()=>k});var n=i(768113),a=i(47324),o=i(88469),c=i.n(o),d=i(642388),l=i(119191),h=i(456550),u=i(193478),p=i(684088);let g={bizDomainConfig:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=u.s0l[s];r&&(t[r]=i),t[e]=i}),t},larkDomainsV3:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=u.s0l[s];r&&(t[r]=Object.keys(i.domains))}),t}};class f{settings;domains={};constructor(e){this.settings=e}getDomain(e){let t=this.getDomains(e);return t&&t[0]||""}getDomains(e){let t=this.domains[e];return t||[]}getDomainAsync(e){return this.getDomainsAsync(e).then(()=>this.getDomain(e))}getDomainsAsync(e){return this.getDomainsFromSettingsAsync().then(()=>this.getDomains(e))}getDomainsFromSettingsAsync(){return this.settings.getSettingsAsync().then(e=>{if(e&&e.lark_domains_v3){let t=g.larkDomainsV3(e.lark_domains_v3);(0,p.v)(this.domains,t)}if(e&&e.biz_domain_config){let t=g.bizDomainConfig(e.biz_domain_config);(0,p.v)(this.domains,t)}})}}class m{settings;features={};values={};constructor(e){this.settings=e}isFeatureEnabled(e){return this.features[e]}isFeatureEnabledAsync(e){return this.getFeaturesFromSettingsAsync().then(()=>this.isFeatureEnabled(e))}getFeaturesFromSettingsAsync(){return this.settings.getSettingsAsync().then(e=>{if(e&&e.lark_features){let{features:t,values:i}=function(e){if(!e)return{features:{},values:{}};let t={};return Array.isArray(e.online)&&(t=e.online.reduce((e,t)=>(e[t]=!0,e),{})),{features:t,values:e.values}}(e.lark_features);(0,p.v)(this.features,t),(0,p.v)(this.values,i)}})}}let y="SETTINGS_UPDATE";async function w(e,t,i=3){try{return await function(e,t,i){let{appId:s,baseUrl:r,locale:a,appVersion:o,channel:c,meta:l,userBrand:u,userUnit:g}=e,f=(0,p.Y)({version:o,app_id:s,app:"lark",platform:"web",action:"startup",locale:a||n.go.ZhCn,app_channel:c,user_brand:u,user_unit:g});l&&["user_etag","data_etag","version_code"].forEach(e=>{Object.prototype.hasOwnProperty.call(l,e)&&(f[e]=l[e])});let m=`${r}/settings/v3/`,y=t.startSpan("wcore-settings.request",{data:{url:m,params:f,remainTimes:i}});return(0,d.a)({url:m,method:"GET",data:f,headers:{"X-LS-Caller-Type":"web-core"}}).then(e=>e.json()).then(e=>{if(e?.data){if(!e?.meta?.complete&&i>0)throw Error("settings data is not complete");return y.endSpan(),e}throw Error("no data returned from server")}).catch(e=>{throw y.endSpan({status:h.yP.INTERNAL,message:e.message,stack:e.stack}),e})}(e,t,i)}catch(s){if(i<=0)throw t.error(s),t.error("fetch settings with retry failed!"),s;return w(e,t,i-1)}}function S(){return Error("\u8BF7\u5148\u8C03\u7528 init \u65B9\u6CD5\u521D\u59CB\u5316")}class v{options;meta;data;updateTimer;fetchPromise;getCachePromise;emitter=new a.EventEmitter;storage;inited=!1;cacheId="";domains;featureGatings;async _init(e,t){if(this.isInitialized())return;this.inited=!0,this.options=e,this.domains=new f(this),this.featureGatings=new m(this),this.storage=(0,l.B)(`lark_web_core_${e.appId||"default"}`,"settingsV3");let i=(t||h.ZP).startSpan("wcore-settings.init");if(e.userId&&e.tenantId){this.cacheId=e.userId+e.tenantId,this.getCachePromise=this.getSettingsFromCache(i).finally(()=>{this.getCachePromise=void 0});let t=await this.getCachePromise;if(t){this.updateData(t),this.domains.getDomainsFromSettingsAsync(),this.featureGatings.getFeaturesFromSettingsAsync(),this.setUpdateTimer(i);return}}await this._tryFetchData(i).finally(()=>{this.setUpdateTimer(i)}),this.domains.getDomainsFromSettingsAsync(),this.featureGatings.getFeaturesFromSettingsAsync()}_initPromise;async init(e,t){return this._initPromise||(this._initPromise=this._init(e,t)),this._initPromise}getSettingsAsync(e){if(this.data)return Promise.resolve(this.data);if(this.fetchPromise)return this.fetchPromise.then(e=>e.data);if(this.getCachePromise)return this.getCachePromise.then(e=>e?e.data:{});if(this.options){let t=(e||h.ZP).startSpan("wcore-settings.getSettingsAsync");return w(this.options,t)}throw S()}getSettings(){if(!this.data)throw Error("settings \u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u4F7F\u7528 getSettings \u6216\u8005\u63D0\u524D\u8C03\u7528 init \u65B9\u6CD5\u521D\u59CB\u5316");return this.data}onChange(e){return this.emitter.addListener(y,e),()=>{this.emitter.removeListener(y,e)}}isInitialized(){return this.inited&&(!!this.data||!!this.fetchPromise||!!this.getCachePromise)}async _tryFetchData(e){if(!this.fetchPromise){if(!this.options)throw S();this.fetchPromise=this.fetchData(this.options,e),this.fetchPromise.finally(()=>{this.fetchPromise=void 0})}await this.fetchPromise}async fetchData(e,t){e.meta=e.meta||this.meta;let i=await w(e,t);return this.updateData(i,e&&e.meta&&Object.prototype.hasOwnProperty.call(e.meta,"user_etag")),{data:this.data,meta:this.meta}}getSettingsFromCache(e){return this.cacheId?this.storage.getItem(this.cacheId).then(t=>t||void e.warn("no cached data")).catch(t=>{e.error(t),e.error("get cached settings faile!")}):Promise.resolve(void 0)}setUpdateTimer(e){this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=null);let t=this.meta&&this.meta.ttl,i=t?1e3*t:6e4;this.updateTimer=(window||self).setTimeout(async()=>{this.updateTimer=null,this._tryFetchData(e)},i),e.debug(`setting v3: next fetch scheduled, timeout: ${i}`)}updateData(e,t=!1){e&&(e.data&&(this.data=t?c()(this.data||{},e.data):e.data,this.domains.getDomainsFromSettingsAsync(),this.featureGatings.getFeaturesFromSettingsAsync(),this.emitter.emit(y,this.data)),e.meta&&(this.meta=e.meta),this.cacheId&&this.storage.setItem(this.cacheId,{meta:this.meta,data:this.data}))}}async function b(){if(!s)return r||(r=E().catch(e=>{throw r=void 0,e})),r}async function E(){let{domains:e,...t}=(0,n.G_)(["locale","appId","domains","appVersion","channel","userBrand","userUnit"]),i=(e||{})[1],r=i?i[0]:"";if(!r)throw"APINotProvided";let a=new v;await a.init({...t,baseUrl:`https://${r}`}),s=a}async function P(){return await b(),s&&s.getSettingsAsync()}async function k(){return await b(),s}function _(e){if(!s){let t;return b().then(()=>{t=s&&s.onChange(e)}),()=>t&&t()}return s?s.onChange(e):()=>void 0}},119191:function(e,t,i){i.d(t,{B:()=>r});var s=i(724410);let r=(...e)=>new s.E9({storeName:e.join("_")})},481105:function(e,t,i){i.d(t,{FB:()=>o,XY:()=>c});var s=i(712705),r=i.n(s);async function n(e,t){let i=new TextEncoder().encode(t);return Array.from(new Uint8Array(await crypto.subtle.digest(e,i))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function a(e){return n("SHA-1",e)}function o(e){return r()(e)}async function c(e){let t=o("ee"),i=t.substring(0,6),s=t.substring(t.length-6);return await a(i+o(e.concat(s)))}},560400:function(e,t,i){i.d(t,{x:()=>s});function s(e,t,i,r="web-core"){}},684088:function(e,t,i){function s(e,t){e&&t&&Object.entries(t).forEach(([t,i])=>{void 0!==i&&(e[t]=i)})}function r(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>void 0!==t))}i.d(t,{Y:()=>r,v:()=>s})},680771:function(e,t,i){i.d(t,{X:()=>s});function s(e,t={}){let i=new URL(e);return Object.entries(t).map(([e,t])=>i.searchParams.append(e,t)),i.href}},65802:function(e,t,i){i.d(t,{V:()=>s});function s(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}},78562:function(e,t,i){i.d(t,{G_:()=>u,Vx:()=>l,eu:()=>o.s0l,go:()=>r,iE:()=>h});var s,r,n=i(777179),a=i.n(n),o=i(349165),c=i(385945);(s=r||(r={})).ZhCn="zh_CN",s.EnUs="en_US",s.JaJp="ja_JP",s.Rw="rw",s.Es="es_ES",s.It="it_IT",s.De="de_DE",s.Fr="fr_FR",s.PtBr="pt_BR",s.Id="id_ID",s.ViVn="vi_VN",s.Th="th_TH",s.KoKr="ko_KR",s.Ru="ru_RU",s.HiIn="hi_IN",s.MsMy="ms_MY";let d={domains:{}};function l(e){(0,c.v)(d,e)}function h(e){let t=d[e];return a()(t)}function u(e){return e.reduce((e,t)=>{let i=h(t);return void 0!==i&&(e[t]=i),e},{})}},549432:function(e,t,i){let s;i.d(t,{KI:()=>y,bm:()=>c.s0l});var r=i(47324),n=i(78562),a=i(122050),o=i(627044),c=i(349165),d=i(385945),l=i(521840);let h=a.jb.getLogger("domain"),u={},p=new r.EventEmitter,g={lark_domains_v3:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=c.s0l[s];r&&(t[r]=Object.keys(i.domains))}),t},biz_domain_config:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=c.s0l[s];r&&(t[r]=i),t[e]=i}),t}};function f(e){let t={};Object.entries(g).forEach(([i,s])=>{let r=e[i];r&&(0,d.v)(t,s(r))}),(0,d.v)(u,t),p.emit("CHANGE",u)}function m(e){if((0,l.x)("domain","settings","2.0.0"),s)return s;let t=(0,n.iE)("domains");t&&(0,d.v)(u,t),e&&(0,d.v)(u,e);let i="";return Object.entries(u).forEach(([e,t])=>{i+=`${e}: [${t&&t.map?t.map(e=>e.length).join(","):t}]`}),h.info("domains startup update data:",i),s=(0,o.Gw)().then(f),(0,o.z2)(f),s}function y(e){return(function(e){s||m();let t=w(e);return t.length?Promise.resolve(t):s.then(()=>w(e))})(e).then(e=>e[0])}function w(e){s||m();let t=(0,n.iE)("domains");if(t&&t[e])return t[e];let i=u[e];return i||h.warn(`domain::getDomains: domain not found: ${e}`),i||[]}},945746:function(e,t,i){i.d(t,{L:()=>s,V:()=>n});var s,r=i(47324);(s||(s={})).Unauthorized="Unauthorized";let n=new r.EventEmitter},122050:function(e,t,i){i.d(t,{jb:()=>o});var s=i(47324),r=i(521840),n=i(57426);let a=new s.EventEmitter,o={getLogger(e,t){(0,r.x)("log","logger","2.0.0");let i=(0,n.jl)({name:e,dblimit:t,onDBLimited(e){a.emit("log_max_row_length",e)},debug:!1}),s={info:()=>void 0,warn:()=>void 0,error:()=>void 0,debug:()=>void 0};for(let e of["info","warn","error","debug"])s[e]=(...t)=>{let s=Array.prototype.map.call(t,t=>"error"===e&&t instanceof Error?`
    Error: ${t.message}.
    Stack: ${t.stack}`:String(JSON.stringify(t)).replace(/^"|"$/g,"")).join(" ");i[e](s)};return s},on(e,t){a.on(e,t)},once(e,t){a.once(e,t)},off(e,t){a.off(e,t)}};o.getLogger("")},57426:function(e,t,i){let s,r,n;i.d(t,{Bm:()=>$,HA:()=>O,yP:()=>c.yP,jl:()=>D,ZP:()=>W,kn:()=>b});var a,o,c=i(559034),d=i(73214),l=i(899218);let h=/SpaceApp/i.test(navigator.userAgent);function u(){return h?"feishu_docs_client":l.ZP.isFeed||l.ZP.isLark?"lark":l.ZP.isDocs?"doc_app":"web"}function p(){let e="others";return l.ZP.isWechat?e=o.WECHAT:l.ZP.isQQ?e=o.QQ:l.ZP.isWeibo?e=o.WEIBO:l.ZP.isToutiao?e=o.TOUTIAO:l.ZP.isMobile&&!l.ZP.isLark?e=o.MOBILE_WEB:!l.ZP.isMobile&&(l.ZP.isMac||l.ZP.isWindows)?e=o.PC_WEB:h&&(e=o.PC_WEB),e}function g(){let e,t,i,s=screen.width,r=screen.height,{appVersion:n}=window.navigator,{userAgent:a}=window.navigator,{language:o}=window.navigator,{referrer:c}=document,d=c?function(e){let t=document.createElement("a");return t.href=e,t}(c).hostname:"",l="",h="",u="",p=`${parseFloat(n)}`;-1!==(e=a.indexOf("Opera"))&&(u="Opera",p=a.substring(e+6),-1!==(e=a.indexOf("Version"))&&(p=a.substring(e+8))),-1!==(e=a.indexOf("Edge"))?(u="Microsoft Edge",p=a.substring(e+5)):-1!==(e=a.indexOf("MSIE"))?(u="Microsoft Internet Explorer",p=a.substring(e+5)):-1!==(e=a.indexOf("Chrome"))?(u="Chrome",p=a.substring(e+7)):-1!==(e=a.indexOf("Safari"))?(u="Safari",p=a.substring(e+7),-1!==(e=a.indexOf("Version"))&&(p=a.substring(e+8))):-1!==(e=a.indexOf("Firefox"))&&(u="Firefox",p=a.substring(e+8)),-1!==(t=p.indexOf(";"))&&(p=p.substring(0,t)),-1!==(t=p.indexOf(" "))&&(p=p.substring(0,t)),-1!==(t=p.indexOf(")"))&&(p=p.substring(0,t));let g=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(n)?"wap":"web",f=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}];for(let e=0;e<f.length;e++){let t=f[e];if(t.r.test(a)){l=t.s;break}}function m(e,t){let i=e.exec(t);return i&&i[1]?i[1]:""}switch(/Windows/.test(l)&&(h=m(/Windows (.*)/,l),l="windows"),l){case"Mac OS X":h=m(/Mac OS X (10[\.\_\d]+)/,a),l="mac";break;case"Android":(i=m(/Android ([\.\_\d]+)/,a))||(i=m(/Android\/([\.\_\d]+)/,a)),h=i,l="android";break;case"iOS":h=(h=(/OS (\d+)_(\d+)_?(\d+)?/.exec(n)||[""])[0])?`${h[1]}.${h[2]}.${h[3]||0}`:"",l="ios";break;case"windows":break;default:l="",h=""}let y=new Date().getTimezoneOffset(),w=parseInt(`${-y/60}`,10);return{browser:u,browser_version:p,platform:g,os_name:l,os_version:h,resolution:`${s}x${r}`,device_model:function(e){let t="";try{if("android"===e)navigator.userAgent.split(";").forEach(function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))});else if("ios"===e||"mac"===e){let e=navigator.userAgent.replace("Mozilla/5.0 (",""),i=e.indexOf(";");t=e.slice(0,i)}}catch(e){}return t.trim()}(l),language:o,referrer:c,referrer_host:d,sdk_version:"3.4.1",timezone:w,tz_offset:60*y}}(a=o||(o={})).MOBILE_WEB="mobile_web",a.PC_WEB="pc_web",a.WECHAT="weixin_web",a.QQ="qq_web",a.WEIBO="weibo_web",a.TOUTIAO="toutiao_web",a.OTHERS="others",g(),u(),p();var f=i(820318);let m=function(){},y=(e,t,i)=>{let{url:s,data:r,success:n=m,fail:a=m,getResponseText:o=m,withCredentials:c=!1}=t,d=new i;d.withCredentials=c,d.open(e,s,!0),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){o?.(this.responseText);try{if(this.responseText){let e=JSON.parse(this.responseText);n(e)}else n({})}catch(e){a(e)}},d.onerror=function(){a(Error("Network request failed"))},d.onabort=function(){a(Error("Network request aborted"))},d.send(r)},w={cn:"https://slardar-bd.feishu.cn",va:"https://mon-va.byteoversea.com",sg:"https://mon-va.byteoversea.com"};var S=i(521840);class v{ready;precollectEvents=[];precollectLogs=[];uid;constructor(e){if(e.hasOwnProperty("region")&&((0,S.x)("ISlardarArgs.region","ISlardarArgs.domain","2.0.0"),console.warn("Please use biz_domain_config.tt_slardar in settings to set ISlardarArgs.domain field")),void 0===e.region&&void 0===e.domain)throw Error('"region" and "domain" fields must has one.');this.ready=!1,this.uid=e.uid,(async()=>{try{await this.slardarInit(e),this.ready=!0,this.sendPrecollect()}catch(e){console.error("Failed to init slardar instance: ",e)}})()}sendEvents(e){if(!e.length)return;let t=e.map(e=>this.buildEvent(e[0],e[1]));this.sendEventsWithReadyCheck(t)}sendLogs(e){if(!e.length)return;let t=e.map(e=>this.buildLog(e));this.sendLogsWithReadyCheck(t)}async slardarInit(e){let t="";this.uid&&(t=await (0,d.XY)(this.uid)),f.ZP.on("beforeSend",e=>({...e,common:{...e.common,..."object"==typeof window&&window.location?{url:location.href,protocol:location.protocol.slice(0,-1),domain:location.hostname,path:location.pathname,query:location.search.substring(1)}:{}}}));let i=(()=>{let e=(()=>{if("function"==typeof XMLHttpRequest)return XMLHttpRequest})();return e?{get(t){y("GET",t,e)},post(t){y("POST",t,e)}}:{get:m,post:m}})();await f.ZP.init({transport:i,userId:t,bid:e.bid,release:e.version,env:e.env,domain:e.domain||w[e.region]}),f.ZP.start()}buildEvent(e,{category:t,metrics:i}={}){return{name:e,metrics:function(e){let t={};return Object.keys(e).forEach(i=>t[i]=Number(e[i])),t}(i),categories:function(e){let t={};return Object.keys(e).forEach(i=>t[i]=String(e[i])),t}(t)}}buildLog(e){return{extra:{...e.context,stack:e.stack||""},content:e.message,level:e.context?.level}}sendPrecollect(){this.ready&&(0!==this.precollectEvents.length&&(this.sendEventsWithReadyCheck(this.precollectEvents),this.precollectEvents.splice(0)),0!==this.precollectLogs.length&&(this.sendLogsWithReadyCheck(this.precollectLogs),this.precollectLogs.splice(0)))}sendEventsWithReadyCheck(e){e.length&&(this.ready?e.forEach(e=>{f.ZP.sendEvent?.(e)}):this.precollectEvents=[...this.precollectEvents,...e])}sendLogsWithReadyCheck(e){e.length&&(this.ready?e.forEach(e=>{f.ZP.sendLog?.(e)}):this.precollectLogs=[...this.precollectLogs,...e])}}class b{slardar;stopped=!1;constructor(e){this.slardar=new v(e)}async export(e,t){try{if(!e.length||this.stopped)return;let i=[],s=[];e.forEach(e=>{e.level>=c.in.Warn&&s.push({message:e.message,stack:e.stack,context:function(e){let t={};return Object.keys(e).forEach(i=>t[i]=String(e[i])),t}({...e.attributes,...e.data,level:e.level,type:e.type})}),e.metrics&&Object.keys(e.metrics).length&&i.push([e.attributes.spanName,{category:e.attributes,metrics:e.metrics,context:{...e.data,status:e.status}}])}),this.slardar.sendEvents(i),this.slardar.sendLogs(s),t(c.Dx.SUCCESS)}catch(e){console.error(e)}}shutdown(){this.stopped=!0}}var E=i(480864);let P="lark_web_core_log_v2",k=function(e){let t=new Date,[i,s]=[t.getMonth()+1,t.getDate()].map(e=>e<10?`0${e}`:e);return`${t.getFullYear()}${i}${s}`}();function _(e){return new Promise((t,i)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>i(e.error)})}function L(e){var t,i;return t=[k],i=([t])=>e(t),(s?Promise.resolve(s):r=r||(0,E.zh)(P).then(e=>{if(!e.objectStoreNames.contains(k)){let t=e.version+1;return e.close(),(0,E.zh)(P,t,e=>{e.createObjectStore(k,{keyPath:"id",autoIncrement:!0}),Array.from(e.objectStoreNames).sort((e,t)=>e>t?-1:1).forEach((t,i)=>{i>=7&&e.deleteObjectStore(t)})})}return e}).then(e=>s=e)).then(e=>new Promise((s,r)=>{let n=e.transaction(t,"readwrite");n.onabort=()=>r(n.error),n.onerror=()=>r(n.error),i(t.map(e=>n.objectStore(e))).then(s,r)}))}class O{onLimited;length=0;limit=1e5;stopped=!1;constructor(e){e&&e.limit&&(this.limit=e.limit),e&&e.onLimited&&(this.onLimited=e.onLimited)}async export(e,t){try{if(!e.length||this.stopped)return;this.length||(this.length=await L(e=>_(e.count()))),await L(t=>{let i=[];this.length>=this.limit&&(e.push({name:"DBError",type:c.tw.Log,level:c.in.Warn,traceFlags:e[0].traceFlags,status:c.yP.OUT_OF_RANGE,message:`\u{65E5}\u{5FD7}\u{8D85}\u{51FA}\u{4E86}\u{6BCF}\u{65E5}\u{6570}\u{91CF}\u{9650}\u{5236}\u{FF0C}${this.limit}`,attributes:e[0].attributes,data:e[0].data,time:Date.now()}),this.onLimited&&this.onLimited(this.length));for(let s=0;s<e.length;s++){let r={...e[s],time:new Date().toISOString()};i.push(_(t.add(r))),this.length++}return Promise.all(i)}),t(c.Dx.SUCCESS)}catch(e){console.error(`[web-core] \u{65E5}\u{5FD7}\u{5199}\u{5165} indexdb \u{5931}\u{8D25}\u{FF0C}${e&&e.message}`)}}shutdown(){this.stopped=!0}}class C{options;reportURL;constructor(e){this.options=e,this.reportURL=this.options.reportURL}reportEvent(e){fetch(this.reportURL,{headers:{"Content-Type":"application/json"},method:"post",mode:"cors",body:JSON.stringify(e)})}}let T={cn:"https://mcs-bd.feishu.cn",sg:"https://sgali-mcs.byteoversea.com",va:"https://maliva-mcs.byteoversea.com"};async function I(e,t,i){let s=`__lite_tea_cache_token_${t}`,r=localStorage.getItem(s);if(r)try{let{web_id:e,ssid:t,timestamp:n,user_unique_id:a}=JSON.parse(r);if(Date.now()-n<7776e5&&i===a)return localStorage.setItem(s,JSON.stringify({web_id:e,ssid:t,user_unique_id:i,timestamp:Date.now()})),{web_id:e,ssid:t}}catch(e){}let n=`${e}/v1/user/webid`,a=await fetch(n,{headers:{"Content-Type":"application/json",Accept:"application/json"},method:"post",mode:"cors",body:JSON.stringify({app_id:t,referer:document.referrer,url:location.href,user_agent:navigator.userAgent,user_unique_id:""})}),{web_id:o}=await a.json(),c=`${e}/v1/user/ssid`,d=await fetch(c,{headers:{"Content-Type":"application/json",Accept:"application/json"},method:"post",mode:"cors",body:JSON.stringify({app_id:t,web_id:o,user_unique_id:i})}),{ssid:l}=await d.json();return localStorage.setItem(s,JSON.stringify({web_id:o,ssid:l,user_unique_id:i,timestamp:Date.now()})),{web_id:o,ssid:l}}var A=i(92107);class N{header;reporter;ready;precollectEvents=[];report_delay;uid;enable=!0;user={};env="";options;constructor(e){var t;if(e.hasOwnProperty("channel")&&((0,S.x)("ITeaArgs.channel","ITeaArgs.domain","2.0.0"),console.warn("Please use biz_domain_config.tt_tea in settings to set ITeaArgs.domain field")),void 0===e.channel&&void 0===e.domain)throw Error('"channel" and "domain" fields must has one.');this.ready=!1,this.report_delay=e.report_delay||100,this.uid=e.uid,this.env=e.env||"production",this.enable=e.hasOwnProperty("enable")?!!e.enable:"production"===this.env;let{header:i,app_id:s}=e,r=Object.assign({},i&&i.custom||{},{platform:u(),sub_platform:p()});this.header=Object.assign(g(),i,{app_id:s,custom:JSON.stringify(r)}),this.options=e,this.reporter=new C({reportURL:(t=this.options.domain||T[e.channel],`${t}/v1/list`)}),(async()=>{try{if(!this.enable)return;this.uid&&(this.user.user_unique_id=await (0,d.XY)(this.uid||(0,A.V)()));let{web_id:e,ssid:t}=await I(this.options.domain||T[this.options.channel],this.options.app_id,this.user.user_unique_id);this.user.web_id=e,this.user.ssid=t,this.ready=!0,this._reportPrecollectEvents()}catch(e){console.error("Failed to init tea instance: ",e)}})()}track(e,t){this.batchTrack([[e,t]])}batchTrack(e){if(!this.enable||!e.length)return;let t=e.map(e=>this._buildEvent(e[0],e[1]));if(this.ready){let e=[{events:[...t],header:this.header,user:this.user}];setTimeout(()=>this.reporter.reportEvent(e),this.report_delay)}else this.precollectEvents=[...this.precollectEvents,...t]}_buildEvent(e,t){return{event:e,params:JSON.stringify({...t,_staging_flag:this.options._staging_flag||0,event_index:x()}),local_time_ms:Date.now()}}_reportPrecollectEvents(){if(0===this.precollectEvents.length)return;let e=[{events:this.precollectEvents,header:this.header,user:this.user}];setTimeout(()=>{this.reporter.reportEvent(e),this.precollectEvents.splice(0)},this.report_delay)}}let x=(n=Number(Date.now())+Number(`${Math.random()}`.slice(2,8)),()=>n+=1);class ${tea;stopped=!1;constructor(e){this.tea=new N(e)}async export(e,t){try{if(!e.length||this.stopped)return;let i=e.filter(e=>e.type===c.tw.Event||e.type===c.tw.Tracing&&e.name.endsWith("start")).map(e=>[e.name,{...e.attributes,...e.data}]);this.tea.batchTrack(i),t(c.Dx.SUCCESS)}catch(e){console.error(e)}}shutdown(){this.stopped=!0}}function D(e={}){let t=new c.pM({flushDelay:e.flushDelay});return(t.logger.setAttributes({lib:"@lark/web-core@1.2.1",logger:"lark-web-core",...e.attributes}),t.setExporter(c.in.Debug,new O({limit:e.dblimit,onLimited:e.onDBLimited})),e&&e.debug&&t.setExporter(c.in.Debug,new c.J),e.name)?t.logger.startSpan(e.name):t.logger}var W=D()},887220:function(e,t,i){i.d(t,{t6:()=>e_,WY:()=>N});var s,r,n,a,o,c,d,l,h,u,p,g,f,m,y,w,S=i(78562),v=i(122050);function b(){let e=(0,S.iE)("domains")||{};if(e[S.eu.API])return{api:(e[S.eu.API]||[""])[0],long:(e[S.eu.LONG]||[])[0]};throw"APINotProvided"}v.jb.getLogger("Net");var E=i(942907),P=i(500821);class k extends Error{code;message;displayMessage;constructor(e,t,i){super(t),this.code=e,this.displayMessage=i||t,this.message=t}}var _=i(484949);(s=h||(h={}))[s.Offline=1]="Offline",s[s.Online2G=2]="Online2G",s[s.Online3G=3]="Online3G",s[s.Online4G=4]="Online4G",s[s.OnlineWifi=5]="OnlineWifi",s[s.OnlineWired=6]="OnlineWired",(r=u||(u={}))[r.Opening=1]="Opening",r[r.Success=2]="Success",r[r.Closed=3]="Closed",(n=p||(p={}))[n.Lark=1]="Lark",n[n.InitLastSid=9e3]="InitLastSid",(a=g||(g={}))[a.Default=1]="Default",a[a.InitLastSid=3]="InitLastSid";let L={77:"3.20.0",7600:"3.15.0",7601:"3.15.0",5080:"3.15.0",5018:"3.15.0"};var O=i(92107),C=i(57426);(o=f||(f={}))[o.PB=1]="PB",o[o.JSON=2]="JSON";class T{isError;error;code;data;reqId;logId;isClientErr(){return!!this.code&&this.code>=400&&this.code<500}unwrap=()=>{if(this.isError)throw this.error;return this.data};expect=e=>{if(this.isError)throw e(this.error),this.error;return this.data};result=()=>{let e=this.isError?this.error:void 0;return{data:this.data,err:e}};isUnauthorized(){return 401===this.code}}async function I(e,t){if(!e.ok){if(![400,403,900].includes(e.status)){let t=await e.text();return new k(e.code,t)}if(t===f.PB){let t=new Uint8Array(await e.arrayBuffer()),i=E.T.decode(t);return new k(i.code,i.message,i.userErrMessage)}if(t!==f.JSON)return e.error;{let t=await e.json()||{};return new k(t.code,t.message)}}}async function A(e){let t,i=new T;i.isError=!0;try{let s=e.commandVersion||"2.7.0";L[e.cmd]&&(s=L[e.cmd]);let r=function(e){e.cid||(e.cid=(0,O.V)());let t={cmd:e.cmd,payloadType:1,payload:e.payload,cid:e.cid};return Object.prototype.hasOwnProperty.call(e,"payloadType")&&(t.payloadType=e.payloadType),P.s.encode(t)}(e),{appId:n,appVersion:a}=e.options||function(){let{appId:e,appVersion:t}=(0,S.G_)(["appId","appVersion"]);return{appId:e,appVersion:t}}();if(!(e.url||b().api))throw Error("Must provide url or init default url.");let o=await (0,_.a)({name:`http-lark-api-cmd-${e.cmd}`,url:e.url||`https://${b().api}/im/gateway/`,method:"POST",data:r,logger:e.logger,headers:{"content-type":"application/x-protobuf","x-Source":"web","x-command":e.cmd.toString(),"x-web-version":a,"x-command-version":s,"X-AppID":(n||0).toString(),locale:e.locale||function(){let e=(0,S.iE)("locale")||S.go.ZhCn;if(e)return e;throw"LocaleNotProvided"}(),...e.headers||{}},credentials:e.credentials,signal:e.signal});if(i.code=o.status,t=o.headers.get("x-tt-logid"),o.ok){let e=await o.arrayBuffer();i.data=P.s.decode(new Uint8Array(e)),i.isError=!1}else{let s=await I(o,f.PB);i.error=s;let r="";s&&(r=`, message=${s.displayMessage}:${s.code}:${s.message}`),e.logger.error("send packet response error:",{attributes:{logId:t,errMsg:r,cmd:e.cmd,status:o.status}})}}catch(s){i.error||(i.error=new k(0,s&&s.message||s)),i.code||(i.code=422),e.logger.error("send packet error:",{attributes:{logId:t,cmd:e.cmd,errMsg:s,status:i.code}})}return i.reqId=e.cid||"",i.logId=t||"",i}async function N(e){let t,{cmd:i,requestCodec:s,responseCodec:r,cid:n,logger:a=C.ZP}=e,o=a.startSpan(`lark-api-cmd-${i}`,{parent:a.manager.tracer.createSpanContext({traceId:n}),attributes:{cmd:i}});e.cid=o.span.context.spanId;let c=2!==e.payloadType?s.encode(e.payload):new TextEncoder().encode(JSON.stringify(e.payload)),d=await A({...e,payload:c,logger:o});if(d.isError)return o.endSpan({status:C.yP.UNKNOWN}),d;let{data:l}=d;return l&&l.payload&&(t=2!==l.payloadType?r.decode(l.payload):JSON.parse(new TextDecoder("utf-8").decode(l.payload))),o.endSpan({status:C.yP.OK}),d.data=t,d}var x=i(47324),$=i(126266),D=i(388646);i(219263),i(820572);var W=i(231282),M=i(317570);(c=m||(m={}))[c.Low=0]="Low",c[c.Middle=1]="Middle",c[c.High=2]="High";var j=i(73214),U=i(633062);let R={saas:"5f45da0e6c7a17dcba80494ef0ab9b21",ka31:"29cd5e7f9de36d4620dee45299e6d088",kastaging:"0036e93a4fc4e5af8acafd200e538391",kami:"0036e93a4fc4e5af8acafd200e538391",kap:"0036e93a4fc4e5af8acafd200e538391",kacrc:"82e450f4f5cdcbae7647dbb82a7fdfef"},F="web_did",B=new Set([2102,2210,2306,2215,89343,89344,6,41,30002,30003]);var G=i(504840),Z=i(549432);let q=(0,G.B)("lark_web_core_frontier");async function z(){let e=await q.getItem(F)||"",t=await (0,Z.KI)(Z.bm.PASSPORT),i=`https://${t}/suite/passport/frontier_ticket/`,s=await (0,_.a)({method:"GET",url:(0,U.X)(i,{local_device_id:e})},!1),{device_id:r,ticket:n}=await s.json();return r&&q.setItem(F,r),{deviceId:r,ticket:n}}var V=i(200007),H=i(945746);async function J(){let{userId:e}=await (0,V.yr)(),t=!!e;return t||H.V.emit(H.L.Unauthorized),t}let K=v.jb.getLogger("Socket");class X{netStatus=y.Online;ws;autoRetry=!0;retryLimit=3;retryCount=0;retryTimer=null;protocol="wss:";host;path="/ws/v2";wsURL;wsListeners={open:[],close:[],error:[],message:[]};sendMessageCache=[];constructor(e){e=e||{},this.host=e.host||this.host,this.protocol=e.protocol||this.protocol,this.path=e.path||this.path,this.autoRetry="autoRetry"in e?!!e.autoRetry:this.autoRetry,this.retryLimit=e.retryLimit||this.retryLimit,this.connect()}close(){this.ws&&this.ws.readyState!==WebSocket.CLOSING&&this.ws.close()}send(e){if(!this.ws){K.info("socket not created"),this.sendMessageCache.push(e);return}switch(this.ws.readyState){case WebSocket.OPEN:this.ws.send(e);break;case WebSocket.CONNECTING:this.sendMessageCache.push(e);break;case WebSocket.CLOSING:case WebSocket.CLOSED:K.info("socket has been closed, drop the message")}}addEventListener(e,t){this.wsListeners[e].push(t)}async connect(){if(K.info("connect to socket"),!this.ws){K.info("first connect"),await this.buildSocketURL(),this.createNewSocket(),this.startNetDetector();return}let{readyState:e}=this.ws;if(e===WebSocket.OPEN||e===WebSocket.CONNECTING)return void K.info("socket already connect");if(e===WebSocket.CLOSED){K.info("socket closed, create new socket"),this.createNewSocket();return}}onNetStatusChange(e){e!==this.netStatus&&(K.info(`net status changed from ${this.netStatus} to ${e}`),this.netStatus=e,e===y.Online&&this.createNewSocket())}startNetDetector(){self.addEventListener("online",()=>{this.onNetStatusChange(y.Online),K.debug("online")}),self.addEventListener("offline",()=>{this.onNetStatusChange(y.Offline),K.debug("offline")})}buildAccessKey(e){let t=(0,S.iE)("channel"),i=(0,S.iE)("appKey");if(!t&&!i)throw"Either channel or appKey should be provided";i=i||t&&R[t]||R.saas;let s=`2${i}${e}f8a69f1719916z`;return(0,j.FB)(s)}async buildSocketURL(){this.host=this.host||await this.getWSHost();let{deviceId:e,ticket:t}=await z(),i={access_key:this.buildAccessKey(e),aid:1,ticket:t,device_id:e,fpid:2,accept_encoding:"gzip",request_id:(0,O.V)()},s=`${this.protocol}//${this.host}${this.path}`;this.wsURL=(0,U.X)(s,i)}resetRetryState(){this.retryCount=0,this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null}retry(){return!!this.autoRetry&&(this.netStatus===y.Offline?(this.resetRetryState(),!1):this.retryTimer?(K.info("auto retry drop, there is a retry request queued"),!0):(this.retryCount+=1,this.retryCount>this.retryLimit)?(K.info(`auto retry exceed limit, stop retry, count=${this.retryCount}, limit=${this.retryLimit}`),this.resetRetryState(),!1):(this.retryTimer=setTimeout(()=>{K.info(`auto retry start, count=${this.retryCount}`),this.createNewSocket(),this.retryTimer=null}),!0))}async createNewSocket(){K.info("create new socket"),this.ws&&(this.ws.removeEventListener("open",this.onSocketOpen),this.ws.removeEventListener("close",this.onSocketClose),this.ws.removeEventListener("error",this.onSocketError),this.ws.close()),this.ws=new WebSocket(this.wsURL),this.ws.binaryType="arraybuffer",this.ws.addEventListener("open",this.onSocketOpen),this.ws.addEventListener("close",this.onSocketClose),this.ws.addEventListener("error",this.onSocketError),this.ws.addEventListener("open",e=>this.wsListeners.open.forEach(t=>t(e))),this.ws.addEventListener("close",e=>this.wsListeners.close.forEach(t=>t(e))),this.ws.addEventListener("error",e=>this.wsListeners.error.forEach(t=>t(e))),this.ws.addEventListener("message",e=>this.wsListeners.message.forEach(t=>t(e)))}onSocketOpen=()=>{K.info("socket open"),this.resetRetryState(),this.sendMessageCache.forEach(e=>{this.ws.send(e)}),this.sendMessageCache=[]};onSocketClose=e=>{switch(K.info(`socket close, code=${e.code}, reason=${e.reason}`),e.code){case 4301:case 4302:case 4303:K.error(`Session expired, code is: ${e.code}, reason is ${e.reason}`),H.V.emit(H.L.Unauthorized);case 4304:this.buildSocketURL(),this.retry()||(K.error(`Ticket invalid, code is: ${e.code}, reason is ${e.reason}`),H.V.emit(H.L.Unauthorized));break;default:this.retry()||J().then(e=>e&&this.reconnect(),()=>this.reconnect())}};reconnect(){setTimeout(()=>this.connect(),3e4)}onSocketError=()=>{K.warn("socket error.")};getWSHost(){return(0,Z.KI)(Z.bm.LONG)}}(d=y||(y={}))[d.Online=0]="Online",d[d.Offline=1]="Offline";var Y=i(317694),Q=i(107580),ee=i(396810),et=i(770276),ei=i(195858),es=i(470553);async function er(e){return N({cmd:70006,requestCodec:Y.F,responseCodec:Q.D,payload:{pipeInfos:e}})}function en(e){return N({cmd:70007,requestCodec:ee.j,responseCodec:et.O,payload:{infos:e}})}function ea(e){return N({cmd:70003,requestCodec:ei.Q,responseCodec:es.j,payload:{supportTypes:e}})}var eo=i(529416),ec=i.n(eo);let ed=new(ec())(1e3),el=new(ec())(1e3),eh=new Map;function eu(e,t="0"){eh.set(e,t||"0")}function ep(e,t=3,i){let s=t,r=async(...n)=>{let a=await e(...n);return a.isError?--s>=0?a:(i&&i(a,t-s),r(...n)):(s=0,a)};return r}let eg=v.jb.getLogger("Pipeline"),ef=e=>(t,i)=>{let s=t.error?t.error.message:"";eg.warn(`${e} failed, current retry number: ${i}, message: ${s}`)},em="MESSAGE",ey="CHAT";class ew{firstSyncSuccessed=!1;lastChangelistCursor=`${Date.now()-1e3}000000`;syncState=1;handlePacket;retryPullChangeLists=ep(en,3,ef("pullChangeLists"));retryPullAllUnsupportedPipe=ep(ea,3,ef("pullAllUnsupportedPipe"));retryPullMultiPipePackets=ep(er,3,ef("pullMultiPipePackets"));setPacketHandler(e){this.handlePacket=e}async syncPipes(e=[]){let t,i=[...new Set([...e,"USER"])];if(eg.debug("Start to sync pipes"),!this.firstSyncSuccessed)return this.syncFirst(i);if(0===this.syncState)return void eg.debug("doesn't sync for it is syncing: cur_cursor={}",this.lastChangelistCursor);this.syncState=0,e.includes(ey)&&(t=this.doPullChangeList([{cursor:$.Z.fromString(this.lastChangelistCursor),changeListIdentity:{changeListType:"CHAT"}}],e));let s=this.doPullPipeline([...eh.entries()].map(([e,t])=>({pipeEntity:{type:e},cursorSid:$.Z.fromString(t)})),e);await Promise.all([t,s]),this.syncState=1}getSyncState(){return this.syncState}isSyncing(){return 0===this.syncState}useChangeLists(e=[]){return e.includes(ey)||e.includes(em)}async syncFirst(e){if(this.firstSyncSuccessed)return;let t=[];this.useChangeLists()&&t.push(this.retryPullChangeLists([{cursor:$.Z.fromString(this.lastChangelistCursor),changeListIdentity:{changeListType:ey}}]).then(e=>{if(!e.isError&&e.data&&e.data.changeLists){let{changeLists:t}=e.data,{lastCursor:i}=t[t.length-1];return i&&(this.lastChangelistCursor=i.toString()),!0}return!1})),t.push(this.retryPullAllUnsupportedPipe([]).then(t=>{if(!t.isError&&t.data&&t.data.infos){let i=new Map(t.data.infos.map(e=>[e.pipeType,e.lastSid.toString()]));return e.forEach(e=>{eu(e,i.get(e))}),!0}return!1})),(await Promise.all(t)).every(e=>!0===e)&&(this.firstSyncSuccessed=!0)}async doPullChangeList(e,t){let i,s=await this.retryPullChangeLists(e),{lastChangelistCursor:r}=this;if(s.isError)return eg.warn("doPullChangeList error"),r;let n=s.data&&s.data.changeLists;if(!n)return eg.warn("doPullChangeList no data"),r;let a=e[0]?e[0].cursor:r,o=Promise.all(n.map(e=>{let i,s;a=e.lastCursor;let n=(e.subChangeListLastCursor||[]).filter(e=>!e.subChangeListIdentity||!t.includes(e.subChangeListIdentity.changeListType||"")).map(e=>({cursor:$.Z.fromString(r),changeListIdentity:e.subChangeListIdentity}));if(n.length&&(i=this.doPullChangeList(n,t)),e.changeListIdentity&&e.changeListIdentity.changeListType&&t.includes(e.changeListIdentity.changeListType)){let{changeListIdentity:i}=e,r=Object.keys(e.pipeLastSid||{}).map(e=>{let t;if(i.changeListType===em&&(t=ed.get(e)),i.changeListType===ey&&(t=el.get(e)||"0"),void 0!==t)return{pipeEntity:{type:i.changeListType,id:$.Z.fromString(e)},cursorSid:$.Z.fromString(t)}}).filter(e=>e);r.length&&(s=this.doPullPipeline(r,t))}return Promise.all([i,s])})),c=n.filter(e=>e.hasMore).map(e=>({cursor:e.lastCursor,changeListIdentity:e.changeListIdentity}));return c.length&&(i=this.doPullChangeList(c,t)),await Promise.all([o,i]),a?a.toString():r}async doPullPipeline(e,t){let i=e.filter(e=>{var i,s;if(e.pipeEntity.type===em){let t=$.Z.fromValue(e.cursorSid),s=(i=String(e.pipeEntity.id),ed.get(i));return void 0!==s&&!t.equals(s)}if(e.pipeEntity.type===ey){let t=$.Z.fromValue(e.cursorSid),i=(s=String(e.pipeEntity.id),el.get(s));return void 0===i||!t.equals(i)}return t.includes(e.pipeEntity.type)});if(!i.length)return;let s=await this.retryPullMultiPipePackets(i);if(s.isError||!s.data||!s.data.pipePackets)return;let r=[],n=[];s.data.pipePackets.forEach(e=>{e.pipeEntity.type===em&&e.pipeEntity.id?r.push({id:e.pipeEntity.id.toString(),sid:e.lastSid?e.lastSid.toString():void 0}):e.pipeEntity.type===ey&&e.pipeEntity.id?n.push({id:e.pipeEntity.id.toString(),sid:e.lastSid?e.lastSid.toString():void 0}):eu(e.pipeEntity.type,e.lastSid&&e.lastSid.toString()),(e.packets||[]).forEach(e=>{eg.debug("handle packet",e.cid,e.cmd),this.handlePacket(e)})}),r.forEach(e=>ed.set(e.id,e.messagePipeVersion||e.sid||"0")),n.forEach(e=>el.set(e.id,e.sid||"0"));let a=s.data.pipePackets.filter(e=>e.hasMore).map(e=>({pipeEntity:e.pipeEntity,cursorSid:e.lastSid}));a.length&&this.doPullPipeline(a,t)}}let eS=new ew,ev="lark_web_core_frontier__last_sid",eb=localStorage.getItem(ev)||"";class eE{beat;dead;interval=3e4;timeout=1e4;living=!0;timer;interTimer;constructor({beat:e,dead:t,interval:i,timeout:s}){this.beat=e,this.dead=t,i&&(this.interval=i),s&&(this.timeout=s),this.interTimer=setInterval(()=>this.detect(),this.interval)}live(){this.living=!0,this.timer&&clearTimeout(this.timer)}destroy(){this.interTimer&&clearInterval(this.interTimer),this.timer&&clearTimeout(this.timer)}detect(){this.beat(),this.timer=setTimeout(()=>{this.living&&(this.dead(),this.living=!1),this.timer&&clearTimeout(this.timer)},this.timeout)}}let eP=v.jb.getLogger("Frontier");(l=w||(w={}))[l.WS=1]="WS",l[l.PIPE=2]="PIPE";class ek{socket;pipeTypes=[];emitter=new x.EventEmitter;listenersMap=new Map;cachedPushPackets=[];emittedSids=new Set;heartBeat;startup(e={}){let{socket:t,pipeTypes:i}=e;i&&(this.pipeTypes=i),t&&t instanceof WebSocket||(this.createSocket(),this.heartBeat=new eE({beat:()=>this.send({cmd:4}),dead:()=>{this.socket.close()}})),this.socket.addEventListener("message",this.handleWSMessage)}shutdown(){this.socket.close(),this.emitter.removeAllListeners(),this.listenersMap.clear(),this.emittedSids.clear(),this.cachedPushPackets=[],this.heartBeat&&this.heartBeat.destroy()}send(e){if(!this.socket)throw"SocketNotProvided";if("object"==typeof e&&"number"==typeof e.cmd){let{cmd:t,codec:i,payload:s,sid:r}=e,n=i&&s&&i.encode(s),a=function(e,t,i,s={}){let r=$.Z.fromNumber(Date.now());return D.s.encode({seqid:r,logid:r,service:1,method:1,headers:[{key:"x-request-time",value:r.multiply(1e3).toString()},...Object.entries(s).map(([e,t])=>({key:e,value:t}))],...{payloadType:"pb",payload:i}})}(0,1,P.s.encode({cmd:t,payloadType:1,payload:n,sid:r}));this.socket.send(a)}else this.socket.send(e)}on(e,t,i){if("function"==typeof this.listenersMap.get(t))return eP.warn(`duplicated listener for cmd ${e}: `,t),()=>this.off(e,t);let{codec:s}=i||{};if(!s)throw"CodecNotProvided";let r=({data:e,source:i})=>{t(s.decode(e),i)};return this.emitter.on(String(e),r),this.listenersMap.set(t,r),()=>this.off(e,t)}off(e,t){let i=this.listenersMap.get(t);i&&"function"==typeof i&&(this.emitter.off(String(e),i),this.listenersMap.delete(t))}getDeviceId(){return z().then(e=>e.deviceId)}createSocket=()=>{let e=b().long;this.socket=new X({host:e}),eS.setPacketHandler(e=>this.handlePacket(e,w.PIPE)),this.socket.addEventListener("open",async()=>{await eS.syncPipes(this.pipeTypes),this.flushMessages()})};flushMessages=()=>{if(this.cachedPushPackets.length>0){let{cachedPushPackets:e}=this;this.cachedPushPackets=[],e.forEach(e=>this.handlePacket(e,w.WS))}};handleWSMessage=e=>{let t;this.heartBeat&&this.heartBeat.live();try{t=function(e){let t=D.s.decode(e);return P.s.decode(t.payload)}(new Uint8Array(e.data))}catch(e){eP.warn("WS message is not a pb packet");return}this.send({cmd:1,sid:t.sid});let{sid:i}=t;return i?(eP.debug("receive ws packet, sid is ",i),eS.isSyncing())?void(B.has(t.cmd)?this.handlePacket(t,w.WS):this.cachedPushPackets.push(t)):void(this.flushMessages(),this.handlePacket(t,w.WS)):void eP.warn("received empty sid")};handlePushSid=e=>{var t;let{sid:i}=e;if(!i)return void eP.warn("receive push sid empty");eP.debug("receive push sid, start pull, sid=",i),(t=[i],N({cmd:12001,requestCodec:W.z,responseCodec:M.D,payload:{sids:t}})).then(e=>{let{packets:t}=e.data||{};Object.values(t||{}).forEach(e=>{eP.debug(`handle packet than pull by sid, cmd=${e.cmd}, status=${e.status}, sid=${e.sid}, cid=${e.cid}`),this.handlePacket(e,w.WS,!1)})})};handlePacket=(e,t,i=!0)=>{let{sid:s}=e;return s?(i&&function(e){let t=eb=localStorage.getItem(ev)||eb,i=$.Z.fromString(e);(!t||$.Z.fromString(t).lessThan(i))&&(eb=e,localStorage.setItem(ev,e))}(s),6e3===e.cmd)?void this.handlePushSid(e):this.emittedSids.has(s)?void eP.debug("sid already emitted: ",s):void(this.emitter.emit(String(e.cmd),{data:e.payload,source:t})&&eP.debug(`emit packet: source=${t} cmd=${e.cmd} sid=${s}`),this.emittedSids.add(s)):void eP.warn("received empty sid")}}let e_=new ek},484949:function(e,t,i){i.d(t,{a:()=>o});var s=i(633062),r=i(945746),n=i(57426);let a="x-request-id";async function o(e,t=!1){var i;let{headers:c,data:d,method:l,logger:h=n.ZP,signal:u}=e,{url:p,name:g}=e,f=new URL(p);g||(g=`${f.host}${f.pathname}`);let m=h.startSpan(g,{parent:h.manager.tracer.createSpanContext({traceId:c&&c[a]}),attributes:{protocol:f.protocol,host:f.host,method:l}}),y={method:l,headers:function(e,t){let i=t||{};return i[a]=e.span.context.spanId,i}(m,c),mode:"cors",credentials:e.credentials?e.credentials:"include",signal:u};if(d)switch(l){case"GET":p=(0,s.X)(p,d);break;case"POST":y.body=d}let w=await fetch(p,y);return m.endSpan({status:(i=w.status)>=200&&i<400?n.yP.OK:i>=400&&i<500?n.yP.INVALID_ARGUMENT:i>=500?n.yP.INTERNAL:n.yP.OK,data:{status:w.status,logId:w.headers.get("x-tt-logid"),traceTag:w.headers.get("x-tt-trace-tag")}}),401===w.status&&t&&r.V.emit(r.L.Unauthorized),w}},200007:function(e,t,i){i.d(t,{TK:()=>l,yr:()=>d});var s=i(602594);i(246299);var r=i(176239);i(945746);var n=i(78562),a=i(549432);async function o(e){let t=e;if(!t){let{locale:e,isOversea:i,passport:s}=(0,n.G_)(["locale","isOversea","passport"]);t=Object.fromEntries(Object.entries(t=Object.assign({locale:e?e.replace("_","-"):void 0,isOversea:i,appId:12},s)).filter(([e,t])=>void 0!==t))}if(!t.origin){let e=await (0,a.KI)(a.bm.API);t.origin=`//${e}`}(0,r.default)(t)}function c(){return(0,s.default)().then(e=>{let{user:t}=e;return{userId:t.id,tenantId:t.tenant.id,...t}})}async function d(){return await o(),c()}async function l(e){let{baseUrl:t,requestId:i,appId:s=12,...r}=e,n=s;return[161471,161472].includes(s)&&(n=12),await o({...r,appId:n,origin:t}),c()}},627044:function(e,t,i){let s,r;i.d(t,{Gw:()=>P,z2:()=>_,rA:()=>k});var n=i(78562),a=i(47324),o=i(88469),c=i.n(o),d=i(484949),l=i(504840),h=i(57426),u=i(349165),p=i(385945);let g={bizDomainConfig:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=u.s0l[s];r&&(t[r]=i),t[e]=i}),t},larkDomainsV3:e=>{let t={};return Object.entries(e).forEach(([e,i])=>{let s=e.toUpperCase(),r=u.s0l[s];r&&(t[r]=Object.keys(i.domains))}),t}};class f{settings;domains={};constructor(e){this.settings=e}getDomain(e){let t=this.getDomains(e);return t&&t[0]||""}getDomains(e){let t=this.domains[e];return t||[]}getDomainAsync(e){return this.getDomainsAsync(e).then(()=>this.getDomain(e))}getDomainsAsync(e){return this.getDomainsFromSettingsAsync().then(()=>this.getDomains(e))}getDomainsFromSettingsAsync(){return this.settings.getSettingsAsync().then(e=>{if(e&&e.lark_domains_v3){let t=g.larkDomainsV3(e.lark_domains_v3);(0,p.v)(this.domains,t)}if(e&&e.biz_domain_config){let t=g.bizDomainConfig(e.biz_domain_config);(0,p.v)(this.domains,t)}})}}class m{settings;features={};values={};constructor(e){this.settings=e}isFeatureEnabled(e){return this.features[e]}isFeatureEnabledAsync(e){return this.getFeaturesFromSettingsAsync().then(()=>this.isFeatureEnabled(e))}getFeaturesFromSettingsAsync(){return this.settings.getSettingsAsync().then(e=>{if(e&&e.lark_features){let{features:t,values:i}=function(e){if(!e)return{features:{},values:{}};let t={};return Array.isArray(e.online)&&(t=e.online.reduce((e,t)=>(e[t]=!0,e),{})),{features:t,values:e.values}}(e.lark_features);(0,p.v)(this.features,t),(0,p.v)(this.values,i)}})}}let y="SETTINGS_UPDATE";async function w(e,t,i=3,s=1e3){try{return await function(e,t,i){let{appId:s,baseUrl:r,locale:a,appVersion:o,channel:c,meta:l,userBrand:u,userUnit:g}=e,f=(0,p.Y)({version:o,app_id:s,app:"lark",platform:"web",action:"startup",locale:a||n.go.ZhCn,app_channel:c,user_brand:u,user_unit:g});l&&["user_etag","data_etag","version_code"].forEach(e=>{Object.prototype.hasOwnProperty.call(l,e)&&(f[e]=l[e])});let m=`${r}/settings/v3/`,y=t.startSpan("wcore-settings.request",{data:{url:m,params:f,remainTimes:i}});return(0,d.a)({url:m,method:"GET",data:f,headers:{"X-LS-Caller-Type":"web-core"}}).then(e=>e.json()).then(e=>{if(e?.data){if(!e?.meta?.complete&&i>0)throw Error("settings data is not complete");return y.endSpan(),e}throw Error("no data returned from server")}).catch(e=>{throw y.endSpan({status:h.yP.INTERNAL,message:e.message,stack:e.stack}),e})}(e,t,i)}catch(r){if(i<=0)throw t.error(r),t.error("fetch settings with retry failed!"),r;return await new Promise(e=>{setTimeout(()=>e(),s)}),w(e,t,i-1,2*s)}}function S(){return Error("\u8BF7\u5148\u8C03\u7528 init \u65B9\u6CD5\u521D\u59CB\u5316")}class v{options;meta;data;updateTimer;fetchPromise;getCachePromise;emitter=new a.EventEmitter;storage;inited=!1;cacheId="";domains;featureGatings;async _init(e,t){if(this.isInitialized())return;this.inited=!0,this.options=e,this.domains=new f(this),this.featureGatings=new m(this),this.storage=(0,l.B)(`lark_web_core_${e.appId||"default"}`,"settingsV3");let i=(t||h.ZP).startSpan("wcore-settings.init");if(e.userId&&e.tenantId){this.cacheId=e.userId+e.tenantId,this.getCachePromise=this.getSettingsFromCache(i).finally(()=>{this.getCachePromise=void 0});let t=await this.getCachePromise;if(t){this.updateData(t),this.domains.getDomainsFromSettingsAsync(),this.featureGatings.getFeaturesFromSettingsAsync(),this.setUpdateTimer(i);return}}await this._tryFetchData(i).finally(()=>{this.setUpdateTimer(i)}),this.domains.getDomainsFromSettingsAsync(),this.featureGatings.getFeaturesFromSettingsAsync()}_initPromise;async init(e,t){return this._initPromise||(this._initPromise=this._init(e,t)),this._initPromise}getSettingsAsync(e){if(this.data)return Promise.resolve(this.data);if(this.fetchPromise)return this.fetchPromise.then(e=>e.data);if(this.getCachePromise)return this.getCachePromise.then(e=>e?e.data:{});if(this.options){let t=(e||h.ZP).startSpan("wcore-settings.getSettingsAsync");return w(this.options,t)}throw S()}getSettings(){if(!this.data)throw Error("settings \u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u4F7F\u7528 getSettings \u6216\u8005\u63D0\u524D\u8C03\u7528 init \u65B9\u6CD5\u521D\u59CB\u5316");return this.data}onChange(e){return this.emitter.addListener(y,e),()=>{this.emitter.removeListener(y,e)}}isInitialized(){return this.inited&&(!!this.data||!!this.fetchPromise||!!this.getCachePromise)}async _tryFetchData(e){if(!this.fetchPromise){if(!this.options)throw S();this.fetchPromise=this.fetchData(this.options,e),this.fetchPromise.finally(()=>{this.fetchPromise=void 0})}await this.fetchPromise}async fetchData(e,t){e.meta=e.meta||this.meta;let i=await w(e,t);return this.updateData(i,e&&e.meta&&Object.prototype.hasOwnProperty.call(e.meta,"user_etag")),{data:this.data,meta:this.meta}}getSettingsFromCache(e){return this.cacheId?this.storage.getItem(this.cacheId).then(t=>t||void e.warn("no cached data")).catch(t=>{e.error(t),e.error("get cached settings faile!")}):Promise.resolve(void 0)}setUpdateTimer(e){this.updateTimer&&(clearTimeout(this.updateTimer),this.updateTimer=null);let t=this.meta&&this.meta.ttl,i=t?1e3*t:6e4;this.updateTimer=(window||self).setTimeout(async()=>{this.updateTimer=null,this._tryFetchData(e)},i),e.debug(`setting v3: next fetch scheduled, timeout: ${i}`)}updateData(e,t=!1){e&&(e.data&&(this.data=t?c()(this.data||{},e.data):e.data,this.domains.getDomainsFromSettingsAsync(),this.featureGatings.getFeaturesFromSettingsAsync(),this.emitter.emit(y,this.data)),e.meta&&(this.meta=e.meta),this.cacheId&&this.storage.setItem(this.cacheId,{meta:this.meta,data:this.data}))}}async function b(){if(!s)return r||(r=E().catch(e=>{throw r=void 0,e})),r}async function E(){let{domains:e,...t}=(0,n.G_)(["locale","appId","domains","appVersion","channel","userBrand","userUnit"]),i=(e||{})[1],r=i?i[0]:"";if(!r)throw"APINotProvided";let a=new v;await a.init({...t,baseUrl:`https://${r}`}),s=a}async function P(){return await b(),s&&s.getSettingsAsync()}async function k(){return await b(),s}function _(e){if(!s){let t;return b().then(()=>{t=s&&s.onChange(e)}),()=>t&&t()}return s?s.onChange(e):()=>void 0}},504840:function(e,t,i){i.d(t,{B:()=>r});var s=i(480864);let r=(...e)=>new s.E9({storeName:e.join("_")})},73214:function(e,t,i){i.d(t,{FB:()=>o,XY:()=>c});var s=i(712705),r=i.n(s);async function n(e,t){let i=new TextEncoder().encode(t);return Array.from(new Uint8Array(await crypto.subtle.digest(e,i))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function a(e){return n("SHA-1",e)}function o(e){return r()(e)}async function c(e){let t=o("ee"),i=t.substring(0,6),s=t.substring(t.length-6);return await a(i+o(e.concat(s)))}},521840:function(e,t,i){i.d(t,{x:()=>s});function s(e,t,i,r="web-core"){}},385945:function(e,t,i){function s(e,t){e&&t&&Object.entries(t).forEach(([t,i])=>{void 0!==i&&(e[t]=i)})}function r(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>void 0!==t))}i.d(t,{Y:()=>r,v:()=>s})},633062:function(e,t,i){i.d(t,{X:()=>s});function s(e,t={}){let i=new URL(e);return Object.entries(t).map(([e,t])=>i.searchParams.append(e,t)),i.href}},92107:function(e,t,i){i.d(t,{V:()=>s});function s(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}}}]);